!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.vl={})}(this,function(e){"use strict";function t(e,t,n){return e.fields=t||[],e.fname=n,e}function s(e){throw Error(e)}function o(e){var t,n,r,i=[],a=null,o=0,c=e.length,u="";function f(){i.push(u+e.substring(t,n)),u="",t=n+1}for(e+="",t=n=0;n<c;++n)if("\\"===(r=e[n]))u+=e.substring(t,n),t=++n;else if(r===a)f(),a=null,o=-1;else{if(a)continue;t===o&&'"'===r?(t=n+1,a=r):t===o&&"'"===r?(t=n+1,a=r):"."!==r||o?"["===r?(t<n&&f(),o=t=n+1):"]"===r&&(o||s("Access path missing open bracket: "+e),0<o&&f(),o=0,t=n+1):t<n?f():t=n+1}return o&&s("Access path missing closing bracket: "+e),a&&s("Access path missing closing quote: "+e),t<n&&(n++,f()),i}var _=Array.isArray;function ee(e){return e===Object(e)}function g(e){return"string"==typeof e}function v(e){return _(e)?"["+e.map(v)+"]":ee(e)||g(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}var n,r,i,a,c=[];i=o(n="id"),a="return _["+i.map(v).join("][")+"];",t(Function("_",a),[n=1===i.length?i[0]:n],r||n),t(function(e){return e},c,"identity"),t(function(){return 0},c,"zero"),t(function(){return 1},c,"one"),t(function(){return!0},c,"true"),t(function(){return!1},c,"false");function u(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}function f(e){return"boolean"==typeof e}function te(e){return"number"==typeof e}function l(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}var d=function(e,t){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function p(e,t){function n(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var ne=function(){return(ne=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function re(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n}var h,m,b,y,x=Array.isArray,w=Object.keys,S=Object.prototype.hasOwnProperty,k={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},E=function(e){throw{name:"SyntaxError",message:e,at:h,text:b}},C=function(e){return e&&e!==m&&E("Expected '"+e+"' instead of '"+m+"'"),m=b.charAt(h),h+=1,m},N=function(){var e,t="";for("-"===m&&C(t="-");"0"<=m&&m<="9";)t+=m,C();if("."===m)for(t+=".";C()&&"0"<=m&&m<="9";)t+=m;if("e"===m||"E"===m)for(t+=m,C(),"-"!==m&&"+"!==m||(t+=m,C());"0"<=m&&m<="9";)t+=m,C();if(e=+t,isFinite(e))return e;E("Bad number")},A=function(){var e,t,n,r="";if('"'===m)for(;C();){if('"'===m)return C(),r;if("\\"===m)if(C(),"u"===m){for(t=n=0;t<4&&(e=parseInt(C(),16),isFinite(e));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else{if("string"!=typeof k[m])break;r+=k[m]}else r+=m}E("Bad string")},T=function(){for(;m&&m<=" ";)C()};y=function(){switch(T(),m){case"{":return function(){var e,t={};if("{"===m){if(C("{"),T(),"}"===m)return C("}"),t;for(;m;){if(e=A(),T(),C(":"),Object.hasOwnProperty.call(t,e)&&E('Duplicate key "'+e+'"'),t[e]=y(),T(),"}"===m)return C("}"),t;C(","),T()}}E("Bad object")}();case"[":return function(){var e=[];if("["===m){if(C("["),T(),"]"===m)return C("]"),e;for(;m;){if(e.push(y()),T(),"]"===m)return C("]"),e;C(","),T()}}E("Bad array")}();case'"':return A();case"-":return N();default:return"0"<=m&&m<="9"?N():function(){switch(m){case"t":return C("t"),C("r"),C("u"),C("e"),!0;case"f":return C("f"),C("a"),C("l"),C("s"),C("e"),!1;case"n":return C("n"),C("u"),C("l"),C("l"),null}E("Unexpected '"+m+"'")}()}};var O,D,M,F=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,z={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function I(e){return F.lastIndex=0,F.test(e)?'"'+e.replace(F,function(e){var t=z[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}var U="undefined"!=typeof JSON?JSON:{parse:function(e,o){var t;return b=e,h=0,m=" ",t=y(),T(),m&&E("Syntax error"),"function"==typeof o?function e(t,n){var r,i,a=t[n];if(a&&"object"==typeof a)for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(void 0!==(i=e(a,r))?a[r]=i:delete a[r]);return o.call(t,n,a)}({"":t},""):t},stringify:function(e,t,n){var r;if(D=O="","number"==typeof n)for(r=0;r<n;r+=1)D+=" ";else"string"==typeof n&&(D=n);if((M=t)&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return function e(t,n){var r,i,a,o,c,u=O,f=n[t];switch(f&&"object"==typeof f&&"function"==typeof f.toJSON&&(f=f.toJSON(t)),"function"==typeof M&&(f=M.call(n,t,f)),typeof f){case"string":return I(f);case"number":return isFinite(f)?String(f):"null";case"boolean":case"null":return String(f);case"object":if(!f)return"null";if(O+=D,c=[],"[object Array]"===Object.prototype.toString.apply(f)){for(o=f.length,r=0;r<o;r+=1)c[r]=e(r,f)||"null";return a=0===c.length?"[]":O?"[\n"+O+c.join(",\n"+O)+"\n"+u+"]":"["+c.join(",")+"]",O=u,a}if(M&&"object"==typeof M)for(o=M.length,r=0;r<o;r+=1)"string"==typeof(i=M[r])&&(a=e(i,f))&&c.push(I(i)+(O?": ":":")+a);else for(i in f)Object.prototype.hasOwnProperty.call(f,i)&&(a=e(i,f))&&c.push(I(i)+(O?": ":":")+a);return a=0===c.length?"{}":O?"{\n"+O+c.join(",\n"+O)+"\n"+u+"}":"{"+c.join(",")+"}",O=u,a}}("",{"":e})}},R=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var h=t.space||"";"number"==typeof h&&(h=Array(h+1).join(" "));var a,p="boolean"==typeof t.cycles&&t.cycles,g=t.replacer||function(e,t){return t},m=t.cmp&&(a=t.cmp,function(i){return function(e,t){var n={key:e,value:i[e]},r={key:t,value:i[t]};return a(n,r)}}),v=[];return function e(t,n,r,i){var a=h?"\n"+new Array(i+1).join(h):"",o=h?": ":":";if(r&&r.toJSON&&"function"==typeof r.toJSON&&(r=r.toJSON()),void 0!==(r=g.call(t,n,r))){if("object"!=typeof r||null===r)return U.stringify(r);if(L(r)){for(var c=[],u=0;u<r.length;u++){var f=e(r,u,r[u],i+1)||U.stringify(null);c.push(a+h+f)}return"["+c.join(",")+a+"]"}if(-1!==v.indexOf(r)){if(p)return U.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}v.push(r);var s=j(r).sort(m&&m(r));for(c=[],u=0;u<s.length;u++){var l=e(r,n=s[u],r[n],i+1);if(l){var d=U.stringify(n)+o+l;c.push(a+h+d)}}return v.splice(v.indexOf(r),1),"{"+c.join(",")+a+"}"}}({"":e},"",e,0)},L=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},j=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var r in e)t.call(e,r)&&n.push(r);return n};function P(e){return!!e.or}function q(e){return!!e.and}function H(e){return!!e.not}var W=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){var r,i,a,o=x(t),c=x(n);if(o&&c){if((i=t.length)!=n.length)return!1;for(r=i;0!=r--;)if(!e(t[r],n[r]))return!1;return!0}if(o!=c)return!1;var u=t instanceof Date,f=n instanceof Date;if(u!=f)return!1;if(u&&f)return t.getTime()==n.getTime();var s=t instanceof RegExp,l=n instanceof RegExp;if(s!=l)return!1;if(s&&l)return t.toString()==n.toString();var d=w(t);if((i=d.length)!==w(n).length)return!1;for(r=i;0!=r--;)if(!S.call(n,d[r]))return!1;for(r=i;0!=r--;)if(!e(t[a=d[r]],n[a]))return!1;return!0}return t!=t&&n!=n};function B(e,t){for(var n={},r=0,i=t;r<i.length;r++){var a=i[r];e.hasOwnProperty(a)&&(n[a]=e[a])}return n}function Y(e,t){for(var n=ne({},e),r=0,i=t;r<i.length;r++){delete n[i[r]]}return n}var G=R;function V(e){if(te(e))return e;var t=g(e)?e:R(e);if(t.length<250)return t;for(var n=0,r=0;r<t.length;r++){n=(n<<5)-n+t.charCodeAt(r),n&=n}return n}function X(e,t){return-1<e.indexOf(t)}function Q(e,t){return e.filter(function(e){return!X(t,e)})}function J(e,t){for(var n=0,r=0;r<e.length;r++)if(t(e[r],r,n++))return!0;return!1}function K(e,t){for(var n=0,r=0;r<e.length;r++)if(!t(e[r],r,n++))return!1;return!0}function Z(e){return[].concat.apply([],e)}function $(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){e=ie(e,i[r])}return e}function ie(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||_(t[n])||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=$(_(t[n].constructor)?[]:{},t[n]):$(e[n],t[n]));return e}function ae(e,t){for(var n,r=[],i={},a=0,o=e;a<o.length;a++){var c=o[a];(n=t(c))in i||(i[n]=1,r.push(c))}return r}function oe(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1}function ce(e,t){for(var n in e)if(n in t)return!0;return!1}function ue(e){for(var t={},n=function(e){var n=o(e).map(function(e,t){return 0===t?e:"["+e+"]"});n.map(function(e,t){return n.slice(0,t+1).join("")}).forEach(function(e){return t[e]=!0})},r=0,i=se(e);r<i.length;r++){n(i[r])}return t}function fe(e,t){return ce(ue(e),ue(t))}var se=Object.keys;function le(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function de(e){return se(e)}function he(e){return JSON.parse(JSON.stringify(e))}function pe(e){return!0===e||!1===e}function ge(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function me(e,t){return H(e)?"!("+me(e.not,t)+")":q(e)?"("+e.and.map(function(e){return me(e,t)}).join(") && (")+")":P(e)?"("+e.or.map(function(e){return me(e,t)}).join(") || (")+")":t(e)}function ve(e,t){if(0===t.length)return!0;var n=t.shift();return ve(e[n],t)&&delete e[n],0===Object.keys(e).length}function be(e){return e.charAt(0).toUpperCase()+e.substr(1)}function ye(e,t){void 0===t&&(t="datum");for(var n=o(e),r=[],i=1;i<=n.length;i++){var a="["+n.slice(0,i).map(v).join("][")+"]";r.push(""+t+a)}return r.join(" && ")}function xe(e,t){return void 0===t&&(t="datum"),t+"["+v(o(e).join("."))+"]"}function we(e){return""+o(e).map(function(e){return e.replace(".","\\.")}).join("\\.")}function _e(e){return""+o(e).join(".")}function Se(e){return e?o(e).length:0}function ke(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,r=e;n<r.length;n++){var i=r[n];if(void 0!==i)return i}}var Ee=42;function Ce(e){var t=++Ee;return e?String(e)+t:t}var Ne=Object.freeze({deepEqual:W,pick:B,omit:Y,stringify:G,hash:V,contains:X,without:Q,union:function(e,t){return e.concat(Q(t,e))},some:J,every:K,flatten:Z,fill:function(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e;return n},mergeDeep:$,unique:ae,differ:oe,hasIntersection:ce,prefixGenerator:ue,fieldIntersection:fe,isNumeric:function(e){return!isNaN(e)},differArray:function(e,t){if(e.length!==t.length)return!0;e.sort(),t.sort();for(var n=0;n<e.length;n++)if(t[n]!==e[n])return!0;return!1},keys:se,vals:le,entries:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({key:n,value:e[n]});return t},flagKeys:de,duplicate:he,isBoolean:pe,varName:ge,logicalExpr:me,deleteNestedProperty:ve,titlecase:be,accessPathWithDatum:ye,flatAccessWithDatum:xe,replacePathInField:we,removePathFromField:_e,accessPathDepth:Se,getFirstDefined:ke,uniqueId:Ce}),Ae={argmax:1,argmin:1,average:1,count:1,distinct:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Te=de(Ae);function Oe(e){return!!Ae[e]}var De=["count","valid","missing","distinct"];function Me(e){return e&&X(De,e)}function Fe(e){return e&&X(["min","max"],e)}var ze=["count","sum","distinct","valid","missing"],Ie=["mean","average","median","q1","q3","min","max"],Ue=l(Ie),Re=Object.freeze({AGGREGATE_OPS:Te,isAggregateOp:Oe,COUNTING_OPS:De,isCountingAggregateOp:Me,isMinMaxOp:Fe,SUM_OPS:ze,SHARED_DOMAIN_OPS:Ie,SHARED_DOMAIN_OP_INDEX:Ue}),Le=["domain","grid","labels","ticks","title"],je={grid:"grid",gridColor:"grid",gridDash:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"main",domain:"main",domainColor:"main",domainOpacity:"main",domainWidth:"main",format:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontWeight:"main",labelLimit:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",maxExtent:"main",minExtent:"main",offset:"main",position:"main",tickColor:"main",tickExtra:"main",tickOffset:"main",tickOpacity:"main",tickRound:"main",ticks:"main",tickSize:"main",title:"main",titleAlign:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontWeight:"main",titleLimit:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",tickWidth:"both",tickCount:"both",values:"both",scale:"both",zindex:"both"},Pe={orient:1,bandPosition:1,domain:1,domainColor:1,domainOpacity:1,domainWidth:1,format:1,grid:1,gridColor:1,gridDash:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontWeight:1,labelLimit:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,maxExtent:1,minExtent:1,offset:1,position:1,tickColor:1,tickCount:1,tickExtra:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontWeight:1,titleLimit:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,values:1,zindex:1},qe=ne({},Pe,{encoding:1,labelAngle:1,tickStep:1});function He(e){return!!qe[e]}var We,Be,Ye,Ge=de(ne({gridScale:1,scale:1},Pe,{encode:1})),Ve=de(qe),Xe=Object.freeze({AXIS_PARTS:Le,AXIS_PROPERTY_TYPE:je,isAxisProperty:He,VG_AXIS_PROPERTIES:Ge,AXIS_PROPERTIES:Ve}),Qe=(We=2||0,{level:function(e){return arguments.length?(We=+e,this):We},error:function(){return 1<=We&&u("error","ERROR",arguments),this},warn:function(){return 2<=We&&u("warn","WARN",arguments),this},info:function(){return 3<=We&&u("log","INFO",arguments),this},debug:function(){return 4<=We&&u("log","DEBUG",arguments),this}}),Je=Qe;function Ke(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Je.warn.apply(Je,arguments)}(Ye=Be||(Be={})).INVALID_SPEC="Invalid spec",Ye.FIT_NON_SINGLE='Autosize "fit" only works for single views and layered views.',Ye.CANNOT_FIX_RANGE_STEP_WITH_FIT='Cannot use a fixed value of "rangeStep" when "autosize" is "fit".',Ye.cannotProjectOnChannelWithoutField=function(e){return'Cannot project a selection on encoding channel "'+e+'", which has no field.'},Ye.nearestNotSupportForContinuous=function(e){return'The "nearest" transform is not supported for '+e+" marks."},Ye.selectionNotSupported=function(e){return"Selection not supported for "+e+" yet"},Ye.selectionNotFound=function(e){return'Cannot find a selection named "'+e+'"'},Ye.SCALE_BINDINGS_CONTINUOUS="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Ye.noSuchRepeatedValue=function(e){return'Unknown repeated value "'+e+'".'},Ye.CONCAT_CANNOT_SHARE_AXIS="Axes cannot be shared in concatenated views.",Ye.REPEAT_CANNOT_SHARE_AXIS="Axes cannot be shared in repeated views.",Ye.cannotSetTitleAnchor=function(e){return'Cannot set title "anchor" for a '+e+" spec"},Ye.unrecognizedParse=function(e){return'Unrecognized parse "'+e+'".'},Ye.differentParse=function(e,t,n){return'An ancestor parsed field "'+e+'" as '+n+" but a child wants to parse the field as "+t+"."},Ye.invalidTransformIgnored=function(e){return"Ignoring an invalid transform: "+G(e)+"."},Ye.NO_FIELDS_NEEDS_AS='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.',Ye.encodingOverridden=function(e){return"Layer's shared "+e.join(",")+" channel "+(1===e.length?"is":"are")+" overriden"},Ye.projectionOverridden=function(e){var t=e.parentProjection,n=e.projection;return"Layer's shared projection "+G(t)+" is overridden by a child projection "+G(n)+"."},Ye.primitiveChannelDef=function(e,t,n){return"Channel "+e+" is a "+t+". Converted to {value: "+G(n)+"}."},Ye.invalidFieldType=function(e){return'Invalid field type "'+e+'"'},Ye.nonZeroScaleUsedWithLengthMark=function(e,t,n){return"A "+(n.scaleType?n.scaleType+" scale":n.zeroFalse?"scale with zero=false":"scale with custom domain that excludes zero")+" is used to encode "+e+"'s "+t+". This can be misleading as the "+("x"===t?"width":"height")+" of the "+e+" can be arbitrary based on the scale domain. You may want to use point mark instead."},Ye.invalidFieldTypeForCountAggregate=function(e,t){return'Invalid field type "'+e+'" for aggregate: "'+t+'", using "quantitative" instead.'},Ye.invalidAggregate=function(e){return'Invalid aggregation operator "'+e+'"'},Ye.emptyOrInvalidFieldType=function(e,t,n){return'Invalid field type "'+e+'" for channel "'+t+'", using "'+n+'" instead.'},Ye.droppingColor=function(e,t){var n=t.fill,r=t.stroke;return"Dropping color "+e+" as the plot also has "+(n&&r?"fill and stroke":n?"fill":"stroke")},Ye.emptyFieldDef=function(e,t){return"Dropping "+G(e)+' from channel "'+t+'" since it does not contain data field or value.'},Ye.latLongDeprecated=function(e,t,n){return e+"-encoding with type "+t+" is deprecated. Replacing with "+n+"-encoding."},Ye.LINE_WITH_VARYING_SIZE="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.",Ye.incompatibleChannel=function(e,t,n){return e+' dropped as it is incompatible with "'+t+'"'+(n?" when "+n:"")+"."},Ye.invalidEncodingChannel=function(e){return e+"-encoding is dropped as "+e+" is not a valid encoding channel."},Ye.facetChannelShouldBeDiscrete=function(e){return e+" encoding should be discrete (ordinal / nominal / binned)."},Ye.discreteChannelCannotEncode=function(e,t){return'Using discrete channel "'+e+'" to encode "'+t+'" field can be misleading as it does not encode '+("ordinal"===t?"order":"magnitude")+"."},Ye.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",Ye.lineWithRange=function(e,t){return"Line mark is for continuous lines and thus cannot be used with "+(e&&t?"x2 and y2":e?"x2":"y2")+". We will use the rule mark (line segments) instead."},Ye.orientOverridden=function(e,t){return'Specified orient "'+e+'" overridden with "'+t+'"'},Ye.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",Ye.cannotUseScalePropertyWithNonColor=function(e){return'Cannot use the scale property "'+e+'" with non-color channel.'},Ye.unaggregateDomainHasNoEffectForRawField=function(e){return"Using unaggregated domain with raw field has no effect ("+G(e)+")."},Ye.unaggregateDomainWithNonSharedDomainOp=function(e){return'Unaggregated domain not applicable for "'+e+'" since it produces values outside the origin domain of the source data.'},Ye.unaggregatedDomainWithLogScale=function(e){return"Unaggregated domain is currently unsupported for log scale ("+G(e)+")."},Ye.cannotApplySizeToNonOrientedMark=function(e){return'Cannot apply size to non-oriented mark "'+e+'".'},Ye.rangeStepDropped=function(e){return'rangeStep for "'+e+'" is dropped as top-level '+("x"===e?"width":"height")+" is provided."},Ye.scaleTypeNotWorkWithChannel=function(e,t,n){return'Channel "'+e+'" does not work with "'+t+'" scale. We are using "'+n+'" scale instead.'},Ye.scaleTypeNotWorkWithFieldDef=function(e,t){return'FieldDef does not work with "'+e+'" scale. We are using "'+t+'" scale instead.'},Ye.scalePropertyNotWorkWithScaleType=function(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."},Ye.scaleTypeNotWorkWithMark=function(e,t){return'Scale type "'+t+'" does not work with mark "'+e+'".'},Ye.mergeConflictingProperty=function(e,t,n,r){return"Conflicting "+t.toString()+' property "'+e.toString()+'" ('+G(n)+" and "+G(r)+").  Using "+G(n)+"."},Ye.independentScaleMeansIndependentGuide=function(e){return'Setting the scale to be independent for "'+e+'" means we also have to set the guide (axis or legend) to be independent.'},Ye.domainSortDropped=function(e){return"Dropping sort property "+G(e)+" as unioned domains only support boolean or op 'count'."},Ye.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains",Ye.MORE_THAN_ONE_SORT="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",Ye.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",Ye.cannotStackRangedMark=function(e){return'Cannot stack "'+e+'" if there is already "'+e+'2"'},Ye.cannotStackNonLinearScale=function(e){return"Cannot stack non-linear scale ("+e+")"},Ye.stackNonSummativeAggregate=function(e){return'Stacking is applied even though the aggregate function is non-summative ("'+e+'")'},Ye.invalidTimeUnit=function(e,t){return"Invalid "+e+": "+G(t)},Ye.dayReplacedWithDate=function(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+e.replace("day","date")+"."},Ye.droppedDay=function(e){return"Dropping day from datetime "+G(e)+" as day cannot be combined with other units."},Ye.errorBarCenterAndExtentAreNotNeeded=function(e,t){return(t?"extent ":"")+(t&&e?"and ":"")+(e?"center ":"")+(t&&e?"are ":"is ")+"not needed when data are aggregated."},Ye.errorBarCenterIsUsedWithWrongExtent=function(e,t,n){return e+" is not usually used with "+t+" for "+n+"."},Ye.errorBarContinuousAxisHasCustomizedAggregate=function(e,t){return"Continuous axis should not have customized aggregation function "+e+"; "+t+" already agregates the axis."},Ye.errorBarCenterIsNotNeeded=function(e,t){return"Center is not needed to be specified in "+t+" when extent is "+e+"."},Ye.errorBand1DNotSupport=function(e){return"1D error band does not support "+e},Ye.channelRequiredForBinned=function(e){return"Channel "+e+' is required for "binned" bin'},Ye.domainRequiredForThresholdScale=function(e){return"Domain for "+e+" is required for threshold scale"};var Ze=2006;function $e(e){return!!(e&&(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))}var et=["january","february","march","april","may","june","july","august","september","october","november","december"],tt=et.map(function(e){return e.substr(0,3)}),nt=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],rt=nt.map(function(e){return e.substr(0,3)});function it(e,t){void 0===t&&(t=!1);var n=[];if(t&&void 0!==e.day&&1<se(e).length&&(Ke(Be.droppedDay(e)),delete(e=he(e)).day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(Ze):n.push(0),void 0!==e.month){var r=t?function(e){if(te(e))return(e-1).toString();var t=e.toLowerCase(),n=et.indexOf(t);if(-1!==n)return n+"";var r=t.substr(0,3),i=tt.indexOf(r);if(-1!==i)return i+"";throw new Error(Be.invalidTimeUnit("month",e))}(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){var i=t?function(e){if(te(e))return 4<e&&Ke(Be.invalidTimeUnit("quarter",e)),(e-1).toString();throw new Error(Be.invalidTimeUnit("quarter",e))}(e.quarter):e.quarter;n.push(i+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var a=t?function(e){if(te(e))return e%7+"";var t=e.toLowerCase(),n=nt.indexOf(t);if(-1!==n)return n+"";var r=t.substr(0,3),i=rt.indexOf(r);if(-1!==i)return i+"";throw new Error(Be.invalidTimeUnit("day",e))}(e.day):e.day;n.push(a+"+1")}else n.push(1);for(var o=0,c=["hours","minutes","seconds","milliseconds"];o<c.length;o++){var u=c[o];void 0!==e[u]?n.push(e[u]):n.push(0)}return e.utc?"utc("+n.join(", ")+")":"datetime("+n.join(", ")+")"}var at=Object.freeze({isDateTime:$e,MONTHS:et,SHORT_MONTHS:tt,DAYS:nt,SHORT_DAYS:rt,dateTimeExpr:it});function ot(e){return!!e&&!!e.header}var ct,ut,ft=Object.freeze({isFacetFieldDef:ot});(ut=ct||(ct={})).YEAR="year",ut.MONTH="month",ut.DAY="day",ut.DATE="date",ut.HOURS="hours",ut.MINUTES="minutes",ut.SECONDS="seconds",ut.MILLISECONDS="milliseconds",ut.YEARMONTH="yearmonth",ut.YEARMONTHDATE="yearmonthdate",ut.YEARMONTHDATEHOURS="yearmonthdatehours",ut.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",ut.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",ut.MONTHDATE="monthdate",ut.HOURSMINUTES="hoursminutes",ut.HOURSMINUTESSECONDS="hoursminutesseconds",ut.MINUTESSECONDS="minutesseconds",ut.SECONDSMILLISECONDS="secondsmilliseconds",ut.QUARTER="quarter",ut.YEARQUARTER="yearquarter",ut.QUARTERMONTH="quartermonth",ut.YEARQUARTERMONTH="yearquartermonth",ut.UTCYEAR="utcyear",ut.UTCMONTH="utcmonth",ut.UTCDAY="utcday",ut.UTCDATE="utcdate",ut.UTCHOURS="utchours",ut.UTCMINUTES="utcminutes",ut.UTCSECONDS="utcseconds",ut.UTCMILLISECONDS="utcmilliseconds",ut.UTCYEARMONTH="utcyearmonth",ut.UTCYEARMONTHDATE="utcyearmonthdate",ut.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours",ut.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes",ut.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds",ut.UTCMONTHDATE="utcmonthdate",ut.UTCHOURSMINUTES="utchoursminutes",ut.UTCHOURSMINUTESSECONDS="utchoursminutesseconds",ut.UTCMINUTESSECONDS="utcminutesseconds",ut.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds",ut.UTCQUARTER="utcquarter",ut.UTCYEARQUARTER="utcyearquarter",ut.UTCQUARTERMONTH="utcquartermonth",ut.UTCYEARQUARTERMONTH="utcyearquartermonth";var st={year:1,quarter:1,month:1,day:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},lt=de(st);function dt(e){return!!st[e]}var ht={utcyear:1,utcquarter:1,utcmonth:1,utcday:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1};function pt(e){return!!ht[e]}var gt={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcquartermonth:1,utcmonthdate:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1},mt=ne({},ht,gt);function vt(e){return!!mt[e]}function bt(e){return e.substr(3)}var yt=ne({},st,ht,{yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,quartermonth:1,monthdate:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},gt),xt=de(yt);var wt={year:"setFullYear",month:"setMonth",date:"setDate",hours:"setHours",minutes:"setMinutes",seconds:"setSeconds",milliseconds:"setMilliseconds",quarter:null,day:null};function _t(e,t){var n=wt[e];return{setDateMethod:t?"setUTC"+n.substr(3):n,getDateMethod:"get"+(t?"UTC":"")+n.substr(3)}}function St(n){return lt.reduce(function(e,t){return kt(n,t)?e.concat(t):e},[])}function kt(e,t){var n=e.indexOf(t);return-1<n&&(t!==ct.SECONDS||0===n||"i"!==e.charAt(n-1))}function Et(r,e){var i=ye(e),a=vt(r)?"utc":"";return it(lt.reduce(function(e,t){var n;return kt(r,t)&&(e[t]=(n=t)===ct.QUARTER?"("+a+"quarter("+i+")-1)":""+a+n+"("+i+")"),e},{}))}function Ct(e,t){if(e){var n=[],r=kt(e,ct.YEAR);kt(e,ct.MONTH)&&n.push(!1!==t?"%b":"%B"),kt(e,ct.DAY)?n.push(t?"%a":"%A"):kt(e,ct.DATE)&&n.push("%d"+(r?",":"")),r&&n.push(t?"%y":"%Y");var i=[];kt(e,ct.HOURS)&&i.push("%H"),kt(e,ct.MINUTES)&&i.push("%M"),kt(e,ct.SECONDS)&&i.push("%S"),kt(e,ct.MILLISECONDS)&&i.push("%L");var a=[];return 0<n.length&&a.push(n.join(" ")),0<i.length&&a.push(i.join(":")),a}}function Nt(e,t,n,r){if(e){var i=Ct(e,n),a="";return kt(e,ct.QUARTER)&&(a="'Q' + quarter("+t+")"),0<i.length&&(a&&(a+=" + ' ' + "),a+=r?"utcFormat("+t+", '"+i.join(" ")+"')":"timeFormat("+t+", '"+i.join(" ")+"')"),a||void 0}}function At(e){return"day"!==e&&0<=e.indexOf("day")?(Ke(Be.dayReplacedWithDate(e)),e.replace("day","date")):e}var Tt,Ot,Dt=Object.freeze({get TimeUnit(){return ct},TIMEUNIT_PARTS:lt,isLocalSingleTimeUnit:dt,isUtcSingleTimeUnit:pt,isUTCTimeUnit:vt,getLocalTimeUnit:bt,TIMEUNITS:xt,isTimeUnit:function(e){return!!yt[e]},convert:function(e,t){for(var n=vt(e),r=n?new Date(Date.UTC(0,0,1,0,0,0,0)):new Date(0,0,1,0,0,0,0),i=0,a=lt;i<a.length;i++){var o=a[i];if(kt(e,o))switch(o){case ct.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case ct.QUARTER:var c=_t("month",n),u=c.getDateMethod;r[c.setDateMethod](3*Math.floor(t[u]()/3));break;default:var f=_t(o,n),s=f.getDateMethod;r[f.setDateMethod](t[s]())}}return r},getTimeUnitParts:St,containsTimeUnit:kt,fieldExpr:Et,getDateTimeComponents:Ct,formatExpression:Nt,normalizeTimeUnit:At});(Ot=Tt||(Tt={})).QUANTITATIVE="quantitative",Ot.ORDINAL="ordinal",Ot.TEMPORAL="temporal",Ot.NOMINAL="nominal",Ot.GEOJSON="geojson";var Mt={quantitative:1,ordinal:1,temporal:1,nominal:1,geojson:1};var Ft=Tt.QUANTITATIVE,zt=Tt.ORDINAL,It=Tt.TEMPORAL,Ut=Tt.NOMINAL,Rt=Tt.GEOJSON;function Lt(e){if(e)switch(e=e.toLowerCase()){case"q":case Ft:return"quantitative";case"t":case It:return"temporal";case"o":case zt:return"ordinal";case"n":case Ut:return"nominal";case Rt:return"geojson"}}var jt=Object.freeze({get Type(){return Tt},TYPE_INDEX:Mt,isType:function(e){return!!Mt[e]},QUANTITATIVE:Ft,ORDINAL:zt,TEMPORAL:It,NOMINAL:Ut,GEOJSON:Rt,getFullName:Lt});function Pt(e){return e.selection}function qt(e){return e&&!g(e)&&"repeat"in e}function Ht(e){var t=e.field,n=e.timeUnit,r=e.bin,i=e.aggregate;return ne({},n?{timeUnit:n}:{},r?{bin:r}:{},i?{aggregate:i}:{},{field:t})}function Wt(e){return!!e&&!!e.condition}function Bt(e){return!!e&&!!e.condition&&!_(e.condition)&&Gt(e.condition)}function Yt(e){return!!e&&!!e.condition&&(_(e.condition)||Xt(e.condition))}function Gt(e){return!(!e||!e.field&&"count"!==e.aggregate)}function Vt(e){return Gt(e)&&g(e.field)}function Xt(e){return e&&"value"in e&&void 0!==e.value}function Qt(e){return!(!e||!e.scale&&!e.sort)}function Jt(e){return!(!e||!e.axis&&!e.stack&&!e.impute)}function Kt(e){return!!e&&!!e.legend}function Zt(e){return!!e&&!!e.format}function $t(e,t){void 0===t&&(t={});var n=e.field,r=t.prefix,i=t.suffix;if(nn(e))n="count_*";else{var a=void 0;t.nofn||(e.op?a=e.op:Qr(e.bin)?(a=Xr(e.bin),i=t.binSuffix||""):e.aggregate?a=String(e.aggregate):e.timeUnit&&(a=String(e.timeUnit))),a&&(n=n?a+"_"+n:a)}return i&&(n=n+"_"+i),r&&(n=r+"_"+n),t.forAs?n:t.expr?xe(n,t.expr):we(n)}function en(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return!!e.bin;case"temporal":return!1}throw new Error(Be.invalidFieldType(e.type))}function tn(e){return!en(e)}function nn(e){return"count"===e.aggregate}function rn(e,t){var n=e.field,r=e.bin,i=e.timeUnit,a=e.aggregate;return"count"===a?t.countTitle:Qr(r)?n+" (binned)":i?n+" ("+St(i).join("-")+")":a?be(a)+" of "+n:n}function an(e,t){var n=e.aggregate||e.timeUnit||Qr(e.bin)&&"bin";return n?n.toUpperCase()+"("+e.field+")":e.field}var on=function(e,t){switch(t.fieldTitle){case"plain":return e.field;case"functional":return an(e);default:return rn(e,t)}},cn=on;function un(e){cn=e}function fn(){un(on)}function sn(e,t,n){var r=n.allowDisabling,i=(ln(e)||{}).title;return r?ke(i,e.title,dn(e,t)):i||e.title||dn(e,t)}function ln(e){return Jt(e)&&e.axis?e.axis:Kt(e)&&e.legend?e.legend:ot(e)&&e.header?e.header:void 0}function dn(e,t){return cn(e,t)}function hn(e){return Zt(e)&&e.format?e.format:(ln(e)||{}).format}function pn(e,t){if(e.timeUnit)return"temporal";if(Qr(e.bin))return"quantitative";switch(Gr(t)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}function gn(e){return Gt(e)?e:Bt(e)?e.condition:void 0}function mn(e,t){if(g(e)||te(e)||f(e)){var n=g(e)?"string":te(e)?"number":"boolean";return Ke(Be.primitiveChannelDef(t,n,e)),{value:e}}return Gt(e)?vn(e,t):Bt(e)?ne({},e,{condition:vn(e.condition,t)}):e}function vn(e,t){if(e.aggregate&&!Oe(e.aggregate)){e.aggregate;var n=re(e,["aggregate"]);Ke(Be.invalidAggregate(e.aggregate)),e=n}if(e.timeUnit&&(e=ne({},e,{timeUnit:At(e.timeUnit)})),Qr(e.bin)&&(e=ne({},e,{bin:bn(e.bin,t)})),Jr(e.bin)&&!X(Rr,t)&&Ke("Channel "+t+' should not be used with "binned" bin'),e.type){var r=Lt(e.type);e.type!==r&&(e=ne({},e,{type:r})),"quantitative"!==e.type&&Me(e.aggregate)&&(Ke(Be.invalidFieldTypeForCountAggregate(e.type,e.aggregate)),e=ne({},e,{type:"quantitative"}))}else{var i=pn(e,t);Ke(Be.emptyOrInvalidFieldType(e.type,t,i)),e=ne({},e,{type:i})}var a=xn(e,t),o=a.compatible,c=a.warning;return o||Ke(c),e}function bn(e,t){return f(e)?{maxbins:Zr(t)}:e.maxbins||e.step?e:ne({},e,{maxbins:Zr(t)})}var yn={compatible:!0};function xn(e,t){var n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:"Channel "+t+" should not be used with a geojson data."};switch(t){case"row":case"column":return tn(e)?{compatible:!1,warning:Be.facetChannelShouldBeDiscrete(t)}:yn;case"x":case"y":case"color":case"fill":case"stroke":case"text":case"detail":case"key":case"tooltip":case"href":return yn;case"longitude":case"longitude2":case"latitude":case"latitude2":return n!==Ft?{compatible:!1,warning:"Channel "+t+" should be used with a quantitative field only, not "+e.type+" field."}:yn;case"opacity":case"size":case"x2":case"y2":return"nominal"!==n||e.sort?yn:{compatible:!1,warning:"Channel "+t+" should not be used with an unsorted discrete field."};case"shape":return X(["ordinal","nominal","geojson"],e.type)?yn:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case"order":return"nominal"!==e.type||"sort"in e?yn:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}throw new Error("channelCompatability not implemented for channel "+t)}function wn(e){return"quantitative"===e.type||Qr(e.bin)}function _n(e){return"temporal"===e.type||!!e.timeUnit}function Sn(e,t){var n,r,i=t.timeUnit,a=t.type,o=t.time,c=t.undefinedIfExprNotRequired;return $e(e)?r=it(e,!0):(g(e)||te(e))&&(i||"temporal"===a)&&(r=dt(i)?it(((n={})[i]=e,n),!0):pt(i)?Sn(e,{timeUnit:bt(i)}):"datetime("+JSON.stringify(e)+")"),r?o?"time("+r+")":r:c?void 0:JSON.stringify(e)}function kn(e,t){var n=e.timeUnit,r=e.type;return t.map(function(e){var t=Sn(e,{timeUnit:n,type:r,undefinedIfExprNotRequired:!0});return void 0!==t?{signal:t}:e})}var En,Cn,Nn=Object.freeze({isConditionalSelection:Pt,isRepeatRef:qt,toFieldDefBase:Ht,isConditionalDef:Wt,hasConditionalFieldDef:Bt,hasConditionalValueDef:Yt,isFieldDef:Gt,isStringFieldDef:Vt,isValueDef:Xt,isScaleFieldDef:Qt,isPositionFieldDef:Jt,isMarkPropFieldDef:Kt,isTextFieldDef:Zt,vgField:$t,isDiscrete:en,isContinuous:tn,isCount:nn,verbalTitleFormatter:rn,functionalTitleFormatter:an,defaultTitleFormatter:on,setTitleFormatter:un,resetTitleFormatter:fn,title:sn,getGuide:ln,defaultTitle:dn,format:hn,defaultType:pn,getFieldDef:gn,normalize:mn,normalizeFieldDef:vn,normalizeBin:bn,channelCompatibility:xn,isNumberFieldDef:wn,isTimeFieldDef:_n,valueExpr:Sn,valueArray:kn});(Cn=En||(En={})).AREA="area",Cn.BAR="bar",Cn.LINE="line",Cn.POINT="point",Cn.RECT="rect",Cn.RULE="rule",Cn.TEXT="text",Cn.TICK="tick",Cn.TRAIL="trail",Cn.CIRCLE="circle",Cn.SQUARE="square",Cn.GEOSHAPE="geoshape";var An=En.AREA,Tn=En.BAR,On=En.LINE,Dn=En.POINT,Mn=En.TEXT,Fn=En.TICK,zn=En.TRAIL,In=En.RECT,Un=En.RULE,Rn=En.GEOSHAPE,Ln=En.CIRCLE,jn=En.SQUARE,Pn={area:1,bar:1,line:1,point:1,text:1,tick:1,trail:1,rect:1,geoshape:1,rule:1,circle:1,square:1};function qn(e){return X(["line","area","trail"],e)}var Hn=de(Pn);function Wn(e){return e.type}var Bn=l(Hn);function Yn(e){return(Wn(e)?e.type:e)in Bn}var Gn,Vn,Xn=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],Qn=["fill","fillOpacity"],Jn=[].concat(Xn,Qn),Kn=["filled","color","tooltip"],Zn={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],text:["shortTimeLabels"],tick:["bandSize","thickness"]},$n={color:"#4c78a8",tooltip:{content:"encoding"}},er={binSpacing:1,continuousBandSize:5},tr={thickness:1},nr=Object.freeze({get Mark(){return En},AREA:An,BAR:Tn,LINE:On,POINT:Dn,TEXT:Mn,TICK:Fn,TRAIL:zn,RECT:In,RULE:Un,GEOSHAPE:Rn,CIRCLE:Ln,SQUARE:jn,isMark:function(e){return!!Pn[e]},isPathMark:qn,PRIMITIVE_MARKS:Hn,isMarkDef:Wn,isPrimitiveMark:Yn,STROKE_CONFIG:Xn,FILL_CONFIG:Qn,FILL_STROKE_CONFIG:Jn,VL_ONLY_MARK_CONFIG_PROPERTIES:Kn,VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX:Zn,defaultMarkConfig:$n,defaultBarConfig:er,defaultTickConfig:tr});(Vn=Gn||(Gn={})).ROW="row",Vn.COLUMN="column",Vn.X="x",Vn.Y="y",Vn.X2="x2",Vn.Y2="y2",Vn.LATITUDE="latitude",Vn.LONGITUDE="longitude",Vn.LATITUDE2="latitude2",Vn.LONGITUDE2="longitude2",Vn.COLOR="color",Vn.FILL="fill",Vn.STROKE="stroke",Vn.SHAPE="shape",Vn.SIZE="size",Vn.OPACITY="opacity",Vn.TEXT="text",Vn.ORDER="order",Vn.DETAIL="detail",Vn.KEY="key",Vn.TOOLTIP="tooltip",Vn.HREF="href";var rr=Gn.X,ir=Gn.Y,ar=Gn.X2,or=Gn.Y2,cr=Gn.LATITUDE,ur=Gn.LATITUDE2,fr=Gn.LONGITUDE,sr=Gn.LONGITUDE2,lr=Gn.ROW,dr=Gn.COLUMN,hr=Gn.SHAPE,pr=Gn.SIZE,gr=Gn.COLOR,mr=Gn.FILL,vr=Gn.STROKE,br=Gn.TEXT,yr=Gn.DETAIL,xr=Gn.KEY,wr=Gn.ORDER,_r=Gn.OPACITY,Sr=Gn.TOOLTIP,kr=Gn.HREF,Er={longitude:1,longitude2:1,latitude:1,latitude2:1},Cr=de(Er),Nr=ne({x:1,y:1,x2:1,y2:1},Er,{color:1,fill:1,stroke:1,opacity:1,size:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1});function Ar(e){return"color"===e||"fill"===e||"stroke"===e}var Tr=ne({},Nr,{row:1,column:1}),Or=de(Tr),Dr=(Tr.order,Tr.detail,de(re(Tr,["order","detail"])));function Mr(e){return!!Tr[e]}var Fr=de(Nr),zr=(Nr.x,Nr.y,Nr.x2,Nr.y2,Nr.latitude,Nr.longitude,Nr.latitude2,Nr.longitude2,re(Nr,["x","y","x2","y2","latitude","longitude","latitude2","longitude2"])),Ir=de(zr),Ur={x:1,y:1},Rr=de(Ur),Lr=re(zr,["text","tooltip","href","detail","key","order"]),jr=de(Lr);function Pr(e){return!!zr[e]}var qr=ne({},Ur,Lr),Hr=de(qr);function Wr(e){return!!qr[e]}function Br(e,t,n){if(X([Ln,Dn,jn,Fn],n)&&X([ar,or],t)){var r=e[t===ar?rr:ir];return!!(Gt(r)&&Gt(e[t])&&Jr(r.bin))}return n in Yr(t)}function Yr(e){switch(e){case gr:case mr:case vr:case yr:case xr:case Sr:case kr:case wr:case _r:case lr:case dr:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,trail:!0,area:!0,text:!0,geoshape:!0};case rr:case ir:case cr:case fr:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,trail:!0,area:!0,text:!0};case ar:case or:case ur:case sr:return{rule:!0,bar:!0,rect:!0,area:!0};case pr:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0,trail:!0};case hr:return{point:!0,geoshape:!0};case br:return{text:!0}}}function Gr(e){switch(e){case rr:case ir:case pr:case _r:case ar:case or:return"continuous";case lr:case dr:case hr:case br:case Sr:case kr:return"discrete";case gr:case mr:case vr:return"flexible";case cr:case fr:case ur:case sr:case yr:case xr:case wr:return}throw new Error("rangeType not implemented for "+e)}var Vr=Object.freeze({get Channel(){return Gn},X:rr,Y:ir,X2:ar,Y2:or,LATITUDE:cr,LATITUDE2:ur,LONGITUDE:fr,LONGITUDE2:sr,ROW:lr,COLUMN:dr,SHAPE:hr,SIZE:pr,COLOR:gr,FILL:mr,STROKE:vr,TEXT:br,DETAIL:yr,KEY:xr,ORDER:wr,OPACITY:_r,TOOLTIP:Sr,HREF:kr,GEOPOSITION_CHANNEL_INDEX:Er,GEOPOSITION_CHANNELS:Cr,isColorChannel:Ar,CHANNELS:Or,SINGLE_DEF_CHANNELS:Dr,isChannel:Mr,UNIT_CHANNELS:Fr,NONPOSITION_CHANNELS:Ir,POSITION_SCALE_CHANNELS:Rr,NONPOSITION_SCALE_CHANNELS:jr,isNonPositionScaleChannel:Pr,SCALE_CHANNELS:Hr,isScaleChannel:Wr,supportMark:Br,getSupportedMark:Yr,rangeType:Gr});function Xr(t){return f(t)?"bin":"bin"+se(t).map(function(e){return ge("_"+e+"_"+t[e])}).join("")}function Qr(e){return!0===e||Kr(e)}function Jr(e){return"binned"===e}function Kr(e){return ee(e)}function Zr(e){switch(e){case lr:case dr:case pr:case gr:case mr:case vr:case _r:case hr:return 6;default:return 10}}var $r,ei,ti=Object.freeze({binToString:Xr,isBinning:Qr,isBinned:Jr,isBinParams:Kr,autoMaxBins:Zr});(ei=$r||($r={})).LINEAR="linear",ei.BIN_LINEAR="bin-linear",ei.LOG="log",ei.POW="pow",ei.SQRT="sqrt",ei.TIME="time",ei.UTC="utc",ei.SEQUENTIAL="sequential",ei.QUANTILE="quantile",ei.QUANTIZE="quantize",ei.THRESHOLD="threshold",ei.ORDINAL="ordinal",ei.BIN_ORDINAL="bin-ordinal",ei.POINT="point",ei.BAND="band";var ni={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric","bin-linear":"bin-linear",time:"time",utc:"time",sequential:"sequential",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},ri=se(ni);function ii(e,t){var n=ni[e],r=ni[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}var ai={linear:0,log:1,pow:1,sqrt:1,time:0,utc:0,point:10,band:11,"bin-linear":0,sequential:0,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function oi(e){return ai[e]}var ci=["linear","bin-linear","log","pow","sqrt","time","utc"],ui=l(ci),fi=["quantile","quantize","threshold"],si=l(fi),li=ci.concat(["sequential","quantile","quantize","threshold"]),di=l(li),hi=["ordinal","bin-ordinal","point","band"],pi=l(hi),gi=l(["bin-linear","bin-ordinal"]);function mi(e){return e in pi}function vi(e){return e in gi}function bi(e){return e in di}function yi(e){return e in ui}function xi(e){return e in si}var wi={textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function _i(e){return e&&!!e.name}function Si(e){return e&&e.selection}var ki={type:1,domain:1,range:1,rangeStep:1,scheme:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},Ei=de(ki),Ci=de(re(ki,["type","domain","range","rangeStep","scheme"])),Ni=function(){for(var e={},t=0,n=Or;t<n.length;t++)for(var r=n[t],i=0,a=se(Mt);i<a.length;i++)for(var o=a[i],c=0,u=ri;c<u.length;c++)for(var f=u[c],s=0,l=[!1,!0];s<l.length;s++){var d=l[s],h=Mi(r,o,d);Di(r,f)&&Oi(f,o,d)&&(e[h]=e[h]||[],e[h].push(f))}return e}();function Ai(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":return X(["sequential","ordinal","bin-ordinal","quantile","quantize","threshold"],e);case"interpolate":return X(["linear","bin-linear","pow","log","sqrt","utc","time"],e);case"round":return yi(e)||"band"===e||"point"===e;case"padding":return yi(e)||X(["point","band"],e);case"paddingOuter":case"rangeStep":return X(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return yi(e)||"sequential"===e;case"nice":return yi(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"zero":return bi(e)&&!X(["log","time","utc","bin-linear","threshold","quantile"],e)}throw new Error("Invalid scale property "+t+".")}function Ti(e,t){switch(t){case"interpolate":case"scheme":return Ar(e)?void 0:Be.cannotUseScalePropertyWithNonColor(e);case"type":case"domain":case"range":case"base":case"exponent":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeStep":case"reverse":case"round":case"clamp":case"zero":return}throw new Error('Invalid scale property "'+t+'".')}function Oi(e,t,n){return X([Tt.ORDINAL,Tt.NOMINAL],t)?void 0===e||mi(e):t===Tt.TEMPORAL?X([$r.TIME,$r.UTC,$r.SEQUENTIAL,void 0],e):t!==Tt.QUANTITATIVE||X(n?[$r.BIN_LINEAR,$r.BIN_ORDINAL,$r.LINEAR]:[$r.LOG,$r.POW,$r.SQRT,$r.QUANTILE,$r.QUANTIZE,$r.THRESHOLD,$r.LINEAR,$r.SEQUENTIAL,void 0],e)}function Di(e,t){switch(e){case Gn.X:case Gn.Y:return yi(t)||X(["band","point"],t);case Gn.SIZE:case Gn.OPACITY:return yi(t)||xi(t)||X(["band","point"],t);case Gn.COLOR:case Gn.FILL:case Gn.STROKE:return"band"!==t;case Gn.SHAPE:return"ordinal"===t}return!1}function Mi(e,t,n){var r=e+"_"+t;return n?r+"_bin":r}var Fi=Object.freeze({get ScaleType(){return $r},SCALE_TYPES:ri,scaleCompatible:ii,scaleTypePrecedence:oi,CONTINUOUS_TO_CONTINUOUS_SCALES:ci,CONTINUOUS_TO_DISCRETE_SCALES:fi,CONTINUOUS_DOMAIN_SCALES:li,DISCRETE_DOMAIN_SCALES:hi,TIME_SCALE_TYPES:["time","utc"],hasDiscreteDomain:mi,isBinScale:vi,hasContinuousDomain:bi,isContinuousToContinuous:yi,isContinuousToDiscrete:xi,defaultScaleConfig:wi,isExtendedScheme:_i,isSelectionDomain:Si,SCALE_PROPERTIES:Ei,NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES:Ci,SCALE_TYPE_INDEX:Ni,scaleTypeSupportProperty:Ai,channelScalePropertyIncompatability:Ti,scaleTypeSupportDataType:Oi,channelSupportScaleType:Di,getSupportedScaleType:function(e,t,n){return Ni[Mi(e,t,n)]}});function zi(e,t,n){return Ii=t||Ri,Ui=n||Vi,Qi(e.trim()).map(Ji)}var Ii,Ui,Ri="view",Li="[",ji="]",Pi="{",qi="}",Hi=":",Wi=",",Bi="@",Yi=">",Gi=/[[\]{}]/,Vi={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function Xi(e,t,n,r,i){for(var a,o=0,c=e.length;t<c;++t){if(a=e[t],!o&&a===n)return t;i&&0<=i.indexOf(a)?--o:r&&0<=r.indexOf(a)&&++o}return t}function Qi(e){for(var t=[],n=0,r=e.length,i=0;i<r;)i=Xi(e,i,Wi,Li+Pi,ji+qi),t.push(e.substring(n,i).trim()),n=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function Ji(e){return"["===e[0]?function(e){var t,n,r=e.length,i=1;if((i=Xi(e,i,ji,Li,ji))===r)throw"Empty between selector: "+e;if(2!==(t=Qi(e.substring(1,i))).length)throw"Between selector must have two elements: "+e;if((e=e.slice(i+1).trim())[0]!==Yi)throw"Expected '>' after between selector: "+e;{if(t=t.map(Ji),(n=Ji(e.slice(1).trim())).between)return{between:t,stream:n};n.between=t}return n}(e):function(t){var e,n,r={source:Ii},i=[],a=[0,0],o=0,c=0,u=t.length,f=0;if(t[u-1]===qi){if(!(0<=(f=t.lastIndexOf(Pi))))throw"Unmatched right brace: "+t;try{a=function(n){var e=n.split(Wi);if(!n.length||2<e.length)throw n;return e.map(function(e){var t=+e;if(t!=t)throw n;return t})}(t.substring(f+1,u-1))}catch(e){throw"Invalid throttle specification: "+t}t=t.slice(0,f).trim(),u=t.length,f=0}if(!u)throw t;t[0]===Bi&&(o=++f);(e=Xi(t,f,Hi))<u&&(i.push(t.substring(c,e).trim()),c=f=++e);if((f=Xi(t,f,Li))===u)i.push(t.substring(c,u).trim());else if(i.push(t.substring(c,f).trim()),n=[],(c=++f)===u)throw"Unmatched left bracket: "+t;for(;f<u;){if((f=Xi(t,f,ji))===u)throw"Unmatched left bracket: "+t;if(n.push(t.substring(c,f).trim()),f<u-1&&t[++f]!==Li)throw"Expected left bracket: "+t;c=++f}if(!(u=i.length)||Gi.test(i[u-1]))throw"Invalid event selector: "+t;1<u?(r.type=i[1],o?r.markname=i[0].slice(1):(s=i[0],Ui.hasOwnProperty(s)?r.marktype=i[0]:r.source=i[0])):r.type=i[0];var s;"!"===r.type.slice(-1)&&(r.consume=!0,r.type=r.type.slice(0,-1));null!=n&&(r.filter=n);a[0]&&(r.throttle=a[0]);a[1]&&(r.debounce=a[1]);return r}(e)}var Ki="_vgsid_",Zi={single:{on:"click",fields:[Ki],resolve:"global",empty:"all"},multi:{on:"click",fields:[Ki],toggle:"event.shiftKey",resolve:"global",empty:"all"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global"}},$i={zero:1,center:1,normalize:1};function ea(e){return!!$i[e]}var ta=[Tn,An,Un,Dn,Ln,jn,On,Mn,Fn],na=[Tn,An];function ra(e,t,n){var r=Wn(e)?e.type:e;if(!X(ta,r))return null;var i=function(e){var t=e.x,n=e.y;if(Gt(t)&&Gt(n))if("quantitative"===t.type&&"quantitative"===n.type){if(t.stack)return"x";if(n.stack)return"y";if(!!t.aggregate!=!!n.aggregate)return t.aggregate?"x":"y"}else{if("quantitative"===t.type)return"x";if("quantitative"===n.type)return"y"}else{if(Gt(t)&&"quantitative"===t.type)return"x";if(Gt(n)&&"quantitative"===n.type)return"y"}}(t);if(!i)return null;var a,o=t[i],c=Vt(o)?$t(o,{}):void 0,u="x"===i?"y":"x",f=t[u],s=Vt(f)?$t(f,{}):void 0,l=Ir.reduce(function(r,i){if(Om(t,i)){var e=t[i];(_(e)?e:[e]).forEach(function(e){var t=gn(e);if(!t.aggregate){var n=Vt(t)?$t(t,{}):void 0;(!n||n!==s&&n!==c)&&r.push({channel:i,fieldDef:t})}})}return r},[]);return 0===l.length?null:(a=void 0!==o.stack?o.stack:X(na,r)?ke(n,"zero"):n)&&ea(a)?(o.scale&&o.scale.type&&o.scale.type!==$r.LINEAR&&Ke(Be.cannotStackNonLinearScale(o.scale.type)),Om(t,i===rr?ar:or)?(void 0!==o.stack&&Ke(Be.cannotStackRangedMark(i)),null):(o.aggregate&&!X(ze,o.aggregate)&&Ke(Be.stackNonSummativeAggregate(o.aggregate)),{groupbyChannel:f?u:void 0,fieldChannel:i,impute:qn(r),stackBy:l,offset:a})):null}var ia=Object.freeze({isStackOffset:ea,STACKABLE_MARKS:ta,STACK_BY_DEFAULT_MARKS:na,stack:ra});function aa(e,t){return oa(e,t)}function oa(e,t){if(la(e))return r=t,i=(n=e).spec,a=re(n,["spec"]),ne({},a,{spec:oa(i,r)});var n,r,i,a,o,c,u,f,s,l,d,h,p,g,m,v,b,y,x,w,_,S,k,E,C,N,A,T;if(ha(e))return function t(e,n,r,i){var a=e.layer,o=e.encoding,c=e.projection,u=re(e,["layer","encoding","projection"]);var f=ca({parentEncoding:r,encoding:o});var s=ua({parentProjection:i,projection:c});return ne({},u,{layer:a.map(function(e){return ha(e)?t(e,n,f,s):fa(e,n,f,s)})})}(e,t);if(pa(e))return c=t,u=(o=e).spec,f=re(o,["spec"]),ne({},f,{spec:oa(u,c)});if(ma(e))return l=t,d=(s=e).vconcat,h=re(s,["vconcat"]),ne({},h,{vconcat:d.map(function(e){return oa(e,l)})});if(va(e))return g=t,m=(p=e).hconcat,v=re(p,["hconcat"]),ne({},v,{hconcat:m.map(function(e){return oa(e,g)})});if(da(e)){var O=Om(e.encoding,lr),D=Om(e.encoding,dr);return O||D?(y=t,x=(b=e).encoding,w=x.row,_=x.column,S=re(x,["row","column"]),k=b.mark,E=b.width,C=b.projection,N=b.height,A=b.selection,b.encoding,T=re(b,["mark","width","projection","height","selection","encoding"]),ne({},T,{facet:ne({},w?{row:w}:{},_?{column:_}:{}),spec:fa(ne({},C?{projection:C}:{},{mark:k},E?{width:E}:{},N?{height:N}:{},{encoding:S},A?{selection:A}:{}),y)})):fa(e,t)}throw new Error(Be.INVALID_SPEC)}function ca(e){var t=e.parentEncoding,n=e.encoding;if(t&&n){var r=se(t).reduce(function(e,t){return n[t]&&e.push(t),e},[]);0<r.length&&Ke(Be.encodingOverridden(r))}var i=ne({},t||{},n||{});return 0<se(i).length?i:void 0}function ua(e){var t=e.parentProjection,n=e.projection;return t&&n&&Ke(Be.projectionOverridden({parentProjection:t,projection:n})),n||t}function fa(e,t,n,r){var i=e.encoding,a=e.projection,o=Wn(e.mark)?e.mark.type:e.mark;if(n||r){var c=ua({parentProjection:r,projection:a}),u=ca({parentEncoding:n,encoding:i});return fa(ne({},e,c?{projection:c}:{},u?{encoding:u}:{}),t)}return Yn(e.mark)?zm(i)?function(e){var t=Om(e.encoding,rr),n=Om(e.encoding,ir),r=Om(e.encoding,ar),i=Om(e.encoding,or);if(r&&!t||i&&!n){var a=he(e);return r&&!t&&(a.encoding.x=a.encoding.x2,delete a.encoding.x2),i&&!n&&(a.encoding.y=a.encoding.y2,delete a.encoding.y2),a}return e}(e):"line"===o&&(i.x2||i.y2)?(Ke(Be.lineWithRange(!!i.x2,!!i.y2)),fa(ne({mark:"rule"},e),t,n,r)):qn(o)?function(e,t){void 0===t&&(t={});var n,r=e.selection,i=e.projection,a=e.encoding,o=e.mark,c=re(e,["selection","projection","encoding","mark"]),u=Wn(o)?o:{type:o},f=(h=u,p=t[u.type],g=a,"transparent"===h.point?{opacity:0}:h.point?ee(h.point)?h.point:{}:void 0!==h.point?null:p.point||g.shape?ee(p.point)?p.point:{}:null),s="area"===u.type&&(l=u,d=t[u.type],l.line?!0===l.line?{}:l.line:void 0!==l.line?null:d.line?!0===d.line?{}:d.line:null);var l,d;var h,p,g;if(!f&&!s)return ne({},e,{mark:sa(u)});var m=[ne({},r?{selection:r}:{},{mark:sa(ne({},u,"area"===u.type?{opacity:.7}:{})),encoding:Y(a,["shape"])})],v=ra(u,a,t?t.stack:void 0),b=a;if(v){var y=v.fieldChannel,x=v.offset;b=ne({},a,((n={})[y]=ne({},a[y],x?{stack:x}:{}),n))}s&&m.push(ne({},i?{projection:i}:{},{mark:ne({type:"line"},B(u,["clip","interpolate","tension"]),s),encoding:b}));f&&m.push(ne({},i?{projection:i}:{},{mark:ne({type:"point",opacity:1,filled:!0},B(u,["clip"]),f),encoding:b}));return ne({},c,{layer:m})}(e,t):e:rv(e,t)}function sa(e){e.point,e.line;var t=re(e,["point","line"]);return 1<se(t).length?t:t.type}function la(e){return void 0!==e.facet}function da(e){return!!e.mark}function ha(e){return void 0!==e.layer}function pa(e){return void 0!==e.repeat}function ga(e){return ma(e)||va(e)}function ma(e){return void 0!==e.vconcat}function va(e){return void 0!==e.hconcat}function ba(t,e){return e.forEach(function(n){var e=V(["field","type","value","timeUnit","bin","aggregate"].reduce(function(e,t){return void 0!==n[t]&&(e[t]=n[t]),e},{}));t[e]=t[e]||n}),t}function ya(e){if(la(e)||pa(e))return ya(e.spec);var t,n;if(ha(e))return t=[],e.layer.map(function(e){t=t.concat(ya(e))}),t;if(da(e))return n=[],Um(e.encoding,function(e,t){n.push(e.field)}),n;throw new Error(Be.INVALID_SPEC)}var xa=Object.freeze({isFacetSpec:la,isUnitSpec:da,isLayerSpec:ha,isRepeatSpec:pa,isConcatSpec:ga,isVConcatSpec:ma,isHConcatSpec:va,fieldDefs:function(e){return le(function t(e,n){return void 0===n&&(n={}),ha(e)?e.layer.forEach(function(e){da(e)?ba(n,Im(e.encoding)):t(e,n)}):la(e)?(ba(n,Im(e.facet)),t(e.spec,n)):pa(e)?t(e.spec,n):ga(e)?(ma(e)?e.vconcat:e.hconcat).forEach(function(e){return t(e,n)}):ba(n,Im(e.encoding)),n}(e))},isStacked:function(e,t){return t=t||e.config,!!Yn(e.mark)&&null!==ra(e.mark,e.encoding,t?t.stack:void 0)},usedFields:ya,normalize:aa});function wa(e){var t=e.anchor,n=(e.frame,e.offset),r=e.orient,i=e.color,a=re(e,["anchor","frame","offset","orient","color"]);return{mark:ne({},a,i?{fill:i}:{}),nonMark:ne({},t?{anchor:t}:{},n?{offset:n}:{},r?{orient:r}:{})}}function _a(e){return g(e)?{type:e}:e||{}}var Sa=["background","padding"];function ka(n){return Sa.reduce(function(e,t){return n&&void 0!==n[t]&&(e[t]=n[t]),e},{})}function Ea(e){return void 0!==e.filter}function Ca(e){return e&&void 0!==e.start&&void 0!==e.stop}function Na(e){return void 0!==e.lookup}function Aa(e){return void 0!==e.sample}function Ta(e){return void 0!==e.window}function Oa(e){return void 0!==e.flatten}function Da(e){return void 0!==e.calculate}function Ma(e){return!!e.bin}function Fa(e){return void 0!==e.impute}function za(e){return void 0!==e.timeUnit}function Ia(e){return void 0!==e.aggregate}function Ua(e){return void 0!==e.stack}function Ra(e){return void 0!==e.fold}function La(e){return e.map(function(e){return Ea(e)?{filter:function t(e,n){return H(e)?{not:t(e.not,n)}:q(e)?{and:e.and.map(function(e){return t(e,n)})}:P(e)?{or:e.or.map(function(e){return t(e,n)})}:n(e)}(e.filter,Yg)}:e})}var ja=Object.freeze({isFilter:Ea,isImputeSequence:Ca,isLookup:Na,isSample:Aa,isWindow:Ta,isFlatten:Oa,isCalculate:Da,isBin:Ma,isImpute:Fa,isTimeUnit:za,isAggregate:Ia,isStack:Ua,isFold:Ra,normalizeTransform:La});function Pa(e){return!!e.signal}function qa(e){return!!e.step}function Ha(e){return!_(e)&&("field"in e&&"data"in e)}var Wa=de({opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeMiterLimit:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,cursor:1,href:1,tooltip:1,cornerRadius:1});function Ba(e,n,t,r){void 0===r&&(r={header:!1});var i=e.combine(),a=i.orient,o=i.scale,c=i.title,u=i.zindex,f=re(i,["orient","scale","title","zindex"]);if(se(f).forEach(function(e){var t=je[e];t&&t!==n&&"both"!==t&&delete f[e]}),"grid"===n){if(!f.grid)return;if(f.encode){var s=f.encode.grid;f.encode=ne({},s?{grid:s}:{}),0===se(f.encode).length&&delete f.encode}return ne({scale:o,orient:a},f,{domain:!1,labels:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:ke(u,0)})}if(r.header||!e.mainExtracted){if(f.encode){for(var l=0,d=Le;l<d.length;l++){var h=d[l];e.hasAxisPart(h)||delete f.encode[h]}0===se(f.encode).length&&delete f.encode}var p,g,m=(g=t,_(p=c)?p.map(function(e){return dn(e,g)}).join(", "):p);return ne({scale:o,orient:a,grid:!1},m?{title:m}:{},f,{zindex:ke(u,1)})}}var Ya={titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontWeight:"fontWeight",titleLimit:"limit",titlePadding:"offset"},Ga={labelAngle:"angle",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelLimit:"limit",labelPadding:"offset"},Va=Object.keys(Ya),Xa=Object.keys(Ga),Qa=Object.freeze({HEADER_TITLE_PROPERTIES_MAP:Ya,HEADER_LABEL_PROPERTIES_MAP:Ga,HEADER_TITLE_PROPERTIES:Va,HEADER_LABEL_PROPERTIES:Xa});function Ja(e){return!(!e||"count"!==e.op&&!e.field||!e.op)}function Ka(e){return!!e&&_(e)}var Za,$a,eo,to,no,ro=Object.freeze({isSortField:Ja,isSortArray:Ka}),io=function(){function e(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}return e.prototype.clone=function(){throw new Error("Cannot clone node")},e.prototype.hash=function(){return void 0===this._hash&&(this._hash=Ce()),this._hash},e.prototype.producedFields=function(){return{}},e.prototype.dependentFields=function(){return{}},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){(this._parent=e).addChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),e.prototype.numChildren=function(){return this._children.length},e.prototype.addChild=function(e,t){-1<this._children.indexOf(e)?console.warn("Attempt to add the same child twice."):void 0!==t?this._children.splice(t,0,e):this._children.push(e)},e.prototype.removeChild=function(e){var t=this._children.indexOf(e);return this._children.splice(t,1),t},e.prototype.remove=function(){for(var e=this._parent.removeChild(this),t=0,n=this._children;t<n.length;t++){var r=n[t];r._parent=this._parent,this._parent.addChild(r,e++)}},e.prototype.insertAsParentOf=function(e){var t=e.parent;t.removeChild(this),this.parent=t,e.parent=this},e.prototype.swapWithParent=function(){for(var e=this._parent,t=e.parent,n=0,r=this._children;n<r.length;n++){r[n].parent=e}this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this},e}(),ao=function(a){function e(e,t,n,r){var i=a.call(this,e,t)||this;return i.type=n,i.refCounts=r,i._source=i._name=t,!i.refCounts||i._name in i.refCounts||(i.refCounts[i._name]=0),i}return p(e,a),e.prototype.clone=function(){var e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e},e.prototype.getSource=function(){return this.refCounts[this._name]++,this._source},e.prototype.isRequired=function(){return!!this.refCounts[this._name]},e.prototype.setSource=function(e){this._source=e},e}(io);function oo(e){this.type=e}oo.prototype.visit=function(e){var t,n,r;if(e(this))return 1;for(n=0,r=(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case"CallExpression":var t=e.arguments.slice();return t.unshift(e.callee),t;case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this)).length;n<r;++n)if(t[n].visit(e))return 1};var co=1,uo=2,fo=3,so=4,lo=5,ho=6,po=7,go=8;(Za={})[co]="Boolean",Za[uo]="<end>",Za[fo]="Identifier",Za[so]="Keyword",Za[lo]="Null",Za[ho]="Numeric",Za[po]="Punctuator",Za[go]="String",Za[9]="RegularExpression";var mo="ArrayExpression",vo="BinaryExpression",bo="CallExpression",yo="ConditionalExpression",xo="Identifier",wo="Literal",_o="LogicalExpression",So="MemberExpression",ko="ObjectExpression",Eo="Property",Co="UnaryExpression",No="Unexpected token %0",Ao="Unexpected number",To="Unexpected string",Oo="Unexpected identifier",Do="Unexpected reserved word",Mo="Unexpected end of input",Fo="Invalid regular expression",zo="Invalid regular expression: missing /",Io="Octal literals are not allowed in strict mode.",Uo="Duplicate data property in object literal not allowed in strict mode",Ro="ILLEGAL",Lo="Disabled.",jo=new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢲऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]"),Po=new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԯԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠ-ࢲࣤ-ॣ०-९ॱ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఀ-ఃఅ-ఌఎ-ఐఒ-నప-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಁ-ಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲഁ-ഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟ෦-෯ෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤞᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧ᪰-᪽ᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶ᳸᳹ᴀ-᷵᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚝꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꧠ-ꧾꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︭︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]");function qo(e,t){if(!e)throw new Error("ASSERT: "+t)}function Ho(e){return 48<=e&&e<=57}function Wo(e){return 0<="0123456789abcdefABCDEF".indexOf(e)}function Bo(e){return 0<="01234567".indexOf(e)}function Yo(e){return 10===e||13===e||8232===e||8233===e}function Go(e){return 36===e||95===e||65<=e&&e<=90||97<=e&&e<=122||92===e||128<=e&&jo.test(String.fromCharCode(e))}function Vo(e){return 36===e||95===e||65<=e&&e<=90||97<=e&&e<=122||48<=e&&e<=57||92===e||128<=e&&Po.test(String.fromCharCode(e))}var Xo={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Qo(){for(var e,t;eo<to&&(e=$a.charCodeAt(eo),32===(t=e)||9===t||11===t||12===t||160===t||5760<=t&&0<=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)||Yo(e));)++eo}function Jo(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)eo<to&&Wo($a[eo])?(r=$a[eo++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):lc({},No,Ro);return String.fromCharCode(i)}function Ko(){var e,t,n,r;for(t=0,"}"===(e=$a[eo])&&lc({},No,Ro);eo<to&&Wo(e=$a[eo++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(1114111<t||"}"!==e)&&lc({},No,Ro),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function Zo(){var e,t;for(e=$a.charCodeAt(eo++),t=String.fromCharCode(e),92===e&&(117!==$a.charCodeAt(eo)&&lc({},No,Ro),++eo,(e=Jo("u"))&&"\\"!==e&&Go(e.charCodeAt(0))||lc({},No,Ro),t=e);eo<to&&Vo(e=$a.charCodeAt(eo));)++eo,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==$a.charCodeAt(eo)&&lc({},No,Ro),++eo,(e=Jo("u"))&&"\\"!==e&&Vo(e.charCodeAt(0))||lc({},No,Ro),t+=e);return t}function $o(){var e,t;return e=eo,{type:1===(t=92===$a.charCodeAt(eo)?Zo():function(){var e,t;for(e=eo++;eo<to;){if(92===(t=$a.charCodeAt(eo)))return eo=e,Zo();if(!Vo(t))break;++eo}return $a.slice(e,eo)}()).length?fo:Xo.hasOwnProperty(t)?so:"null"===t?lo:"true"===t||"false"===t?co:fo,value:t,start:e,end:eo}}function ec(){var e,t,n,r,i=eo,a=$a.charCodeAt(eo),o=$a[eo];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++eo,{type:po,value:String.fromCharCode(a),start:i,end:eo};default:if(61===(e=$a.charCodeAt(eo+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return eo+=2,{type:po,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:eo};case 33:case 61:return eo+=2,61===$a.charCodeAt(eo)&&++eo,{type:po,value:$a.slice(i,eo),start:i,end:eo}}}return">>>="===(r=$a.substr(eo,4))?{type:po,value:r,start:i,end:eo+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:po,value:n,start:i,end:eo+=3}:o===(t=n.substr(0,2))[1]&&0<="+-<>&|".indexOf(o)||"=>"===t?{type:po,value:t,start:i,end:eo+=2}:0<="<>=!+-*%&|^/".indexOf(o)?{type:po,value:o,start:i,end:++eo}:void lc({},No,Ro)}function tc(){var e,t,n;if(qo(Ho((n=$a[eo]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=eo,e="","."!==n){if(e=$a[eo++],n=$a[eo],"0"===e){if("x"===n||"X"===n)return++eo,function(e){for(var t="";eo<to&&Wo($a[eo]);)t+=$a[eo++];return 0===t.length&&lc({},No,Ro),Go($a.charCodeAt(eo))&&lc({},No,Ro),{type:ho,value:parseInt("0x"+t,16),start:e,end:eo}}(t);if(Bo(n))return function(e){for(var t="0"+$a[eo++];eo<to&&Bo($a[eo]);)t+=$a[eo++];return(Go($a.charCodeAt(eo))||Ho($a.charCodeAt(eo)))&&lc({},No,Ro),{type:ho,value:parseInt(t,8),octal:!0,start:e,end:eo}}(t);n&&Ho(n.charCodeAt(0))&&lc({},No,Ro)}for(;Ho($a.charCodeAt(eo));)e+=$a[eo++];n=$a[eo]}if("."===n){for(e+=$a[eo++];Ho($a.charCodeAt(eo));)e+=$a[eo++];n=$a[eo]}if("e"===n||"E"===n)if(e+=$a[eo++],"+"!==(n=$a[eo])&&"-"!==n||(e+=$a[eo++]),Ho($a.charCodeAt(eo)))for(;Ho($a.charCodeAt(eo));)e+=$a[eo++];else lc({},No,Ro);return Go($a.charCodeAt(eo))&&lc({},No,Ro),{type:ho,value:parseFloat(e),start:t,end:eo}}function nc(){var e,t,n,r;return no=null,Qo(),e=eo,t=function(){var e,t,n,r;for(qo("/"===(e=$a[eo]),"Regular expression literal must start with a slash"),t=$a[eo++],r=n=!1;eo<to;)if(t+=e=$a[eo++],"\\"===e)Yo((e=$a[eo++]).charCodeAt(0))&&lc({},zo),t+=e;else if(Yo(e.charCodeAt(0)))lc({},zo);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||lc({},zo),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(n=t="";eo<to&&Vo((e=$a[eo]).charCodeAt(0));)++eo,"\\"===e&&eo<to?lc({},No,Ro):(n+=e,t+=e);return 0<=n.search(/[^gimuy]/g)&&lc({},Fo,n),{value:n,literal:t}}(),r=function(e,t){var n=e;0<=t.indexOf("u")&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(e,t){if(parseInt(t,16)<=1114111)return"x";lc({},Fo)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:eo}}function rc(){var e;return Qo(),to<=eo?{type:uo,start:eo,end:eo}:Go(e=$a.charCodeAt(eo))?$o():40===e||41===e||59===e?ec():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(qo("'"===(e=$a[eo])||'"'===e,"String literal must starts with a quote"),t=eo,++eo;eo<to;){if((n=$a[eo++])===e){e="";break}if("\\"===n)if((n=$a[eo++])&&Yo(n.charCodeAt(0)))"\r"===n&&"\n"===$a[eo]&&++eo;else switch(n){case"u":case"x":"{"===$a[eo]?(++eo,i+=Ko()):i+=Jo(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:Bo(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),eo<to&&Bo($a[eo])&&(a=!0,r=8*r+"01234567".indexOf($a[eo++]),0<="0123".indexOf(n)&&eo<to&&Bo($a[eo])&&(r=8*r+"01234567".indexOf($a[eo++]))),i+=String.fromCharCode(r)):i+=n}else{if(Yo(n.charCodeAt(0)))break;i+=n}}return""!==e&&lc({},No,Ro),{type:go,value:i,octal:a,start:t,end:eo}}():46===e?Ho($a.charCodeAt(eo+1))?tc():ec():Ho(e)?tc():ec()}function ic(){var e;return eo=(e=no).end,no=rc(),eo=e.end,e}function ac(){var e;e=eo,no=rc(),eo=e}function oc(e,t,n){var r=new oo("||"===e||"&&"===e?_o:vo);return r.operator=e,r.left=t,r.right=n,r}function cc(e){var t=new oo(xo);return t.name=e,t}function uc(e){var t=new oo(wo);return t.value=e.value,t.raw=$a.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function fc(e,t,n){var r=new oo(So);return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function sc(e,t,n){var r=new oo(Eo);return r.key=t,r.value=n,r.kind=e,r}function lc(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,function(e,t){return qo(t<r.length,"Message reference must be in range"),r[t]});throw(n=new Error(i)).index=eo,n.description=i,n}function dc(e){e.type===uo&&lc(e,Mo),e.type===ho&&lc(e,Ao),e.type===go&&lc(e,To),e.type===fo&&lc(e,Oo),e.type===so&&lc(e,Do),lc(e,No,e.value)}function hc(e){var t=ic();t.type===po&&t.value===e||dc(t)}function pc(e){return no.type===po&&no.value===e}function gc(e){return no.type===so&&no.value===e}function mc(){var e,t,n=[];for(eo=no.start,hc("[");!pc("]");)pc(",")?(ic(),n.push(null)):(n.push(Cc()),pc("]")||hc(","));return ic(),e=n,(t=new oo(mo)).elements=e,t}function vc(){var e;return eo=no.start,(e=ic()).type===go||e.type===ho?(e.octal&&lc(e,Io),uc(e)):cc(e.value)}function bc(){var e,t,n,r,i,a,o,c=[],u={},f=String;for(eo=no.start,hc("{");!pc("}");)i=r=n=void 0,eo=no.start,t="$"+((e=(n=no).type===fo?(i=vc(),hc(":"),sc("init",i,Cc())):n.type!==uo&&n.type!==po?(r=vc(),hc(":"),sc("init",r,Cc())):void dc(n)).key.type===xo?e.key.name:f(e.key.value)),Object.prototype.hasOwnProperty.call(u,t)?lc({},Uo):u[t]=!0,c.push(e),pc("}")||hc(",");return hc("}"),a=c,(o=new oo(ko)).properties=a,o}var yc={if:1,this:1};function xc(){var e,t,n,r;if(pc("("))return hc("("),r=Nc(),hc(")"),r;if(pc("["))return mc();if(pc("{"))return bc();if(e=no.type,eo=no.start,e===fo||yc[no.value])n=cc(ic().value);else if(e===go||e===ho)no.octal&&lc(no,Io),n=uc(ic());else{if(e===so)throw new Error(Lo);e===co?((t=ic()).value="true"===t.value,n=uc(t)):e===lo?((t=ic()).value=null,n=uc(t)):pc("/")||pc("/=")?(n=uc(nc()),ac()):dc(ic())}return n}function wc(){var e=[];if(hc("("),!pc(")"))for(;eo<to&&(e.push(Cc()),!pc(")"));)hc(",");return hc(")"),e}function _c(){var e,t;return eo=no.start,e=ic(),(t=e).type!==fo&&t.type!==so&&t.type!==co&&t.type!==lo&&dc(e),cc(e.value)}function Sc(){var e=function(){var e,t,n,r,i,a;for(e=xc();;)if(pc("."))hc("."),e=fc(".",e,_c());else if(pc("("))t=wc(),r=e,i=t,a=void 0,(a=new oo(bo)).callee=r,a.arguments=i,e=a;else{if(!pc("["))break;n=void 0,hc("["),n=Nc(),hc("]"),e=fc("[",e,n)}return e}();if(no.type===po&&(pc("++")||pc("--")))throw new Error(Lo);return e}function kc(){var e,t,n,r,i;if(no.type!==po&&no.type!==so)t=Sc();else{if(pc("++")||pc("--"))throw new Error(Lo);if(pc("+")||pc("-")||pc("~")||pc("!"))e=ic(),t=kc(),n=e.value,r=t,(i=new oo(Co)).operator=n,i.argument=r,i.prefix=!0,t=i;else{if(gc("delete")||gc("void")||gc("typeof"))throw new Error(Lo);t=Sc()}}return t}function Ec(e){var t=0;if(e.type!==po&&e.type!==so)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Cc(){var e,t,n,r,i,a,o;return e=function(){var e,t,n,r,i,a,o,c,u,f;if(e=no,u=kc(),0===(i=Ec(r=no)))return u;for(r.prec=i,ic(),t=[e,no],a=[u,r,o=kc()];0<(i=Ec(no));){for(;2<a.length&&i<=a[a.length-2].prec;)o=a.pop(),c=a.pop().value,u=a.pop(),t.pop(),n=oc(c,u,o),a.push(n);(r=ic()).prec=i,a.push(r),t.push(no),n=kc(),a.push(n)}for(n=a[f=a.length-1],t.pop();1<f;)t.pop(),n=oc(a[f-1].value,a[f-2],n),f-=2;return n}(),pc("?")&&(ic(),t=Cc(),hc(":"),n=Cc(),r=e,i=t,a=n,(o=new oo(yo)).test=r,o.consequent=i,o.alternate=a,e=o),e}function Nc(){var e=Cc();if(pc(","))throw new Error(Lo);return e}function Ac(e){var t=function(e){eo=0,to=($a=e).length,no=null,ac();var t=Nc();if(no.type!==uo)throw new Error("Unexpect token after expression.");return t}(e),n={};return t.visit(function(e){"MemberExpression"===e.type&&function e(t){return"MemberExpression"===t.object.type?e(t.object):"datum"===t.object.name}(e)&&(n[function e(t){var n=[];return"Identifier"===t.type?[t.name]:"Literal"===t.type?[t.value]:("MemberExpression"===t.type&&(n=(n=n.concat(e(t.object))).concat(e(t.property))),n)}(e).slice(1).join(".")]=!0)}),n}var Tc=function(r){function c(e,t){var n=r.call(this,e)||this;return n.transform=t,n._dependentFields=Ac(n.transform.calculate),n}return p(c,r),c.prototype.clone=function(){return new c(null,he(this.transform))},c.parseAllForSortIndex=function(o,e){return e.forEachFieldDef(function(e,t){if(Qt(e)&&Ka(e.sort)){var n=e.field,r=e.timeUnit,i=e.sort,a=i.map(function(e,t){return Bg({field:n,timeUnit:r,equal:e})+" ? "+t+" : "}).join("")+i.length;o=new c(o,{calculate:a,as:Oc(e,t,{forAs:!0})})}}),o},c.prototype.producedFields=function(){var e={};return e[this.transform.as]=!0,e},c.prototype.dependentFields=function(){return this._dependentFields},c.prototype.assemble=function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}},c.prototype.hash=function(){return"Calculate "+V(this.transform)},c}(io);function Oc(e,t,n){return $t(e,ne({prefix:t,suffix:"sort_index"},n||{}))}var Dc=["row","column"],Mc=["header","footer"];function Fc(e,t){for(var n=e.component.layoutHeaders[t],r=[],i=0,a=Mc;i<a.length;i++){var o=a[i];if(n[o])for(var c=0,u=n[o];c<u.length;c++){var f=u[c];r.push(zc(e,t,o,n,f))}}return r}function zc(e,t,n,r,i){var a,o,c,u,f,s;if(i){var l=null,d=r.facetFieldDef;if(d&&i.labels){var h=d.header,p=void 0===h?{}:h,g=p.format,m=p.labelAngle,v=e.config?e.config:void 0,b=ne({},(90+(s=((s=m)%360+360)%360))%180==0?{}:s<90||270<s?{align:{value:"right"}}:135<=s&&s<225?{align:{value:"left"}}:{});l=ne({text:bm(d,g,"parent",e.config),offset:10},"row"===t?{orient:"left"}:{},{style:"guide-label"},void 0!==m?{angle:m}:{},45<=(f=((f=m)%360+360)%360)&&f<=135?{baseline:"top"}:{baseline:"middle"},Ic(v,d,Xa,Ga),0<se(b).length?{encode:{update:b}}:{})}var y=i.axes,x=y&&0<y.length;if(l||x){var w="row"===t?"height":"width";return ne({name:e.getName(t+"_"+n),type:"group",role:t+"-"+n},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:(o=d,c=t,u=o.sort,Ja(u)?{field:$t(u,{expr:"datum"}),order:u.order||"ascending"}:_(u)?{field:Oc(o,c,{expr:"datum"}),order:"ascending"}:{field:$t(o,{expr:"datum"}),order:u||"ascending"})}:{},l?{title:l}:{},i.sizeSignal?{encode:{update:(a={},a[w]=i.sizeSignal,a)}}:{},x?{axes:y}:{})}}return null}function Ic(e,t,n,r){for(var i={},a=0,o=n;a<o.length;a++){var c=o[a];e&&e.header&&e.header[c]&&(i[r[c]]=e.header[c]),t&&t.header&&t.header[c]&&(i[r[c]]=t.header[c])}return i}function Uc(e){return[].concat(Rc(e,"width"),Rc(e,"height"))}function Rc(e,t){var n="width"===t?"x":"y",r=e.component.layoutSize.get(t);if(!r||"merged"===r)return[];var i=e.getSizeSignalRef(t).signal;if("range-step"!==r)return[{name:i,value:r}];var a=e.getScaleComponent(n);if(a){var o=a.get("type"),c=a.get("range");if(mi(o)&&qa(c)){var u=e.scaleName(n);if(Gp(e.parent))if("independent"===e.parent.component.resolve.scale[n])return[Lc(u,c)];return[Lc(u,c),{name:i,update:jc(u,a,"domain('"+u+"').length")}]}}throw new Error("layout size is range step although there is no rangeStep.")}function Lc(e,t){return{name:e+"_step",value:t.step}}function jc(e,t,n){var r=t.get("type"),i=t.get("padding"),a=ke(t.get("paddingOuter"),i),o=t.get("paddingInner");return"bandspace("+n+", "+(o="band"===r?void 0!==o?o:i:1)+", "+a+") * "+e+"_step"}var Pc={},qc={clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,direction:1,fillColor:1,format:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,strokeWidth:1,symbolFillColor:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,title:1,titleAlign:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontWeight:1,titleLimit:1,titleOpacity:1,titlePadding:1,type:1,values:1,zindex:1},Hc=ne({},qc,{opacity:1,shape:1,stroke:1,fill:1,size:1,encode:1}),Wc=de(qc),Bc=de(Hc),Yc=Object.freeze({defaultLegendConfig:Pc,LEGEND_PROPERTIES:Wc,VG_LEGEND_PROPERTIES:Bc});function Gc(e,t){var n=e.scale[t],r=X(Rr,t)?"axis":"legend";return"independent"===n?("shared"===e[r][t]&&Ke(Be.independentScaleMeansIndependentGuide(t)),"independent"):e[r][t]||"shared"}var Vc=function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t={}),this.explicit=e,this.implicit=t}return e.prototype.clone=function(){return new e(he(this.explicit),he(this.implicit))},e.prototype.combine=function(){return ne({},this.explicit,this.implicit)},e.prototype.get=function(e){return ke(this.explicit[e],this.implicit[e])},e.prototype.getWithExplicit=function(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}},e.prototype.setWithExplicit=function(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)},e.prototype.set=function(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this},e.prototype.copyKeyFromSplit=function(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)},e.prototype.copyKeyFromObject=function(e,t){void 0!==t[e]&&this.set(e,t[e],!0)},e.prototype.copyAll=function(e){for(var t=0,n=se(e.combine());t<n.length;t++){var r=n[t],i=e.getWithExplicit(r);this.setWithExplicit(r,i)}},e}();function Xc(e){return{explicit:!0,value:e}}function Qc(e){return{explicit:!1,value:e}}function Jc(a){return function(e,t,n,r){var i=a(e.value,t.value);return 0<i?e:i<0?t:Kc(e,t,n,r)}}function Kc(e,t,n,r){return e.explicit&&t.explicit&&Ke(Be.mergeConflictingProperty(n,r,e.value,t.value)),e}function Zc(e,t,n,r,i){return void 0===i&&(i=Kc),void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:G(e.value)===G(t.value)?e:i(e,t,n,r)}var $c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return p(t,e),t}(Vc);function eu(e){return nu(e,function(e,t){return Math.max(e,t.value)})}function tu(e){return nu(e,function(e,t){return ke(e,t.value)})}function nu(e,t){return Yt(e)?(_(e.condition)?e.condition:[e.condition]).reduce(t,e.value):Xt(e)?e.value:void 0}var ru=Object.freeze({symbols:function(e,t,n,r,i){if("gradient"!==i.get("type")){var a=ne({},function(e,t,n){for(var r=0,i=n;r<i.length;r++){var a=i[r],o=mm(a,t.markDef,t.config);void 0!==o&&(e[a]={value:o})}return e}({},n,Jn),nm(n));switch(n.mark){case Tn:case Fn:case Mn:a.shape={value:"square"};break;case Ln:case jn:a.shape={value:n.mark}}var o=n.markDef,c=n.encoding,u=o.filled,f=eu(c.opacity)||o.opacity;if(a.fill)if("fill"===r||u&&r===gr)delete a.fill;else if(a.fill.field)i.get("symbolFillColor")?delete a.fill:(a.fill={value:"black"},a.fillOpacity={value:f||1});else if(_(a.fill)){var s=tu(c.fill||c.color)||o.fill||u&&o.color;s&&(a.fill={value:s})}if(a.stroke)if("stroke"===r||!u&&r===gr)delete a.stroke;else if(a.stroke.field)delete a.stroke;else if(_(a.stroke)){var l=ke(tu(c.stroke||c.color),o.stroke,u?o.color:void 0);l&&(a.stroke={value:l})}if(a.fill&&"transparent"!==a.fill.value&&!a.stroke&&(a.stroke={value:"transparent"}),r!==hr){var d=tu(c.shape)||o.shape;d&&(a.shape={value:d})}return r!==_r&&f&&(a.opacity={value:f}),a=ne({},a,t),0<se(a).length?a:void 0}},gradient:function(e,t,n,r,i){var a={};if("gradient"===i.get("type")){var o=eu(n.encoding.opacity)||n.markDef.opacity;o&&(a.opacity={value:o})}return a=ne({},a,t),0<se(a).length?a:void 0},labels:function(e,t,n,r,i){var a=n.legend(r),o=n.config,c={};if(_n(e)){var u=n.getScaleComponent(r).get("type")===$r.UTC,f=Sm("datum.value",e.timeUnit,a.format,o.legend.shortTimeLabels,o.timeFormat,u);t=ne({},f?{text:{signal:f}}:{},t)}return c=ne({},c,t),0<se(c).length?c:void 0}});function iu(e){var r,i;Yp(e)?e.component.legends=(i=(r=e).encoding,[gr,mr,vr,pr,hr,_r].reduce(function(e,t){var n=i[t];return!r.legend(t)||!r.getScaleComponent(t)||Gt(n)&&t===hr&&n.type===Rt||(e[t]=function(i,a){for(var o=i.fieldDef(a),e=i.legend(a),c=new $c({},function(e,t){var n;switch(t){case gr:var r=e.scaleName(gr);return e.markDef.filled?{fill:r}:{stroke:r};case mr:case vr:case pr:case hr:case _r:return(n={})[t]=e.scaleName(t),n}}(i,a)),t=0,n=Wc;t<n.length;t++){var r=n[t],u=ou(r,e,a,i);if(void 0!==u){var f=au(u,r,e,o);(f||void 0===i.config.legend[r])&&c.set(r,u,f)}}var s=e.encoding||{},l=["labels","legend","title","symbols","gradient"].reduce(function(e,t){var n=Tm(s[t]||{},i),r=ru[t]?ru[t](o,n,i,a,c):n;return void 0!==r&&0<se(r).length&&(e[t]={update:r}),e},{});return 0<se(l).length&&c.set("encode",l,!!e.encoding),c}(r,t)),e},{})):e.component.legends=function(i){for(var e=i.component,n=e.legends,a=e.resolve,t=function(t){iu(t),se(t.component.legends).forEach(function(e){a.legend[e]=Gc(i.component.resolve,e),"shared"===a.legend[e]&&(n[e]=cu(n[e],t.component.legends[e]),n[e]||(a.legend[e]="independent",delete n[e]))})},r=0,o=i.children;r<o.length;r++){var c=o[r];t(c)}return se(n).forEach(function(e){for(var t=0,n=i.children;t<n.length;t++){var r=n[t];r.component.legends[e]&&"shared"===a.legend[e]&&delete r.component.legends[e]}}),n}(e)}function au(e,t,n,r){switch(t){case"values":return!!n.values;case"title":if("title"===t&&e===r.title)return!0}return e===n[t]}function ou(e,t,n,r){var i=r.fieldDef(n);switch(e){case"format":return ym(i,t.format,r.config);case"title":return sn(i,r.config,{allowDisabling:!0})||void 0;case"labelOverlap":return ke(t.labelOverlap,function(e){if(X(["quantile","threshold","log"],e))return"greedy"}(r.getScaleComponent(n).get("type")));case"values":return function(e,t){var n=e.values;if(n)return kn(t,n)}(t,i)}return t[e]}function cu(t,r){if(!t)return r.clone();var e=t.getWithExplicit("orient"),n=r.getWithExplicit("orient");if(!e.explicit||!n.explicit||e.value===n.value){for(var i=!1,a=function(n){var e=Zc(t.getWithExplicit(n),r.getWithExplicit(n),n,"legend",function(e,t){switch(n){case"title":return Nm(e,t);case"type":return i=!0,Qc("symbol")}return Kc(e,t,n,"legend")});t.setWithExplicit(n,e)},o=0,c=Bc;o<c.length;o++){a(c[o])}return i&&(((t.implicit||{}).encode||{}).gradient&&ve(t.implicit,["encode","gradient"]),((t.explicit||{}).encode||{}).gradient&&ve(t.explicit,["encode","gradient"])),t}}function uu(e){for(var t=e.component.legends,n={},r=0,i=se(t);r<i.length;r++){var a=i[r],o=e.getScaleComponent(a),c=G(o.domains);if(n[c])for(var u=0,f=n[c];u<f.length;u++){cu(f[u],t[a])||n[c].push(t[a])}else n[c]=[t[a].clone()]}return Z(le(n)).map(function(e){return e.combine()})}function fu(e){return Qp(e)||Xp(e)||Vp(e)?(t=e).children.reduce(function(e,t){return e.concat(t.assembleProjections())},su(t)):su(e);var t}function su(r){var e=r.component.projection;if(!e||e.merged)return[];var t=e.combine(),n=t.name,i=re(t,["name"]),a={signal:"["+e.size.map(function(e){return e.signal}).join(", ")+"]"},o=e.data.reduce(function(e,t){var n=Pa(t)?t.signal:"data('"+r.lookupDataSource(t)+"')";return X(e,n)||e.push(n),e},[]);if(o.length<=0)throw new Error("Projection's fit didn't find any data sources");return[ne({name:n,size:a,fit:{signal:1<o.length?"["+o.join(", ")+"]":o[0]}},i)]}function lu(e){return!!e.url}function du(e){return!!e.values}function hu(e){return!!e.name&&!lu(e)&&!du(e)}var pu="main",gu="raw",mu=Object.freeze({isUrlData:lu,isInlineData:du,isNamedData:hu,MAIN:pu,RAW:gu}),vu=["type","clipAngle","clipExtent","center","rotate","precision","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"],bu=function(a){function e(e,t,n,r){var i=a.call(this,ne({},t),{name:e})||this;return i.specifiedProjection=t,i.size=n,i.data=r,i.merged=!1,i}return p(e,a),e}(Vc);function yu(e){Yp(e)?e.component.projection=function(t){var e=t.specifiedProjection,n=t.config;if(t.hasProjection){var r=[];return[[fr,cr],[sr,ur]].forEach(function(e){(t.channelHasField(e[0])||t.channelHasField(e[1]))&&r.push({signal:t.getName("geojson_"+r.length)})}),t.channelHasField(hr)&&t.fieldDef(hr).type===Rt&&r.push({signal:t.getName("geojson_"+r.length)}),0===r.length&&r.push(t.requestDataName(pu)),new bu(t.projectionName(!0),ne({},n.projection||{},e||{}),[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")],r)}return}(e):e.component.projection=function(e){if(0===e.children.length)return;var r,t=K(e.children,function(e){yu(e);var t=e.component.projection;if(t){if(r){var n=function(t,n){var e=K(vu,function(e){return!t.explicit.hasOwnProperty(e)&&!n.explicit.hasOwnProperty(e)||!(!t.explicit.hasOwnProperty(e)||!n.explicit.hasOwnProperty(e)||G(t.get(e))!==G(n.get(e)))});if(G(t.size)===G(n.size)){if(e)return t;if(G(t.explicit)===G({}))return n;if(G(n.explicit)===G({}))return t}return null}(r,t);return n&&(r=n),!!n}return r=t,!0}return!0});if(r&&t){var n=e.projectionName(!0),i=new bu(n,r.specifiedProjection,r.size,he(r.data));return e.children.forEach(function(e){e.component.projection&&(i.data=i.data.concat(e.component.projection.data),e.renameProjection(e.component.projection.get("name"),n),e.component.projection.merged=!0)}),i}return}(e)}var xu=function(i){function d(e,t,n){var r=i.call(this,e)||this;return r.dimensions=t,r.measures=n,r}return p(d,i),d.prototype.clone=function(){return new d(null,ne({},this.dimensions),he(this.measures))},d.makeFromEncoding=function(e,c){var t=!1;c.forEachFieldDef(function(e){e.aggregate&&(t=!0)});var u={},f={};return t?(c.forEachFieldDef(function(e,t){var n,r,i,a=e.aggregate,o=e.field;a?"count"===a?(u["*"]=u["*"]||{},u["*"].count=$t(e,{forAs:!0})):(u[o]=u[o]||{},u[o][a]=$t(e,{forAs:!0}),Wr(t)&&"unaggregated"===c.scaleDomain(t)&&(u[o].min=$t({field:o,aggregate:"min"},{forAs:!0}),u[o].max=$t({field:o,aggregate:"max"},{forAs:!0}))):(n=f,r=t,Qr((i=e).bin)?(n[$t(i,{})]=!0,n[$t(i,{binSuffix:"end"})]=!0,Am(i,r)&&(n[$t(i,{binSuffix:"range"})]=!0)):n[$t(i)]=!0)}),se(f).length+se(u).length===0?null:new d(e,f,u)):null},d.makeFromTransform=function(e,t){for(var n={},r={},i=0,a=t.aggregate;i<a.length;i++){var o=(l=a[i]).op,c=l.field,u=l.as;o&&("count"===o?(r["*"]=r["*"]||{},r["*"].count=u||$t(l,{forAs:!0})):(r[c]=r[c]||{},r[c][o]=u||$t(l,{forAs:!0})))}for(var f=0,s=t.groupby||[];f<s.length;f++){var l;n[l=s[f]]=!0}return se(n).length+se(r).length===0?null:new d(e,n,r)},d.prototype.merge=function(e){oe(this.dimensions,e.dimensions)?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Je.debug.apply(Je,arguments)}("different dimensions, cannot merge"):(!function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];for(var i in r)r.hasOwnProperty(i)&&(n in e?e[n][i]=r[i]:e[n]={op:r[i]})}}(this.measures,e.measures),e.remove())},d.prototype.addDimensions=function(e){var t=this;e.forEach(function(e){return t.dimensions[e]=!0})},d.prototype.dependentFields=function(){var t={};return se(this.dimensions).forEach(function(e){return t[e]=!0}),se(this.measures).forEach(function(e){return t[e]=!0}),t},d.prototype.producedFields=function(){for(var e={},t=0,n=se(this.measures);t<n.length;t++)for(var r=n[t],i=0,a=se(this.measures[r]);i<a.length;i++){var o=a[i];e[this.measures[r][o]||o+"_"+r]=!0}return e},d.prototype.hash=function(){return"Aggregate "+V({dimensions:this.dimensions,measures:this.measures})},d.prototype.assemble=function(){for(var e=[],t=[],n=[],r=0,i=se(this.measures);r<i.length;r++)for(var a=i[r],o=0,c=se(this.measures[a]);o<c.length;o++){var u=c[o];n.push(this.measures[a][u]),e.push(u),t.push(we(a))}return{type:"aggregate",groupby:se(this.dimensions),ops:e,fields:t,as:n}},d}(io);function wu(e,t){return e<t?-1:t<e?1:t<=e?0:NaN}1===(_u=wu).length&&(Su=_u,_u=function(e,t){return wu(Su(e),t)});var _u,Su,ku={value:function(){}};function Eu(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r)throw new Error("illegal type: "+e);r[e]=[]}return new Cu(r)}function Cu(e){this._=e}function Nu(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function Au(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=ku,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}Cu.prototype=Eu.prototype={constructor:Cu,on:function(e,t){var n,r,i=this._,a=(r=i,(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");if(0<=n&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!r.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}})),o=-1,c=a.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++o<c;)if(n=(e=a[o]).type)i[n]=Au(i[n],e.name,t);else if(null==t)for(n in i)i[n]=Au(i[n],e.name,null);return this}for(;++o<c;)if((n=(e=a[o]).type)&&(n=Nu(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Cu(e)},call:function(e,t){if(0<(n=arguments.length-2))for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(r=this._[e]).length;a<n;++a)r[a].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};var Tu="http://www.w3.org/1999/xhtml",Ou={svg:"http://www.w3.org/2000/svg",xhtml:Tu,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Du(e){var t=e+="",n=t.indexOf(":");return 0<=n&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),Ou.hasOwnProperty(t)?{space:Ou[t],local:e}:e}function Mu(e){var t=Du(e);return(t.local?function(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}:function(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===Tu&&e.documentElement.namespaceURI===Tu?e.createElement(n):e.createElementNS(t,n)}})(t)}function Fu(){}function zu(e){return null==e?Fu:function(){return this.querySelector(e)}}function Iu(){return[]}function Uu(e){return null==e?Iu:function(){return this.querySelectorAll(e)}}var Ru=function(e){return function(){return this.matches(e)}};if("undefined"!=typeof document){var Lu=document.documentElement;if(!Lu.matches){var ju=Lu.webkitMatchesSelector||Lu.msMatchesSelector||Lu.mozMatchesSelector||Lu.oMatchesSelector;Ru=function(e){return function(){return ju.call(this,e)}}}}var Pu=Ru;function qu(e){return new Array(e.length)}function Hu(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Hu.prototype={constructor:Hu,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var Wu="$";function Bu(e,t,n,r,i,a){for(var o,c=0,u=t.length,f=a.length;c<f;++c)(o=t[c])?(o.__data__=a[c],r[c]=o):n[c]=new Hu(e,a[c]);for(;c<u;++c)(o=t[c])&&(i[c]=o)}function Yu(e,t,n,r,i,a,o){var c,u,f,s={},l=t.length,d=a.length,h=new Array(l);for(c=0;c<l;++c)(u=t[c])&&(h[c]=f=Wu+o.call(u,u.__data__,c,t),f in s?i[c]=u:s[f]=u);for(c=0;c<d;++c)(u=s[f=Wu+o.call(e,a[c],c,a)])?((r[c]=u).__data__=a[c],s[f]=null):n[c]=new Hu(e,a[c]);for(c=0;c<l;++c)(u=t[c])&&s[h[c]]===u&&(i[c]=u)}function Gu(e,t){return e<t?-1:t<e?1:t<=e?0:NaN}function Vu(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Xu(e,t){return e.style.getPropertyValue(t)||Vu(e).getComputedStyle(e,null).getPropertyValue(t)}function Qu(e){return e.trim().split(/^|\s+/)}function Ju(e){return e.classList||new Ku(e)}function Ku(e){this._node=e,this._names=Qu(e.getAttribute("class")||"")}function Zu(e,t){for(var n=Ju(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function $u(e,t){for(var n=Ju(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function ef(){this.textContent=""}function tf(){this.innerHTML=""}function nf(){this.nextSibling&&this.parentNode.appendChild(this)}function rf(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function af(){return null}function of(){var e=this.parentNode;e&&e.removeChild(this)}function cf(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function uf(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}Ku.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);0<=t&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return 0<=this._names.indexOf(e)}};var ff={};"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(ff={mouseenter:"mouseover",mouseleave:"mouseout"}));function sf(n,e,t){return n=lf(n,e,t),function(e){var t=e.relatedTarget;t&&(t===this||8&t.compareDocumentPosition(this))||n.call(this,e)}}function lf(t,n,r){return function(e){try{t.call(this,this.__data__,n,r)}finally{}}}function df(a){return function(){var e=this.__on;if(e){for(var t,n=0,r=-1,i=e.length;n<i;++n)t=e[n],a.type&&t.type!==a.type||t.name!==a.name?e[++r]=t:this.removeEventListener(t.type,t.listener,t.capture);++r?e.length=r:delete this.__on}}}function hf(u,f,s){var l=ff.hasOwnProperty(u.type)?sf:lf;return function(e,t,n){var r,i=this.__on,a=l(f,t,n);if(i)for(var o=0,c=i.length;o<c;++o)if((r=i[o]).type===u.type&&r.name===u.name)return this.removeEventListener(r.type,r.listener,r.capture),this.addEventListener(r.type,r.listener=a,r.capture=s),void(r.value=f);this.addEventListener(u.type,a,s),r={type:u.type,name:u.name,value:f,listener:a,capture:s},i?i.push(r):this.__on=[r]}}function pf(e,t,n){var r=Vu(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}var gf=[null];function mf(e,t){this._groups=e,this._parents=t}function vf(){return new mf([[document.documentElement]],gf)}function bf(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function yf(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function xf(){}mf.prototype=vf.prototype={constructor:mf,select:function(e){"function"!=typeof e&&(e=zu(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o,c=t[i],u=c.length,f=r[i]=new Array(u),s=0;s<u;++s)(a=c[s])&&(o=e.call(a,a.__data__,s,c))&&("__data__"in a&&(o.__data__=a.__data__),f[s]=o);return new mf(r,this._parents)},selectAll:function(e){"function"!=typeof e&&(e=Uu(e));for(var t=this._groups,n=t.length,r=[],i=[],a=0;a<n;++a)for(var o,c=t[a],u=c.length,f=0;f<u;++f)(o=c[f])&&(r.push(e.call(o,o.__data__,f,c)),i.push(o));return new mf(r,i)},filter:function(e){"function"!=typeof e&&(e=Pu(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o=t[i],c=o.length,u=r[i]=[],f=0;f<c;++f)(a=o[f])&&e.call(a,a.__data__,f,o)&&u.push(a);return new mf(r,this._parents)},data:function(e,t){if(!e)return p=new Array(this.size()),s=-1,this.each(function(e){p[++s]=e}),p;var n,r=t?Yu:Bu,i=this._parents,a=this._groups;"function"!=typeof e&&(n=e,e=function(){return n});for(var o=a.length,c=new Array(o),u=new Array(o),f=new Array(o),s=0;s<o;++s){var l=i[s],d=a[s],h=d.length,p=e.call(l,l&&l.__data__,s,i),g=p.length,m=u[s]=new Array(g),v=c[s]=new Array(g);r(l,d,m,v,f[s]=new Array(h),p,t);for(var b,y,x=0,w=0;x<g;++x)if(b=m[x]){for(w<=x&&(w=x+1);!(y=v[w])&&++w<g;);b._next=y||null}}return(c=new mf(c,i))._enter=u,c._exit=f,c},enter:function(){return new mf(this._enter||this._groups.map(qu),this._parents)},exit:function(){return new mf(this._exit||this._groups.map(qu),this._parents)},merge:function(e){for(var t=this._groups,n=e._groups,r=t.length,i=n.length,a=Math.min(r,i),o=new Array(r),c=0;c<a;++c)for(var u,f=t[c],s=n[c],l=f.length,d=o[c]=new Array(l),h=0;h<l;++h)(u=f[h]||s[h])&&(d[h]=u);for(;c<r;++c)o[c]=t[c];return new mf(o,this._parents)},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],a=i.length-1,o=i[a];0<=--a;)(r=i[a])&&(o&&o!==r.nextSibling&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(n){function e(e,t){return e&&t?n(e.__data__,t.__data__):!e-!t}n||(n=Gu);for(var t=this._groups,r=t.length,i=new Array(r),a=0;a<r;++a){for(var o,c=t[a],u=c.length,f=i[a]=new Array(u),s=0;s<u;++s)(o=c[s])&&(f[s]=o);f.sort(e)}return new mf(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){var e=new Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null},size:function(){var e=0;return this.each(function(){++e}),e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,a=t[n],o=0,c=a.length;o<c;++o)(i=a[o])&&e.call(i,i.__data__,o,a);return this},attr:function(e,t){var n=Du(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?function(e){return function(){this.removeAttributeNS(e.space,e.local)}}:function(e){return function(){this.removeAttribute(e)}}:"function"==typeof t?n.local?function(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}}:function(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttribute(t):this.setAttribute(t,e)}}:n.local?function(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}:function(e,t){return function(){this.setAttribute(e,t)}})(n,t))},style:function(e,t,n){return 1<arguments.length?this.each((null==t?function(e){return function(){this.style.removeProperty(e)}}:"function"==typeof t?function(t,n,r){return function(){var e=n.apply(this,arguments);null==e?this.style.removeProperty(t):this.style.setProperty(t,e,r)}}:function(e,t,n){return function(){this.style.setProperty(e,t,n)}})(e,t,null==n?"":n)):Xu(this.node(),e)},property:function(e,t){return 1<arguments.length?this.each((null==t?function(e){return function(){delete this[e]}}:"function"==typeof t?function(t,n){return function(){var e=n.apply(this,arguments);null==e?delete this[t]:this[t]=e}}:function(e,t){return function(){this[e]=t}})(e,t)):this.node()[e]},classed:function(e,t){var n=Qu(e+"");if(arguments.length<2){for(var r=Ju(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?function(e,t){return function(){(t.apply(this,arguments)?Zu:$u)(this,e)}}:t?function(e){return function(){Zu(this,e)}}:function(e){return function(){$u(this,e)}})(n,t))},text:function(e){return arguments.length?this.each(null==e?ef:("function"==typeof e?function(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}:function(e){return function(){this.textContent=e}})(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?tf:("function"==typeof e?function(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}:function(e){return function(){this.innerHTML=e}})(e)):this.node().innerHTML},raise:function(){return this.each(nf)},lower:function(){return this.each(rf)},append:function(e){var t="function"==typeof e?e:Mu(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:Mu(e),r=null==t?af:"function"==typeof t?t:zu(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(of)},clone:function(e){return this.select(e?uf:cf)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,i,a=(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return 0<=n&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}),o=a.length;if(!(arguments.length<2)){for(c=t?hf:df,null==n&&(n=!1),r=0;r<o;++r)this.each(c(a[r],t,n));return this}var c=this.node().__on;if(c)for(var u,f=0,s=c.length;f<s;++f)for(r=0,u=c[f];r<o;++r)if((i=a[r]).type===u.type&&i.name===u.name)return u.value},dispatch:function(e,t){return this.each(("function"==typeof t?function(e,t){return function(){return pf(this,e,t.apply(this,arguments))}}:function(e,t){return function(){return pf(this,e,t)}})(e,t))}};var wf=1/.7,_f="\\s*([+-]?\\d+)\\s*",Sf="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",kf="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ef=/^#([0-9a-f]{3})$/,Cf=/^#([0-9a-f]{6})$/,Nf=new RegExp("^rgb\\("+[_f,_f,_f]+"\\)$"),Af=new RegExp("^rgb\\("+[kf,kf,kf]+"\\)$"),Tf=new RegExp("^rgba\\("+[_f,_f,_f,Sf]+"\\)$"),Of=new RegExp("^rgba\\("+[kf,kf,kf,Sf]+"\\)$"),Df=new RegExp("^hsl\\("+[Sf,kf,kf]+"\\)$"),Mf=new RegExp("^hsla\\("+[Sf,kf,kf,Sf]+"\\)$"),Ff={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function zf(e){var t;return e=(e+"").trim().toLowerCase(),(t=Ef.exec(e))?new jf((t=parseInt(t[1],16))>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):(t=Cf.exec(e))?If(parseInt(t[1],16)):(t=Nf.exec(e))?new jf(t[1],t[2],t[3],1):(t=Af.exec(e))?new jf(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Tf.exec(e))?Uf(t[1],t[2],t[3],t[4]):(t=Of.exec(e))?Uf(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Df.exec(e))?qf(t[1],t[2]/100,t[3]/100,1):(t=Mf.exec(e))?qf(t[1],t[2]/100,t[3]/100,t[4]):Ff.hasOwnProperty(e)?If(Ff[e]):"transparent"===e?new jf(NaN,NaN,NaN,0):null}function If(e){return new jf(e>>16&255,e>>8&255,255&e,1)}function Uf(e,t,n,r){return r<=0&&(e=t=n=NaN),new jf(e,t,n,r)}function Rf(e){return e instanceof xf||(e=zf(e)),e?new jf((e=e.rgb()).r,e.g,e.b,e.opacity):new jf}function Lf(e,t,n,r){return 1===arguments.length?Rf(e):new jf(e,t,n,null==r?1:r)}function jf(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Pf(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function qf(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||1<=n?e=t=NaN:t<=0&&(e=NaN),new Hf(e,t,n,r)}function Hf(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Wf(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}bf(xf,zf,{displayable:function(){return this.rgb().displayable()},hex:function(){return this.rgb().hex()},toString:function(){return this.rgb()+""}}),bf(jf,Lf,yf(xf,{brighter:function(e){return e=null==e?wf:Math.pow(wf,e),new jf(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new jf(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},hex:function(){return"#"+Pf(this.r)+Pf(this.g)+Pf(this.b)},toString:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}})),bf(Hf,function(e,t,n,r){return 1===arguments.length?function(e){if(e instanceof Hf)return new Hf(e.h,e.s,e.l,e.opacity);if(e instanceof xf||(e=zf(e)),!e)return new Hf;if(e instanceof Hf)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,c=a-i,u=(a+i)/2;return c?(o=t===a?(n-r)/c+6*(n<r):n===a?(r-t)/c+2:(t-n)/c+4,c/=u<.5?a+i:2-a-i,o*=60):c=0<u&&u<1?0:o,new Hf(o,c,u,e.opacity)}(e):new Hf(e,t,n,null==r?1:r)},yf(xf,{brighter:function(e){return e=null==e?wf:Math.pow(wf,e),new Hf(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new Hf(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new jf(Wf(240<=e?e-240:e+120,i,r),Wf(e,i,r),Wf(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var Bf=Math.PI/180,Yf=180/Math.PI,Gf=.96422,Vf=1,Xf=.82521,Qf=4/29,Jf=6/29,Kf=3*Jf*Jf,Zf=Jf*Jf*Jf;function $f(e){if(e instanceof es)return new es(e.l,e.a,e.b,e.opacity);if(e instanceof as){if(isNaN(e.h))return new es(e.l,0,0,e.opacity);var t=e.h*Bf;return new es(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}e instanceof jf||(e=Rf(e));var n,r,i=is(e.r),a=is(e.g),o=is(e.b),c=ts((.2225045*i+.7168786*a+.0606169*o)/Vf);return i===a&&a===o?n=r=c:(n=ts((.4360747*i+.3850649*a+.1430804*o)/Gf),r=ts((.0139322*i+.0971045*a+.7141733*o)/Xf)),new es(116*c-16,500*(n-c),200*(c-r),e.opacity)}function es(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function ts(e){return Zf<e?Math.pow(e,1/3):e/Kf+Qf}function ns(e){return Jf<e?e*e*e:Kf*(e-Qf)}function rs(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function is(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function as(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}bf(es,function(e,t,n,r){return 1===arguments.length?$f(e):new es(e,t,n,null==r?1:r)},yf(xf,{brighter:function(e){return new es(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new es(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new jf(rs(3.1338561*(t=Gf*ns(t))-1.6168667*(e=Vf*ns(e))-.4906146*(n=Xf*ns(n))),rs(-.9787684*t+1.9161415*e+.033454*n),rs(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),bf(as,function(e,t,n,r){return 1===arguments.length?function(e){if(e instanceof as)return new as(e.h,e.c,e.l,e.opacity);if(e instanceof es||(e=$f(e)),0===e.a&&0===e.b)return new as(NaN,0,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*Yf;return new as(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}(e):new as(e,t,n,null==r?1:r)},yf(xf,{brighter:function(e){return new as(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new as(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return $f(this).rgb()}}));var os=1.78277,cs=-.29227,us=-.90649,fs=1.97294,ss=fs*us,ls=fs*os,ds=os*cs- -.14861*us;function hs(e,t,n,r){return 1===arguments.length?function(e){if(e instanceof ps)return new ps(e.h,e.s,e.l,e.opacity);e instanceof jf||(e=Rf(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(ds*r+ss*t-ls*n)/(ds+ss-ls),a=r-i,o=(fs*(n-i)-cs*a)/us,c=Math.sqrt(o*o+a*a)/(fs*i*(1-i)),u=c?Math.atan2(o,a)*Yf-120:NaN;return new ps(u<0?u+360:u,c,i,e.opacity)}(e):new ps(e,t,n,null==r?1:r)}function ps(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function gs(e){return function(){return e}}function ms(t,n){return function(e){return t+e*n}}function vs(a){return 1==(a=+a)?bs:function(e,t){return t-e?(n=e,r=t,i=a,n=Math.pow(n,i),r=Math.pow(r,i)-n,i=1/i,function(e){return Math.pow(n+e*r,i)}):gs(isNaN(e)?t:e);var n,r,i}}function bs(e,t){var n=t-e;return n?ms(e,n):gs(isNaN(e)?t:e)}bf(ps,hs,yf(xf,{brighter:function(e){return e=null==e?wf:Math.pow(wf,e),new ps(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new ps(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*Bf,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new jf(255*(t+n*(-.14861*r+os*i)),255*(t+n*(cs*r+us*i)),255*(t+n*(fs*r)),this.opacity)}}));var ys=function e(t){var o=vs(t);function n(t,e){var n=o((t=Lf(t)).r,(e=Lf(e)).r),r=o(t.g,e.g),i=o(t.b,e.b),a=bs(t.opacity,e.opacity);return function(e){return t.r=n(e),t.g=r(e),t.b=i(e),t.opacity=a(e),t+""}}return n.gamma=e,n}(1);var xs,ws=(xs=function(f){var s=f.length-1;return function(e){var t,n,r,i=e<=0?e=0:1<=e?s-(e=1):Math.floor(e*s),a=f[i],o=f[i+1],c=0<i?f[i-1]:2*a-o,u=i<s-1?f[i+2]:2*o-a;return((1-3*(t=(e-i/s)*s)+3*(n=t*t)-(r=n*t))*c+(4-6*n+3*r)*a+(1+3*t+3*n-3*r)*o+r*u)/6}},function(e){var t,n,r=e.length,i=new Array(r),a=new Array(r),o=new Array(r);for(t=0;t<r;++t)n=Lf(e[t]),i[t]=n.r||0,a[t]=n.g||0,o[t]=n.b||0;return i=xs(i),a=xs(a),o=xs(o),n.opacity=1,function(e){return n.r=i(e),n.g=a(e),n.b=o(e),n+""}});function _s(t,n){return n-=t=+t,function(e){return t+n*e}}var Ss=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ks=new RegExp(Ss.source,"g");var Es,Cs,Ns,As,Ts=180/Math.PI,Os={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ds(e,t,n,r,i,a){var o,c,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(c=Math.sqrt(n*n+r*r))&&(n/=c,r/=c,u/=c),e*r<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*Ts,skewX:Math.atan(u)*Ts,scaleX:o,scaleY:c}}function Ms(d,h,p,g){function m(e){return e.length?e.pop()+" ":""}return function(e,t){var n,r,i,a,o,c,u,f,s=[],l=[];return e=d(e),t=d(t),function(e,t,n,r,i,a){if(e!==n||t!==r){var o=i.push("translate(",null,h,null,p);a.push({i:o-4,x:_s(e,n)},{i:o-2,x:_s(t,r)})}else(n||r)&&i.push("translate("+n+h+r+p)}(e.translateX,e.translateY,t.translateX,t.translateY,s,l),n=e.rotate,r=t.rotate,i=s,a=l,n!==r?(180<n-r?r+=360:180<r-n&&(n+=360),a.push({i:i.push(m(i)+"rotate(",null,g)-2,x:_s(n,r)})):r&&i.push(m(i)+"rotate("+r+g),o=e.skewX,c=t.skewX,u=s,f=l,o!==c?f.push({i:u.push(m(u)+"skewX(",null,g)-2,x:_s(o,c)}):c&&u.push(m(u)+"skewX("+c+g),function(e,t,n,r,i,a){if(e!==n||t!==r){var o=i.push(m(i)+"scale(",null,",",null,")");a.push({i:o-4,x:_s(e,n)},{i:o-2,x:_s(t,r)})}else 1===n&&1===r||i.push(m(i)+"scale("+n+","+r+")")}(e.scaleX,e.scaleY,t.scaleX,t.scaleY,s,l),e=t=null,function(e){for(var t,n=-1,r=l.length;++n<r;)s[(t=l[n]).i]=t.x(e);return s.join("")}}}var Fs=Ms(function(e){return"none"===e?Os:(Es||(Es=document.createElement("DIV"),Cs=document.documentElement,Ns=document.defaultView),Es.style.transform=e,e=Ns.getComputedStyle(Cs.appendChild(Es),null).getPropertyValue("transform"),Cs.removeChild(Es),Ds(+(e=e.slice(7,-1).split(","))[0],+e[1],+e[2],+e[3],+e[4],+e[5]))},"px, ","px)","deg)"),zs=Ms(function(e){return null==e?Os:(As||(As=document.createElementNS("http://www.w3.org/2000/svg","g")),As.setAttribute("transform",e),(e=As.transform.baseVal.consolidate())?Ds((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):Os)},", ",")",")");Math.SQRT2;function Is(c){return function e(o){function t(t,e){var n=c((t=hs(t)).h,(e=hs(e)).h),r=bs(t.s,e.s),i=bs(t.l,e.l),a=bs(t.opacity,e.opacity);return function(e){return t.h=n(e),t.s=r(e),t.l=i(Math.pow(e,o)),t.opacity=a(e),t+""}}return o=+o,t.gamma=e,t}(1)}Is(function(e,t){var n=t-e;return n?ms(e,180<n||n<-180?n-360*Math.round(n/360):n):gs(isNaN(e)?t:e)});var Us,Rs,Ls=Is(bs),js=0,Ps=0,qs=0,Hs=1e3,Ws=0,Bs=0,Ys=0,Gs="object"==typeof performance&&performance.now?performance:Date,Vs="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Xs(){return Bs||(Vs(Qs),Bs=Gs.now()+Ys)}function Qs(){Bs=0}function Js(){this._call=this._time=this._next=null}function Ks(e,t,n){var r=new Js;return r.restart(e,t,n),r}function Zs(){Bs=(Ws=Gs.now())+Ys,js=Ps=0;try{!function(){Xs(),++js;for(var e,t=Us;t;)0<=(e=Bs-t._time)&&t._call.call(null,e),t=t._next;--js}()}finally{js=0,function(){var e,t,n=Us,r=1/0;for(;n;)n=n._call?(r>n._time&&(r=n._time),(e=n)._next):(t=n._next,n._next=null,e?e._next=t:Us=t);Rs=e,el(r)}(),Bs=0}}function $s(){var e=Gs.now(),t=e-Ws;Hs<t&&(Ys-=t,Ws=e)}function el(e){js||(Ps&&(Ps=clearTimeout(Ps)),24<e-Bs?(e<1/0&&(Ps=setTimeout(Zs,e-Gs.now()-Ys)),qs&&(qs=clearInterval(qs))):(qs||(Ws=Gs.now(),qs=setInterval($s,Hs)),js=1,Vs(Zs)))}function tl(t,n,e){var r=new Js;return n=null==n?0:+n,r.restart(function(e){r.stop(),t(e+n)},n,e),r}Js.prototype=Ks.prototype={constructor:Js,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Xs():+n)+(null==t?0:+t),this._next||Rs===this||(Rs?Rs._next=this:Us=this,Rs=this),this._call=e,this._time=n,el()},stop:function(){this._call&&(this._call=null,this._time=1/0,el())}};var nl=Eu("start","end","interrupt"),rl=[],il=0,al=1,ol=2,cl=3,ul=4,fl=5,sl=6;function ll(e,t,n,r,i,a){var o=e.__transition;if(o){if(n in o)return}else e.__transition={};!function(a,o,c){var u,f=a.__transition;function s(e){var t,n,r,i;if(c.state!==al)return d();for(t in f)if((i=f[t]).name===c.name){if(i.state===cl)return tl(s);i.state===ul?(i.state=sl,i.timer.stop(),i.on.call("interrupt",a,a.__data__,i.index,i.group),delete f[t]):+t<o&&(i.state=sl,i.timer.stop(),delete f[t])}if(tl(function(){c.state===cl&&(c.state=ul,c.timer.restart(l,c.delay,c.time),l(e))}),c.state=ol,c.on.call("start",a,a.__data__,c.index,c.group),c.state===ol){for(c.state=cl,u=new Array(r=c.tween.length),t=0,n=-1;t<r;++t)(i=c.tween[t].value.call(a,a.__data__,c.index,c.group))&&(u[++n]=i);u.length=n+1}}function l(e){for(var t=e<c.duration?c.ease.call(null,e/c.duration):(c.timer.restart(d),c.state=fl,1),n=-1,r=u.length;++n<r;)u[n].call(null,t);c.state===fl&&(c.on.call("end",a,a.__data__,c.index,c.group),d())}function d(){for(var e in c.state=sl,c.timer.stop(),delete f[o],f)return;delete a.__transition}(f[o]=c).timer=Ks(function(e){c.state=al,c.timer.restart(s,c.delay,c.time),c.delay<=e&&s(e-c.delay)},0,c.time)}(e,n,{name:t,index:r,group:i,on:nl,tween:rl,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:il})}function dl(e,t){var n=pl(e,t);if(n.state>il)throw new Error("too late; already scheduled");return n}function hl(e,t){var n=pl(e,t);if(n.state>ol)throw new Error("too late; already started");return n}function pl(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function gl(e,t,n){var r=e._id;return e.each(function(){var e=hl(this,r);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return pl(e,r).value[t]}}function ml(e,t){var n;return("number"==typeof t?_s:t instanceof zf?ys:(n=zf(t))?(t=n,ys):function(e,r){var t,n,i,a,o,c=Ss.lastIndex=ks.lastIndex=0,u=-1,f=[],s=[];for(e+="",r+="";(t=Ss.exec(e))&&(n=ks.exec(r));)(i=n.index)>c&&(i=r.slice(c,i),f[u]?f[u]+=i:f[++u]=i),(t=t[0])===(n=n[0])?f[u]?f[u]+=n:f[++u]=n:(f[++u]=null,s.push({i:u,x:_s(t,n)})),c=ks.lastIndex;return c<r.length&&(i=r.slice(c),f[u]?f[u]+=i:f[++u]=i),f.length<2?s[0]?(o=s[0].x,function(e){return o(e)+""}):(a=r,function(){return a}):(r=s.length,function(e){for(var t,n=0;n<r;++n)f[(t=s[n]).i]=t.x(e);return f.join("")})})(e,t)}var vl=vf.prototype.constructor;var bl=0;function yl(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function xl(){return++bl}var wl=vf.prototype;yl.prototype=function(e){return vf().transition(e)}.prototype={constructor:yl,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=zu(e));for(var r=this._groups,i=r.length,a=new Array(i),o=0;o<i;++o)for(var c,u,f=r[o],s=f.length,l=a[o]=new Array(s),d=0;d<s;++d)(c=f[d])&&(u=e.call(c,c.__data__,d,f))&&("__data__"in c&&(u.__data__=c.__data__),l[d]=u,ll(l[d],t,n,d,l,pl(c,n)));return new yl(a,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=Uu(e));for(var r=this._groups,i=r.length,a=[],o=[],c=0;c<i;++c)for(var u,f=r[c],s=f.length,l=0;l<s;++l)if(u=f[l]){for(var d,h=e.call(u,u.__data__,l,f),p=pl(u,n),g=0,m=h.length;g<m;++g)(d=h[g])&&ll(d,t,n,g,h,p);a.push(h),o.push(u)}return new yl(a,o,t,n)},filter:function(e){"function"!=typeof e&&(e=Pu(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o=t[i],c=o.length,u=r[i]=[],f=0;f<c;++f)(a=o[f])&&e.call(a,a.__data__,f,o)&&u.push(a);return new yl(r,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,a=Math.min(r,i),o=new Array(r),c=0;c<a;++c)for(var u,f=t[c],s=n[c],l=f.length,d=o[c]=new Array(l),h=0;h<l;++h)(u=f[h]||s[h])&&(d[h]=u);for(;c<r;++c)o[c]=t[c];return new yl(o,this._parents,this._name,this._id)},selection:function(){return new vl(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=xl(),r=this._groups,i=r.length,a=0;a<i;++a)for(var o,c=r[a],u=c.length,f=0;f<u;++f)if(o=c[f]){var s=pl(o,t);ll(o,e,n,f,c,{time:s.time+s.delay+s.duration,delay:0,duration:s.duration,ease:s.ease})}return new yl(r,this._parents,e,n)},call:wl.call,nodes:wl.nodes,node:wl.node,size:wl.size,empty:wl.empty,each:wl.each,on:function(e,t){var n,r,i,a,o,c,u=this._id;return arguments.length<2?pl(this.node(),u).on.on(e):this.each((n=u,i=t,c=((r=e)+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return 0<=t&&(e=e.slice(0,t)),!e||"start"===e})?dl:hl,function(){var e=c(this,n),t=e.on;t!==a&&(o=(a=t).copy()).on(r,i),e.on=o}))},attr:function(e,t){var n=Du(e),r="transform"===n?zs:ml;return this.attrTween(e,"function"==typeof t?(n.local?function(n,r,i){var a,o,c;return function(){var e,t=i(this);if(null!=t)return(e=this.getAttributeNS(n.space,n.local))===t?null:e===a&&t===o?c:c=r(a=e,o=t);this.removeAttributeNS(n.space,n.local)}}:function(n,r,i){var a,o,c;return function(){var e,t=i(this);if(null!=t)return(e=this.getAttribute(n))===t?null:e===a&&t===o?c:c=r(a=e,o=t);this.removeAttribute(n)}})(n,r,gl(this,"attr."+e,t)):null==t?(n.local?function(e){return function(){this.removeAttributeNS(e.space,e.local)}}:function(e){return function(){this.removeAttribute(e)}})(n):(n.local?function(t,n,r){var i,a;return function(){var e=this.getAttributeNS(t.space,t.local);return e===r?null:e===i?a:a=n(i=e,r)}}:function(t,n,r){var i,a;return function(){var e=this.getAttribute(t);return e===r?null:e===i?a:a=n(i=e,r)}})(n,r,t+""))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var r=Du(e);return this.tween(n,(r.local?function(r,e){function t(){var t=this,n=e.apply(t,arguments);return n&&function(e){t.setAttributeNS(r.space,r.local,n(e))}}return t._value=e,t}:function(r,e){function t(){var t=this,n=e.apply(t,arguments);return n&&function(e){t.setAttribute(r,n(e))}}return t._value=e,t})(r,t))},style:function(e,t,n){var r,i,a,o,c,u,f,s,l,d,h,p,g,m,v,b,y,x="transform"==(e+="")?Fs:ml;return null==t?this.styleTween(e,(g=e,m=x,function(){var e=Xu(this,g),t=(this.style.removeProperty(g),Xu(this,g));return e===t?null:e===v&&t===b?y:y=m(v=e,b=t)})).on("end.style."+e,(p=e,function(){this.style.removeProperty(p)})):this.styleTween(e,"function"==typeof t?(f=x,s=gl(this,"style."+(u=e),t),function(){var e=Xu(this,u),t=s(this);return null==t&&(this.style.removeProperty(u),t=Xu(this,u)),e===t?null:e===l&&t===d?h:h=f(l=e,d=t)}):(r=e,i=x,a=t+"",function(){var e=Xu(this,r);return e===a?null:e===o?c:c=i(o=e,a)}),n)},styleTween:function(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;return this.tween(r,function(r,e,i){function t(){var t=this,n=e.apply(t,arguments);return n&&function(e){t.style.setProperty(r,n(e),i)}}return t._value=e,t}(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?(n=gl(this,"text",e),function(){var e=n(this);this.textContent=null==e?"":e}):(t=null==e?"":e+"",function(){this.textContent=t}));var t,n},remove:function(){return this.on("end.remove",(n=this._id,function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}));var n},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r,i=pl(this.node(),n).tween,a=0,o=i.length;a<o;++a)if((r=i[a]).name===e)return r.value;return null}return this.each((null==t?function(i,a){var o,c;return function(){var e=hl(this,i),t=e.tween;if(t!==o)for(var n=0,r=(c=o=t).length;n<r;++n)if(c[n].name===a){(c=c.slice()).splice(n,1);break}e.tween=c}}:function(a,o,c){var u,f;if("function"!=typeof c)throw new Error;return function(){var e=hl(this,a),t=e.tween;if(t!==u){f=(u=t).slice();for(var n={name:o,value:c},r=0,i=f.length;r<i;++r)if(f[r].name===o){f[r]=n;break}r===i&&f.push(n)}e.tween=f}})(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?function(e,t){return function(){dl(this,e).delay=+t.apply(this,arguments)}}:function(e,t){return t=+t,function(){dl(this,e).delay=t}})(t,e)):pl(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?function(e,t){return function(){hl(this,e).duration=+t.apply(this,arguments)}}:function(e,t){return t=+t,function(){hl(this,e).duration=t}})(t,e)):pl(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw new Error;return function(){hl(this,e).ease=t}}(t,e)):pl(this.node(),t).ease}};Math.PI,Math.PI;var _l={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function Sl(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))return _l.time=Xs(),_l;return n}vf.prototype.interrupt=function(e){return this.each(function(){!function(e,t){var n,r,i,a=e.__transition,o=!0;if(a){for(i in t=null==t?null:t+"",a)(n=a[i]).name===t?(r=n.state>ol&&n.state<fl,n.state=sl,n.timer.stop(),r&&n.on.call("interrupt",e,e.__data__,n.index,n.group),delete a[i]):o=!1;o&&delete e.__transition}}(this,e)})},vf.prototype.transition=function(e){var t,n;e=e instanceof yl?(t=e._id,e._name):(t=xl(),(n=_l).time=Xs(),null==e?null:e+"");for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var o,c=r[a],u=c.length,f=0;f<u;++f)(o=c[f])&&ll(o,e,t,f,c,n||Sl(o,t));return new yl(r,this._parents,e,t)};Math.PI,Math.PI;var kl="$";function El(){}function Cl(e,t){var n=new El;if(e instanceof El)e.each(function(e,t){n.set(t,e)});else if(Array.isArray(e)){var r,i=-1,a=e.length;if(null==t)for(;++i<a;)n.set(i,e[i]);else for(;++i<a;)n.set(t(r=e[i],i,e),r)}else if(e)for(var o in e)n.set(o,e[o]);return n}function Nl(){}El.prototype=Cl.prototype={constructor:El,has:function(e){return kl+e in this},get:function(e){return this[kl+e]},set:function(e,t){return this[kl+e]=t,this},remove:function(e){var t=kl+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===kl&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===kl&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===kl&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===kl&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===kl&&++e;return e},empty:function(){for(var e in this)if(e[0]===kl)return!1;return!0},each:function(e){for(var t in this)t[0]===kl&&e(this[t],t.slice(1),this)}};var Al=Cl.prototype;Nl.prototype=function(e,t){var n=new Nl;if(e instanceof Nl)e.each(function(e){n.add(e)});else if(e){var r=-1,i=e.length;if(null==t)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}.prototype={constructor:Nl,has:Al.has,add:function(e){return this[kl+(e+="")]=e,this},remove:Al.remove,clear:Al.clear,values:Al.keys,size:Al.size,empty:Al.empty,each:Al.each};var Tl={},Ol={};function Dl(e){return new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}")}function Ml(a){var t=new RegExp('["'+a+"\n\r]"),l=a.charCodeAt(0);function n(r,e){var t,n=[],i=r.length,a=0,o=0,c=i<=0,u=!1;function f(){if(c)return Ol;if(u)return u=!1,Tl;var e,t,n=a;if(34===r.charCodeAt(n)){for(;a++<i&&34!==r.charCodeAt(a)||34===r.charCodeAt(++a););return(e=a)>=i?c=!0:10===(t=r.charCodeAt(a++))?u=!0:13===t&&(u=!0,10===r.charCodeAt(a)&&++a),r.slice(n+1,e-1).replace(/""/g,'"')}for(;a<i;){if(10===(t=r.charCodeAt(e=a++)))u=!0;else if(13===t)u=!0,10===r.charCodeAt(a)&&++a;else if(t!==l)continue;return r.slice(n,e)}return c=!0,r.slice(n,i)}for(10===r.charCodeAt(i-1)&&--i,13===r.charCodeAt(i-1)&&--i;(t=f())!==Ol;){for(var s=[];t!==Tl&&t!==Ol;)s.push(t),t=f();e&&null==(s=e(s,o++))||n.push(s)}return n}function r(e){return e.map(o).join(a)}function o(e){return null==e?"":t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,a){var o,c,t=n(e,function(e,t){if(o)return o(e,t-1);var n,r,i;c=e,o=a?(r=a,i=Dl(n=e),function(e,t){return r(i(e),t,n)}):Dl(e)});return t.columns=c||[],t},parseRows:n,format:function(e,n){var t,r,i;return null==n&&(t=e,r=Object.create(null),i=[],t.forEach(function(e){for(var t in e)t in r||i.push(r[t]=t)}),n=i),[n.map(o).join(a)].concat(e.map(function(t){return n.map(function(e){return o(t[e])}).join(a)})).join("\n")},formatRows:function(e){return e.map(r).join("\n")}}}var Fl=Ml(","),zl=(Fl.parse,Fl.parseRows,Fl.format,Fl.formatRows,Ml("\t"));zl.parse,zl.parseRows,zl.format,zl.formatRows;function Il(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,a,o,c,u,f,s,l,d,h=e._root,p={data:r},g=e._x0,m=e._y0,v=e._x1,b=e._y1;if(!h)return e._root=p,e;for(;h.length;)if((f=t>=(a=(g+v)/2))?g=a:v=a,(s=n>=(o=(m+b)/2))?m=o:b=o,!(h=(i=h)[l=s<<1|f]))return i[l]=p,e;if(c=+e._x.call(null,h.data),u=+e._y.call(null,h.data),t===c&&n===u)return p.next=h,i?i[l]=p:e._root=p,e;for(;i=i?i[l]=new Array(4):e._root=new Array(4),(f=t>=(a=(g+v)/2))?g=a:v=a,(s=n>=(o=(m+b)/2))?m=o:b=o,(l=s<<1|f)==(d=(o<=u)<<1|a<=c););return i[d]=h,i[l]=p,e}function Ul(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function Rl(e){return e[0]}function Ll(e){return e[1]}function jl(e,t,n,r,i,a){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=a,this._root=void 0}function Pl(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var ql=function(e,t,n){var r=new jl(null==t?Rl:t,null==n?Ll:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}.prototype=jl.prototype;ql.copy=function(){var e,t,n=new jl(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=Pl(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=Pl(t));return n},ql.add=function(e){var t=+this._x.call(null,e),n=+this._y.call(null,e);return Il(this.cover(t,n),t,n,e)},ql.addAll=function(e){var t,n,r,i,a=e.length,o=new Array(a),c=new Array(a),u=1/0,f=1/0,s=-1/0,l=-1/0;for(n=0;n<a;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||((o[n]=r)<u&&(u=r),s<r&&(s=r),(c[n]=i)<f&&(f=i),l<i&&(l=i));for(s<u&&(u=this._x0,s=this._x1),l<f&&(f=this._y0,l=this._y1),this.cover(u,f).cover(s,l),n=0;n<a;++n)Il(this,o[n],c[n],e[n]);return this},ql.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,a=(r=Math.floor(t))+1;else{if(!(e<n||i<e||t<r||a<t))return this;var o,c,u=i-n,f=this._root;switch(c=(t<(r+a)/2)<<1|e<(n+i)/2){case 0:for(;(o=new Array(4))[c]=f,f=o,a=r+(u*=2),(i=n+u)<e||a<t;);break;case 1:for(;(o=new Array(4))[c]=f,f=o,a=r+(u*=2),e<(n=i-u)||a<t;);break;case 2:for(;(o=new Array(4))[c]=f,f=o,r=a-(u*=2),(i=n+u)<e||t<r;);break;case 3:for(;(o=new Array(4))[c]=f,f=o,r=a-(u*=2),e<(n=i-u)||t<r;);}this._root&&this._root.length&&(this._root=f)}return this._x0=n,this._y0=r,this._x1=i,this._y1=a,this},ql.data=function(){var t=[];return this.visit(function(e){if(!e.length)for(;t.push(e.data),e=e.next;);}),t},ql.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},ql.find=function(e,t,n){var r,i,a,o,c,u,f,s=this._x0,l=this._y0,d=this._x1,h=this._y1,p=[],g=this._root;for(g&&p.push(new Ul(g,s,l,d,h)),null==n?n=1/0:(s=e-n,l=t-n,d=e+n,h=t+n,n*=n);u=p.pop();)if(!(!(g=u.node)||(i=u.x0)>d||(a=u.y0)>h||(o=u.x1)<s||(c=u.y1)<l))if(g.length){var m=(i+o)/2,v=(a+c)/2;p.push(new Ul(g[3],m,v,o,c),new Ul(g[2],i,v,m,c),new Ul(g[1],m,a,o,v),new Ul(g[0],i,a,m,v)),(f=(v<=t)<<1|m<=e)&&(u=p[p.length-1],p[p.length-1]=p[p.length-1-f],p[p.length-1-f]=u)}else{var b=e-+this._x.call(null,g.data),y=t-+this._y.call(null,g.data),x=b*b+y*y;if(x<n){var w=Math.sqrt(n=x);s=e-w,l=t-w,d=e+w,h=t+w,r=g.data}}return r},ql.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(o=+this._y.call(null,e)))return this;var t,n,r,i,a,o,c,u,f,s,l,d,h=this._root,p=this._x0,g=this._y0,m=this._x1,v=this._y1;if(!h)return this;if(h.length)for(;;){if((f=a>=(c=(p+m)/2))?p=c:m=c,(s=o>=(u=(g+v)/2))?g=u:v=u,!(h=(t=h)[l=s<<1|f]))return this;if(!h.length)break;(t[l+1&3]||t[l+2&3]||t[l+3&3])&&(n=t,d=l)}for(;h.data!==e;)if(!(h=(r=h).next))return this;return(i=h.next)&&delete h.next,r?i?r.next=i:delete r.next:t?(i?t[l]=i:delete t[l],(h=t[0]||t[1]||t[2]||t[3])&&h===(t[3]||t[2]||t[1]||t[0])&&!h.length&&(n?n[d]=h:this._root=h)):this._root=i,this},ql.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},ql.root=function(){return this._root},ql.size=function(){var t=0;return this.visit(function(e){if(!e.length)for(;++t,e=e.next;);}),t},ql.visit=function(e){var t,n,r,i,a,o,c=[],u=this._root;for(u&&c.push(new Ul(u,this._x0,this._y0,this._x1,this._y1));t=c.pop();)if(!e(u=t.node,r=t.x0,i=t.y0,a=t.x1,o=t.y1)&&u.length){var f=(r+a)/2,s=(i+o)/2;(n=u[3])&&c.push(new Ul(n,f,s,a,o)),(n=u[2])&&c.push(new Ul(n,r,s,f,o)),(n=u[1])&&c.push(new Ul(n,f,i,a,s)),(n=u[0])&&c.push(new Ul(n,r,i,f,s))}return this},ql.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new Ul(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var a,o=t.x0,c=t.y0,u=t.x1,f=t.y1,s=(o+u)/2,l=(c+f)/2;(a=i[0])&&n.push(new Ul(a,o,c,s,l)),(a=i[1])&&n.push(new Ul(a,s,c,u,l)),(a=i[2])&&n.push(new Ul(a,o,l,s,f)),(a=i[3])&&n.push(new Ul(a,s,l,u,f))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},ql.x=function(e){return arguments.length?(this._x=e,this):this._x},ql.y=function(e){return arguments.length?(this._y=e,this):this._y};Math.PI,Math.sqrt(5);function Hl(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[1<r.length?r[0]+r.slice(2):r,+e.slice(n+1)]}var Wl,Bl=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Yl(e){return new Gl(e)}function Gl(e){if(!(t=Bl.exec(e)))throw new Error("invalid format: "+e);var t;this.fill=t[1]||" ",this.align=t[2]||">",this.sign=t[3]||"-",this.symbol=t[4]||"",this.zero=!!t[5],this.width=t[6]&&+t[6],this.comma=!!t[7],this.precision=t[8]&&+t[8].slice(1),this.trim=!!t[9],this.type=t[10]||""}function Vl(e,t){var n=Hl(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Yl.prototype=Gl.prototype,Gl.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Xl={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Vl(100*e,t)},r:Vl,s:function(e,t){var n=Hl(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(Wl=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:o<a?r+new Array(a-o+1).join("0"):0<a?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+Hl(e,Math.max(0,t+a-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Ql(e){return e}var Jl,Kl=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Zl(e){var t,c,u,_=e.grouping&&e.thousands?(c=e.grouping,u=e.thousands,function(e,t){for(var n=e.length,r=[],i=0,a=c[0],o=0;0<n&&0<a&&(t<o+a+1&&(a=Math.max(1,t-o)),r.push(e.substring(n-=a,n+a)),!((o+=a+1)>t));)a=c[i=(i+1)%c.length];return r.reverse().join(u)}):Ql,r=e.currency,S=e.decimal,k=e.numerals?(t=e.numerals,function(e){return e.replace(/[0-9]/g,function(e){return t[+e]})}):Ql,i=e.percent||"%";function f(e){var f=(e=Yl(e)).fill,s=e.align,l=e.sign,t=e.symbol,d=e.zero,h=e.width,p=e.comma,g=e.precision,m=e.trim,v=e.type;"n"===v?(p=!0,v="g"):Xl[v]||(null==g&&(g=12),m=!0,v="g"),(d||"0"===f&&"="===s)&&(d=!0,f="0",s="=");var b="$"===t?r[0]:"#"===t&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",y="$"===t?r[1]:/[%p]/.test(v)?i:"",x=Xl[v],w=/[defgprs%]/.test(v);function n(e){var t,n,r,i=b,a=y;if("c"===v)a=x(e)+a,e="";else{var o=(e=+e)<0;if(e=x(Math.abs(e),g),m&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(0<i){if(!+e[r])break e;i=0}}return 0<i?e.slice(0,i)+e.slice(t+1):e}(e)),o&&0==+e&&(o=!1),i=(o?"("===l?l:"-":"-"===l||"("===l?"":l)+i,a=("s"===v?Kl[8+Wl/3]:"")+a+(o&&"("===l?")":""),w)for(t=-1,n=e.length;++t<n;)if((r=e.charCodeAt(t))<48||57<r){a=(46===r?S+e.slice(t+1):e.slice(t))+a,e=e.slice(0,t);break}}p&&!d&&(e=_(e,1/0));var c=i.length+e.length+a.length,u=c<h?new Array(h-c+1).join(f):"";switch(p&&d&&(e=_(u+e,u.length?h-a.length:1/0),u=""),s){case"<":e=i+e+a+u;break;case"=":e=i+u+e+a;break;case"^":e=u.slice(0,c=u.length>>1)+i+e+a+u.slice(c);break;default:e=u+i+e+a}return k(e)}return g=null==g?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),n.toString=function(){return e+""},n}return{format:f,formatPrefix:function(e,t){var n,r=f(((e=Yl(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor((n=t,((n=Hl(Math.abs(n)))?n[1]:NaN)/3)))),a=Math.pow(10,-i),o=Kl[8+i/3];return function(e){return r(a*e)+o}}}}function $l(){return new ed}function ed(){this.reset()}Jl=Zl({decimal:".",thousands:",",grouping:[3],currency:["$",""]}),Jl.format,Jl.formatPrefix,ed.prototype={constructor:ed,reset:function(){this.s=this.t=0},add:function(e){nd(td,e,this.t),nd(this,td.s,this.s),this.s?this.t+=td.t:this.s=td.t},valueOf:function(){return this.s}};var td=new ed;function nd(e,t,n){var r=e.s=t+n,i=r-t,a=r-i;e.t=t-a+(n-i)}Math.PI,$l(),$l(),$l(),$l(),$l(),$l(),$l(),$l();var rd=new Date,id=new Date;function ad(a,o,n,r){function c(e){return a(e=new Date(+e)),e}return(c.floor=c).ceil=function(e){return a(e=new Date(e-1)),o(e,1),a(e),e},c.round=function(e){var t=c(e),n=c.ceil(e);return e-t<n-e?t:n},c.offset=function(e,t){return o(e=new Date(+e),null==t?1:Math.floor(t)),e},c.range=function(e,t,n){var r,i=[];if(e=c.ceil(e),n=null==n?1:Math.floor(n),!(e<t&&0<n))return i;for(;i.push(r=new Date(+e)),o(e,n),a(e),r<e&&e<t;);return i},c.filter=function(n){return ad(function(e){if(e<=e)for(;a(e),!n(e);)e.setTime(e-1)},function(e,t){if(e<=e)if(t<0)for(;++t<=0;)for(;o(e,-1),!n(e););else for(;0<=--t;)for(;o(e,1),!n(e););})},n&&(c.count=function(e,t){return rd.setTime(+e),id.setTime(+t),a(rd),a(id),Math.floor(n(rd,id))},c.every=function(t){return t=Math.floor(t),isFinite(t)&&0<t?1<t?c.filter(r?function(e){return r(e)%t==0}:function(e){return c.count(0,e)%t==0}):c:null}),c}var od=ad(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});od.every=function(n){return n=Math.floor(n),isFinite(n)&&0<n?1<n?ad(function(e){e.setTime(Math.floor(e/n)*n)},function(e,t){e.setTime(+e+t*n)},function(e,t){return(t-e)/n}):od:null};od.range;var cd=6e4,ud=36e5,fd=(ad(function(e){e.setTime(1e3*Math.floor(e/1e3))},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getUTCSeconds()}).range,ad(function(e){e.setTime(Math.floor(e/cd)*cd)},function(e,t){e.setTime(+e+t*cd)},function(e,t){return(t-e)/cd},function(e){return e.getMinutes()}).range,ad(function(e){var t=e.getTimezoneOffset()*cd%ud;t<0&&(t+=ud),e.setTime(Math.floor((+e-t)/ud)*ud+t)},function(e,t){e.setTime(+e+t*ud)},function(e,t){return(t-e)/ud},function(e){return e.getHours()}).range,ad(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*cd)/864e5},function(e){return e.getDate()-1}));fd.range;function sd(t){return ad(function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*cd)/6048e5})}var ld=sd(0),dd=sd(1),hd=(sd(2),sd(3),sd(4)),pd=(sd(5),sd(6),ld.range,ad(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}).range,ad(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()}));pd.every=function(n){return isFinite(n=Math.floor(n))&&0<n?ad(function(e){e.setFullYear(Math.floor(e.getFullYear()/n)*n),e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t*n)}):null};pd.range,ad(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*cd)},function(e,t){return(t-e)/cd},function(e){return e.getUTCMinutes()}).range,ad(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+t*ud)},function(e,t){return(t-e)/ud},function(e){return e.getUTCHours()}).range;var gd=ad(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5},function(e){return e.getUTCDate()-1});gd.range;function md(t){return ad(function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/6048e5})}var vd=md(0),bd=md(1),yd=(md(2),md(3),md(4)),xd=(md(5),md(6),vd.range,ad(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}).range,ad(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()}));xd.every=function(n){return isFinite(n=Math.floor(n))&&0<n?ad(function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/n)*n),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t*n)}):null};xd.range;function wd(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function _d(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Sd(e){return{y:e,m:0,d:1,H:0,M:0,S:0,L:0}}var kd,Ed,Cd,Nd={"-":"",_:" ",0:"0"},Ad=/^\s*\d+/,Td=/^%/,Od=/[\\^$*+?|[\]().{}]/g;function Dd(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function Md(e){return e.replace(Od,"\\$&")}function Fd(e){return new RegExp("^(?:"+e.map(Md).join("|")+")","i")}function zd(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function Id(e,t,n){var r=Ad.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function Ud(e,t,n){var r=Ad.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function Rd(e,t,n){var r=Ad.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function Ld(e,t,n){var r=Ad.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function jd(e,t,n){var r=Ad.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function Pd(e,t,n){var r=Ad.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function qd(e,t,n){var r=Ad.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(68<+r[0]?1900:2e3),n+r[0].length):-1}function Hd(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Wd(e,t,n){var r=Ad.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function Bd(e,t,n){var r=Ad.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function Yd(e,t,n){var r=Ad.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function Gd(e,t,n){var r=Ad.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Vd(e,t,n){var r=Ad.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function Xd(e,t,n){var r=Ad.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function Qd(e,t,n){var r=Ad.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Jd(e,t,n){var r=Ad.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Kd(e,t,n){var r=Td.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Zd(e,t,n){var r=Ad.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function $d(e,t,n){var r=Ad.exec(t.slice(n));return r?(e.Q=1e3*+r[0],n+r[0].length):-1}function eh(e,t){return Dd(e.getDate(),t,2)}function th(e,t){return Dd(e.getHours(),t,2)}function nh(e,t){return Dd(e.getHours()%12||12,t,2)}function rh(e,t){return Dd(1+fd.count(pd(e),e),t,3)}function ih(e,t){return Dd(e.getMilliseconds(),t,3)}function ah(e,t){return ih(e,t)+"000"}function oh(e,t){return Dd(e.getMonth()+1,t,2)}function ch(e,t){return Dd(e.getMinutes(),t,2)}function uh(e,t){return Dd(e.getSeconds(),t,2)}function fh(e){var t=e.getDay();return 0===t?7:t}function sh(e,t){return Dd(ld.count(pd(e),e),t,2)}function lh(e,t){var n=e.getDay();return e=4<=n||0===n?hd(e):hd.ceil(e),Dd(hd.count(pd(e),e)+(4===pd(e).getDay()),t,2)}function dh(e){return e.getDay()}function hh(e,t){return Dd(dd.count(pd(e),e),t,2)}function ph(e,t){return Dd(e.getFullYear()%100,t,2)}function gh(e,t){return Dd(e.getFullYear()%1e4,t,4)}function mh(e){var t=e.getTimezoneOffset();return(0<t?"-":(t*=-1,"+"))+Dd(t/60|0,"0",2)+Dd(t%60,"0",2)}function vh(e,t){return Dd(e.getUTCDate(),t,2)}function bh(e,t){return Dd(e.getUTCHours(),t,2)}function yh(e,t){return Dd(e.getUTCHours()%12||12,t,2)}function xh(e,t){return Dd(1+gd.count(xd(e),e),t,3)}function wh(e,t){return Dd(e.getUTCMilliseconds(),t,3)}function _h(e,t){return wh(e,t)+"000"}function Sh(e,t){return Dd(e.getUTCMonth()+1,t,2)}function kh(e,t){return Dd(e.getUTCMinutes(),t,2)}function Eh(e,t){return Dd(e.getUTCSeconds(),t,2)}function Ch(e){var t=e.getUTCDay();return 0===t?7:t}function Nh(e,t){return Dd(vd.count(xd(e),e),t,2)}function Ah(e,t){var n=e.getUTCDay();return e=4<=n||0===n?yd(e):yd.ceil(e),Dd(yd.count(xd(e),e)+(4===xd(e).getUTCDay()),t,2)}function Th(e){return e.getUTCDay()}function Oh(e,t){return Dd(bd.count(xd(e),e),t,2)}function Dh(e,t){return Dd(e.getUTCFullYear()%100,t,2)}function Mh(e,t){return Dd(e.getUTCFullYear()%1e4,t,4)}function Fh(){return"+0000"}function zh(){return"%"}function Ih(e){return+e}function Uh(e){return Math.floor(+e/1e3)}kd=function(e){var r=e.dateTime,i=e.date,a=e.time,t=e.periods,n=e.days,o=e.shortDays,c=e.months,u=e.shortMonths,f=Fd(t),s=zd(t),l=Fd(n),d=zd(n),h=Fd(o),p=zd(o),g=Fd(c),m=zd(c),v=Fd(u),b=zd(u),y={a:function(e){return o[e.getDay()]},A:function(e){return n[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return c[e.getMonth()]},c:null,d:eh,e:eh,f:ah,H:th,I:nh,j:rh,L:ih,m:oh,M:ch,p:function(e){return t[+(12<=e.getHours())]},Q:Ih,s:Uh,S:uh,u:fh,U:sh,V:lh,w:dh,W:hh,x:null,X:null,y:ph,Y:gh,Z:mh,"%":zh},x={a:function(e){return o[e.getUTCDay()]},A:function(e){return n[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return c[e.getUTCMonth()]},c:null,d:vh,e:vh,f:_h,H:bh,I:yh,j:xh,L:wh,m:Sh,M:kh,p:function(e){return t[+(12<=e.getUTCHours())]},Q:Ih,s:Uh,S:Eh,u:Ch,U:Nh,V:Ah,w:Th,W:Oh,x:null,X:null,y:Dh,Y:Mh,Z:Fh,"%":zh},w={a:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=p[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=l.exec(t.slice(n));return r?(e.w=d[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=b[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=g.exec(t.slice(n));return r?(e.m=m[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,t,n){return k(e,r,t,n)},d:Bd,e:Bd,f:Jd,H:Gd,I:Gd,j:Yd,L:Qd,m:Wd,M:Vd,p:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.p=s[r[0].toLowerCase()],n+r[0].length):-1},Q:Zd,s:$d,S:Xd,u:Ud,U:Rd,V:Ld,w:Id,W:jd,x:function(e,t,n){return k(e,i,t,n)},X:function(e,t,n){return k(e,a,t,n)},y:qd,Y:Pd,Z:Hd,"%":Kd};function _(u,f){return function(e){var t,n,r,i=[],a=-1,o=0,c=u.length;for(e instanceof Date||(e=new Date(+e));++a<c;)37===u.charCodeAt(a)&&(i.push(u.slice(o,a)),null!=(n=Nd[t=u.charAt(++a)])?t=u.charAt(++a):n="e"===t?" ":"0",(r=f[t])&&(t=r(e,n)),i.push(t),o=a+1);return i.push(u.slice(o,a)),i.join("")}}function S(i,a){return function(e){var t,n,r=Sd(1900);if(k(r,i,e+="",0)!=e.length)return null;if("Q"in r)return new Date(r.Q);if("p"in r&&(r.H=r.H%12+12*r.p),"V"in r){if(r.V<1||53<r.V)return null;"w"in r||(r.w=1),r.d="Z"in r?(t=4<(n=(t=_d(Sd(r.y))).getUTCDay())||0===n?bd.ceil(t):bd(t),t=gd.offset(t,7*(r.V-1)),r.y=t.getUTCFullYear(),r.m=t.getUTCMonth(),t.getUTCDate()+(r.w+6)%7):(t=4<(n=(t=a(Sd(r.y))).getDay())||0===n?dd.ceil(t):dd(t),t=fd.offset(t,7*(r.V-1)),r.y=t.getFullYear(),r.m=t.getMonth(),t.getDate()+(r.w+6)%7)}else("W"in r||"U"in r)&&("w"in r||(r.w="u"in r?r.u%7:"W"in r?1:0),n="Z"in r?_d(Sd(r.y)).getUTCDay():a(Sd(r.y)).getDay(),r.m=0,r.d="W"in r?(r.w+6)%7+7*r.W-(n+5)%7:r.w+7*r.U-(n+6)%7);return"Z"in r?(r.H+=r.Z/100|0,r.M+=r.Z%100,_d(r)):a(r)}}function k(e,t,n,r){for(var i,a,o=0,c=t.length,u=n.length;o<c;){if(u<=r)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=w[i in Nd?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return y.x=_(i,y),y.X=_(a,y),y.c=_(r,y),x.x=_(i,x),x.X=_(a,x),x.c=_(r,x),{format:function(e){var t=_(e+="",y);return t.toString=function(){return e},t},parse:function(e){var t=S(e+="",wd);return t.toString=function(){return e},t},utcFormat:function(e){var t=_(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=S(e,_d);return t.toString=function(){return e},t}}}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),kd.format,kd.parse,Ed=kd.utcFormat,Cd=kd.utcParse;var Rh="%Y-%m-%dT%H:%M:%S.%LZ";Date.prototype.toISOString||Ed(Rh);+new Date("2000-01-01T00:00:00.000Z")||Cd(Rh);function Lh(e){for(var t=e.length/6|0,n=new Array(t),r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}function jh(e){return ws(e[e.length-1])}Lh("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Lh("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),Lh("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),Lh("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),Lh("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),Lh("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),Lh("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),Lh("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),Lh("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),jh(new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(Lh)),jh(new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(Lh)),jh(new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(Lh)),jh(new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(Lh)),jh(new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(Lh)),jh(new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(Lh)),jh(new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(Lh)),jh(new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(Lh)),jh(new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(Lh)),jh(new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(Lh)),jh(new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(Lh)),jh(new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(Lh)),jh(new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(Lh)),jh(new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(Lh)),jh(new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(Lh)),jh(new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(Lh)),jh(new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(Lh)),jh(new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(Lh)),jh(new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(Lh)),jh(new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(Lh)),jh(new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Lh)),jh(new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(Lh)),jh(new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(Lh)),jh(new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(Lh)),jh(new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(Lh)),jh(new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(Lh)),jh(new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(Lh)),Ls(hs(300,.5,0),hs(-240,.5,1));Ls(hs(-100,.75,.35),hs(80,1.5,.8)),Ls(hs(260,.75,.35),hs(80,1.5,.8)),hs(),Lf(),Math.PI,Math.PI;function Ph(t){var n=t.length;return function(e){return t[Math.max(0,Math.min(n-1,Math.floor(e*n)))]}}Ph(Lh("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));Ph(Lh("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),Ph(Lh("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),Ph(Lh("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921")),Math.PI;function qh(e){return e<0?-1:1}function Hh(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),c=(a*i+o*r)/(r+i);return(qh(a)+qh(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(c))||0}function Wh(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Bh(e,t,n){var r=e._x0,i=e._y0,a=e._x1,o=e._y1,c=(a-r)/3;e._context.bezierCurveTo(r+c,i+c*t,a-c,o-c*n,a,o)}function Yh(e){this._context=e}function Gh(e){this._context=e}function Vh(e){for(var t=0,n=e;t<n.length;t++){for(var r=n[t],i=0,a=r.children;i<a.length;i++){var o=a[i];if(o.parent!==r)return console.error("Dataflow graph is inconsistent.",parent,o),!1}if(!Vh(r.children))return!1}return!0}Yh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Bh(this,this._t0,Wh(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Bh(this,Wh(this,n=Hh(this,e,t)),n);break;default:Bh(this,this._t0,n=Hh(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(function(e){this._context=new Gh(e)}.prototype=Object.create(Yh.prototype)).point=function(e,t){Yh.prototype.point.call(this,t,e)},Gh.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}};var Xh=function(l){function e(e,t,n,r){var i=l.call(this,e)||this;i.model=t,i.name=n,i.data=r;for(var a=0,o=[dr,lr];a<o.length;a++){var c=o[a],u=t.facet[c];if(u){var f=u.bin,s=u.sort;i[c]=ne({name:t.getName(c+"_domain"),fields:[$t(u)].concat(Qr(f)?[$t(u,{binSuffix:"end"})]:[])},Ja(s)?{sortField:s}:_(s)?{sortIndexField:Oc(u,c)}:{})}}return i.childModel=t.child,i}return p(e,l),e.prototype.hash=function(){var e="Facet";return this.column&&(e+=" c:"+V(this.column)),this.row&&(e+=" r:"+V(this.row)),e},Object.defineProperty(e.prototype,"fields",{get:function(){return(this.column&&this.column.fields||[]).concat(this.row&&this.row.fields||[])},enumerable:!0,configurable:!0}),e.prototype.getSource=function(){return this.name},e.prototype.getChildIndependentFieldsWithStep=function(){for(var e={},t=0,n=["x","y"];t<n.length;t++){var r=n[t],i=this.childModel.component.scales[r];if(i&&!i.merged){var a=i.get("type"),o=i.get("range");if(mi(a)&&qa(o)){var c=yp(xp(this.childModel,r));c?e[r]=c:Ke("Unknown field for ${channel}.  Cannot calculate view size.")}}}return e},e.prototype.assembleRowColumnData=function(e,t,n){var r="row"===e?"y":"x",i=[],a=[],o=[];n[r]&&(t?(i.push("distinct_"+n[r]),a.push("max")):(i.push(n[r]),a.push("distinct")),o.push("distinct_"+n[r]));var c=this[e],u=c.sortField,f=c.sortIndexField;if(u){var s=u.op,l=u.field;i.push(l),a.push(s),o.push($t(u,{forAs:!0}))}else f&&(i.push(f),a.push("max"),o.push(f));return{name:this[e].name,source:t||this.data,transform:[ne({type:"aggregate",groupby:this[e].fields},i.length?{fields:i,ops:a,as:o}:{})]}},e.prototype.assemble=function(){var e=[],t=null,n=this.getChildIndependentFieldsWithStep();if(this.column&&this.row&&(n.x||n.y)){t="cross_"+this.column.name+"_"+this.row.name;var r=[].concat(n.x?[n.x]:[],n.y?[n.y]:[]),i=r.map(function(){return"distinct"});e.push({name:t,source:this.data,transform:[{type:"aggregate",groupby:this.column.fields.concat(this.row.fields),fields:r,ops:i}]})}for(var a=0,o=[dr,lr];a<o.length;a++){var c=o[a];this[c]&&e.push(this.assembleRowColumnData(c,t,n))}return e},e}(io);var Qh=function(r){function m(e,t){var n=r.call(this,e)||this;return n._parse=t,n}return p(m,r),m.prototype.clone=function(){return new m(null,he(this._parse))},m.prototype.hash=function(){return"Parse "+V(this._parse)},m.makeExplicit=function(e,t,n){var r={},i=t.data;return i&&i.format&&i.format.parse&&(r=i.format.parse),this.makeWithAncestors(e,r,{},n)},m.makeImplicitFromFilterTransform=function(e,t,n){var r={};return function e(t,n){if(H(t))e(t.not,n);else if(q(t))for(var r=0,i=t.and;r<i.length;r++)e(i[r],n);else if(P(t))for(var a=0,o=t.or;a<o.length;a++)e(o[a],n);else n(t)}(t.filter,function(e){if(qg(e)){var t=null;zg(e)?t=e.equal:jg(e)?t=e.range[0]:Pg(e)&&(t=(e.oneOf||e.in)[0]),t&&($e(t)?r[e.field]="date":te(t)?r[e.field]="number":g(t)&&(r[e.field]="string")),e.timeUnit&&(r[e.field]="date")}}),0===se(r).length?null:this.makeWithAncestors(e,{},r,n)},m.makeImplicitFromEncoding=function(e,t,n){var r={};return(Yp(t)||Gp(t))&&t.forEachFieldDef(function(e){_n(e)?r[e.field]="date":wn(e)&&Fe(e.aggregate)?r[e.field]="number":1<Se(e.field)?e.field in r||(r[e.field]="flatten"):Qt(e)&&Ja(e.sort)&&1<Se(e.sort.field)&&(e.sort.field in r||(r[e.sort.field]="flatten"))}),this.makeWithAncestors(e,{},r,n)},m.makeWithAncestors=function(e,t,n,r){for(var i=0,a=se(n);i<a.length;i++){var o=a[i];void 0!==(f=r.getWithExplicit(o)).value&&(f.explicit||f.value===n[o]||"derived"===f.value||"flatten"===n[o]?delete n[o]:Ke(Be.differentParse(o,n[o],f.value)))}for(var c=0,u=se(t);c<u.length;c++){var f;o=u[c];void 0!==(f=r.get(o))&&(f===t[o]?delete t[o]:Ke(Be.differentParse(o,t[o],f)))}var s=new Vc(t,n);r.copyAll(s);for(var l={},d=0,h=se(s.combine());d<h.length;d++){var p=h[d],g=s.get(p);null!==g&&(l[p]=g)}return 0===se(l).length||r.parseNothing?null:new m(e,l)},Object.defineProperty(m.prototype,"parse",{get:function(){return this._parse},enumerable:!0,configurable:!0}),m.prototype.merge=function(e){this._parse=ne({},this._parse,e.parse),e.remove()},m.prototype.assembleFormatParse=function(){for(var e={},t=0,n=se(this._parse);t<n.length;t++){var r=n[t],i=this._parse[r];1===Se(r)&&(e[r]=i)}return e},m.prototype.producedFields=function(){return l(se(this._parse))},m.prototype.dependentFields=function(){return l(se(this._parse))},m.prototype.assembleTransforms=function(t){var a=this;return void 0===t&&(t=!1),se(this._parse).filter(function(e){return!t||1<Se(e)}).map(function(e){var t,n,r,i=(t=e,n=a._parse[e],r=ye(t),"number"===n?"toNumber("+r+")":"boolean"===n?"toBoolean("+r+")":"string"===n?"toString("+r+")":"date"===n?"toDate("+r+")":"flatten"===n?r:0!==n.indexOf("date:")?0!==n.indexOf("utc:")?(Ke(Be.unrecognizedParse(n)),null):"utcParse("+r+","+n.slice(4,n.length)+")":"timeParse("+r+","+n.slice(5,n.length)+")");return i?{type:"formula",expr:i,as:_e(e)}:null}).filter(function(e){return null!==e})},m}(io),Jh=function(a){function e(e){var t=a.call(this,null)||this;if(du(e=e||{name:"source"}))t._data={values:e.values};else if(lu(e)){if(t._data={url:e.url},e.format||(e.format={}),!e.format||!e.format.type){var n=/(?:\.([^.]+))?$/.exec(e.url)[1];X(["json","csv","tsv","dsv","topojson"],n)||(n="json"),e.format.type=n}}else hu(e)&&(t._data={});if(e.name&&(t._name=e.name),e.format){var r=e.format,i=(r.parse,re(r,["parse"]));t._data.format=i}return t}return p(e,a),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.prototype.hasName=function(){return!!this._name},Object.defineProperty(e.prototype,"dataName",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{set:function(e){throw new Error("Source nodes have to be roots.")},enumerable:!0,configurable:!0}),e.prototype.remove=function(){throw new Error("Source nodes are roots and cannot be removed.")},e.prototype.hash=function(){throw new Error("Cannot hash sources")},e.prototype.assemble=function(){return ne({name:this._name},this._data,{transform:[]})},e}(io),Kh=function(){function e(){this._mutated=!1}return e.prototype.setMutated=function(){this._mutated=!0},Object.defineProperty(e.prototype,"mutatedFlag",{get:function(){return this._mutated},enumerable:!0,configurable:!0}),e}(),Zh=function(t){function e(){var e=t.call(this)||this;return e._continue=!1,e}return p(e,t),e.prototype.setContinue=function(){this._continue=!0},Object.defineProperty(e.prototype,"continueFlag",{get:function(){return this._continue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flags",{get:function(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}},set:function(e){var t=e.continueFlag,n=e.mutatedFlag;t&&this.setContinue(),n&&this.setMutated()},enumerable:!0,configurable:!0}),e.prototype.optimizeNextFromLeaves=function(e){if(e instanceof Jh)return!1;var t=e.parent;return this.run(e).continueFlag&&this.optimizeNextFromLeaves(t),this.mutatedFlag},e}(Kh),$h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return p(t,e),t}(Kh),ep=function(r){function i(e,t){var n=r.call(this,e)||this;return n.formula=t,n}return p(i,r),i.prototype.clone=function(){return new i(null,he(this.formula))},i.makeFromEncoding=function(e,t){var n=t.reduceFieldDef(function(e,t){if(t.timeUnit){var n=$t(t,{forAs:!0});e[n]={as:n,timeUnit:t.timeUnit,field:t.field}}return e},{});return 0===se(n).length?null:new i(e,n)},i.makeFromTransform=function(e,t){var n;return new i(e,((n={})[t.field]={as:t.as,timeUnit:t.timeUnit,field:t.field},n))},i.prototype.merge=function(e){this.formula=ne({},this.formula,e.formula),e.remove()},i.prototype.producedFields=function(){var t={};return le(this.formula).forEach(function(e){t[e.as]=!0}),t},i.prototype.dependentFields=function(){var t={};return le(this.formula).forEach(function(e){t[e.field]=!0}),t},i.prototype.hash=function(){return"TimeUnit "+V(this.formula)},i.prototype.assemble=function(){return le(this.formula).map(function(e){return{type:"formula",as:e.as,expr:Et(e.timeUnit,e.field)}})},i}(io),tp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return p(t,e),t.prototype.run=function(e){var t=e.parent;if(e instanceof Qh){if(t instanceof Jh)return this.flags;if(1<t.numChildren())return this.setContinue(),this.flags;if(t instanceof Qh)this.setMutated(),t.merge(e);else{if(fe(t.producedFields(),e.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),e.swapWithParent()}}return this.setContinue(),this.flags},t}(Zh),np=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return p(t,e),t.prototype.mergeNodes=function(e,t){for(var n=t.shift(),r=0,i=t;r<i.length;r++){var a=i[r];e.removeChild(a),a.parent=n,a.remove()}},t.prototype.run=function(e){for(var t=e.children.map(function(e){return e.hash()}),n={},r=0;r<t.length;r++)void 0===n[t[r]]?n[t[r]]=[e.children[r]]:n[t[r]].push(e.children[r]);for(var i=0,a=se(n);i<a.length;i++){var o=a[i];1<n[o].length&&(this.setMutated(),this.mergeNodes(e,n[o]))}for(var c=0,u=e.children;c<u.length;c++){var f=u[c];this.run(f)}return this.mutatedFlag},t}($h),rp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return p(t,e),t.prototype.run=function(e){return e instanceof ao||0<e.numChildren()||e instanceof Xh||(this.setMutated(),e.remove()),this.flags},t}(Zh),ip=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fields={},e}return p(e,t),e.prototype.run=function(e){var t=this;if(this.setContinue(),e instanceof ep){var n=e.producedFields();se(n).every(function(e){return!!t.fields[e]})?(this.setMutated(),e.remove()):this.fields=ne({},this.fields,n)}return this.flags},e}(Zh);var ap=function(r){function h(e,t){var n=r.call(this,e)||this;return n._stack=t,n}return p(h,r),h.prototype.clone=function(){return new h(null,he(this._stack))},h.makeFromTransform=function(e,t){var n,r=t.stack,i=t.groupby,a=t.as,o=t.offset,c=void 0===o?"zero":o,u=[],f=[];if(void 0!==t.sort)for(var s=0,l=t.sort;s<l.length;s++){var d=l[s];u.push(d.field),f.push(ke(d.order,"ascending"))}return new h(e,{stackField:r,groupby:i,offset:c,sort:{field:u,order:f},facetby:[],as:_(n=a)&&n.every(function(e){return g(e)})&&1<n.length?a:g(a)?[a,a+"_end"]:[t.stack+"_start",t.stack+"_end"]})},h.makeFromEncoding=function(e,t){var n,r=t.stack;if(!r)return null;r.groupbyChannel&&(n=t.fieldDef(r.groupbyChannel));var i,a=t.stack.stackBy.reduce(function(e,t){var n=$t(t.fieldDef);return n&&e.push(n),e},[]),o=t.encoding.order;return i=_(o)||Gt(o)?km(o):a.reduce(function(e,t){return e.field.push(t),e.order.push("descending"),e},{field:[],order:[]}),new h(e,{dimensionFieldDef:n,stackField:t.vgField(r.fieldChannel),facetby:[],stackby:a,sort:i,offset:r.offset,impute:r.impute,as:[t.vgField(r.fieldChannel,{suffix:"start",forAs:!0}),t.vgField(r.fieldChannel,{suffix:"end",forAs:!0})]})},Object.defineProperty(h.prototype,"stack",{get:function(){return this._stack},enumerable:!0,configurable:!0}),h.prototype.addDimensions=function(e){this._stack.facetby=this._stack.facetby.concat(e)},h.prototype.dependentFields=function(){var t={};t[this._stack.stackField]=!0,this.getGroupbyFields().forEach(function(e){return t[e]=!0}),this._stack.facetby.forEach(function(e){return t[e]=!0});var e=this._stack.sort.field;return _(e)?e.forEach(function(e){return t[e]=!0}):t[e]=!0,t},h.prototype.producedFields=function(){return this._stack.as.reduce(function(e,t){return e[t]=!0,e},{})},h.prototype.hash=function(){return"Stack "+V(this._stack)},h.prototype.getGroupbyFields=function(){var e=this._stack,t=e.dimensionFieldDef,n=e.impute,r=e.groupby;return t?t.bin?n?[$t(t,{binSuffix:"mid"})]:[$t(t,{}),$t(t,{binSuffix:"end"})]:[$t(t)]:r||[]},h.prototype.assemble=function(){var e=[],t=this._stack,n=t.facetby,r=t.dimensionFieldDef,i=t.stackField,a=t.stackby,o=t.sort,c=t.offset,u=t.impute,f=t.as;return u&&r&&(r.bin&&e.push({type:"formula",expr:"("+$t(r,{expr:"datum"})+"+"+$t(r,{expr:"datum",binSuffix:"end"})+")/2",as:$t(r,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:i,groupby:a,key:$t(r,{binSuffix:"mid"}),method:"value",value:0})),e.push({type:"stack",groupby:this.getGroupbyFields().concat(n),field:i,sort:o,as:f,offset:c}),e},h}(io),op=function(r){function e(e,t){var n=r.call(this,e)||this;return n.transform=t,n}return p(e,r),e.prototype.clone=function(){return new e(null,he(this.transform))},e.prototype.addDimensions=function(e){this.transform.groupby=ae(this.transform.groupby.concat(e),function(e){return e})},e.prototype.dependentFields=function(){var t={};return this.transform.groupby.forEach(function(e){return t[e]=!0}),this.transform.sort.forEach(function(e){return t[e.field]=!0}),this.transform.window.map(function(e){return e.field}).filter(function(e){return void 0!==e}).forEach(function(e){return t[e]=!0}),t},e.prototype.producedFields=function(){var t=this,n={};return this.transform.window.forEach(function(e){return n[t.getDefaultName(e)]=!0}),n},e.prototype.getDefaultName=function(e){return e.as||$t(e)},e.prototype.hash=function(){return"WindowTransform "+V(this.transform)},e.prototype.assemble=function(){for(var e=[],t=[],n=[],r=[],i=0,a=this.transform.window;i<a.length;i++){var o=a[i];t.push(o.op),n.push(this.getDefaultName(o)),r.push(void 0===o.param?null:o.param),e.push(void 0===o.field?null:o.field)}var c=this.transform.frame,u=this.transform.groupby,f=[],s=[];if(void 0!==this.transform.sort)for(var l=0,d=this.transform.sort;l<d.length;l++){var h=d[l];f.push(h.field),s.push(h.order||"ascending")}var p={field:f,order:s},g=this.transform.ignorePeers,m={type:"window",params:r,as:n,ops:t,fields:e,sort:p};return void 0!==g&&(m.ignorePeers=g),void 0!==u&&(m.groupby=u),void 0!==c&&(m.frame=c),m},e}(io),cp="scale_",up=5;function fp(e){if(e instanceof Xh)if(1!==e.numChildren()||e.children[0]instanceof ao){var t=e.model.component.data.main;!function e(t){if(t instanceof ao&&t.type===pu&&1===t.numChildren()){var n=t.children[0];n instanceof Xh||(n.swapWithParent(),e(t))}}(t);for(var n=(o=e,function e(t){if(t instanceof Xh)return Z(t.children.map(e));var n=t.clone();if(n instanceof ao){var r=cp+n.getSource();n.setSource(r),o.model.component.data.outputNodes[r]=n}else(n instanceof xu||n instanceof ap||n instanceof op)&&n.addDimensions(o.fields);return Z(t.children.map(e)).forEach(function(e){return e.parent=n}),[n]}),r=0,i=Z(e.children.map(n));r<i.length;r++){i[r].parent=t}}else{var a=e.children[0];(a instanceof xu||a instanceof ap||a instanceof op)&&a.addDimensions(e.fields),a.swapWithParent(),fp(e)}else e.children.map(fp);var o}var sp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return p(t,e),t.prototype.run=function(e){e instanceof ao&&!e.isRequired()&&(this.setMutated(),e.remove());for(var t=0,n=e.children;t<n.length;t++){var r=n[t];this.run(r)}return this.mutatedFlag},t}($h);function lp(e){var n=[];return e.forEach(function e(t){0===t.numChildren()?n.push(t):t.children.forEach(e)}),n}var dp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return p(t,e),t.prototype.run=function(e){var t=e.parent,n=t.children.filter(function(e){return e instanceof Qh});if(1<n.length){for(var r={},i=0,a=n;i<a.length;i++)for(var o=(h=a[i]).parse,c=0,u=se(o);c<u.length;c++){var f=u[c];void 0===r[f]?r[f]=o[f]:r[f]!==o[f]&&delete r[f]}if(0!==se(r).length){this.setMutated();for(var s=new Qh(t,r),l=0,d=n;l<d.length;l++){for(var h=d[l],p=0,g=se(r);p<g.length;p++){var m=g[p];delete h.parse[m]}t.removeChild(h),h.parent=s,0===se(h.parse).length&&h.remove()}}}return this.setContinue(),this.flags},t}(Zh);function hp(e){return e}function pp(n,e,t){return e.map(function(e){var t=new n;return t instanceof Zh?t.optimizeNextFromLeaves(e):t.run(e)}).some(hp)||t}function gp(e){var t=e.sources,n=!1;return n=pp(sp,t,n),t=t.filter(function(e){return 0<e.numChildren()}),n=pp(rp,lp(t),n),t=t.filter(function(e){return 0<e.numChildren()}),n=pp(tp,lp(t),n),n=pp(ip,lp(t),n),n=pp(dp,lp(t),n),n=pp(np,t,n),e.sources=t,n}function mp(e){var p,g,m;Yp(e)?(g=(p=e).specifiedScales,m=p.component.scales,se(m).forEach(function(e){var t,n,r,i,a=g[e],o=a?a.domain:void 0,c=(n=e,r=(t=p).getScaleComponent(n).get("type"),(i=function(e,t,n,r){if("unaggregated"===e){var i=bp(t,n),a=i.valid,o=i.reason;if(!a)return void Ke(o)}else if(void 0===e&&r.useUnaggregatedDomain){var a=bp(t,n).valid;if(a)return"unaggregated"}return e}(t.scaleDomain(n),t.fieldDef(n),r,t.config.scale))!==t.scaleDomain(n)&&(t.specifiedScales[n]=ne({},t.specifiedScales[n],{domain:i})),"x"===n&&t.channelHasField("x2")?t.channelHasField("x")?vp(r,i,t,"x").concat(vp(r,i,t,"x2")):vp(r,i,t,"x2"):"y"===n&&t.channelHasField("y2")?t.channelHasField("y")?vp(r,i,t,"y").concat(vp(r,i,t,"y2")):vp(r,i,t,"y2"):vp(r,i,t,n)),u=m[e];if(u.domains=c,Si(o)&&u.set("domainRaw",{signal:kg+V(o)},!0),p.component.data.isFaceted){for(var f=p;!Gp(f)&&f.parent;)f=f.parent;var s=f.component.resolve.scale[e];if("shared"===s)for(var l=0,d=c;l<d.length;l++){var h=d[l];Ha(h)&&(h.data=cp+h.data.replace(cp,""))}}})):function(u){for(var e=0,t=u.children;e<t.length;e++){var n=t[e];mp(n)}var f=u.component.scales;se(f).forEach(function(e){for(var t,n=null,r=0,i=u.children;r<i.length;r++){var a=i[r],o=a.component.scales[e];if(o){t=void 0===t?o.domains:t.concat(o.domains);var c=o.get("domainRaw");n&&c&&n.signal!==c.signal&&Ke("The same selection must be used to override scale domains in a layered view."),n=c}}f[e].domains=t,n&&f[e].set("domainRaw",n,!0)})}(e)}function vp(e,t,n,r){var i,a,o=n.fieldDef(r);if(t&&"unaggregated"!==t&&!Si(t)){var c=o.type,u=o.timeUnit;return"temporal"===c||u?(i=c,a=u,t.map(function(e){return{signal:"{data: "+Sn(e,{timeUnit:a,type:i})+"}"}})):[t]}var f=n.stack;if(f&&r===f.fieldChannel)return"normalize"===f.offset?[[0,1]]:[{data:l=n.requestDataName(pu),field:n.vgField(r,{suffix:"start"})},{data:l,field:n.vgField(r,{suffix:"end"})}];var s=Wr(r)?function(e,t,n){if(!mi(n))return;var r=e.fieldDef(t),i=r.sort;if(Ka(i))return{op:"min",field:Oc(r,t),order:"ascending"};if(Ja(i))return ne({},i,i.field?{field:we(i.field)}:{});if("descending"===i)return{op:"min",field:e.vgField(t),order:"descending"};if(X(["ascending",void 0],i))return!0;return}(n,r,e):void 0;if("unaggregated"===t){var l=n.requestDataName(pu),d=o.field;return[{data:l,field:$t({field:d,aggregate:"min"})},{data:l,field:$t({field:d,aggregate:"max"})}]}if(!Qr(o.bin))return s?[{data:pe(s)?n.requestDataName(pu):n.requestDataName(gu),field:n.vgField(r),sort:s}]:[{data:n.requestDataName(pu),field:n.vgField(r)}];if(vi(e)){var h=n.getName(Xr(o.bin)+"_"+o.field+"_bins");return[{signal:"sequence("+h+".start, "+h+".stop + "+h+".step, "+h+".step)"}]}return mi(e)?[{data:pe(s)?n.requestDataName(pu):n.requestDataName(gu),field:n.vgField(r,Am(o,r)?{binSuffix:"range"}:{}),sort:!0!==s&&Ja(s)?s:{field:n.vgField(r,{}),op:"min"}}]:"x"!==r&&"y"!==r?[{data:n.requestDataName(pu),field:n.vgField(r,{})}]:Kr(o.bin)&&o.bin.extent?[o.bin.extent]:[{data:l=n.requestDataName(pu),field:n.vgField(r,{})},{data:l,field:n.vgField(r,{binSuffix:"end"})}]}function bp(e,t){return e.aggregate?Ue[e.aggregate]?"quantitative"===e.type&&"log"===t?{valid:!1,reason:Be.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:Be.unaggregateDomainWithNonSharedDomainOp(e.aggregate)}:{valid:!1,reason:Be.unaggregateDomainHasNoEffectForRawField(e)}}function yp(e){if(Ha(e)&&g(e.field))return e.field;if(_(n=e)||!("fields"in n)||"data"in n)return!_(t=e)&&"fields"in t&&"data"in t?(Ke("Detected faceted independent scales that union domain of multiple fields from the same data source.  We will use the first field.  The result view size may be incorrect."),g(r=e.fields[0])?r:void 0):void 0;for(var t,n,r=void 0,i=0,a=e.fields;i<a.length;i++){var o=a[i];if(Ha(o)&&g(o.field))if(r){if(r!==o.field)return Ke("Detected faceted independent scales that union domain of multiple fields from different data sources.  We will use the first field.  The result view size may be incorrect."),r}else r=o.field}return Ke("Detected faceted independent scales that union domain of identical fields from different source detected.  We will assume that this is the same field from a different fork of the same data source.  However, if this is not case, the result view size maybe incorrect."),r}function xp(t,e){return function(e){var t=ae(e.map(function(e){return Ha(e)?(e.sort,re(e,["sort"])):e}),V),n=ae(e.map(function(e){if(Ha(e)){var t=e.sort;return void 0===t||pe(t)||("count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}}).filter(function(e){return void 0!==e}),V);if(1===t.length){if(Ha(o=e[0])&&0<n.length){var r=n[0];return 1<n.length&&(Ke(Be.MORE_THAN_ONE_SORT),r=!0),ne({},o,{sort:r})}return o}var i,a=ae(n.map(function(e){return pe(e)?e:"count"===e.op?e:(Ke(Be.domainSortDropped(e)),!0)}),V);1===a.length?i=a[0]:1<a.length&&(Ke(Be.MORE_THAN_ONE_SORT),i=!0);var o,c=ae(e.map(function(e){return Ha(e)?e.data:null}),function(e){return e});return 1!==c.length||null===c[0]?ne({fields:t},i?{sort:i}:{}):o=ne({data:c[0],fields:t.map(function(e){return e.field})},i?{sort:i}:{})}(t.component.scales[e].domains.map(function(e){return Ha(e)&&(e.data=t.lookupDataSource(e.data)),e}))}function wp(f){return se(f.component.scales).reduce(function(e,t){var n=f.component.scales[t];if(n.merged)return e;var r=n.combine(),i=r.domainRaw,a=r.range,o=r.name,c=r.type,u=(r.domainRaw,r.range,re(r,["name","type","domainRaw","range"]));return a=function(e,t,n,r){if("x"===r||"y"===r){if(qa(e))return{step:{signal:t+"_step"}};if(_(e)&&2===e.length){var i=e[0],a=e[1];if(0===i&&Pa(a))return[0,{signal:n.getSizeName(a.signal)}];if(Pa(i)&&0===a)return[{signal:n.getSizeName(i.signal)},0]}}return e}(a,o,f,t),i&&0<=i.signal.indexOf(kg)&&(i=function(e,t){var n=JSON.parse(t.signal.replace(kg,"")),r=ge(n.selection),i=n.encoding,a=n.field,o=e.component.selection&&e.component.selection[r];{if(!o){if(o=e.getSelectionComponent(r,n.selection),i||a){if(i&&!a){var c=o.project.filter(function(e){return e.channel===i});!c.length||1<c.length?(a=o.project[0].field,Ke((c.length?"Multiple ":"No ")+"matching "+v(i)+" encoding found for selection "+v(n.selection)+'. Using "field": '+v(a)+".")):a=c[0].field}}else a=o.project[0].field,1<o.project.length&&Ke('A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": '+v(a)+".");return{signal:ye(a,r)}}Ke('Use "bind": "scales" to setup a binding for scales and selections within the same view.')}return{signal:"null"}}(f,i)),e.push(ne({name:o,type:c,domain:xp(f,t)},i?{domainRaw:i}:{},{range:a},u)),e},[])}var _p=function(r){function e(e,t){var n=r.call(this,{},{name:e})||this;return n.merged=!1,n.domains=[],n.setWithExplicit("type",t),n}return p(e,r),e}(Vc),Sp=["shortTimeLabels"],kp={width:200,height:200};function Ep(e){return e&&!!e.scheme}var Cp={padding:5,timeFormat:"%b %d, %Y",countTitle:"Number of Records",invalidValues:"filter",view:kp,mark:$n,area:{},bar:er,circle:{},geoshape:{},line:{},point:{},rect:{},rule:{color:"black"},square:{},text:{color:"black"},tick:tr,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:wi,projection:{},axis:{},axisX:{},axisY:{minExtent:30},axisLeft:{},axisRight:{},axisTop:{},axisBottom:{},axisBand:{},legend:Pc,selection:Zi,style:{},title:{}};function Np(e){return $(he(Cp),e)}var Ap=["view"].concat(Hn),Tp=["padding","numberFormat","timeFormat","countTitle","stack","scale","selection","invalidValues","overlay"],Op=ne({view:["width","height"]},Zn);function Dp(e){e=he(e);for(var t=0,n=Tp;t<n.length;t++){delete e[a=n[t]]}if(e.axis)for(var r=0,i=Sp;r<i.length;r++){var a=i[r];delete e.axis[a]}if(e.legend)for(var o=0,c=Sp;o<c.length;o++){a=c[o];delete e.legend[a]}if(e.mark)for(var u=0,f=Kn;u<f.length;u++){a=f[u];delete e.mark[a]}for(var s=0,l=Ap;s<l.length;s++){for(var d=l[s],h=0,p=Kn;h<p.length;h++){a=p[h];delete e[d][a]}var g=Op[d];if(g)for(var m=0,v=g;m<v.length;m++){a=v[m];delete e[d][a]}Mp(e,d)}for(var b=0,y=nv();b<y.length;b++){delete e[y[b]]}for(var a in Mp(e,"title","group-title"),e)ee(e[a])&&0===se(e[a]).length&&delete e[a];return 0<se(e).length?e:void 0}function Mp(e,t,n,r){var i="title"===t?wa(e.title).mark:r?e[t][r]:e[t];"view"===t&&(n="cell");var a=ne({},i,e.style[t]);0<se(a).length&&(e.style[n||t]=a),r||delete e[t]}var Fp=Object.freeze({defaultViewConfig:kp,isVgScheme:Ep,defaultConfig:Cp,initConfig:Np,stripAndRedirectConfig:Dp}),zp=["range","rangeStep","scheme"];function Ip(e){var l,d;Yp(e)?(d=(l=e).component.scales,Hr.forEach(function(e){var t=d[e];if(t){var n=l.getScaleComponent(e),r=l.specifiedScales[e],i=l.fieldDef(e),a="x"===e?"width":"y"===e?"height":void 0,o=a?!!l.component.layoutSize.get(a):void 0,c=n.get("type"),u=X(["point","band"],c)||!!r.rangeStep;a&&l.fit&&!o&&u&&(Ke(Be.CANNOT_FIX_RANGE_STEP_WITH_FIT),o=!0);var f=function(e){var t=[],n=e.getScaleComponent("x"),r=n&&n.get("range");r&&qa(r)&&te(r.step)&&t.push(r.step);var i=e.getScaleComponent("y"),a=i&&i.get("range");return a&&qa(a)&&te(a.step)&&t.push(a.step),t}(l),s=function(e,t,n,r,i,a,o,c,u,f){for(var s=c||null===r.rangeStep,l=0,d=zp;l<d.length;l++){var h=d[l];if(void 0!==r[h]){var p=Ai(t,h),g=Ti(e,h);if(p)if(g)Ke(g);else switch(h){case"range":return Xc(r[h]);case"scheme":return Xc(Up(r[h]));case"rangeStep":var m=r[h];if(null!==m){if(!c)return Xc({step:m});Ke(Be.rangeStepDropped(e))}}else Ke(Be.scalePropertyNotWorkWithScaleType(t,h,e))}}return Qc(function(e,t,n,r,i,a,o,c,u,f){switch(e){case rr:case ir:if(X(["point","band"],t)&&!u)if(e===rr&&"text"===a){if(r.scale.textXRangeStep)return{step:r.scale.textXRangeStep}}else if(r.scale.rangeStep)return{step:r.scale.rangeStep};return e===ir&&bi(t)?[{signal:o},0]:[0,{signal:o}];case pr:var s=function(e,t,n){if(t)return 0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Be.incompatibleChannel("size",e))}(a,i,r),l=function(e,t,n){var r=n.scale;switch(e){case"bar":case"tick":return void 0!==n.scale.maxBandSize?n.scale.maxBandSize:Lp(t,n.scale)-1;case"line":case"trail":case"rule":return n.scale.maxStrokeWidth;case"text":return n.scale.maxFontSize;case"point":case"square":case"circle":if(n.scale.maxSize)return n.scale.maxSize;var i=Lp(t,r);return(i-2)*(i-2)}throw new Error(Be.incompatibleChannel("size",e))}(a,c,r);return xi(t)?function(e,t,n){for(var r=[],i=(t-e)/(n-1),a=0;a<n;a++)r.push(e+a*i);return r}(s,l,Rp(t,r,f,e)):[s,l];case hr:return"symbol";case gr:case mr:case vr:if("ordinal"===t)return"nominal"===n?"category":"ordinal";if(xi(t)){var d=Rp(t,r,f,e);return r.range&&Ep(r.range.ordinal)?ne({},r.range.ordinal,{count:d}):{scheme:"blues",count:d}}return yi(t)?["#f7fbff","#0e427f"]:"rect"===a||"geoshape"===a?"heatmap":"ramp";case _r:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error("Scale range undefined for channel "+e)}(e,t,n,i,a,o,u,f,s,r.domain))}(e,c,i.type,r,l.config,t.get("zero"),l.mark,o,l.getName(a),f);t.setWithExplicit("range",s)}})):Pp(e,"range")}function Up(e){if(_i(e)){var t={scheme:e.name};return e.count&&(t.count=e.count),e.extent&&(t.extent=e.extent),t}return{scheme:e}}function Rp(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return void 0!==n&&_(n)?n.length+1:(Ke(Be.domainRequiredForThresholdScale(r)),3)}}function Lp(e,t){return 0<e.length?Math.min.apply(null,e):t.rangeStep?t.rangeStep:21}function jp(e,t){var l,d,h;Yp(e)?(d=t,h=(l=e).component.scales,se(h).forEach(function(e){var t=l.specifiedScales[e],n=h[e],r=l.getScaleComponent(e),i=l.fieldDef(e),a=l.config,o=t[d],c=r.get("type"),u=Ai(c,d),f=Ti(e,d);if(void 0!==o&&(u?f&&Ke(f):Ke(Be.scalePropertyNotWorkWithScaleType(c,d,e))),u&&void 0===f)if(void 0!==o)n.copyKeyFromObject(d,t);else{var s=function(e,t,n,r,i,a,o,c,u){var f=u.scale;switch(e){case"interpolate":return function(e,t){if(X([gr,mr,vr],e)&&yi(t))return"hcl"}(t,r);case"nice":return function(e,t,n){if(!n.bin&&!X([$r.TIME,$r.UTC],e))return!!X([rr,ir],t)||void 0}(r,t,n);case"padding":return function(e,t,n,r,i,a){if(X([rr,ir],e)){if(yi(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;var o=i.type,c=i.orient;if("bar"===o&&!r.bin&&("vertical"===c&&"x"===e||"horizontal"===c&&"y"===e))return a.continuousBandSize}if(t===$r.POINT)return n.pointPadding}}(t,r,f,n,c,u.bar);case"paddingInner":return function(e,t,n){if(void 0===e)return X([rr,ir],t)?n.bandPaddingInner:void 0}(i,t,f);case"paddingOuter":return function(e,t,n,r,i){if(void 0===e)return X([rr,ir],t)&&n===$r.BAND?void 0!==i.bandPaddingOuter?i.bandPaddingOuter:r/2:void 0}(i,t,r,a,f);case"reverse":return function(e,t){if(bi(e)&&"descending"===t)return!0}(r,n.sort);case"zero":return function(e,t,n,r,i){if(n&&"unaggregated"!==n)return!1;if("size"===e&&"quantitative"===t.type&&!xi(i))return!0;if(t.bin||!X([rr,ir],e))return!1;var a=r.orient;return!X(["bar","area","line","trail"],r.type)||!("horizontal"===a&&"y"===e||"vertical"===a&&"x"===e)}(t,n,o,c,r)}return f[e]}(d,e,i,r.get("type"),r.get("padding"),r.get("paddingInner"),t.domain,l.markDef,a);void 0!==s&&n.set(d,s,!1)}})):Pp(e,t)}function Pp(a,o){for(var c=a.component.scales,e=0,t=a.children;e<t.length;e++){var n=t[e];"range"===o?Ip(n):jp(n,o)}se(c).forEach(function(e){for(var t,n=0,r=a.children;n<r.length;n++){var i=r[n].component.scales[e];if(i)t=Zc(t,i.getWithExplicit(o),o,"scale",Jc(function(e,t){switch(o){case"range":return e.step&&t.step?e.step-t.step:0}return 0}))}c[e].setWithExplicit(o,t)})}function qp(e,t,n,r,i){var a=function(e,t,n,r,i){switch(t.type){case"nominal":case"ordinal":if(Ar(e)||"discrete"===Gr(e))return"shape"===e&&"ordinal"===t.type&&Ke(Be.discreteChannelCannotEncode(e,"ordinal")),"ordinal";if(X(["x","y"],e)){if(X(["rect","bar","rule"],n))return"band";if("bar"===n)return"band"}return"point";case"temporal":return Ar(e)?"sequential":"discrete"===Gr(e)?(Ke(Be.discreteChannelCannotEncode(e,"temporal")),"ordinal"):"time";case"quantitative":if(Ar(e)){if(Qr(t.bin))return"bin-ordinal";var a=r||{},o=a.domain,c=void 0===o?void 0:o,u=a.range,f=void 0===u?void 0:u;return c&&_(c)&&2<c.length&&f&&_(f)&&2<f.length?"linear":"sequential"}return"discrete"===Gr(e)?(Ke(Be.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):Qr(t.bin)&&"x"!==e&&"y"!==e?"bin-linear":"linear";case"geojson":return}throw new Error(Be.invalidFieldType(t.type))}(t,n,r,e),o=e.type;return Wr(t)?void 0!==o?Di(t,o)?Oi(o,n.type,n.bin)?o:(Ke(Be.scaleTypeNotWorkWithFieldDef(o,a)),a):(Ke(Be.scaleTypeNotWorkWithChannel(t,o,a)),a):a:null}function Hp(e){var o,c,u,f;Yp(e)?e.component.scales=(c=(o=e).encoding,u=o.config,f=o.mark,Hr.reduce(function(e,t){var n,r,i=c[t];if(Gt(i)&&f===Rn&&t===hr&&i.type===Rt)return e;if(Gt(i)?r=(n=i).scale:Bt(i)?(n=i.condition,r=i.condition.scale):t===rr?n=gn(c.x2):t===ir&&(n=gn(c.y2)),n&&null!==r&&!1!==r){var a=qp(r=r||{},t,n,f,u.scale);e[t]=new _p(o.scaleName(t+"",!0),{value:a,explicit:r.type===a})}return e},{})):e.component.scales=function(c){for(var u=c.component.scales={},f={},i=c.component.resolve,e=function(r){Hp(r),se(r.component.scales).forEach(function(e){if(i.scale[e]=i.scale[e]||function(e,t){if(Qp(t)||Gp(t))return"shared";if(Xp(t)||Vp(t))return X(Rr,e)?"independent":"shared";throw new Error("invalid model type for resolve")}(e,c),"shared"===i.scale[e]){var t=f[e],n=r.component.scales[e].getWithExplicit("type");t?ii(t.value,n.value)?f[e]=Zc(t,n,"type","scale",Wp):(i.scale[e]="independent",delete f[e]):f[e]=n}})},t=0,n=c.children;t<n.length;t++){var r=n[t];e(r)}return se(f).forEach(function(e){var t=c.scaleName(e,!0),n=f[e];u[e]=new _p(t,n);for(var r=0,i=c.children;r<i.length;r++){var a=i[r],o=a.component.scales[e];o&&(a.renameScale(o.get("name"),t),o.merged=!0)}}),u}(e)}var Wp=Jc(function(e,t){return oi(e)-oi(t)});var Bp=function(){function e(){this.nameMap={}}return e.prototype.rename=function(e,t){this.nameMap[e]=t},e.prototype.has=function(e){return void 0!==this.nameMap[e]},e.prototype.get=function(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e},e}();function Yp(e){return e&&"unit"===e.type}function Gp(e){return e&&"facet"===e.type}function Vp(e){return e&&"repeat"===e.type}function Xp(e){return e&&"concat"===e.type}function Qp(e){return e&&"layer"===e.type}var Jp=function(){function e(e,t,n,r,i,a){var o,c,u,f,s,l,d,h,p=this;this.children=[],this.correctDataNames=function(e){return e.from&&e.from.data&&(e.from.data=p.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=p.lookupDataSource(e.from.facet.data)),e},this.parent=t,this.config=r,this.repeater=i,this.name=e.name||n,this.title=g(e.title)?{text:e.title}:e.title,this.scaleNameMap=t?t.scaleNameMap:new Bp,this.projectionNameMap=t?t.projectionNameMap:new Bp,this.layoutSizeNameMap=t?t.layoutSizeNameMap:new Bp,this.data=e.data,this.description=e.description,this.transforms=La(e.transform||[]),this.layout=da(e)||ha(e)?void 0:(c=(o=e||{}).align,u=void 0===c?void 0:c,f=o.center,s=void 0===f?void 0:f,l=o.bounds,d=void 0===l?void 0:l,h=o.spacing,{align:u,bounds:d,center:s,spacing:void 0===h?void 0:h}),this.component={data:{sources:t?t.component.data.sources:[],outputNodes:t?t.component.data.outputNodes:{},outputNodeRefCounts:t?t.component.data.outputNodeRefCounts:{},isFaceted:la(e)||t&&t.component.data.isFaceted&&!e.data},layoutSize:new Vc,layoutHeaders:{row:{},column:{}},mark:null,resolve:ne({scale:{},axis:{},legend:{}},a||{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}return Object.defineProperty(e.prototype,"width",{get:function(){return this.getSizeSignalRef("width")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.getSizeSignalRef("height")},enumerable:!0,configurable:!0}),e.prototype.initSize=function(e){var t=e.width,n=e.height;t&&this.component.layoutSize.set("width",t,!0),n&&this.component.layoutSize.set("height",n,!0)},e.prototype.parse=function(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSize(),this.parseSelection(),this.parseProjection(),this.parseData(),this.parseAxisAndHeader(),this.parseLegend(),this.parseMarkGroup()},e.prototype.parseScale=function(){!function(e){Hp(e),mp(e);for(var t=0,n=Ci;t<n.length;t++)jp(e,n[t]);Ip(e)}(this)},e.prototype.parseProjection=function(){yu(this)},e.prototype.renameTopLevelLayoutSize=function(){"width"!==this.getName("width")&&this.renameLayoutSize(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameLayoutSize(this.getName("height"),"height")},e.prototype.parseLegend=function(){iu(this)},e.prototype.assembleGroupStyle=function(){if("unit"===this.type||"layer"===this.type)return"cell"},e.prototype.assembleLayoutSize=function(){if("unit"===this.type||"layer"===this.type)return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},e.prototype.assembleLayout=function(){if(this.layout){var e=this.layout,t=e.align,n=e.bounds,r=e.center,i=e.spacing,a=void 0===i?{}:i;return ne({padding:te(a)?a:{row:a.row||10,column:a.column||10}},this.assembleDefaultLayout(),t?{align:t}:{},n?{bounds:n}:{},r?{center:r}:{})}},e.prototype.assembleDefaultLayout=function(){return{}},e.prototype.assembleHeaderMarks=function(){for(var e,t,n,r,i,a=this.component.layoutHeaders,o=[],c=0,u=Dc;c<u.length;c++){a[l=u[c]].title&&o.push((t=l,void 0,n=(e=this).component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{name:t+"-title",type:"group",role:t+"-title",title:ne({text:n,offset:10},"row"===t?{orient:"left"}:{},{style:"guide-title"},Ic(r,i,Va,Ya))}))}for(var f=0,s=Dc;f<s.length;f++){var l=s[f];o=o.concat(Fc(this,l))}return o},e.prototype.assembleAxes=function(){return e=this.component.axes,t=this.config,n=e.x,r=void 0===n?[]:n,i=e.y,a=void 0===i?[]:i,r.map(function(e){return Ba(e,"main",t)}).concat(r.map(function(e){return Ba(e,"grid",t)}),a.map(function(e){return Ba(e,"main",t)}),a.map(function(e){return Ba(e,"grid",t)})).filter(function(e){return e});var e,t,n,r,i,a},e.prototype.assembleLegends=function(){return uu(this)},e.prototype.assembleProjections=function(){return fu(this)},e.prototype.assembleTitle=function(){var e=this.title||{},t=e.encoding,n=re(e,["encoding"]),r=ne({},wa(this.config.title).nonMark,n,t?{encode:{update:t}}:{});if(r.text)return X(["unit","layer"],this.type)||(r.anchor&&"start"!==r.anchor&&Ke(Be.cannotSetTitleAnchor(this.type)),r.anchor="start"),0<se(r).length?r:void 0},e.prototype.assembleGroup=function(e){void 0===e&&(e=[]);var t={};0<(e=e.concat(this.assembleSelectionSignals())).length&&(t.signals=e);var n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());var r=!this.parent||Gp(this.parent)?function n(e){return Qp(e)||Xp(e)||Vp(e)?e.children.reduce(function(e,t){return e.concat(n(t))},wp(e)):wp(e)}(this):[];0<r.length&&(t.scales=r);var i=this.assembleAxes();0<i.length&&(t.axes=i);var a=this.assembleLegends();return 0<a.length&&(t.legends=a),t},e.prototype.hasDescendantWithFieldOnChannel=function(e){for(var t=0,n=this.children;t<n.length;t++){var r=n[t];if(Yp(r)){if(r.channelHasField(e))return!0}else if(r.hasDescendantWithFieldOnChannel(e))return!0}return!1},e.prototype.getName=function(e){return ge((this.name?this.name+"_":"")+e)},e.prototype.requestDataName=function(e){var t=this.getName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t},e.prototype.getSizeSignalRef=function(e){if(Gp(this.parent)){var t="width"===e?"x":"y",n=this.component.scales[t];if(n&&!n.merged){var r=n.get("type"),i=n.get("range");if(mi(r)&&qa(i)){var a=n.get("name"),o=yp(xp(this,t));return o?{signal:jc(a,n,$t({aggregate:"distinct",field:o},{expr:"datum"}))}:(Ke("Unknown field for ${channel}.  Cannot calculate view size."),null)}}}return{signal:this.layoutSizeNameMap.get(this.getName(e))}},e.prototype.lookupDataSource=function(e){var t=this.component.data.outputNodes[e];return t?t.getSource():e},e.prototype.getSizeName=function(e){return this.layoutSizeNameMap.get(e)},e.prototype.renameLayoutSize=function(e,t){this.layoutSizeNameMap.rename(e,t)},e.prototype.renameScale=function(e,t){this.scaleNameMap.rename(e,t)},e.prototype.renameProjection=function(e,t){this.projectionNameMap.rename(e,t)},e.prototype.scaleName=function(e,t){return t?this.getName(e):Mr(e)&&Wr(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0},e.prototype.projectionName=function(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0},e.prototype.getScaleComponent=function(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale().  Make sure you have called parseScale or use parseUnitModelWithScale().");var t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0},e.prototype.getSelectionComponent=function(e,t){var n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(Be.selectionNotFound(t));return n},e}(),Kp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return p(t,e),t.prototype.vgField=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);if(n)return $t(n,t)},t.prototype.reduceFieldDef=function(i,e,t){return Rm(this.getMapping(),function(e,t,n){var r=gn(t);return r?i(e,r,n):e},e,t)},t.prototype.forEachFieldDef=function(r,e){Um(this.getMapping(),function(e,t){var n=gn(e);n&&r(n,t)},e)},t}(Jp),Zp="_fields",$p={has:function(e){return"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind},parse:function(e,t,n){for(var r=ge(n.name),i=n.scales=[],a=0,o=n.project;a<o.length;a++){var c=o[a],u=c.channel;if(Wr(u)){var f=e.getScaleComponent(u),s=f?f.get("type"):void 0;if(f&&bi(s)&&!vi(s)){if(f.set("domainRaw",{signal:ye(c.field,r)},!0),i.push(u),e.repeater&&e.repeater.row===e.repeater.column)e.getScaleComponent(u===rr?ir:rr).set("domainRaw",{signal:ye(c.field,r)},!0)}else Ke(Be.SCALE_BINDINGS_CONTINUOUS)}}},topLevelSignals:function(e,n,r){var t=n.scales.filter(function(t){return!r.filter(function(e){return e.name===Mg(n,t,"data")}).length}).map(function(e){return{channel:e,signal:Mg(n,e,"data")}});if(!e.parent||!t.length)return r;var i=r.filter(function(e){return e.name===n.name})[0],a=i.update;if(0<=a.indexOf(Eg))i.update="{"+t.map(function(e){return n.fields[e.channel]+": "+e.signal}).join(", ")+"}";else for(var o=0,c=t;o<c.length;o++){var u=c[o],f=", "+n.fields[u.channel]+": "+u.signal;a.indexOf(f)<0&&(i.update=a.substring(0,a.length-1)+f+"}")}return r.concat(t.map(function(e){return{name:e.signal}}))},signals:function(e,n,r){if(e.parent)for(var t=function(t){var e=r.filter(function(e){return e.name===Mg(n,t,"data")})[0];e.push="outer",delete e.value,delete e.update},i=0,a=n.scales;i<a.length;i++){t(a[i])}return r}};function eg(e,t){return"domain("+v(e.scaleName(t))+")"}var tg="_brush",ng="_scale_trigger",rg={signals:function(e,t){var n=t.name,r=n+Sg+Zp,i=$p.has(t),a=[],o=[],c=[];if(t.translate&&!i){var u="!event.item || event.item.mark.name !== "+v(n+tg);ag(t,function(e,t){var n=t.between[0].filter||(t.between[0].filter=[]);n.indexOf(u)<0&&n.push(u)})}for(var f=0,s=t.project;f<s.length;f++){var l=s[f].channel;if(l===rr||l===ir){var d=ig(e,t,l),h=Mg(t,l,"data"),p=Mg(t,l,"visual"),g=v(e.scaleName(l)),m=bi(e.getScaleComponent(l).get("type"))?"+":"";a.push.apply(a,d),o.push(h),c.push({scaleName:e.scaleName(l),expr:"(!isArray("+h+") || ("+m+"invert("+g+", "+p+")[0] === "+m+h+"[0] && "+m+"invert("+g+", "+p+")[1] === "+m+h+"[1]))"})}else Ke("Interval selections only support x and y encoding channels.")}return i||a.push({name:n+ng,update:c.map(function(e){return e.expr}).join(" && ")+" ? "+(n+ng)+" : {}"}),a.concat({name:n+Sg,on:[{events:o.map(function(e){return{signal:e}}),update:o.join(" && ")+" ? {unit: "+Og(e)+", fields: "+r+", values: ["+o.join(", ")+"]} : null"}]})},modifyExpr:function(e,t){return t.name+Sg+", "+("global"===t.resolve?"true":"{unit: "+Og(e)+"}")},marks:function(e,t,n){var r=t.name,i=Fg(t),a=i.xi,o=i.yi,c="data("+v(t.name+_g)+")";if($p.has(t))return n;var u={x:null!==a?{signal:r+"_x[0]"}:{value:0},y:null!==o?{signal:r+"_y[0]"}:{value:0},x2:null!==a?{signal:r+"_x[1]"}:{field:{group:"width"}},y2:null!==o?{signal:r+"_y[1]"}:{field:{group:"height"}}};if("global"===t.resolve)for(var f=0,s=se(u);f<s.length;f++){var l=s[f];u[l]=[ne({test:c+".length && "+c+"[0].unit === "+Og(e)},u[l]),{value:0}]}var d=t.mark,h=d.fill,p=d.fillOpacity,g=re(d,["fill","fillOpacity"]),m=se(g).reduce(function(e,t){return e[t]=[{test:[null!==a&&r+"_x[0] !== "+r+"_x[1]",null!=o&&r+"_y[0] !== "+r+"_y[1]"].filter(function(e){return e}).join(" && "),value:g[t]},{value:null}],e},{});return[{name:r+tg+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:h},fillOpacity:{value:p}},update:u}}].concat(n,{name:r+tg,type:"rect",clip:!0,encode:{enter:{fill:{value:"transparent"}},update:ne({},u,m)}})}};function ig(e,t,n){var r=Mg(t,n,"visual"),i=Mg(t,n,"data"),a=$p.has(t),o=v(e.scaleName(n)),c=e.getScaleComponent(n),u=c?c.get("type"):void 0,f=e.getSizeSignalRef(n===rr?"width":"height").signal,s=n+"(unit)",l=ag(t,function(e,t){return e.concat({events:t.between[0],update:"["+s+", "+s+"]"},{events:t,update:"["+r+"[0], clamp("+s+", 0, "+f+")]"})});return l.push({events:{signal:t.name+ng},update:bi(u)&&!vi(u)?"[scale("+o+", "+i+"[0]), scale("+o+", "+i+"[1])]":"[0, 0]"}),a?[{name:i,on:[]}]:[{name:r,value:[],on:l},{name:i,on:[{events:{signal:r},update:r+"[0] === "+r+"[1] ? null : invert("+o+", "+r+")"}]}]}function ag(e,n){return e.events.reduce(function(e,t){return t.between?n(e,t):(Ke(t+" is not an ordered event stream for interval selections"),e)},[])}var og="voronoi",cg={has:function(e){return"interval"!==e.type&&e.nearest},marks:function(r,e,t){var n=Fg(e),i=n.x,a=n.y,o=r.mark;if(qn(o))return Ke(Be.nearestNotSupportForContinuous(o)),t;var c={name:r.getName(og),type:"path",from:{data:r.getName("marks")},encode:{enter:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}}},transform:[{type:"voronoi",x:{expr:i||!i&&!a?"datum.datum.x || 0":"0"},y:{expr:a||!i&&!a?"datum.datum.y || 0":"0"},size:[r.getSizeSignalRef("width"),r.getSizeSignalRef("height")]}]},u=0,f=!1;return t.forEach(function(e,t){var n=e.name||"";n===r.component.mark[0].name?u=t:0<=n.indexOf(og)&&(f=!0)}),f||t.splice(u+1,0,c),t}};function ug(n,e){var t=e.name,r=t+Sg+Zp,i=e.project,a=cg.has(e)?"(item().isVoronoi ? datum.datum : datum)":"datum",o=i.map(function(e){var t=n.fieldDef(e.channel);return t&&t.bin?"["+ye(n.vgField(e.channel,{}),a)+", "+ye(n.vgField(e.channel,{binSuffix:"end"}),a)+"]":""+ye(e.field,a)}).join(", ");return[{name:t+Sg,value:{},on:[{events:e.events,update:"datum && item().mark.marktype !== 'group' ? {unit: "+Og(n)+", fields: "+r+", values: ["+o+"]} : null",force:!0}]}]}var fg={signals:ug,modifyExpr:function(e,t){return t.name+Sg+", "+("global"===t.resolve?"null":"{unit: "+Og(e)+"}")}},sg={signals:ug,modifyExpr:function(e,t){return t.name+Sg+", "+("global"===t.resolve?"true":"{unit: "+Og(e)+"}")}},lg="_toggle",dg="_translate_anchor",hg="_translate_delta",pg={has:function(e){return"interval"===e.type&&e.translate},signals:function(e,t,n){var r=t.name,i=$p.has(t),a=r+dg,o=Fg(t),c=o.x,u=o.y,f=zi(t.translate,"scope");return i||(f=f.map(function(e){return e.between[0].markname=r+tg,e})),n.push({name:a,value:{},on:[{events:f.map(function(e){return e.between[0]}),update:"{x: x(unit), y: y(unit)"+(null!==c?", extent_x: "+(i?eg(e,rr):"slice("+Mg(t,"x","visual")+")"):"")+(null!==u?", extent_y: "+(i?eg(e,ir):"slice("+Mg(t,"y","visual")+")"):"")+"}"}]},{name:r+hg,value:{},on:[{events:f,update:"{x: "+a+".x - x(unit), y: "+a+".y - y(unit)}"}]}),null!==c&&gg(e,t,rr,"width",n),null!==u&&gg(e,t,ir,"height",n),n}};function gg(e,t,n,r,i){var a=t.name,o=$p.has(t),c=i.filter(function(e){return e.name===Mg(t,n,o?"data":"visual")})[0],u=a+dg,f=a+hg,s=e.getSizeSignalRef(r).signal,l=e.getScaleComponent(n),d=l.get("type"),h=u+".extent_"+n,p=(o?"log"===d?"panLog":"pow"===d?"panPow":"panLinear":"panLinear")+"("+h+", "+(""+(o&&n===rr?"-":"")+f+"."+n+" / "+(o?""+s:"span("+h+")"))+(o&&"pow"===d?", "+(l.get("exponent")||1):"")+")";c.on.push({events:{signal:f},update:o?p:"clampRange("+p+", 0, "+s+")"})}var mg="_zoom_anchor",vg="_zoom_delta",bg={has:function(e){return"interval"===e.type&&e.zoom},signals:function(e,t,n){var r=t.name,i=$p.has(t),a=r+vg,o=Fg(t),c=o.x,u=o.y,f=v(e.scaleName(rr)),s=v(e.scaleName(ir)),l=zi(t.zoom,"scope");return i||(l=l.map(function(e){return e.markname=r+tg,e})),n.push({name:r+mg,on:[{events:l,update:i?"{"+[f?"x: invert("+f+", x(unit))":"",s?"y: invert("+s+", y(unit))":""].filter(function(e){return!!e}).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:l,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),null!==c&&yg(e,t,"x","width",n),null!==u&&yg(e,t,"y","height",n),n}};function yg(e,t,n,r,i){var a=t.name,o=$p.has(t),c=i.filter(function(e){return e.name===Mg(t,n,o?"data":"visual")})[0],u=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(n),s=f.get("type"),l=o?eg(e,n):c.name,d=a+vg,h=(o?"log"===s?"zoomLog":"pow"===s?"zoomPow":"zoomLinear":"zoomLinear")+"("+l+", "+(""+a+mg+"."+n)+", "+d+(o&&"pow"===s?", "+(f.get("exponent")||1):"")+")";c.on.push({events:{signal:d},update:o?h:"clampRange("+h+", 0, "+u+")"})}var xg={project:{has:function(e){var t=e;return void 0!==t.fields||void 0!==t.encodings},parse:function(e,t,n){var r={},i={},a=n.project||(n.project=[]);n.fields={},t.fields&&a.push.apply(a,t.fields.map(function(e){return{field:e,type:"E"}}));for(var o=0,c=t.encodings||[];o<c.length;o++){var u=c[o],f=e.fieldDef(u);if(f){var s=f.field;if(f.timeUnit&&(r[s=e.vgField(u)]={as:s,field:f.field,timeUnit:f.timeUnit}),!i[s]){var l="E";if("interval"===n.type){var d=e.getScaleComponent(u).get("type");bi(d)&&!vi(d)&&(l="R")}else f.bin&&(l="R-RE");a.push(i[s]={field:s,channel:u,type:l})}n.fields[u]=s}else Ke(Be.cannotProjectOnChannelWithoutField(u))}se(r).length&&(n.timeUnit=new ep(null,r))},signals:function(e,t,n){var r=t.name+Sg+Zp;return n.filter(function(e){return e.name===r}).length?n:n.concat({name:r,update:""+JSON.stringify(t.project)})}},toggle:{has:function(e){return"multi"===e.type&&e.toggle},signals:function(e,t,n){return n.concat({name:t.name+lg,value:!1,on:[{events:t.events,update:t.toggle}]})},modifyExpr:function(e,t,n){var r=t.name+Sg,i=t.name+lg;return i+" ? null : "+r+", "+("global"===t.resolve?i+" ? null : true, ":i+" ? null : {unit: "+Og(e)+"}, ")+i+" ? "+r+" : null"}},scales:$p,translate:pg,zoom:bg,inputs:{has:function(e){return"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind},topLevelSignals:function(e,n,r){for(var i=n.name,t=n.project,a=n.bind,o=cg.has(n)?"(item().isVoronoi ? datum.datum : datum)":"datum",c=function(e){var t=ge(i+"_"+e.field);r.filter(function(e){return e.name===t}).length||r.unshift({name:t,value:"",on:[{events:n.events,update:"datum && item().mark.marktype !== 'group' ? "+ye(e.field,o)+" : null"}],bind:a[e.field]||a[e.channel]||a})},u=0,f=t;u<f.length;u++){c(f[u])}return r},signals:function(e,t,n){var r=t.name,i=t.project,a=n.filter(function(e){return e.name===r+Sg})[0],o=r+Sg+Zp,c=i.map(function(e){return ge(r+"_"+e.field)}),u=c.map(function(e){return e+" !== null"}).join(" && ");return c.length&&(a.update=u+" ? {fields: "+o+", values: ["+c.join(", ")+"]} : null"),delete a.value,delete a.on,n}},nearest:cg};function wg(e,t){for(var n in xg)xg[n].has(e)&&t(xg[n])}var _g="_store",Sg="_tuple",kg="_selection_domain_",Eg="vlSelectionResolve";function Cg(n,r){return Ag(n,function(t,e){r=e.marks?e.marks(n,t,r):r,wg(t,function(e){e.marks&&(r=e.marks(n,t,r))})}),r}function Ng(o,e,c){var u=[];var t=me(e,function(e){var t=ge(e),n=o.getSelectionComponent(t,e),r=v(t+_g);if(n.timeUnit){var i=c||o.component.data.raw,a=n.timeUnit.clone();i.parent?a.insertAsParentOf(i):i.parent=a}return"none"!==n.empty&&u.push(r),"vlSelectionTest("+r+", datum"+("global"===n.resolve?")":", "+v(n.resolve)+")")});return(u.length?"!("+u.map(function(e){return"length(data("+e+"))"}).join(" || ")+") || ":"")+"("+t+")"}function Ag(e,t){var n=e.component.selection;for(var r in n)if(n.hasOwnProperty(r)){var i=n[r];t(i,Tg(i.type))}}function Tg(e){switch(e){case"single":return sg;case"multi":return fg;case"interval":return rg}return null}function Og(e){var t=v(e.name),n=function(e){for(var t=e.parent;t&&!Gp(t);)t=t.parent;return t}(e);return n&&(t+=(n.facet.row?" + '_' + ("+ye(n.vgField("row"),"facet")+")":"")+(n.facet.column?" + '_' + ("+ye(n.vgField("column"),"facet")+")":"")),t}function Dg(e){var t=!1;return Ag(e,function(e){t=t||e.project.some(function(e){return e.field===Ki})}),t}function Mg(e,t,n){var r=e._signalNames||(e._signalNames={});if(r[t]&&r[t][n])return r[t][n];r[t]=r[t]||{};for(var i=ge(e.name+"_"+("visual"===n?t:e.fields[t])),a=i,o=1;r[a];)a=i+"_"+o++;return r[a]=r[t][n]=a}function Fg(e){var n=null,r=null,i=null,a=null;return e.project.forEach(function(e,t){e.channel===rr?(n=e,r=t):e.channel===ir&&(i=e,a=t)}),{x:n,xi:r,y:i,yi:a}}function zg(e){return e&&!!e.field&&void 0!==e.equal}function Ig(e){return e&&!!e.field&&void 0!==e.lt}function Ug(e){return e&&!!e.field&&void 0!==e.lte}function Rg(e){return e&&!!e.field&&void 0!==e.gt}function Lg(e){return e&&!!e.field&&void 0!==e.gte}function jg(e){return!!(e&&e.field&&_(e.range)&&2===e.range.length)}function Pg(e){return e&&!!e.field&&(_(e.oneOf)||_(e.in))}function qg(e){return Pg(e)||zg(e)||jg(e)||Ig(e)||Rg(e)||Ug(e)||Lg(e)}function Hg(n,e,r){return me(e,function(e){return g(e)?e:(t=e)&&t.selection?Ng(n,e.selection,r):Bg(e);var t})}function Wg(e,t){return Sn(e,{timeUnit:t,time:!0})}function Bg(e,t){void 0===t&&(t=!0);var n,r,i,a=e.field,o=e.timeUnit,c=o?"time("+Et(o,a)+")":$t(e,{expr:"datum"});if(zg(e))return c+"==="+Wg(e.equal,o);if(Ig(e))return c+"<"+Wg(f=e.lt,o);if(Rg(e))return c+">"+Wg(u=e.gt,o);if(Ug(e))return c+"<="+Wg(f=e.lte,o);if(Lg(e))return c+">="+Wg(u=e.gte,o);if(Pg(e))return"indexof(["+(r=e.oneOf,i=o,r.map(function(e){return Wg(e,i)})).join(",")+"], "+c+") !== -1";if((n=e)&&n.field&&void 0!==n.valid)return e.valid?c+"!==null&&!isNaN("+c+")":c+"===null||isNaN("+c+")";if(jg(e)){var u=e.range[0],f=e.range[1];if(null!==u&&null!==f&&t)return"inrange("+c+", ["+Wg(u,o)+", "+Wg(f,o)+"])";var s=[];return null!==u&&s.push(c+" >= "+Wg(u,o)),null!==f&&s.push(c+" <= "+Wg(f,o)),0<s.length?s.join(" && "):"true"}throw new Error("Invalid field predicate: "+JSON.stringify(e))}function Yg(e){return qg(e)&&e.timeUnit?ne({},e,{timeUnit:At(e.timeUnit)}):e}function Gg(e,t){var n=t[e+"Offset"];if(n)return n}function Vg(e,t,n,r){return Xg(e,t,{binSuffix:"start"===n?void 0:"end"},r?{offset:r}:{})}function Xg(e,t,n,r){var i=ne({},t?{scale:t}:{},{field:$t(e,n)});return r?ne({},i,r):i}function Qg(e,t){return void 0===t&&(t=!0),{scale:e,band:t}}function Jg(e,t,n){return{signal:'scale("'+e+'", ('+$t(t,{expr:"datum"})+" + "+(void 0!==n?$t(n,{expr:"datum"}):$t(t,{binSuffix:"end",expr:"datum"}))+") / 2)"}}function Kg(e,t,n,r,i,a,o){if(t){if(Gt(t)){if(Qr(t.bin))return X([rr,ir],e)&&t.type===Ft?a&&a.impute?Xg(t,r,{binSuffix:"mid"}):Jg(r,t):Xg(t,r,Am(t,e)?{binSuffix:"range"}:{});if(Jr(t.bin)){if(Gt(n))return Jg(r,t,n);Ke(Be.channelRequiredForBinned(e))}if(i){var c=i.get("type");if(mi(c))return"band"===c?Xg(t,r,{binSuffix:"range"},{band:.5}):Xg(t,r,{binSuffix:"range"})}return Xg(t,r,{})}if(Xt(t)){var u=t.value;return X(["x","x2"],e)&&"width"===u?{field:{group:"width"}}:X(["y","y2"],e)&&"height"===u?{field:{group:"height"}}:{value:u}}}return"function"==typeof o?o():o}function Zg(e,t){for(var n=[],r={},i=0,a=e;i<a.length;i++){var o=a[i],c=sn(o,t,{allowDisabling:!1}),u=$g(o,t).signal;r[c]||n.push('"'+c+'": '+u),r[c]=!0}return n.length?{signal:"{"+n.join(", ")+"}"}:void 0}function $g(e,t){if(e){if(Xt(e))return{value:e.value};if(Gt(e))return bm(e,hn(e),"datum",t)}}function em(e){return ne({},e,{mult:.5})}function tm(t,n,r,i,a){return function(){if(g(t)){if(r){var e=i.get("type");if(X([$r.LOG,$r.TIME,$r.UTC],e))"bar"!==a&&"area"!==a||Ke(Be.nonZeroScaleUsedWithLengthMark(a,n,{scaleType:e}));else{if(function(e){if(!1!==e.get("zero"))return!0;var t=e.domains;return!!_(t)&&J(t,function(e){return _(e)&&2===e.length&&e[0]<=0&&0<=e[1]})}(i))return{scale:r,value:0};"bar"!==a&&"area"!==a||Ke(Be.nonZeroScaleUsedWithLengthMark(a,n,{zeroFalse:!1===i.explicit.zero}))}}return"zeroOrMin"===t?"x"===n?{value:0}:{field:{group:"height"}}:"x"===n?{field:{group:"width"}}:{value:0}}return t}}function nm(e){var t,n,r=e.markDef,i=e.encoding,a=e.config,o=r.filled,c=r.type,u={fill:mm("fill",r,a),stroke:mm("stroke",r,a),color:mm("color",r,a)},f=X(["bar","point","circle","square","geoshape"],c)?"transparent":void 0,s={fill:ke(r.fill,u.fill,f),stroke:ke(r.stroke,u.stroke)},l=o?"fill":"stroke",d=ne({},s.fill?{fill:{value:s.fill}}:{},s.stroke?{stroke:{value:s.stroke}}:{});return i.fill||i.stroke?(r.color&&Ke(Be.droppingColor("property",{fill:"fill"in i,stroke:"stroke"in i})),ne({},cm("fill",e,{defaultValue:ke(s.fill,f)}),cm("stroke",e,{defaultValue:s.stroke}))):i.color?ne({},d,cm("color",e,{vgChannel:l,defaultValue:ke(r[l],r.color,u[l],u.color,o?f:void 0)})):void 0!==r.fill||void 0!==r.stroke?(r.color&&Ke(Be.droppingColor("property",{fill:"fill"in r,stroke:"stroke"in r})),d):r.color?ne({},d,((t={})[l]={value:r.color},t)):void 0!==u.fill||void 0!==u.stroke?d:u.color?ne({},f?{fill:{value:"transparent"}}:{},((n={})[l]={value:u.color},n)):{}}function rm(e,t){var r,i,a,o,n,c,u,f=nm(e),s=f.fill,l=f.stroke;return ne({},(c=e.markDef,u=t,Wa.reduce(function(e,t){return void 0!==c[t]&&"ignore"!==u[t]&&(e[t]={value:c[t]}),e},{})),im(e,"fill",s),im(e,"stroke",l),cm("opacity",e),(i=(r=e).encoding,a=r.markDef,o=r.config,n=i.tooltip,_(n)?{tooltip:Zg(n,o)}:um(r,n,"tooltip",function(e){var t=$g(e,r.config);if(t)return t;var n=ke(a.tooltip,mm("tooltip",a,o));return g(n)?{value:n}:ee(n)?"encoding"===n.content?Zg(Im(i),o):{signal:"datum"}:void 0})),fm(e,"href"))}function im(e,t,n){var r,i,a,o=e.config,c=e.mark;if(o.invalidValues&&n&&!qn(c)){var u=am(e,{invalid:!0,channels:Hr});if(u)return(r={})[t]=[{test:u,value:null}].concat(null!=(a=n)?_(a)?a:[a]:[]),r}return n?((i={})[t]=n,i):{}}function am(a,e){var t=e.invalid,n=void 0!==t&&t,r=e.channels.reduce(function(e,t){var n=a.getScaleComponent(t);if(n){var r=n.get("type"),i=a.vgField(t,{expr:"datum"});i&&bi(r)&&(e[i]=!0)}return e},{}),i=se(r);if(0<i.length){var o=n?"||":"&&";return i.map(function(e){return e+" "+(n?"===":"!==")+" null "+o+" "+(n?"":"!")+"isNaN("+e+")"}).join(" "+o+" ")}}function om(e){if("filter"===e.config.invalidValues){var t=am(e,{channels:["x","y"]});if(t)return{defined:{signal:t}}}return{}}function cm(t,n,e){void 0===e&&(e={});var r=e.defaultValue,i=e.vgChannel,a=e.defaultRef||(void 0!==r?{value:r}:void 0),o=n.encoding[t];return um(n,o,i||t,function(e){return Kg(t,e,void 0,n.scaleName(t),n.getScaleComponent(t),null,a)})}function um(r,e,t,i){var n,a,o=e&&e.condition,c=i(e);if(o){var u=(_(o)?o:[o]).map(function(e){var t=i(e),n=Pt(e)?Ng(r,e.selection):Hg(r,e.test);return ne({test:n},t)});return(n={})[t]=u.concat(void 0!==c?[c]:[]),n}return void 0!==c?((a={})[t]=c,a):{}}function fm(t,e){void 0===e&&(e="text");var n=t.encoding[e];return um(t,n,e,function(e){return $g(e,t.config)})}function sm(e,t,n){var r,i,a,o=n.scaleName(t),c="x"===t?"width":"height";if(n.encoding.size||void 0!==n.markDef.size)if(n.markDef.orient){var u=((r={})[t+"c"]=Xg(e,o,{},{band:.5}),r);if(gn(n.encoding.size))return ne({},u,cm("size",n,{vgChannel:c}));if(Xt(n.encoding.size))return ne({},u,cm("size",n,{vgChannel:c}));if(void 0!==n.markDef.size)return ne({},u,((i={})[c]={value:n.markDef.size},i))}else Ke(Be.cannotApplySizeToNonOrientedMark(n.markDef.type));return(a={})[t]=Xg(e,o,{binSuffix:"range"}),a[c]=Qg(o),a}function lm(e,t,n,r){var i="x"===e?"width":"height";return ne({},hm(e,t,n,"x"===e?"xc":"yc"),cm("size",t,{defaultRef:r,vgChannel:i}))}function dm(e,t,n,r,i,a){var o,c,u={x:a?i:0,x2:a?0:i,y:a?0:i,y2:a?i:0},f=n===rr?ar:or;return Qr(e.bin)?((o={})[f]=Vg(e,r,"start",u[n+"2"]),o[n]=Vg(e,r,"end",u[n]),o):Jr(e.bin)&&Gt(t)?((c={})[f]=Xg(e,r,{},{offset:u[n+"2"]}),c[n]=Xg(t,r,{},{offset:u[n]}),c):void Ke(Be.channelRequiredForBinned(f))}function hm(e,t,n,r){var i,a,o,c,u,f,s,l,d=t.encoding,h=t.mark,p=t.stack,g=d[e],m=d[e===rr?ar:or],v=t.scaleName(e),b=t.getScaleComponent(e),y=Gg(e,t.markDef),x=g||!d.latitude&&!d.longitude?ne({},(o=g,c=m,s=p,l=tm(n,a=e,u=v,f=b,h),Gt(o)&&s&&a===s.fieldChannel?Xg(o,u,{suffix:"end"}):Kg(a,o,c,u,f,s,l)),y?{offset:y}:{}):{field:t.getName(e)};return(i={})[r||e]=x,i}function pm(e,t,n){var r,i,a,o,c,u,f,s,l=e.encoding,d=e.mark,h=e.stack,p="x2"===n?"x":"y",g=l[p],m=e.scaleName(p),v=e.getScaleComponent(p),b=Gg(n,e.markDef),y=g||!l.latitude&&!l.longitude?ne({},(a=g,o=l[i=n],f=h,s=tm(t,p,c=m,u=v,d),Gt(a)&&f&&i.charAt(0)===f.fieldChannel.charAt(0)?Xg(a,c,{suffix:"start"}):Kg(i,o,void 0,c,u,f,s)),b?{offset:b}:{}):{field:e.getName(n)};return(r={})[n]=y,r}function gm(e){return[].concat(e.type,e.style||[])}function mm(e,t,n,r){var i=(void 0===r?{}:r).skipGeneralMarkConfig,a=void 0!==i&&i;return ke(vm(e,t,n.style),n[t.type][e],a?void 0:n.mark[e])}function vm(e,t,n){for(var r,i=0,a=gm(t);i<a.length;i++){var o=n[a[i]],c=e;o&&void 0!==o[c]&&(r=o[c])}return r}function bm(e,t,n,r){var i=ym(e,t,r);if(Qr(e.bin))return{signal:_m($t(e,{expr:n}),$t(e,{expr:n,binSuffix:"end"}),i,r)};if("quantitative"===e.type)return{signal:""+xm($t(e,{expr:n,binSuffix:"range"}),i)};if(_n(e)){var a=Qt(e)&&e.scale&&e.scale.type===$r.UTC;return{signal:Sm($t(e,{expr:n}),e.timeUnit,t,r.text.shortTimeLabels,r.timeFormat,a,!0)}}return{signal:"''+"+$t(e,{expr:n})}}function ym(e,t,n){if(!_n(e))return t||(e.type===Ft?n.numberFormat:void 0)}function xm(e,t){return"format("+e+', "'+(t||"")+'")'}function wm(e,t,n){return xm(e,t||n.numberFormat)}function _m(e,t,n,r){return e+" === null || isNaN("+e+') ? "null" : '+wm(e,n,r)+' + " - " + '+wm(t,n,r)}function Sm(e,t,n,r,i,a,o){return void 0===o&&(o=!1),!t||n?(n=n||i)||o?(a?"utc":"time")+"Format("+e+", '"+n+"')":void 0:Nt(t,e,r,a)}function km(e,n){return(_(e)?e:[e]).reduce(function(e,t){return e.field.push($t(t,n)),e.order.push(t.sort||"ascending"),e},{field:[],order:[]})}function Em(e,t){var i=e.slice();return t.forEach(function(e){for(var t=0,n=i;t<n.length;t++){var r=n[t];if(G(r)===G(e))return}i.push(e)}),i}function Cm(e,t){return e!==t&&t?e?e+", "+t:t:e}function Nm(e,t){if(_(e.value)&&_(t.value))return{explicit:e.explicit,value:Em(e.value,t.value)};if(!_(e.value)&&!_(t.value))return{explicit:e.explicit,value:Cm(e.value,t.value)};throw new Error("It should never reach here")}function Am(e,t){return Qr(e.bin)?Wr(t)&&X(["ordinal","nominal"],e.type):(console.warn("Only use this method with binned field defs"),!1)}function Tm(r,i){return se(r).reduce(function(e,t){var n=r[t];return ne({},e,um(i,n,t,function(e){return{value:e.value}}))},{})}function Om(e,t){var n=e&&e[t];return!!n&&(_(n)?J(n,function(e){return!!e.field}):Gt(n)||Bt(n))}function Dm(r){return J(Or,function(e){if(Om(r,e)){var t=r[e];if(_(t))return J(t,function(e){return!!e.aggregate});var n=gn(t);return n&&!!n.aggregate}return!1})}function Mm(g,m){var v=[],b=[],y=[],x=[],w={};return Um(g,function(e,t){var n=e.field,r=e.aggregate,i=e.timeUnit,a=e.bin,o=re(e,["field","aggregate","timeUnit","bin"]);if(Gt(e)&&(r||i||a)){var c=ln(e),u=c&&c.title,f=$t(e,{forAs:!0}),s=ne({},u?[]:{title:sn(e,m,{allowDisabling:!0})},o,{field:f}),l=t===Gn.X||t===Gn.Y;if(r&&Oe(r)){var d={op:r,as:f};n&&(d.field=n),x.push(d)}else if(Qr(a)){if(b.push({bin:a,field:n,as:f}),v.push($t(e,{binSuffix:"end"})),Am(e,t)&&v.push($t(e,{binSuffix:"range"})),l){var h={field:f+"_end",type:Tt.QUANTITATIVE};w[t+"2"]=h}s.bin="binned",s.type=Tt.QUANTITATIVE}else if(i){y.push({timeUnit:i,field:n,as:f});var p=Ct(i,m.axis.shortTimeLabels).join(" ");Pr(t)?s.legend=ne({format:p},s.legend):l?s.axis=ne({format:p},s.axis):"text"!==t&&"tooltip"!==t||(s.format=s.format||p)}r||v.push(f),w[t]=s}else Gt(e)&&v.push(n),w[t]=g[t]}),{bins:b,timeUnits:y,aggregate:x,groupby:v,encoding:w}}function Fm(i,a){return se(i).reduce(function(e,n){if(!Mr(n))return Ke(Be.invalidEncodingChannel(n)),e;if(!Br(i,n,a))return Ke(Be.incompatibleChannel(n,a)),e;if("size"===n&&"line"===a){var t=gn(i[n]);if(t&&t.aggregate)return Ke(Be.LINE_WITH_VARYING_SIZE),e}if("color"===n&&("fill"in i||"stroke"in i))return Ke(Be.droppingColor("encoding",{fill:"fill"in i,stroke:"stroke"in i})),e;var r=i[n];if("detail"===n||"order"===n&&!_(r)&&!Xt(r)||"tooltip"===n&&_(r))r&&(e[n]=(_(r)?r:[r]).reduce(function(e,t){return Gt(t)?e.push(vn(t,n)):Ke(Be.emptyFieldDef(t,n)),e},[]));else{if(!Gt(r)&&!Xt(r)&&!Wt(r))return Ke(Be.emptyFieldDef(r,n)),e;e[n]=mn(r,n)}return e},{})}function zm(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)}function Im(n){var r=[];return Or.forEach(function(e){if(Om(n,e)){var t=n[e];(_(t)?t:[t]).forEach(function(e){Gt(e)?r.push(e):Bt(e)&&r.push(e.condition)})}}),r}function Um(e,n,r){if(e)for(var t=function(t){_(e[t])?e[t].forEach(function(e){n.call(r,e,t)}):n.call(r,e[t],t)},i=0,a=se(e);i<a.length;i++){t(a[i])}}function Rm(r,i,e,a){return r?se(r).reduce(function(e,n){var t=r[n];return _(t)?t.reduce(function(e,t){return i.call(a,e,t,n)},e):i.call(a,e,t,n)},e):e}var Lm=Object.freeze({channelHasField:Om,isAggregate:Dm,extractTransformsFromEncoding:Mm,normalizeEncoding:Fm,isRanged:zm,fieldDefs:Im,forEach:Um,reduce:Rm});function jm(u,f,s,l,d){var h=s.scale,p=s.axis;return function(e,t,n,r,i){var a,o;void 0===r&&(r=void 0),void 0===i&&(i={});var c=p&&void 0!==p.title?void 0:void 0!==s.title?s.title:s.field;return Pm(u,e,d,{mark:t,encoding:ne((a={},a[f]=ne({field:n+"_"+s.field,type:s.type},c?{title:c}:{},h?{scale:h}:{},p?{axis:p}:{}),a),g(r)?(o={},o[f+"2"]={field:r+"_"+s.field,type:s.type},o):{},l,i)})}}function Pm(e,t,n,r){var i=e.clip,a=e.color,o=e.opacity,c=e.type;return e[t]||void 0===e[t]&&n[t]?[ne({},r,{mark:ne({},n[t],i?{clip:i}:{},a?{color:a}:{},o?{opacity:o}:{},Wn(r.mark)?r.mark:{type:r.mark},{style:c+"-"+t},f(e[t])?{}:e[t])})]:[]}function qm(e,t,n){var r,i,a,o=e.encoding;if(i="vertical"===t?(a="y",r=o.y,o.y2?o.y2:void 0):(a="x",r=o.x,o.x2?o.x2:void 0),r&&r.aggregate){var c=r.aggregate,u=re(r,["aggregate"]);c!==n&&Ke(Be.errorBarContinuousAxisHasCustomizedAggregate(c,n)),r=u}if(i&&i.aggregate){c=i.aggregate;var f=re(i,["aggregate"]);c!==n&&Ke(Be.errorBarContinuousAxisHasCustomizedAggregate(c,n)),i=f}return{continuousAxisChannelDef:r,continuousAxisChannelDef2:i,continuousAxis:a}}function Hm(e,t){var n=e.mark,r=e.encoding;if(Gt(r.x)&&tn(r.x)){if(Gt(r.y)&&tn(r.y)){if(void 0===r.x.aggregate&&r.y.aggregate===t)return"vertical";if(void 0===r.y.aggregate&&r.x.aggregate===t)return"horizontal";if(r.x.aggregate===t&&r.y.aggregate===t)throw new Error("Both x and y cannot have aggregate");return Wn(n)&&n.orient?n.orient:"vertical"}return"horizontal"}if(Gt(r.y)&&tn(r.y))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}function Wm(e,r,i){return ne({},e,{encoding:Rm(e.encoding,function(e,t,n){return-1<r.indexOf(n)?e[n]=t:Ke(Be.incompatibleChannel(n,i)),e},{})})}var Bm="boxplot",Ym=se({box:1,median:1,outliers:1,rule:1,ticks:1}),Gm=["x","y","color","detail","opacity","size"];function Vm(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}var Xm="errorbar",Qm=se({ticks:1,rule:1});var Jm=["x","y","x2","y2","color","detail","opacity"];function Km(e,t,n){var r=(e=Wm(e,Jm,t)).mark,i=e.encoding,a=e.selection,o=(e.projection,re(e,["mark","encoding","selection","projection"])),c=Wn(r)?r:{type:r};a&&Ke(Be.selectionNotSupported(t));var u=function(e,t){var n=e.encoding;if(Gt(n.x2)&&Gt(n.x)&&tn(n.x)){if(Gt(n.y2)&&Gt(n.y)&&tn(n.y))throw new Error("Cannot have both x2 and y2 with both are quantiative");return{orient:"horizontal",isRangedErrorBar:!0}}return Gt(n.y2)&&Gt(n.y)&&tn(n.y)?{orient:"vertical",isRangedErrorBar:!0}:{orient:Hm(e,t),isRangedErrorBar:!1}}(e,t),f=u.orient,s=u.isRangedErrorBar,l=qm(e,f,t),d=l.continuousAxisChannelDef,h=l.continuousAxisChannelDef2,p=l.continuousAxis,g=function(e,t,n,r,i,a){var o=[],c=[],u=t.field;if(r)(e.center||e.extent)&&Ke(Be.errorBarCenterAndExtentAreNotNeeded(e.center,e.extent)),c=[{calculate:"datum."+u,as:"lower_"+u},{calculate:"datum."+n.field,as:"upper_"+u}];else{var f=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":a.errorbar.center,s=e.extent?e.extent:"mean"===f?"stderr":"iqr";"median"===f!=("iqr"===s)&&Ke(Be.errorBarCenterIsUsedWithWrongExtent(f,s,i)),"stderr"===s||"stdev"===s?(o=[{op:s,field:u,as:"extent_"+u},{op:f,field:u,as:"center_"+u}],c=[{calculate:"datum.center_"+u+" + datum.extent_"+u,as:"upper_"+u},{calculate:"datum.center_"+u+" - datum.extent_"+u,as:"lower_"+u}]):(e.center&&e.extent&&Ke(Be.errorBarCenterIsNotNeeded(e.extent,i)),o=[{op:"ci"===s?"ci0":"q1",field:u,as:"lower_"+u},{op:"ci"===s?"ci1":"q3",field:u,as:"upper_"+u}])}return{postAggregateCalculates:c,errorBarSpecificAggregate:o}}(c,d,h,s,t,n),m=g.errorBarSpecificAggregate,v=g.postAggregateCalculates,b=p,y=(i[b],p+"2"),x=(i[y],Mm(re(i,["symbol"==typeof b?b:b+"","symbol"==typeof y?y:y+""]),n)),w=x.bins,_=x.timeUnits,S=x.aggregate,k=x.groupby,E=x.encoding,C=S.concat(m),N=s?[]:k;return{transform:(o.transform||[]).concat(w,_,C.length?[{aggregate:C,groupby:N}]:[],v),groupby:N,continuousAxisChannelDef:d,continuousAxis:p,encodingWithoutContinuousAxis:E,ticksOrient:"vertical"===f?"horizontal":"vertical",markDef:c,outerSpec:o}}var Zm="errorband",$m=se({band:1,borders:1});var ev={};function tv(e,t,n){ev[e]={normalizer:t,parts:n}}function nv(){return se(ev)}function rv(e,t){var n=Wn(e.mark)?e.mark.type:e.mark;if(n in ev)return(0,ev[n].normalizer)(e,t);throw new Error('Invalid mark type "'+n+'"')}tv(Bm,function(e,t){var n,r=(e=Wm(e,Gm,Bm)).mark,i=(e.encoding,e.selection),a=(e.projection,re(e,["mark","encoding","selection","projection"])),o=Wn(r)?r:{type:r};i&&Ke(Be.selectionNotSupported("boxplot"));var c,u,f,s,l,d,h,p,g,m,v,b,y,x,w,_,S,k,E,C,N=o.extent||t.boxplot.extent,A=ke(o.size,t.boxplot.size),T=!te(N),O=(u=N,f=t,s=Hm(c=e,Bm),l=qm(c,s,Bm),d=l.continuousAxisChannelDef,h=l.continuousAxis,p=d.field,g=!te(u),m=Vm(p).concat([{op:"median",field:p,as:"mid_box_"+p},{op:"min",field:p,as:(g?"lower_whisker_":"min_")+p},{op:"max",field:p,as:(g?"upper_whisker_":"max_")+p}]),v=g?[]:[{calculate:"datum.upper_box_"+p+" - datum.lower_box_"+p,as:"iqr_"+p},{calculate:"min(datum.upper_box_"+p+" + datum.iqr_"+p+" * "+u+", datum.max_"+p+")",as:"upper_whisker_"+p},{calculate:"max(datum.lower_box_"+p+" - datum.iqr_"+p+" * "+u+", datum.min_"+p+")",as:"lower_whisker_"+p}],(b=c.encoding)[y=h],x=Mm(re(b,["symbol"==typeof y?y:y+""]),f),w=x.bins,_=x.timeUnits,S=x.aggregate,k=x.groupby,E=x.encoding,C="vertical"===s?"horizontal":"vertical",{transform:w.concat(_,[{aggregate:S.concat(m),groupby:k}],v),groupby:k,continuousAxisChannelDef:d,continuousAxis:h,encodingWithoutContinuousAxis:E,tickOrient:C}),D=O.transform,M=O.continuousAxisChannelDef,F=O.continuousAxis,z=O.groupby,I=O.encodingWithoutContinuousAxis,U=O.tickOrient,R=(I.color,I.size),L=re(I,["color","size"]),j=function(e){return jm(o,F,M,e,t.boxplot)},P=j(L),q=j(I),H=j(ne({},L,R?{size:R}:{})),W={type:"tick",color:"black",opacity:1,orient:U},B=ne({type:"bar"},A?{size:A}:{}),Y=ne({type:"tick"},ee(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{},A?{size:A}:{},{orient:U}),G=P("rule","rule","lower_whisker","lower_box").concat(P("rule","rule","upper_box","upper_whisker"),P("ticks",W,"lower_whisker"),P("ticks",W,"upper_whisker"),q("box",B,"lower_box","upper_box"),H("median",Y,"mid_box")),V=[];if(!T){var X="datum.lower_box_"+M.field,Q="datum.upper_box_"+M.field,J="("+Q+" - "+X+")",K=X+" - "+N+" * "+J,Z=Q+" + "+N+" * "+J,$="datum."+M.field;V=Pm(o,"outliers",t.boxplot,{transform:[{window:Vm(M.field),frame:[null,null],groupby:z},{filter:"("+$+" < "+K+") || ("+$+" > "+Z+")"}],mark:"point",encoding:ne((n={},n[F]={field:M.field,type:M.type},n),L)})}return 0<V.length?ne({},a,{layer:[{transform:D,layer:G}].concat(V)}):ne({},a,{transform:(a.transform||[]).concat(D),layer:G})},Ym),tv(Xm,function(e,t){var n=Km(e,Xm,t),r=n.transform,i=n.continuousAxisChannelDef,a=n.continuousAxis,o=n.encodingWithoutContinuousAxis,c=n.ticksOrient,u=n.markDef,f=n.outerSpec,s=jm(u,a,i,o,t.errorbar),l={type:"tick",orient:c};return ne({},f,{transform:r,layer:s("ticks",l,"lower").concat(s("ticks",l,"upper"),s("rule","rule","lower","upper"))})},Qm),tv(Zm,function(e,t){var n=Km(e,Zm,t),r=n.transform,i=n.continuousAxisChannelDef,a=n.continuousAxis,o=n.encodingWithoutContinuousAxis,c=n.markDef,u=n.outerSpec,f=jm(c,a,i,o,t.errorband),s=void 0!==e.encoding.x&&void 0!==e.encoding.y,l={type:s?"area":"rect"},d={type:s?"line":"rule"},h=ne({},c.interpolate?{interpolate:c.interpolate}:{},c.tension&&c.interpolate?{interpolate:c.tension}:{});return s?(l=ne({},l,h),d=ne({},d,h)):c.interpolate?Ke(Be.errorBand1DNotSupport("interpolate")):c.tension&&Ke(Be.errorBand1DNotSupport("tension")),ne({},u,{transform:r,layer:f("band",l,"lower","upper").concat(f("borders",d,"lower"),f("borders",d,"upper"))})},$m);var iv=Object.freeze({add:tv,remove:function(e){delete ev[e]},getAllCompositeMarks:nv,getCompositeMarkParts:function(e){if(e in ev)return ev[e].parts;throw new Error("Unregistered composite mark "+e)},normalize:rv});function av(e,t,n){var r;r="as"in e?g(e.as)?[e.as,e.as+"_end"]:[e.as[0],e.as[1]]:[$t(e,{forAs:!0}),$t(e,{binSuffix:"end",forAs:!0})];var i,a,o,c,u=bn(t,void 0)||{},f=(i=u,a=e.field,Xr(i)+"_"+a),s=(c=f,{signal:(o=n).getName(c+"_bins"),extentSignal:o.getName(c+"_extent")}),l=s.signal,d=s.extentSignal;return{key:f,binComponent:ne({bin:u,field:e.field,as:r},l?{signal:l}:{},d?{extentSignal:d}:{})}}var ov=function(r){function c(e,t){var n=r.call(this,e)||this;return n.bins=t,n}return p(c,r),c.prototype.clone=function(){return new c(null,he(this.bins))},c.makeFromEncoding=function(e,o){var t=o.reduceFieldDef(function(e,t,n){if(Qr(t.bin)){var r=av(t,t.bin,o),i=r.key,a=r.binComponent;e[i]=ne({},a,e[i],function(e,t,n,r){if(Am(t,n)){var i=Yp(e)&&(e.axis(n)||e.legend(n))||{},a=$t(t,{expr:"datum"}),o=$t(t,{expr:"datum",binSuffix:"end"});return{formulaAs:$t(t,{binSuffix:"range",forAs:!0}),formula:_m(a,o,i.format,r)}}return{}}(o,t,n,o.config))}return e},{});return 0===se(t).length?null:new c(e,t)},c.makeFromTransform=function(e,t,n){var r,i=av(t,t.bin,n),a=i.key,o=i.binComponent;return new c(e,((r={})[a]=o,r))},c.prototype.merge=function(e){this.bins=ne({},this.bins,e.bins),e.remove()},c.prototype.producedFields=function(){var t={};return le(this.bins).forEach(function(e){e.as.forEach(function(e){return t[e]=!0})}),t},c.prototype.dependentFields=function(){var t={};return le(this.bins).forEach(function(e){t[e.field]=!0}),t},c.prototype.hash=function(){return"Bin "+V(this.bins)},c.prototype.assemble=function(){return Z(le(this.bins).map(function(e){var t=[],n=ne({type:"bin",field:e.field,as:e.as,signal:e.signal},e.bin);return!e.bin.extent&&e.extentSignal&&(t.push({type:"extent",field:e.field,signal:e.extentSignal}),n.extent={signal:e.extentSignal}),t.push(n),e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))},c}(io),cv=function(i){function e(e,t,n){var r=i.call(this,e)||this;return r.model=t,r.filter=n,r.expr=Hg(r.model,r.filter,r),r._dependentFields=Ac(r.expr),r}return p(e,i),e.prototype.clone=function(){return new e(null,this.model,he(this.filter))},e.prototype.dependentFields=function(){return this._dependentFields},e.prototype.assemble=function(){return{type:"filter",expr:this.expr}},e.prototype.hash=function(){return"Filter "+this.expr},e}(io),uv=function(c){function e(e,t){var n=c.call(this,e)||this;n.transform=t;var r=n.transform,i=r.flatten,a=r.as,o=void 0===a?[]:a;return n.transform.as=i.map(function(e,t){return o[t]||e}),n}return p(e,c),e.prototype.clone=function(){return new e(this.parent,he(this.transform))},e.prototype.producedFields=function(){var r=this;return this.transform.flatten.reduce(function(e,t,n){return e[r.transform.as[n]]=!0,e},{})},e.prototype.hash=function(){return"FlattenTransform "+V(this.transform)},e.prototype.assemble=function(){var e=this.transform;return{type:"flatten",fields:e.flatten,as:e.as}},e}(io),fv=function(i){function e(e,t){var n=i.call(this,e)||this;n.transform=t;var r=n.transform.as||[void 0,void 0];return n.transform.as=[r[0]||"key",r[1]||"value"],n}return p(e,i),e.prototype.clone=function(){return new e(null,he(this.transform))},e.prototype.producedFields=function(){return this.transform.as.reduce(function(e,t){return e[t]=!0,e},{})},e.prototype.hash=function(){return"FoldTransform "+V(this.transform)},e.prototype.assemble=function(){var e=this.transform;return{type:"fold",fields:e.fold,as:e.as}},e}(io),sv=function(a){function o(e,t,n,r){var i=a.call(this,e)||this;return i.fields=t,i.geojson=n,i.signal=r,i}return p(o,a),o.prototype.clone=function(){return new o(null,he(this.fields),this.geojson,this.signal)},o.parseAll=function(n,r){var i=0;if([[fr,cr],[sr,ur]].forEach(function(e){var t=e.map(function(e){return r.channelHasField(e)?r.fieldDef(e).field:void 0});(t[0]||t[1])&&(n=new o(n,t,null,r.getName("geojson_"+i++)))}),r.channelHasField(hr)){var e=r.fieldDef(hr);e.type===Rt&&(n=new o(n,null,e.field,r.getName("geojson_"+i++)))}return n},o.prototype.assemble=function(){return ne({type:"geojson"},this.fields?{fields:this.fields}:{},this.geojson?{geojson:this.geojson}:{},{signal:this.signal})},o}(io),lv=function(a){function o(e,t,n,r){var i=a.call(this,e)||this;return i.projection=t,i.fields=n,i.as=r,i}return p(o,a),o.prototype.clone=function(){return new o(null,this.projection,he(this.fields),he(this.as))},o.parseAll=function(r,i){return i.projectionName()&&[[fr,cr],[sr,ur]].forEach(function(e){var t=e.map(function(e){return i.channelHasField(e)?i.fieldDef(e).field:void 0}),n=e[0]===sr?"2":"";(t[0]||t[1])&&(r=new o(r,i.projectionName(),t,[i.getName("x"+n),i.getName("y"+n)]))}),r},o.prototype.assemble=function(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}},o}(io),dv=function(t){function e(e){return t.call(this,e)||this}return p(e,t),e.prototype.clone=function(){return new e(null)},e.prototype.producedFields=function(){var e;return(e={})[Ki]=!0,e},e.prototype.assemble=function(){return{type:"identifier",as:Ki}},e}(io);function hv(e,t,n,r){if(void 0!==e.size)return{value:e.size};var i=mm("size",e,r,{skipGeneralMarkConfig:!0});if(void 0!==i)return{value:i};if(n){var a=n.get("type");if("point"!==a&&"band"!==a)return{value:r.bar.continuousBandSize};if(void 0!==r.bar.discreteBandSize)return{value:r.bar.discreteBandSize};if(a!==$r.POINT)return Qg(t);var o=n.get("range");if(qa(o)&&te(o.step))return{value:o.step-1};Ke(Be.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL)}return{value:ke(r.bar.discreteBandSize,r.scale.rangeStep?r.scale.rangeStep-1:void 0,20)}}function pv(e,t){var n=e.config,r=e.markDef,i=e.width,a=e.height;return ne({},rm(e,{size:"include",orient:"ignore"}),hm("x",e,em(i)),hm("y",e,em(a)),cm("size",e,{defaultValue:mm("size",r,n)}),function(e,t,n){if(n)return{shape:{value:n}};return cm("shape",e,{defaultValue:mm("shape",e.markDef,t)})}(e,n,t))}var gv={area:{vgMark:"area",encodeEntry:function(e){return ne({},rm(e,{size:"ignore",orient:"include"}),hm("x",e,"zeroOrMin"),hm("y",e,"zeroOrMin"),pm(e,"zeroOrMin","horizontal"===e.markDef.orient?"x2":"y2"),om(e))}},bar:{vgMark:"rect",encodeEntry:function(e){return ne({},rm(e,{size:"ignore",orient:"ignore"}),function(e){var t=e.config,n=e.encoding,r=e.markDef,i=e.width,a=r.orient,o=n.size,c=n.x,u=n.x2,f=e.scaleName(rr),s=e.getScaleComponent(rr);{if(Gt(c)&&Jr(c.bin))return dm(c,u,rr,f,ke(r.binSpacing,t.bar.binSpacing),s.get("reverse"));if("horizontal"===a||u)return ne({},hm("x",e,"zeroOrMin"),pm(e,"zeroOrMin","x2"));if(Gt(c)){var l=s.get("type");if(Qr(c.bin)&&!o&&!mi(l))return dm(c,void 0,rr,e.scaleName("x"),ke(r.binSpacing,t.bar.binSpacing),s.get("reverse"));if(l===$r.BAND)return sm(c,"x",e)}return lm("x",e,ne({},em(i)),hv(r,f,s,t))}}(e),function(e){var t=e.config,n=e.encoding,r=e.height,i=e.markDef,a=i.orient,o=n.size,c=n.y,u=n.y2,f=e.scaleName(ir),s=e.getScaleComponent(ir);{if(Gt(c)&&Jr(c.bin))return dm(c,u,ir,f,ke(i.binSpacing,t.bar.binSpacing),s.get("reverse"));if("vertical"===a||u)return ne({},hm("y",e,"zeroOrMin"),pm(e,"zeroOrMin","y2"));if(Gt(c)){var l=s.get("type");if(Qr(c.bin)&&!o&&!mi(l))return dm(c,void 0,ir,e.scaleName("y"),ke(i.binSpacing,t.bar.binSpacing),s.get("reverse"));if(l===$r.BAND)return sm(c,"y",e)}return lm("y",e,em(r),hv(i,f,s,t))}}(e))}},circle:{vgMark:"symbol",encodeEntry:function(e){return pv(e,"circle")}},geoshape:{vgMark:"shape",encodeEntry:function(e){return ne({},rm(e,{size:"ignore",orient:"ignore"}))},postEncodingTransform:function(e){var t=e.encoding.shape;return[ne({type:"geoshape",projection:e.projectionName()},t&&Gt(t)&&t.type===Rt?{field:$t(t,{expr:"datum"})}:{})]}},line:{vgMark:"line",encodeEntry:function(e){var t=e.width,n=e.height;return ne({},rm(e,{size:"ignore",orient:"ignore"}),hm("x",e,em(t)),hm("y",e,em(n)),cm("size",e,{vgChannel:"strokeWidth"}),om(e))}},point:{vgMark:"symbol",encodeEntry:function(e){return pv(e)}},rect:{vgMark:"rect",encodeEntry:function(e){return ne({},rm(e,{size:"ignore",orient:"ignore"}),function(e){var t=e.encoding.x,n=e.encoding.x2,r=e.getScaleComponent(rr),i=r?r.get("type"):void 0,a=e.scaleName(rr);{if(Gt(t)&&(Qr(t.bin)||Jr(t.bin)))return dm(t,n,rr,a,0,r.get("reverse"));if(Gt(t)&&r&&mi(i)){if(i===$r.BAND)return sm(t,"x",e);throw new Error(Be.scaleTypeNotWorkWithMark(In,i))}return ne({},hm("x",e,"zeroOrMax"),pm(e,"zeroOrMin","x2"))}}(e),function(e){var t=e.encoding.y,n=e.encoding.y2,r=e.getScaleComponent(ir),i=r?r.get("type"):void 0,a=e.scaleName(ir);{if(Gt(t)&&(Qr(t.bin)||Jr(t.bin)))return dm(t,n,ir,a,0,r.get("reverse"));if(Gt(t)&&r&&mi(i)){if(i===$r.BAND)return sm(t,"y",e);throw new Error(Be.scaleTypeNotWorkWithMark(In,i))}return ne({},hm("y",e,"zeroOrMax"),pm(e,"zeroOrMin","y2"))}}(e))}},rule:{vgMark:"rule",encodeEntry:function(e){var t=e.markDef,n=e.width,r=e.height,i=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?ne({},rm(e,{size:"ignore",orient:"ignore"}),hm("x",e,"horizontal"===i?"zeroOrMin":em(n)),hm("y",e,"vertical"===i?"zeroOrMin":em(r)),"vertical"!==i?pm(e,"zeroOrMax","x2"):{},"horizontal"!==i?pm(e,"zeroOrMax","y2"):{},cm("size",e,{vgChannel:"strokeWidth",defaultValue:t.size})):{}}},square:{vgMark:"symbol",encodeEntry:function(e){return pv(e,"square")}},text:{vgMark:"text",encodeEntry:function(e){var t=e.config,n=(e.encoding,e.width),r=e.height,i=e.markDef,a=ke(i.fontSize,i.size,vm("fontSize",i,t.style),vm("size",i,t.style),t[i.type].fontSize,t[i.type].size);return ne({},rm(e,{size:"ignore",orient:"ignore"}),hm("x",e,em(n)),hm("y",e,em(r)),fm(e),cm("size",e,{defaultValue:a,vgChannel:"fontSize"}),function(e,t){var n;if(void 0!==t)return(n={})[e]={value:t},n}("align",function(e,t,n){if(void 0!==(e.align||mm("align",e,n)))return;return"center"}(e.markDef,0,t)))}},tick:{vgMark:"rect",encodeEntry:function(e){var t,n=e.config,r=e.markDef,i=e.width,a=e.height,o=r.orient,c="horizontal"===o?"width":"height",u="horizontal"===o?"height":"width";return ne({},rm(e,{size:"ignore",orient:"ignore"}),hm("x",e,em(i),"xc"),hm("y",e,em(a),"yc"),cm("size",e,{defaultValue:function(e){var t=e.config,n=e.markDef,r=n.orient,i=e.getScaleComponent("horizontal"===r?"x":"y");{if(void 0!==n.size)return n.size;if(void 0!==t.tick.bandSize)return t.tick.bandSize;var a=i?i.get("range"):void 0,o=a&&qa(a)?a.step:t.scale.rangeStep;if("number"!=typeof o)throw new Error("Function does not handle non-numeric rangeStep");return o/1.5}}(e),vgChannel:c}),((t={})[u]={value:ke(r.thickness,n.tick.thickness)},t))}},trail:{vgMark:"trail",encodeEntry:function(e){var t=e.width,n=e.height;return ne({},rm(e,{size:"include",orient:"ignore"}),hm("x",e,em(t)),hm("y",e,em(n)),cm("size",e),om(e))}}};function mv(e){return X([On,An,zn],e.mark)?(n=yv((t=e).mark,t.encoding),r=bv(t,{fromPrefix:0<n.length?vv:""}),0<n.length?[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:vv+t.requestDataName(pu),data:t.requestDataName(pu),groupby:n}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:r}]:r):bv(e);var t,n,r}var vv="faceted_path_";function bv(e,t){void 0===t&&(t={fromPrefix:""});var n,r,i,a=e.mark,o=ke(e.markDef.clip,(r=(n=e).getScaleComponent("x"),i=n.getScaleComponent("y"),!!(r&&r.get("domainRaw")||i&&i.get("domainRaw")))),c=gm(e.markDef),u=e.encoding.key,f=function(e){var t=e.encoding,n=e.stack,r=e.mark,i=e.markDef,a=t.order;if(_(a)||!Xt(a)){if((_(a)||Gt(a))&&!n)return km(a,{expr:"datum"});if(qn(r)){var o=t["horizontal"===i.orient?"y":"x"];if(Gt(o)){var c=o.sort;return{field:Ja(c)?$t({aggregate:Dm(e.encoding)?c.op:void 0,field:c.field},{expr:"datum"}):$t(o,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"}),order:"descending"}}}}}(e),s=gv[a].postEncodingTransform?gv[a].postEncodingTransform(e):null;return[ne({name:e.getName("marks"),type:gv[a].vgMark},o?{clip:!0}:{},c?{style:c}:{},u?{key:{field:u.field}}:{},f?{sort:f}:{},{from:{data:t.fromPrefix+e.requestDataName(pu)},encode:{update:gv[a].encodeEntry(e)}},s?{transform:s}:{})]}function yv(i,a){return se(a).reduce(function(t,e){switch(e){case"x":case"y":case"order":case"href":case"x2":case"y2":case"latitude":case"longitude":case"latitude2":case"longitude2":case"text":case"shape":case"tooltip":return t;case"detail":case"key":var n=a[e];return(_(n)||Gt(n))&&(_(n)?n:[n]).forEach(function(e){e.aggregate||t.push($t(e,{}))}),t;case"size":if("trail"===i)return t;case"color":case"fill":case"stroke":case"opacity":var r=gn(a[e]);return r&&!r.aggregate&&t.push($t(r,{})),t;default:throw new Error("Bug: Channel "+e+" unimplemented for line mark")}},[])}var xv=function(r){function h(e,t){var n=r.call(this,e)||this;return n.transform=t,n}return p(h,r),h.prototype.clone=function(){return new h(null,he(this.transform))},h.prototype.producedFields=function(){var e;return(e={})[this.transform.impute]=!0,e},h.prototype.processSequence=function(e){var t=e.start,n=void 0===t?0:t,r=e.stop,i=e.step;return{signal:"sequence("+[n,r].concat(i?[i]:[]).join(",")+")"}},h.makeFromTransform=function(e,t){return new h(e,t)},h.makeFromEncoding=function(e,t){var n=t.encoding,r=n.x,i=n.y;if(Gt(r)&&Gt(i)){var a=r.impute?r:i.impute?i:void 0;if(void 0===a)return;var o=r.impute?i:i.impute?r:void 0,c=a.impute,u=c.method,f=c.value,s=c.frame,l=c.keyvals,d=yv(t.mark,n);return new h(e,ne({impute:a.field,key:o.field},u?{method:u}:{},void 0!==f?{value:f}:{},s?{frame:s}:{},void 0!==l?{keyvals:l}:{},d.length?{groupby:d}:{}))}return null},h.prototype.hash=function(){return"Impute "+V(this.transform)},h.prototype.assemble=function(){var e,t=this.transform,n=t.impute,r=t.key,i=t.keyvals,a=t.method,o=t.groupby,c=t.value,u=t.frame,f=void 0===u?[null,null]:u,s=ne({type:"impute",field:n,key:r},i?{keyvals:Ca(i)?this.processSequence(i):i}:{},{method:"value"},o?{groupby:o}:{},{value:null});a&&"value"!==a?e=[ne({type:"window",as:["imputed_"+n+"_value"],ops:[a],fields:[n],frame:f,ignorePeers:!1},o?{groupby:o}:{}),{type:"formula",expr:"datum."+n+" === null ? datum.imputed_"+n+"_value : datum."+n,as:n}]:e=[{type:"formula",expr:"datum."+n+" === null ? "+c+" : datum."+n,as:n}];return[s].concat(e)},h}(io),wv=function(i){function e(e,t,n){void 0===e&&(e={}),void 0===t&&(t={}),void 0===n&&(n=!1);var r=i.call(this,e,t)||this;return r.explicit=e,r.implicit=t,r.parseNothing=n,r}return p(e,i),e.prototype.clone=function(){var e=i.prototype.clone.call(this);return e.parseNothing=this.parseNothing,e},e}(Vc),_v=function(i){function u(e,t,n){var r=i.call(this,e)||this;return r.transform=t,r.secondary=n,r}return p(u,i),u.prototype.clone=function(){return new u(null,he(this.transform),this.secondary)},u.make=function(e,t,n,r){var i=t.component.data.sources,a=Uv(n.from.data,i);a||(a=new Jh(n.from.data),i.push(a));var o=t.getName("lookup_"+r),c=new ao(a,o,"lookup",t.component.data.outputNodeRefCounts);return new u(e,n,(t.component.data.outputNodes[o]=c).getSource())},u.prototype.producedFields=function(){return l(this.transform.from.fields||(this.transform.as instanceof Array?this.transform.as:[this.transform.as]))},u.prototype.hash=function(){return"Lookup "+V({transform:this.transform,secondary:this.secondary})},u.prototype.assemble=function(){var e;if(this.transform.from.fields)e=ne({values:this.transform.from.fields},this.transform.as?{as:this.transform.as instanceof Array?this.transform.as:[this.transform.as]}:{});else{var t=this.transform.as;g(t)||(Ke(Be.NO_FIELDS_NEEDS_AS),t="_lookup"),e={as:[t]}}return ne({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e,this.transform.default?{default:this.transform.default}:{})},u}(io),Sv=function(r){function e(e,t){var n=r.call(this,e)||this;return n.transform=t,n}return p(e,r),e.prototype.clone=function(){return new e(null,he(this.transform))},e.prototype.hash=function(){return"SampleTransform "+V(this.transform)},e.prototype.assemble=function(){return{type:"sample",size:this.transform.sample}},e}(io);function kv(i){var a=0;return function t(e,n){e instanceof Jh&&(lu(e.data)||(i.push(n),n={name:null,source:n.name,transform:[]}));if(e instanceof Qh&&(e.parent instanceof Jh&&!n.source?(n.format=ne({},n.format||{},{parse:e.assembleFormatParse()}),n.transform=n.transform.concat(e.assembleTransforms(!0))):n.transform=n.transform.concat(e.assembleTransforms())),e instanceof Xh)return n.name||(n.name="data_"+a++),!n.source||0<n.transform.length?(i.push(n),e.data=n.name):e.data=n.source,void e.assemble().forEach(function(e){return i.push(e)});(e instanceof cv||e instanceof Tc||e instanceof lv||e instanceof sv||e instanceof xu||e instanceof _v||e instanceof op||e instanceof fv||e instanceof uv||e instanceof dv||e instanceof Sv)&&n.transform.push(e.assemble()),(e instanceof ov||e instanceof ep||e instanceof xv||e instanceof ap)&&(n.transform=n.transform.concat(e.assemble())),e instanceof ao&&(n.source&&0===n.transform.length?e.setSource(n.source):e.parent instanceof ao?e.setSource(n.name):(n.name||(n.name="data_"+a++),e.setSource(n.name),1===e.numChildren()&&(i.push(n),n={name:null,source:n.name,transform:[]})));switch(e.numChildren()){case 0:e instanceof ao&&(!n.source||0<n.transform.length)&&i.push(n);break;case 1:t(e.children[0],n);break;default:n.name||(n.name="data_"+a++);var r=n.name;!n.source||0<n.transform.length?i.push(n):r=n.source,e.children.forEach(function(e){t(e,{name:null,source:r,transform:[]})})}}}function Ev(e){Nv(e);var t=e.component.layoutSize;t.setWithExplicit("width",Av(e,"width")),t.setWithExplicit("height",Av(e,"height"))}var Cv=Ev;function Nv(e){for(var t=0,n=e.children;t<n.length;t++){n[t].parseLayoutSize()}}function Av(e,t){for(var n,r="width"===t?"x":"y",i=e.component.resolve,a=0,o=e.children;a<o.length;a++){var c=(l=o[a]).component.layoutSize.getWithExplicit(t),u=i.scale[r];if("independent"===u&&"range-step"===c.value){n=void 0;break}if(n){if("independent"===u&&n.value!==c.value){n=void 0;break}n=Zc(n,c,t,"")}else n=c}if(n){for(var f=0,s=e.children;f<s.length;f++){var l=s[f];e.renameLayoutSize(l.getName(t),e.getName(t)),l.component.layoutSize.set(t,"merged",!1)}return n}return{explicit:!1,value:void 0}}function Tv(e,t){var n="width"===t?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){var a=i.get("type"),o=i.get("range");return mi(a)&&qa(o)?"range-step":r.view[t]}return e.hasProjection?r.view[t]:"width"===t&&"text"===e.mark?r.scale.textXRangeStep:r.scale.rangeStep||wi.rangeStep}function Ov(e,t){return qt(e.field)?e.field.repeat in t?ne({},e,{field:t[e.field.repeat]}):void Ke(Be.noSuchRepeatedValue(e.field.repeat)):e}function Dv(e,t){if(void 0!==(e=Ov(e,t))){if(e.sort&&Ja(e.sort)){var n=Ov(e.sort,t);e=ne({},e,n?{sort:n}:{})}return e}}function Mv(e,t){if(Gt(e))return(n=Dv(e,t))?n:Wt(e)?{condition:e.condition}:void 0;if(Bt(e)){var n;if(n=Dv(e.condition,t))return ne({},e,{condition:n});e.condition;return re(e,["condition"])}return e}function Fv(e,t){var n={};for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if(_(i))n[r]=i.map(function(e){return Mv(e,t)}).filter(function(e){return e});else{var a=Mv(i,t);a&&(n[r]=a)}}return n}function zv(e,t,n){return $t(t,ne({suffix:"by_"+$t(e)},n||{}))}var Iv=function(c){function s(e,t,n,r,i){var a=c.call(this,e,t,n,i,r,e.resolve)||this;a.type="facet",a.child=Zv(e.spec,a,a.getName("child"),void 0,r,i,!1),a.children=[a.child];var o=Fv(e.facet,r);return a.facet=a.initFacet(o),a}return p(s,c),s.prototype.initFacet=function(e){return Rm(e,function(e,t,n){return X([lr,dr],n)?void 0===t.field?Ke(Be.emptyFieldDef(t,n)):e[n]=mn(t,n):Ke(Be.incompatibleChannel(n,"facet")),e},{})},s.prototype.channelHasField=function(e){return!!this.facet[e]},s.prototype.fieldDef=function(e){return this.facet[e]},s.prototype.parseData=function(){this.component.data=Rv(this),this.child.parseData()},s.prototype.parseLayoutSize=function(){Nv(this)},s.prototype.parseSelection=function(){this.child.parseSelection(),this.component.selection=this.child.component.selection},s.prototype.parseMarkGroup=function(){this.child.parseMarkGroup()},s.prototype.parseAxisAndHeader=function(){this.child.parseAxisAndHeader(),this.parseHeader("column"),this.parseHeader("row"),this.mergeChildAxis("x"),this.mergeChildAxis("y")},s.prototype.parseHeader=function(e){if(this.channelHasField(e)){var t=this.facet[e],n=sn(t,this.config,{allowDisabling:!0});this.child.component.layoutHeaders[e].title&&(n+=" / "+this.child.component.layoutHeaders[e].title,this.child.component.layoutHeaders[e].title=null),this.component.layoutHeaders[e]={title:n,facetFieldDef:t,header:[this.makeHeaderComponent(e,!0)]}}},s.prototype.makeHeaderComponent=function(e,t){var n="row"===e?"height":"width";return{labels:t,sizeSignal:this.child.component.layoutSize.get(n)?this.child.getSizeSignalRef(n):void 0,axes:[]}},s.prototype.mergeChildAxis=function(e){var t,n=this.child;if(n.component.axes[e]){var r=this.component,i=r.layoutHeaders,a=r.resolve;if(a.axis[e]=Gc(a,e),"shared"===a.axis[e])for(var o="x"===e?"column":"row",c=i[o],u=0,f=n.component.axes[e];u<f.length;u++){var s=f[u],l="top"===(t=s.get("orient"))||"left"===t?"header":"footer";c[l]=c[l]||[this.makeHeaderComponent(o,!1)];var d=Ba(s,"main",this.config,{header:!0});c[l][0].axes.push(d),s.mainExtracted=!0}}},s.prototype.assembleSelectionTopLevelSignals=function(e){return this.child.assembleSelectionTopLevelSignals(e)},s.prototype.assembleSelectionSignals=function(){return this.child.assembleSelectionSignals(),[]},s.prototype.assembleSelectionData=function(e){return this.child.assembleSelectionData(e)},s.prototype.getHeaderLayoutMixins=function(){var o=this,c={};return["row","column"].forEach(function(a){["header","footer"].forEach(function(e){var t=o.component.layoutHeaders[a],n=t[e];if(n&&n[0]){var r="row"===a?"height":"width",i="header"===e?"headerBand":"footerBand";o.child.component.layoutSize.get(r)||(c[i]=c[i]||{},c[i][a]=.5),t.title&&(c.offset=c.offset||{},c.offset["row"===a?"rowTitle":"columnTitle"]=10)}})}),c},s.prototype.assembleDefaultLayout=function(){var e=this.channelHasField("column")?this.columnDistinctSignal():1;return ne({},this.getHeaderLayoutMixins(),{columns:e,bounds:"full",align:"all"})},s.prototype.assembleLayoutSignals=function(){return this.child.assembleLayoutSignals()},s.prototype.columnDistinctSignal=function(){if(!(this.parent&&this.parent instanceof s))return{signal:"length(data('"+this.getName("column_domain")+"'))"}},s.prototype.assembleGroup=function(e){return this.parent&&this.parent instanceof s?ne({},this.channelHasField("column")?{encode:{update:{columns:{field:$t(this.facet.column,{prefix:"distinct"})}}}}:{},c.prototype.assembleGroup.call(this,e)):c.prototype.assembleGroup.call(this,e)},s.prototype.getCardinalityAggregateForChild=function(){var e=[],t=[],n=[];if(this.child instanceof s){if(this.child.channelHasField("column")){var r=$t(this.child.facet.column);e.push(r),t.push("distinct"),n.push("distinct_"+r)}}else for(var i=0,a=["x","y"];i<a.length;i++){var o=a[i],c=this.child.component.scales[o];if(c&&!c.merged){var u=c.get("type"),f=c.get("range");if(mi(u)&&qa(f))(r=yp(xp(this.child,o)))?(e.push(r),t.push("distinct"),n.push("distinct_"+r)):Ke("Unknown field for ${channel}.  Cannot calculate view size.")}}return{fields:e,ops:t,as:n}},s.prototype.assembleFacet=function(){var o=this,e=this.component.data.facetRoot,t=e.name,n=e.data,r=this.facet,c=r.row,u=r.column,i=this.getCardinalityAggregateForChild(),f=i.fields,s=i.ops,l=i.as,d=[];["row","column"].forEach(function(e){var t=o.facet[e];if(t){d.push($t(t));var n=t.sort;if(Ja(n)){var r=n.field,i=n.op,a=zv(t,n);c&&u?(f.push(a),s.push("max")):(f.push(r),s.push(i)),l.push(a)}else if(_(n)){a=Oc(t,e);f.push(a),s.push("max"),l.push(a)}}});var a=!!c&&!!u;return ne({name:t,data:n,groupby:d},a||f.length?{aggregate:ne({},a?{cross:a}:{},f.length?{fields:f,ops:s,as:l}:{})}:{})},s.prototype.headerSortFields=function(e){var t=this.facet[e];return t?Ja(t.sort)?[zv(t,t.sort,{expr:"datum"})]:_(t.sort)?[Oc(t,e,{expr:"datum"})]:[$t(t,{expr:"datum"})]:[]},s.prototype.headerSortOrder=function(e){var t=this.facet[e];if(t){var n=t.sort;return[(Ja(n)?n.order:!_(n)&&n)||"ascending"]}return[]},s.prototype.assembleMarks=function(){var t,e,n,r=this.child,i=this.component.data.facetRoot,a=(t=i,n=kv(e=[]),t.children.forEach(function(e){return n(e,{source:t.name,name:null,transform:[]})}),e),o=r.assembleLayoutSize(),c=r.assembleTitle(),u=r.assembleGroupStyle();return[ne({name:this.getName("cell"),type:"group"},c?{title:c}:{},u?{style:u}:{},{from:{facet:this.assembleFacet()},sort:{field:this.headerSortFields("row").concat(this.headerSortFields("column")),order:this.headerSortOrder("row").concat(this.headerSortOrder("column"))}},0<a.length?{data:a}:{},o?{encode:{update:o}}:{},r.assembleGroup(function(e,t){if(e.component.selection&&se(e.component.selection).length){var n=v(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:zi("mousemove","scope"),update:"isTuple(facet) ? facet : group("+n+").datum"}]})}return t}(this,[])))]},s.prototype.getMapping=function(){return this.facet},s}(Kp);function Uv(e,t){for(var n=0,r=t;n<r.length;n++){var i=r[n],a=i.data;if(du(e)&&du(a)){var o=e.values,c=a.values;if(W(o,c))return i}else if(lu(e)&&lu(a)){if(e.url===a.url)return i}else if(hu(e)&&hu(a)&&e.name===a.name)return i}return null}function Rv(e){var t=function(e,t){if(!e.data&&e.parent)return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main;var n=Uv(e.data,t);if(n)return n.data.format=$({},e.data.format,n.data.format),n;var r=new Jh(e.data);return t.push(r),r}(e,e.component.data.sources),n=e.component.data,r=n.outputNodes,i=n.outputNodeRefCounts,a=e.parent?e.parent.component.data.ancestorParse.clone():new wv;e.data&&e.data.format&&null===e.data.format.parse&&(a.parseNothing=!0),t=Qh.makeExplicit(t,e,a)||t,Dg(e)&&(Yp(e)||Qp(e))&&(t=new dv(t));var c,u,f,s,o=e.parent&&Qp(e.parent);(Yp(e)||Gp(e))&&o&&(t=ov.makeFromEncoding(t,e)||t),0<e.transforms.length&&(c=t,f=a,s=0,(u=e).transforms.forEach(function(e){var t,n,r=void 0;if(Da(e))n=c=new Tc(c,e),r="derived";else if(Ea(e))n=c=Qh.makeImplicitFromFilterTransform(c,e,f)||c,c=new cv(c,u,e.filter);else if(Ma(e))n=c=ov.makeFromTransform(c,e,u),r="number";else if(za(e))n=c=ep.makeFromTransform(c,e),r="date",void 0===f.getWithExplicit(e.field).value&&(c=new Qh(c,((t={})[e.field]=r,t)),f.set(e.field,r,!1));else if(Ia(e))n=c=xu.makeFromTransform(c,e),r="number",Dg(u)&&(c=new dv(c));else if(Na(e))n=c=_v.make(c,u,e,s++),r="derived";else if(Ta(e))n=c=new op(c,e),r="number";else if(Ua(e))n=c=ap.makeFromTransform(c,e),r="derived";else if(Ra(e))n=c=new fv(c,e),r="derived";else if(Oa(e))n=c=new uv(c,e),r="derived";else if(Aa(e))c=new Sv(c,e);else{if(!Fa(e))return void Ke(Be.invalidTransformIgnored(e));n=c=xv.makeFromTransform(c,e),r="derived"}if(n&&void 0!==r)for(var i=0,a=se(n.producedFields());i<a.length;i++){var o=a[i];f.set(o,r,!1)}}),t=c),t=Qh.makeImplicitFromEncoding(t,e,a)||t,Yp(e)&&(t=sv.parseAll(t,e),t=lv.parseAll(t,e)),(Yp(e)||Gp(e))&&(o||(t=ov.makeFromEncoding(t,e)||t),t=ep.makeFromEncoding(t,e)||t,t=Tc.parseAllForSortIndex(t,e));var l=e.getName(gu),d=new ao(t,l,gu,i);if(t=r[l]=d,Yp(e)){var h=xu.makeFromEncoding(t,e);h&&(t=h,Dg(e)&&(t=new dv(t))),t=xv.makeFromEncoding(t,e)||t,t=ap.makeFromEncoding(t,e)||t}var p=e.getName(pu),g=new ao(t,p,pu,i);t=r[p]=g;var m=null;if(Gp(e)){var v=e.getName("facet");t=function(e,t){var n=t.row,r=t.column;if(n&&r){for(var i=null,a=0,o=[n,r];a<o.length;a++){var c=o[a];if(Ja(c.sort)){var u=c.sort,f=u.field,s=u.op;e=i=new op(e,{window:[{op:s,field:f,as:zv(c,c.sort,{forAs:!0})}],groupby:[$t(c)],frame:[null,null]})}}return i}return null}(t=Tc.parseAllForSortIndex(t,e),e.facet)||t,m=new Xh(t,e,v,g.getSource()),t=r[v]=m}return ne({},e.component.data,{outputNodes:r,outputNodeRefCounts:i,raw:d,main:g,facetRoot:m,ancestorParse:a})}var Lv=function(o){function e(e,t,n,r,i,a){return o.call(this,e,t,n,r,i,a)||this}return p(e,o),e.prototype.parseData=function(){this.component.data=Rv(this),this.children.forEach(function(e){e.parseData()})},e.prototype.parseSelection=function(){var n=this;this.component.selection={};for(var e=function(t){t.parseSelection(),se(t.component.selection).forEach(function(e){n.component.selection[e]=t.component.selection[e]})},t=0,r=this.children;t<r.length;t++){e(r[t])}},e.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseMarkGroup()}},e.prototype.parseAxisAndHeader=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseAxisAndHeader()}},e.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},e.prototype.assembleSelectionSignals=function(){return this.children.forEach(function(e){return e.assembleSelectionSignals()}),[]},e.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},Uc(this))},e.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},e)},e.prototype.assembleMarks=function(){return this.children.map(function(e){var t=e.assembleTitle(),n=e.assembleGroupStyle(),r=e.assembleLayoutSize();return ne({type:"group",name:e.getName("group")},t?{title:t}:{},n?{style:n}:{},r?{encode:{update:r}}:{},e.assembleGroup())})},e}(Jp),jv=function(o){function e(e,t,n,r,i){var a=o.call(this,e,t,n,i,r,e.resolve)||this;return a.type="concat",e.resolve&&e.resolve.axis&&("shared"===e.resolve.axis.x||"shared"===e.resolve.axis.y)&&Ke(Be.CONCAT_CANNOT_SHARE_AXIS),a.isVConcat=ma(e),a.children=(ma(e)?e.vconcat:e.hconcat).map(function(e,t){return Zv(e,a,a.getName("concat_"+t),void 0,r,i,!1)}),a}return p(e,o),e.prototype.parseLayoutSize=function(){!function(e){Nv(e);var t=e.component.layoutSize,n=e.isVConcat?"width":"height";t.setWithExplicit(n,Av(e,n))}(this)},e.prototype.parseAxisGroup=function(){return null},e.prototype.assembleDefaultLayout=function(){return ne({},this.isVConcat?{columns:1}:{},{bounds:"full",align:"each"})},e}(Lv);var Pv=function(i){function e(e,t,n){void 0===e&&(e={}),void 0===t&&(t={}),void 0===n&&(n=!1);var r=i.call(this)||this;return r.explicit=e,r.implicit=t,r.mainExtracted=n,r}return p(e,i),e.prototype.clone=function(){return new e(he(this.explicit),he(this.implicit),this.mainExtracted)},e.prototype.hasAxisPart=function(e){return"axis"===e||("grid"===e||"title"===e?!!this.get(e):!(!1===(t=this.get(e))||null===t));var t},e}(Vc);function qv(e,t,n,r,i){void 0===r&&(r="");for(var a=0,o=("band"===i?["axisBand"]:[]).concat(["x"===n?"axisX":"axisY","axis"+r.substr(0,1).toUpperCase()+r.substr(1),"axis"]);a<o.length;a++){var c=o[a];if(t[c]&&void 0!==t[c][e])return t[c][e]}}function Hv(e){switch(e){case rr:return"bottom";case ir:return"left"}throw new Error(Be.INVALID_CHANNEL_FOR_AXIS)}function Wv(n){return Rr.reduce(function(e,t){return n.component.scales[t]&&n.axis(t)&&(e[t]=[function(i,a){var o=a.axis(i),c=new Pv;Ge.forEach(function(e){var t=function(e,t,n,r){var i=r.fieldDef(n),a=function(e,t,n,r){if(void 0!==t.labelAngle)return(t.labelAngle%360+360)%360;var i=qv("labelAngle",e.config,n,Hv(n),e.getScaleComponent(n).get("type"));return void 0!==i?(i%360+360)%360:n===rr&&X([Ut,zt],r.type)?270:void 0}(r,t,n,i);switch(e){case"scale":return r.scaleName(n);case"gridScale":return function(e,t){var n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}(r,n);case"format":return ym(i,t.format,r.config);case"grid":if(Jr(r.fieldDef(n).bin))return!1;var o=r.getScaleComponent(n).get("type");return ke(t.grid,(b=i,!mi(o)&&!Qr(b.bin)));case"labelAlign":return ke(t.labelAlign,function(e,t){if(void 0!==e)return e=(e%360+360)%360,"top"===t||"bottom"===t?e%180==0?"center":0<e&&e<180?"top"===t?"right":"left":"top"===t?"left":"right":(e+90)%180==0?"center":90<=e&&e<270?"left"===t?"left":"right":"left"===t?"right":"left"}(a,Hv(n)));case"labelAngle":return a;case"labelBaseline":return ke(t.labelBaseline,function(e,t){if(void 0!==e)return"top"===t||"bottom"===t?e<=45||315<=e?"top"===t?"bottom":"top":135<=e&&e<=225?"top"===t?"top":"bottom":"middle":e<=45||315<=e||135<=e&&e<=225?"middle":45<=e&&e<=135?"left"===t?"top":"bottom":"left"===t?"bottom":"top"}(a,Hv(n)));case"labelFlush":return g=i,m=n,void 0!==(v=t).labelFlush?v.labelFlush:!("x"!==m||!X(["quantitative","temporal"],g.type))||void 0;case"labelOverlap":var o=r.getScaleComponent(n).get("type");return d=i,p=o,void 0!==(h=t).labelOverlap?h.labelOverlap:"nominal"!==d.type?"log"!==p||"greedy":void 0;case"orient":return ke(t.orient,Hv(n));case"tickCount":var o=r.getScaleComponent(n).get("type"),c=r.scaleName(n),u="x"===n?"width":"y"===n?"height":void 0,f=u?r.getSizeSignalRef(u):void 0;return ke(t.tickCount,function(e,t,n,r,i,a){if(!mi(n)&&"log"!==n&&!X(["month","hours","day","quarter"],t.timeUnit))return a.tickStep?{signal:"(domain('"+i+"')[1] - domain('"+i+"')[0]) / "+a.tickStep+" + 1"}:Qr(t.bin)?{signal:"ceil("+r.signal+"/20)"}:{signal:"ceil("+r.signal+"/40)"}}(0,i,o,f,c,t));case"title":var s="x"===n?"x2":"y2",l=r.fieldDef(s);return ke(t.title,Vv(r,n),Em([Ht(i)],l?[Ht(l)]:[]));case"values":return function(e,t,n,r){var i=e.values;if(i)return kn(n,i);if(n.type===Ft){if(Qr(n.bin)){var a=t.scaleDomain(r);if(a&&"unaggregated"!==a&&!Si(a))return i;var o=t.getName(Xr(n.bin)+"_"+n.field+"_bins");return{signal:"sequence("+o+".start, "+o+".stop + "+o+".step, "+o+".step)"}}if(e.tickStep){var c=t.scaleName(r),u=e.tickStep;return{signal:"sequence(domain('"+c+"')[0], domain('"+c+"')[1] + "+u+", "+u+")"}}}}(t,r,i,n)}var d,h,p;var g,m,v;var b;return He(e)?t[e]:void 0}(e,o,i,a);if(void 0!==t){var n=function(e,t,n,r,i){switch(t){case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===Vv(r,i))return!0}return e===n[t]}(t,e,o,a,i),r=qv(e,a.config,i,c.get("orient"),a.getScaleComponent(i).get("type"));n||void 0===r?c.set(e,t,n):"grid"===e&&r&&c.set(e,r,!1)}});var u=o.encoding||{},e=Le.reduce(function(e,t){if(!c.hasAxisPart(t))return e;var n=Tm(u[t]||{},a),r="labels"===t?function(e,t,n,r){var i=e.fieldDef(t)||("x"===t?e.fieldDef("x2"):"y"===t?e.fieldDef("y2"):void 0),a=e.axis(t),o=e.config,c={};if(_n(i)){var u=e.getScaleComponent(t).get("type")===$r.UTC,f=Sm("datum.value",i.timeUnit,a.format,o.axis.shortTimeLabels,null,u);f&&(c.text={signal:f})}return c=ne({},c,n),0===se(c).length?void 0:c}(a,i,n,c.get("orient")):n;return void 0!==r&&0<se(r).length&&(e[t]={update:r}),e},{});0<se(e).length&&c.set("encode",e,!!o.encoding||void 0!==o.labelAngle);return c}(t,n)]),e},{})}var Bv={bottom:"top",top:"bottom",left:"right",right:"left"};function Yv(e,t){if(!e)return t.map(function(e){return e.clone()});if(e.length===t.length){for(var n=e.length,r=0;r<n;r++){var i=e[r],a=t[r];if(!!i!=!!a)return;if(i&&a){var o=i.getWithExplicit("orient"),c=a.getWithExplicit("orient");if(o.explicit&&c.explicit&&o.value!==c.value)return;e[r]=Gv(i,a)}}return e}}function Gv(t,r){for(var e=function(n){var e=Zc(t.getWithExplicit(n),r.getWithExplicit(n),n,"axis",function(e,t){switch(n){case"title":return Nm(e,t);case"gridScale":return{explicit:e.explicit,value:ke(e.value,t.value)}}return Kc(e,t,n,"axis")});t.setWithExplicit(n,e)},n=0,i=Ge;n<i.length;n++){e(i[n])}return t}function Vv(e,t){var n="x"===t?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),a=r?r.title:void 0,o=i?i.title:void 0;return a&&o?Cm(a,o):a||(o||(void 0!==a?a:void 0!==o?o:void 0))}function Xv(e,t,n){var r,i,a,o=Wn(e)?ne({},e):{type:e},c=o.orient||mm("orient",o,n);return o.orient=function(e,t,n){switch(e){case Dn:case Ln:case jn:case Mn:case In:return}var r=t.x,i=t.y,a=t.x2,o=t.y2;switch(e){case Tn:if(Gt(r)&&Jr(r.bin))return"vertical";if(Gt(i)&&Jr(i.bin))return"horizontal";if(o||a){if(n)return n;if(!a&&Gt(r)&&r.type===Ft&&!Qr(r.bin))return"horizontal";if(!o&&Gt(i)&&i.type===Ft&&!Qr(i.bin))return"vertical"}case Un:if(a&&o)return;case An:if(o)return Gt(i)&&Jr(i.bin)?"horizontal":"vertical";if(a)return Gt(r)&&Jr(r.bin)?"vertical":"horizontal";if(e===Un){if(t.x&&!t.y)return"vertical";if(t.y&&!t.x)return"horizontal"}case On:case Fn:var c=Gt(t.x)&&tn(t.x),u=Gt(t.y)&&tn(t.y);if(c&&!u)return"tick"!==e?"horizontal":"vertical";if(!c&&u)return"tick"!==e?"vertical":"horizontal";if(c&&u){var f=t.x,s=t.y,l=f.type===It,d=s.type===It;return l&&!d?"tick"!==e?"vertical":"horizontal":!l&&d?"tick"!==e?"horizontal":"vertical":!f.aggregate&&s.aggregate?"tick"!==e?"vertical":"horizontal":f.aggregate&&!s.aggregate?"tick"!==e?"horizontal":"vertical":n||"vertical"}return n||void 0}return"vertical"}(o.type,t,c),void 0!==c&&c!==o.orient&&Ke(Be.orientOverridden(o.orient,c)),void 0===ke(o.opacity,mm("opacity",o,n))&&(o.opacity=function(e,t){if(X([Dn,Fn,Ln,jn],e)&&!Dm(t))return.7;return}(o.type,t)),void 0===o.filled&&(o.filled=(i=mm("filled",r=o,n),a=r.type,ke(i,a!==Dn&&a!==On&&a!==Un))),void 0===(o.cursor||mm("cursor",o,n))&&(o.cursor=function(e,t,n){if(t.href||e.href||mm("href",e,n))return"pointer";return e.cursor}(o,t,n)),o}var Qv=function(s){function e(e,t,n,r,i,a,o){void 0===r&&(r={});var c=s.call(this,e,t,n,a,i,void 0)||this;c.fit=o,c.type="unit",c.specifiedScales={},c.specifiedAxes={},c.specifiedLegends={},c.specifiedProjection={},c.selection={},c.children=[],c.initSize(ne({},r,e.width?{width:e.width}:{},e.height?{height:e.height}:{}));var u=Wn(e.mark)?e.mark.type:e.mark,f=c.encoding=Fm(Fv(e.encoding||{},i),u);return c.markDef=Xv(e.mark,f,a),c.stack=ra(u,f,c.config.stack),c.specifiedScales=c.initScales(u,f),c.specifiedAxes=c.initAxes(f),c.specifiedLegends=c.initLegend(f),c.specifiedProjection=e.projection,c.selection=e.selection,c}return p(e,s),Object.defineProperty(e.prototype,"hasProjection",{get:function(){var t=this.encoding,e=this.mark===Rn,n=t&&Cr.some(function(e){return Gt(t[e])});return e||n},enumerable:!0,configurable:!0}),e.prototype.scaleDomain=function(e){var t=this.specifiedScales[e];return t?t.domain:void 0},e.prototype.axis=function(e){return this.specifiedAxes[e]},e.prototype.legend=function(e){return this.specifiedLegends[e]},e.prototype.initScales=function(e,a){return Hr.reduce(function(e,t){var n,r,i=a[t];return Gt(i)?r=(n=i).scale:Bt(i)?(n=i.condition,r=i.condition.scale):"x"===t?n=gn(a.x2):"y"===t&&(n=gn(a.y2)),n&&(e[t]=r||{}),e},{})},e.prototype.initAxes=function(i){return[rr,ir].reduce(function(e,t){var n=i[t];if(Gt(n)||t===rr&&Gt(i.x2)||t===ir&&Gt(i.y2)){var r=Gt(n)?n.axis:null;null!==r&&(e[t]=ne({},r))}return e},{})},e.prototype.initLegend=function(i){return jr.reduce(function(e,t){var n=i[t];if(n){var r=Gt(n)?n.legend:Bt(n)?n.condition.legend:null;null!==r&&!1!==r&&(e[t]=ne({},r))}return e},{})},e.prototype.parseData=function(){this.component.data=Rv(this)},e.prototype.parseLayoutSize=function(){!function(e){var t=e.component.layoutSize;if(!t.explicit.width){var n=Tv(e,"width");t.set("width",n,!1)}if(!t.explicit.height){var r=Tv(e,"height");t.set("height",r,!1)}}(this)},e.prototype.parseSelection=function(){this.component.selection=function(a,o){var c={},u=a.config.selection,e=function(e){if(!o.hasOwnProperty(e))return"continue";var t=o[e],n=u[t.type];for(var r in n)"encodings"===r&&t.fields||"fields"===r&&t.encodings||("mark"===r&&(t[r]=ne({},n[r],t[r])),void 0!==t[r]&&!0!==t[r]||(t[r]=n[r]||t[r]));e=ge(e);var i=c[e]=ne({},t,{name:e,events:g(t.on)?zi(t.on,"scope"):t.on});wg(i,function(e){e.parse&&e.parse(a,t,i)})};for(var t in o)e(t);return c}(this,this.selection)},e.prototype.parseMarkGroup=function(){this.component.mark=mv(this)},e.prototype.parseAxisAndHeader=function(){this.component.axes=Wv(this)},e.prototype.assembleSelectionTopLevelSignals=function(e){return a=e,o=!1,Ag(i=this,function(t,e){var n=t.name,r=v(n+_g);a.filter(function(e){return e.name===n}).length||a.push({name:t.name,update:Eg+"("+r+("global"===t.resolve?")":", "+v(t.resolve)+")")}),o=!0,e.topLevelSignals&&(a=e.topLevelSignals(i,t,a)),wg(t,function(e){e.topLevelSignals&&(a=e.topLevelSignals(i,t,a))})}),o&&(a.filter(function(e){return"unit"===e.name}).length||a.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})),a;var i,a,o},e.prototype.assembleSelectionSignals=function(){return a=[],Ag(i=this,function(t,e){var n=t.name,r=e.modifyExpr(i,t);a.push.apply(a,e.signals(i,t)),wg(t,function(e){e.signals&&(a=e.signals(i,t,a)),e.modifyExpr&&(r=e.modifyExpr(i,t,r))}),a.push({name:n+"_modify",on:[{events:{signal:n+Sg},update:"modify("+v(t.name+_g)+", "+r+")"}]})}),a;var i,a},e.prototype.assembleSelectionData=function(e){return n=e,Ag(this,function(t){n.filter(function(e){return e.name===t.name+_g}).length||n.push({name:t.name+_g})}),n;var n},e.prototype.assembleLayout=function(){return null},e.prototype.assembleLayoutSignals=function(){return Uc(this)},e.prototype.assembleMarks=function(){var e=this.component.mark||[];return this.parent&&Qp(this.parent)||(e=Cg(this,e)),e.map(this.correctDataNames)},e.prototype.assembleLayoutSize=function(){return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},e.prototype.getMapping=function(){return this.encoding},e.prototype.toSpec=function(e,t){var n,r=he(this.encoding);return n={mark:this.markDef,encoding:r},e||(n.config=he(this.config)),t||(n.data=he(this.data)),n},Object.defineProperty(e.prototype,"mark",{get:function(){return this.markDef.type},enumerable:!0,configurable:!0}),e.prototype.channelHasField=function(e){return Om(this.encoding,e)},e.prototype.fieldDef=function(e){return gn(this.encoding[e])},e}(Kp),Jv=function(f){function s(e,t,n,r,i,a,o){var c=f.call(this,e,t,n,a,i,e.resolve)||this;c.type="layer";var u=ne({},r,e.width?{width:e.width}:{},e.height?{height:e.height}:{});return c.initSize(u),c.children=e.layer.map(function(e,t){if(ha(e))return new s(e,c,c.getName("layer_"+t),u,i,a,o);if(da(e))return new Qv(e,c,c.getName("layer_"+t),u,i,a,o);throw new Error(Be.INVALID_SPEC)}),c}return p(s,f),s.prototype.parseData=function(){this.component.data=Rv(this);for(var e=0,t=this.children;e<t.length;e++){t[e].parseData()}},s.prototype.parseLayoutSize=function(){Ev(this)},s.prototype.parseSelection=function(){var n=this;this.component.selection={};for(var e=function(t){t.parseSelection(),se(t.component.selection).forEach(function(e){n.component.selection[e]=t.component.selection[e]})},t=0,r=this.children;t<r.length;t++){e(r[t])}},s.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseMarkGroup()}},s.prototype.parseAxisAndHeader=function(){!function(e){for(var t=e.component,n=t.axes,r=t.resolve,i={top:0,bottom:0,right:0,left:0},a=0,o=e.children;a<o.length;a++){(p=o[a]).parseAxisAndHeader();for(var c=0,u=se(p.component.axes);c<u.length;c++){var f=u[c];r.axis[f]=Gc(e.component.resolve,f),"shared"===r.axis[f]&&(n[f]=Yv(n[f],p.component.axes[f]),n[f]||(r.axis[f]="independent",delete n[f]))}}for(var s=0,l=[rr,ir];s<l.length;s++){f=l[s];for(var d=0,h=e.children;d<h.length;d++){var p;if((p=h[d]).component.axes[f]){if("independent"===r.axis[f]){n[f]=(n[f]||[]).concat(p.component.axes[f]);for(var g=0,m=p.component.axes[f];g<m.length;g++){var v=m[g],b=v.getWithExplicit("orient"),y=b.value,x=b.explicit;if(0<i[y]&&!x){var w=Bv[y];i[y]>i[w]&&v.set("orient",w,!1)}i[y]++}}delete p.component.axes[f]}}}}(this)},s.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},s.prototype.assembleSelectionSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleSelectionSignals())},[])},s.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},Uc(this))},s.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},e)},s.prototype.assembleTitle=function(){var e=f.prototype.assembleTitle.call(this);if(e)return e;for(var t=0,n=this.children;t<n.length;t++){if(e=n[t].assembleTitle())return e}},s.prototype.assembleLayout=function(){return null},s.prototype.assembleMarks=function(){return function(e,t){for(var n=0,r=e.children;n<r.length;n++){var i=r[n];Yp(i)&&(t=Cg(i,t))}return t}(this,Z(this.children.map(function(e){return e.assembleMarks()})))},s.prototype.assembleLegends=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLegends())},uu(this))},s}(Jp),Kv=function(o){function e(e,t,n,r,i){var a=o.call(this,e,t,n,i,r,e.resolve)||this;return a.type="repeat",e.resolve&&e.resolve.axis&&("shared"===e.resolve.axis.x||"shared"===e.resolve.axis.y)&&Ke(Be.REPEAT_CANNOT_SHARE_AXIS),a.repeat=e.repeat,a.children=a._initChildren(e,a.repeat,r,i),a}return p(e,o),e.prototype._initChildren=function(e,t,n,r){for(var i=[],a=t.row||[n?n.row:null],o=t.column||[n?n.column:null],c=0,u=a;c<u.length;c++)for(var f=u[c],s=0,l=o;s<l.length;s++){var d=l[s],h=(f?"_"+f:"")+(d?"_"+d:""),p={row:f,column:d};i.push(Zv(e.spec,this,this.getName("child"+h),void 0,p,r,!1))}return i},e.prototype.parseLayoutSize=function(){Cv(this)},e.prototype.assembleDefaultLayout=function(){return{columns:this.repeat&&this.repeat.column?this.repeat.column.length:1,bounds:"full",align:"all"}},e}(Lv);function Zv(e,t,n,r,i,a,o){if(la(e))return new Iv(e,t,n,i,a);if(ha(e))return new Jv(e,t,n,r,i,a,o);if(da(e))return new Qv(e,t,n,r,i,a,o);if(pa(e))return new Kv(e,t,n,i,a);if(ga(e))return new jv(e,t,n,i,a);throw new Error(Be.INVALID_SPEC)}function $v(e,t){if(la(e)||pa(e))return r=t,i=(n=e).spec,a=re(n,["spec"]),ne({},a,{spec:$v(i,r)});var n,r,i,a,o,c,u,f,s,l,d,h,p,g,m,v;if(ha(e))return c=t,u=(o=e).layer,f=re(o,["layer"]),ne({},f,{layer:u.map(function(e){return $v(e,c)})});if(da(e))return function(e,t){{if(e.encoding){var n=e.encoding,r=e.transform,i=re(e,["encoding","transform"]),a=Mm(n,t),o=a.bins,c=a.timeUnits,u=a.aggregate,f=a.groupby,s=a.encoding;return ne({transform:(r||[]).concat(o,c,u.length?[{aggregate:u,groupby:f}]:[])},i,{encoding:s})}return e}}(e,t);if(ma(e))return l=t,d=(s=e).vconcat,h=re(s,["vconcat"]),ne({},h,{vconcat:d.map(function(e){return $v(e,l)})});if(va(e))return g=t,m=(p=e).hconcat,v=re(p,["hconcat"]),ne({},v,{hconcat:m.map(function(e){return $v(e,g)})});throw new Error(Be.INVALID_SPEC)}var eb={text:["text"],line:["x","y"],trail:["x","y"],area:["x","y"]},tb={bar:l(["row","column","x","y","size","color","fill","stroke","detail"]),line:l(["row","column","x","y","color","fill","stroke","color","detail"]),trail:l(["row","column","x","y","color","fill","stroke","color","detail","size"]),area:l(["row","column","x","y","color","fill","stroke","detail"]),tick:l(["row","column","x","y","color","fill","stroke","detail"]),circle:l(["row","column","x","y","color","fill","stroke","size","detail"]),square:l(["row","column","x","y","color","fill","stroke","size","detail"]),point:l(["row","column","x","y","color","fill","stroke","size","detail","shape"]),geoshape:l(["row","column","color","fill","stroke","detail","shape"]),text:l(["row","column","size","color","fill","stroke","text"])};var nb=Object.freeze({DEFAULT_REQUIRED_CHANNEL_MAP:eb,DEFAULT_SUPPORTED_CHANNEL_TYPE:tb,getEncodingMappingError:function(e,t,n){void 0===t&&(t=eb),void 0===n&&(n=tb);var r=Wn(e.mark)?e.mark.type:e.mark,i=e.encoding,a=t[r],o=n[r];for(var c in a)if(!(a[c]in i))return'Missing encoding channel "'+a[c]+'" for mark "'+r+'"';for(var u in i)if(!o[u])return'Encoding channel "'+u+'" is not supported by mark type "'+r+'"';return r!==Tn||i.x||i.y?null:"Missing both x and y for bar"}}),rb="3.0.0-rc7";e.aggregate=Re,e.axis=Xe,e.bin=ti,e.channel=Vr,e.compositeMark=iv,e.config=Fp,e.data=mu,e.datetime=at,e.encoding=Lm,e.facet=ft,e.fieldDef=Nn,e.header=Qa,e.legend=Yc,e.mark=nr,e.scale=Fi,e.sort=ro,e.spec=xa,e.stack=ia,e.timeUnit=Dt,e.transform=ja,e.type=jt,e.util=Ne,e.validate=nb,e.version=rb,e.compile=function(e,t){var n,r,i,a;void 0===t&&(t={}),t.logger&&(n=t.logger,Je=n),t.fieldTitle&&un(t.fieldTitle);try{var o=Np($({},t.config,e.config)),c=aa(e,o),u=function(e,t,n){void 0===n&&(n=!0);var r=ne({type:"pad"},_a(t),_a(e));return"fit"===r.type&&(n||(Ke(Be.FIT_NON_SINGLE),r.type="pad")),r}(e.autosize,o.autosize,ha(c)||da(c)),f=Zv(c,null,"",void 0,void 0,o,"fit"===u.type);return f.parse(),function(e){Vh(e.sources);for(var t=0,n=0,r=0;r<up&&gp(e);r++)t++;for(e.sources.map(fp),r=0;r<up&&gp(e);r++)n++;Vh(e.sources),Math.max(t,n)===up&&Ke("Maximum optimization runs("+up+") reached.")}(f.component.data),function(e,t,n,r){void 0===n&&(n={});var i=e.config?Dp(e.config):void 0,a=[].concat(e.assembleSelectionData([]),function(e,t){var n=[],r=kv(n),i=0;e.sources.forEach(function(e){e.hasName()||(e.dataName="source_"+i++);var t=e.assemble();r(e,t)}),n.forEach(function(e){0===e.transform.length&&delete e.transform});for(var a=0,o=0;o<n.length;o++)0!==((p=n[o]).transform||[]).length||p.source||n.splice(a++,0,n.splice(o,1)[0]);for(var c=0,u=n;c<u.length;c++)for(var f=0,s=(p=u[c]).transform||[];f<s.length;f++){var l=s[f];"lookup"===l.type&&(l.from=e.outputNodes[l.from].getSource())}for(var d=0,h=n;d<h.length;d++){var p;(p=h[d]).name in t&&(p.values=t[p.name])}return n}(e.component.data,n)),o=e.assembleProjections(),c=e.assembleTitle(),u=e.assembleGroupStyle(),f=e.assembleLayoutSignals();return f=f.filter(function(e){return"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1)}),{spec:ne({$schema:"https://vega.github.io/schema/vega/v4.json"},e.description?{description:e.description}:{},t,c?{title:c}:{},u?{style:u}:{},{data:a},0<o.length?{projections:o}:{},e.assembleGroup(f.concat(e.assembleSelectionTopLevelSignals([]))),i?{config:i}:{},r?{usermeta:r}:{})}}(f,(r=e,i=o,ne({autosize:1===se(a=u).length&&a.type?a.type:a},ka(i),ka(r))),e.datasets,e.usermeta)}finally{t.logger&&(Je=Qe),t.fieldTitle&&fn()}},e.extractTransforms=$v,Object.defineProperty(e,"__esModule",{value:!0})});