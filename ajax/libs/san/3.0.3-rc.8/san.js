!function(t){function e(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function i(t,i){var n=t.prototype,s=new Function;s.prototype=i.prototype,t.prototype=new s,t.prototype.constructor=t,e(t.prototype,n)}function n(t,e,i){if(t&&t.length>0)for(var n=0,s=t.length;s>n&&e.call(i||t,t[n],n)!==!1;n++);}function s(t,e){var i;return n(t,function(t){return i=t===e,!i}),i}function r(t,e){var i=Function.prototype.bind,n=Array.prototype.slice;if(i&&t.bind===i)return i.apply(t,n.call(arguments,1));var s=n.call(arguments,2);return function(){return t.apply(e,s.concat(n.call(arguments)))}}function o(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)}function a(t,e,i){t.addEventListener?t.removeEventListener(e,i,!1):t.detachEvent("on"+e,i)}function p(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function h(t){return Ce[t]?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t)}function c(){return"_san_"+_e++}function u(t,e){if(e&&(t=r(t,e)),Ee.push(t),!we)if(we=function(){var t=Ee.slice(0);Ee=[],we=null,n(t,function(t){t()})},"function"==typeof MutationObserver){var i=1,s=new MutationObserver(we),o=document.createTextNode(i);s.observe(o,{characterData:!0}),o.data=++i}else"function"==typeof setImmediate?setImmediate(we):setTimeout(we,0)}function l(){this.raw=be?[]:"",this.length=0}function d(){this.raw=[],this.index={}}function f(t){return/^(area|base|br|col|embed|hr|img|input|keygen|param|source|track|wbr)$/i.test(t)}function v(t){this.source=t,this.len=this.source.length,this.index=0}function g(t){t&&t.isText||(this.directives=new d,this.props=new d,this.events=new d,this.childs=[]),e(this,t)}function y(t){function e(t){t&&a.childs.push(new g({isText:!0,text:t,textExpr:C(t),parent:a}))}var i=new g;if("string"!=typeof t)return i;t=t.replace(/<!--([\s\S]*?)-->/gm,"").replace(/(^\s+|\s+$)/g,"");for(var n,s=new v(t),r=/<(\/)?([a-z0-9-]+)\s*/gi,o=/([-:0-9a-z\(\)\[\]]+)(=(['"])([^\3]*?)\3)?\s*/gi,a=i,p=0;null!=(n=s.match(r));){var h=n[1],c=n[2].toLowerCase();if(e(t.slice(p,s.index-n[0].length)),h&&62===s.currentCode()){for(var u=a;u&&u.tagName!==c;)u=u.parent;u&&(a=u.parent),s.go(1)}else if(!h){for(var l=new g({tagName:c,parent:a}),d=f(c);;){var y=s.currentCode();if(62===y){s.go(1);break}if(47===y&&62===s.charCode(s.index+1)){s.go(2),d=!0;break}var x=s.match(o);x&&m(l,x[1],x[2]?x[4]:x[1])}a.childs.push(l),d||(a=l)}p=s.index}return e(s.cut(p)),i}function m(t,e,i,n){if("id"===e)return void(t.id=i);var s,r=e.indexOf("-");switch(r>0&&(s=e.slice(0,r),e=e.slice(r+1)),s){case"on":t.events.push({name:e,expr:T(i)});break;case"san":var o=w(e,i);o&&t.directives.push(o);break;case"prop":x(t,e,i);break;default:n||x(t,e,i)}}function x(t,e,i){var n=i.match(/^\{=\s*(\S[\s\S]*?)\s*=\}$/);if(n)return void t.props.push({name:e,expr:E(n[1]),twoWay:!0});var s=C(i);1===s.segs.length&&(s=s.segs[0]),t.props.push(N({name:e,expr:s,raw:i}))}function N(t){return"class"===t.name&&n(t.expr.segs,function(t){t.type===ke.INTERP&&t.filters.push({type:ke.CALL,name:{type:ke.IDENT,name:"join"},args:[{type:ke.STRING,value:" "}]})}),t}function w(t,e){var i=Se[t];if(i){var n=i(e);return n.name=t,n}}function C(t){function e(t){t&&o.push({type:ke.STRING,value:t})}for(var i,n=/\{\{\s*([\s\S]+?)\s*\}\}/gi,s=new v(t),r=0,o=[];null!=(i=s.match(n));)e(s.cut(r,s.index-i[0].length)),o.push(_(i[1])),r=s.index;return e(s.cut(r)),{type:ke.TEXT,segs:o}}function _(t){for(var e=new v(t),i=R(e),n=[];e.goUntil(124);)n.push(B(e));return{type:ke.INTERP,expr:i,filters:n}}function E(t){return"object"==typeof t&&t.type?t:R(new v(t))}function T(t){return B(new v(t))}function b(t){var e,i=t.currentCode(),n=t.index;t:for(;e=t.nextCode();)switch(e){case 92:t.go(1);break;case i:t.go(1);break t}var s=t.cut(n,t.index);return{type:ke.STRING,value:new Function("return "+s)()}}function A(t){var e=t.match(/\s*([\$0-9a-z_]+)/gi);return{type:ke.IDENT,name:e[1]}}function k(t){var e=t.match(/\s*(-?[0-9]+(.[0-9]+)?)/g);return{type:ke.NUMBER,value:e[1]-0}}function S(t){var e={type:ke.PROP_ACCESSOR,paths:[]},i=A(t);if(!i)return null;e.paths.push(i);t:for(;;){var n=t.currentCode();switch(n){case 46:t.go(1),e.paths.push({type:ke.STRING,value:A(t).name});break;case 91:t.go(1),e.paths.push(R(t)),t.goUntil(93);break;default:break t}}return 1===e.paths.length?i:e}function R(t){var e=I(t);if(t.goUntil(),63===t.currentCode()){t.go(1);var i=R(t);if(t.goUntil(),58===t.currentCode())return t.go(1),{type:ke.TERTIARY,segs:[e,i,R(t)]}}return e}function I(t){var e=O(t);if(t.goUntil(),124===t.currentCode()){if(124===t.nextCode())return t.go(1),{type:ke.BINARY,operator:248,segs:[e,I(t)]};t.go(-1)}return e}function O(t){var e=P(t);if(t.goUntil(),38===t.currentCode()){if(38===t.nextCode())return t.go(1),{type:ke.BINARY,operator:76,segs:[e,O(t)]};t.go(-1)}return e}function P(t){var e=H(t);t.goUntil();var i=t.currentCode();switch(i){case 61:case 33:if(61===t.nextCode())return i+=61,61===t.nextCode()&&(t.go(1),i+=61),{type:ke.BINARY,operator:i,segs:[e,P(t)]};t.go(-1)}return e}function H(t){var e=L(t);t.goUntil();var i=t.currentCode();switch(i){case 60:case 62:return 61===t.nextCode()&&(i+=61,t.go(1)),{type:ke.BINARY,operator:i,segs:[e,H(t)]}}return e}function L(t){var e=U(t);t.goUntil();var i=t.currentCode();switch(i){case 43:case 45:return t.go(1),{type:ke.BINARY,operator:i,segs:[e,L(t)]}}return e}function U(t){var e=D(t);t.goUntil();var i=t.currentCode();switch(i){case 42:case 47:return t.go(1),{type:ke.BINARY,operator:i,segs:[e,U(t)]}}return e}function D(t){switch(t.goUntil(),t.currentCode()){case 33:return t.go(1),{type:ke.UNARY,expr:D(t)};case 34:case 39:return b(t);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return k(t);case 40:return M(t)}return S(t)}function M(t){t.go(1);var e=R(t);return t.goUntil(41),e}function B(t){t.goUntil();var e=A(t),i=[];if(t.goUntil(40))for(;!t.goUntil(41);)i.push(R(t)),t.goUntil(44);return{type:ke.CALL,name:e,args:i}}function Y(t,e,i){var s=!1;return n(t,function(t){return s=V(t,e,i),!s}),s}function V(t,e,i){switch(e.type===ke.IDENT&&(e={type:ke.PROP_ACCESSOR,paths:[e]}),t.type){case ke.UNARY:return V(t.expr,e,i);case ke.TEXT:case ke.BINARY:case ke.TERTIARY:return Y(t.segs,e,i);case ke.IDENT:return t.name===e.paths[0].name;case ke.INTERP:if(!V(t.expr,e,i)){var s=!1;return n(t.filters,function(t){return s=Y(t.args,e,i),!s}),s}return!0;case ke.PROP_ACCESSOR:for(var r=t.paths,o=e.paths,s=r[0].name===o[0].name,a=1,p=r.length,h=o.length;p>a;a++){var c=r[a];switch(c.type){case ke.PROP_ACCESSOR:case ke.IDENT:if(V(c,e,i))return!0}s&&h>a&&z(c,i)!=z(o[a],i)&&(s=!1)}return s}return!1}function F(t){this.parent=t,this.listeners=[],this.data={}}function j(t){return Oe[t]}function z(t,e,i){switch(t.type){case ke.UNARY:return!z(t.expr,e,i);case ke.BINARY:var s=Re[t.operator];if("function"==typeof s)return s(z(t.segs[0],e,i),z(t.segs[1],e,i));return;case ke.TERTIARY:var r=z(t.segs[0],e,i);return z(r?t.segs[1]:t.segs[2],e,i);case ke.STRING:case ke.NUMBER:return t.value;case ke.IDENT:case ke.PROP_ACCESSOR:return e.get(t);case ke.INTERP:var o=z(t.expr,e,i);return i&&n(t.filters,function(t){var s=t.name.name,r=i.filters[s]||Pe[s];if("function"==typeof r){var a=[o];n(t.args,function(t){a.push(z(t,e,i))}),o=r.apply(i,a)}}),null==o&&(o=""),o;case ke.TEXT:var a=new l;return n(t.segs,function(t){var n=z(t,e,i);t.type!==ke.INTERP||t.filters[0]||(n=Pe.html(n)),a.push(n)}),a.toString()}}function W(t,e,i){var n=e instanceof ae?e:e.owner;i=i||(e instanceof ae?e.data:e.scope);var s={aNode:t,owner:n,scope:i,parent:e};if(t.isText)return new q(s);if(t.directives.get("if"))return new de(s);if(t.directives.get("else"))return new ve(s);if(t.directives.get("for"))return new ge(s);var r=n.components&&n.components[t.tagName];if(r){var o=new r(s);return o}return"slot"===t.tagName?new J(s):new K(s)}function $(){this.raw={}}function G(t){t=t||{},this.lifeCycle=new $,this.init(t)}function X(t){return'<script type="text/san" id="'+t.id+'"></script>'}function q(t){G.call(this,t)}function J(t){this.childs=[],G.call(this,t)}function K(t){this.childs=[],this.eventListeners={},this._updatedOp=0,this._updateOpCount=0,G.call(this,t)}function Q(t,e){return t.propHandlers[e]||t.propHandlers["*"]}function Z(t){Q(this,t.name).output(this,t)}function te(t,e){("input"===e.type||"value"===e.propertyName)&&(e.value=(e.target||e.srcElement).value,ee.call(this,t,e))}function ee(t,e){var i=[],s=t.expr;n(s.args,function(t){i.push(t.type===ke.IDENT&&"$event"===t.name?this instanceof ae?e:e||window.event:this.evalExpr(t))},this);var r=this.owner;this instanceof ae&&t.isOwn&&(r=this);var o=r[s.name.name];"function"==typeof o&&o.apply(r,i)}function ie(t,e){t.tagName&&(e.push("<"),e.push(t.tagName),e.push(' id="'),e.push(t.id),e.push('"'),t.props.each(function(t){var i=this instanceof ae?z(t.expr,this.data,this):this.evalExpr(t.expr);e.push(Q(this,t.name).input.attr(this,t.name,i)||"")},t),e.push(">"))}function ne(t,e){var i=t.tagName;f(i)||(e.push("</"),e.push(i),e.push(">"))}function se(t){var e=new l;return n(t.aNode.childs,function(i){var n=W(i,t);t.childs.push(n),e.push(n.genHTML())}),e.toString()}function re(t,e){return t=t.toLowerCase(),{input:{attr:function(e,i,n){return n?" "+t+'="'+t+'"':void 0},prop:function(e,i,n){var s=De[t]||t;e.el[s]=!!n}},choose:function(i){return"function"!=typeof e||e(i)?t:void 0}}}function oe(t,e,i){var n=t.option.target;return n&&n.id===e.id&&(!i||n.prop===i)}function ae(t){this.slotChilds=[],this.data=new F,K.call(this,t)}function pe(t){for(var e,i=new le(t.el);e=i.current;){var n=he(e,t,i);n&&t.childs.push(n),i.goNext()}}function he(t,e,i){var n=e instanceof ae?e:e.owner,s=t.tagName.toLowerCase(),r=null;s.indexOf("-")>0&&(r=n.components[s]);var o=t.getAttribute("san-component");o&&(r=n.components[o]);var a={owner:n,scope:n.data,parent:e,el:t,elWalker:i};if(r)return new r(a);var p=ce(t),h=t.getAttribute("san-stump");return a.aNode=p,p.directives.get("if")||"if"===h?new de(a):p.directives.get("else")||"else"===h?new ve(a):p.directives.get("for")||"for"===h?new ge(a):ue(t)?new q(a):new K(a)}function ce(t){var e=new g;return e.tagName=t.tagName.toLowerCase(),n(t.attributes,function(t){m(e,t.name,t.value,!0)}),e}function ue(t){return"SCRIPT"===t.tagName&&"text/san"===t.type}function le(t){this.raw=[],this.index=0;for(var e=t.firstChild;e;)1===e.nodeType&&this.raw.push(e),e=e.nextSibling;this.current=this.raw[this.index],this.next=this.raw[this.index+1]}function de(t){K.call(this,t)}function fe(t){var e=t.aNode,i=new g({childs:e.childs,props:e.props,events:e.events,tagName:e.tagName});return t.aNode.directives.each(function(t){switch(t.name){case"if":case"else":break;default:i.directives.push(t)}}),W(i,t)}function ve(t){for(var e=t.parent.childs,i=e.length;i--;){var n=e[i];if(!(n instanceof q)){if(n instanceof de){var s={name:"if",value:{type:ke.UNARY,expr:n.aNode.directives.get("if").value}};return t.aNode.directives.push(s),t.aNode.directives.remove("else"),t.el&&(ue(t.el)?t.el.setAttribute("san-stump","if"):t.el.removeAttribute("san-else")),t.ifDirective=s,new de(t)}break}}throw new Error("[SAN FATEL] else not match if.")}function ge(t){K.call(this,t)}function ye(t,e){var i=t.aNode.directives.get("for");n(t.evalExpr(i.list),e,t)}function me(t,e,i){function s(t){var e,i=t;switch(t.type){case ke.IDENT:e=t;break;case ke.PROP_ACCESSOR:e=t.paths[0]}return e&&e.name===r.item&&(i={type:ke.PROP_ACCESSOR,paths:r.list.type===ke.PROP_ACCESSOR?r.list.paths.slice(0):[r.list]},i.paths.push({type:ke.NUMBER,value:o.get(r.index)}),t.type===ke.PROP_ACCESSOR&&(i.paths=i.paths.concat(t.paths.slice(1)))),i}var r=t.aNode.directives.get("for"),o=new F(t.scope);o.set(r.item,e),o.set(r.index,i),n(["set","remove","unshift","shift","push","pop","splice"],function(e){var i=t.scope[e];o[e]=function(e){e=s(E(e)),i.apply(t.scope,[e].concat(Array.prototype.slice.call(arguments,1)))}});var a=t.aNode,p=new g({childs:a.childs,props:a.props,events:a.events,tagName:a.tagName});a.directives.each(function(t){"for"!==t.name&&p.directives.push(t)});var h=W(p,t,o);return o.onChange(function(t){t.expr.type===ke.IDENT&&t.expr.name===r.index&&h.updateView(t)}),h}function xe(t,e,i){for(var n=t.childs,s=t.aNode.directives.get("for"),r=n.length;r>e;e++){var o=n[e].scope.get(s.index);null!=o&&F.prototype.set.call(n[e].scope,s.index,i(o))}}function Ne(t){function e(t){ae.call(this,t)}return e.prototype=t,i(e,ae),e}var we,Ce=function(){var t={};return n("svg,g,defs,desc,metadata,symbol,use,image,path,rect,circle,line,ellipse,polyline,polygon,text,tspan,tref,textpath,marker,pattern,clippath,mask,filter,cursor,view,animate,font,font-face,glyph,missing-glyph".split(","),function(e){t[e]=!0}),t}(),_e=1,Ee=[],Te=function(){var t="undefined"!=typeof navigator&&navigator.userAgent.match(/msie\s*([0-9]+)/i);return t?t[1]-0:0}(),be=Te&&8>Te,Ae=Te&&9>Te;l.prototype.toString=function(){return be?this.raw.join(""):this.raw},l.prototype.push=be?function(t){this.raw[this.length++]=t}:function(t){this.length++,this.raw+=t},d.prototype.push=function(t){if(!t.name)throw new Error('Object must have "name" property');this.index[t.name]||(this.raw.push(t),this.index[t.name]=t)},d.prototype.getAt=function(t){return this.raw[t]},d.prototype.get=function(t){return this.index[t]},d.prototype.each=function(t,e){n(this.raw,r(t,e||this))},d.prototype.removeAt=function(t){var e=this.raw[t].name;this.index[e]=null,this.raw.splice(t,1)},d.prototype.remove=function(t){this.index[t]=null;for(var e=this.raw.length;e--;)if(this.raw[e].name===t){this.raw.splice(e,1);break}},d.prototype.concat=function(t){var e=new d;return n(this.raw.concat(t.raw),function(t){e.push(t)}),e};var ke={STRING:1,NUMBER:2,IDENT:3,PROP_ACCESSOR:4,INTERP:5,CALL:6,TEXT:7,BINARY:8,UNARY:9,TERTIARY:10};v.prototype.currentCode=function(){return this.charCode(this.index)},v.prototype.cut=function(t,e){return this.source.slice(t,e)},v.prototype.go=function(t){this.index+=t},v.prototype.nextCode=function(){return this.go(1),this.currentCode()},v.prototype.charCode=function(t){return this.source.charCodeAt(t)},v.prototype.goUntil=function(t){for(var e;this.index<this.len&&(e=this.currentCode());)switch(e){case 32:case 9:this.index++;break;default:return e===t?(this.index++,!0):!1}},v.prototype.match=function(t){t.lastIndex=this.index;var e=t.exec(this.source);return e&&(this.index=t.lastIndex),e};var Se={"for":function(t){var e=new v(t),i=e.match(/^\s*([\$0-9a-z_]+)(\s*,\s*([\$0-9a-z_]+))?\s+in\s+/gi);if(i)return{item:i[1],index:i[3]||"$index",list:S(e)};throw new Error("for syntax error: "+t)},ref:function(t){return{value:C(t)}},"if":function(t){return{value:E(t)}},"else":function(){return{value:!0}}},Re={43:function(t,e){return t+e},45:function(t,e){return t-e},42:function(t,e){return t*e},47:function(t,e){return t/e},60:function(t,e){return e>t},62:function(t,e){return t>e},76:function(t,e){return t&&e},94:function(t,e){return t!=e},121:function(t,e){return e>=t},122:function(t,e){return t==e},123:function(t,e){return t>=e},155:function(t,e){return t!==e},183:function(t,e){return t===e},248:function(t,e){return t||e}},Ie={SET:1,SPLICE:2};F.prototype.onChange=function(t){"function"==typeof t&&this.listeners.push(t)},F.prototype.unChange=function(t){for(var e=this.listeners.length;e--;)t&&this.listeners[e]!==t||this.listeners.splice(e,1)},F.prototype.fireChange=function(t){n(this.listeners,function(e){e.call(this,t)},this)},F.prototype.get=function(t){t=E(t);var e=null;switch(t.type){case ke.IDENT:e=this.data[t.name];break;case ke.PROP_ACCESSOR:var i=t.paths;e=this.data[i[0].name];for(var n=1,s=i.length;null!=e&&s>n;n++){var r=i[n],o=z(r,this);e=e[o]}}return null==e&&this.parent?this.parent.get(t):e},F.prototype.set=function(t,e,i){i=i||{},t=E(t);var n,s=this.data;switch(t.type){case ke.IDENT:n=t.name;break;case ke.PROP_ACCESSOR:var r=t.paths,o=r.length;if(1===o)n=r[0].name;else{s=s[r[0].name];for(var a=1;o-1>a;a++){var p=z(r[a],this);null==s[p]&&(s[p]={}),s=s[p]}n=z(r[a],this)}}null!=n&&(s[n]=e,!i.silence&&this.fireChange({type:Ie.SET,expr:t,value:e,option:i}))},F.prototype.push=function(t,e,i){var n=this.get(t);n instanceof Array&&this.splice(t,n.length,0,[e],i)},F.prototype.pop=function(t,e){var i=this.get(t);if(i instanceof Array){var n=i.length;if(n)return this.splice(t,n-1,1,null,e)[0]}},F.prototype.shift=function(t,e){return this.splice(t,0,1,null,e)[0]},F.prototype.unshift=function(t,e,i){this.splice(t,0,0,[e],i)},F.prototype.removeAt=function(t,e,i){this.splice(t,e,1,null,i)},F.prototype.remove=function(t,e,i){var n=this.get(t);if(n instanceof Array)for(var s=n.length;s--;)if(n[s]===e){this.splice(t,s,1,null,i);break}},F.prototype.splice=function(t,e,i,s,r){r=r||{},t=E(t);var o=this.get(t),a=[];if(o instanceof Array){if(0>e||e>o.length)return;var p=[e,i];n(s,function(t){p.push(t)}),a=o.splice.apply(o,p),!r.silence&&this.fireChange({expr:t,type:Ie.SPLICE,index:e,deleteCount:a.length,value:a,insertions:s||[],option:r})}return a};var Oe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Pe={html:function(t){return null==t?"":String(t).replace(/[&<>"']/g,j)},url:encodeURIComponent,raw:function(t){return t},yesToBe:function(t,e){return t?e:""},nullToBe:function(t,e){return null==t?e:t},yesOrNoToBe:function(t,e,i){return t?e:i},join:function(t,e){return t instanceof Array?t.join(e):t}},He={compiled:{name:"compiled",value:1},inited:{name:"inited",value:2},created:{name:"created",value:3},attached:{name:"attached",value:4,mutex:"detached"},detached:{name:"detached",value:5,mutex:"attached"},disposed:{name:"disposed",value:6,mutex:"*"}};$.prototype.set=function(t){var e=He[t];e&&(e.mutex&&("*"===e.mutex?this.raw={}:this.raw[He[e.mutex].value]=0),this.raw[e.value]=1)},$.prototype.is=function(t){var e=He[t];return e?!!this.raw[e.value]:!1},G.prototype._callHook=function(t){if(!this.lifeCycle.is(t)){this.lifeCycle.set(t),"function"==typeof this["_"+t]&&this["_"+t].call(this),"function"==typeof this[t]&&this[t].call(this);var e=this.hooks&&this.hooks[t];e&&e.call(this)}},G.prototype.init=function(t){this._init(t),this._callHook("inited")},G.prototype._init=function(t){this.owner=t.owner,this.parent=t.parent,this.parent&&(this.parentComponent=this.parent instanceof ae?this.parent:this.parent.parentComponent),this.scope=t.scope,this.aNode=this.aNode||t.aNode,this.el=t.el,this.id=this.el&&this.el.id||this.aNode&&this.aNode.id||c()},G.prototype._created=function(){this.el||(this.el=document.getElementById(this.id))},G.prototype._noticeAttached=function(){n(this.childs,function(t){t._noticeAttached()}),this._callHook("created"),this._callHook("attached")},G.prototype.dispose=function(){this._dispose(),this._callHook("disposed")},G.prototype._dispose=function(){this.el=null,this.owner=null,this.scope=null,this.aNode=null,this.parent=null,this.parentComponent=null},G.prototype.evalExpr=function(t){return z(t,this.scope,this.owner)},i(q,G),q.prototype._init=function(t){G.prototype._init.call(this,t),this.el&&(this.aNode.isText=!0,this.aNode.tagName=null,this.aNode.textExpr=C(this.el.innerHTML),this.parent._pushChildANode(this.aNode)),this.expr=this.aNode.textExpr},q.prototype._inited=function(){this.el&&(this._callHook("created"),this.el.parentNode&&this._callHook("attached"))},q.prototype.genHTML=function(){var t=Ae?"﻿":"";return(this.evalExpr(this.expr)||t)+X(this)},q.prototype.update=function(){if(!this.lifeCycle.is("disposed")){var t=this.el.previousSibling;if(t&&3===t.nodeType){var e="string"==typeof t.textContent?"textContent":"data";t[e]=this.evalExpr(this.expr)}else this.el.insertAdjacentHTML("beforebegin",this.evalExpr(this.expr));this.hasUpdateOpInNextTick=0,this._callHook("updated")}},q.prototype.updateView=function(t){return!this.hasUpdateOpInNextTick&&V(this.expr,t.expr,this.scope)?(this.hasUpdateOpInNextTick=1,u(this.update,this),!0):void 0},q.prototype._dispose=function(){this.expr=null,G.prototype._dispose.call(this)},i(J,G),J.prototype._init=function(t){var e=t.aNode.props.get("name");this.name=e?e.raw:"__default__";var i=t.owner,n=i.aNode.givenSlots,s=n&&n[this.name],r=new g;s?(r.childs=s,t.owner=i.owner,t.scope=i.scope):r.childs=t.aNode.childs.slice(0),t.aNode=r,G.prototype._init.call(this,t)},J.prototype._inited=function(){this.owner.slotChilds.push(this)},J.prototype.genHTML=function(){return se(this)},J.prototype.updateView=function(){},J.prototype.slotUpdateView=function(t){if(!this.lifeCycle.is("disposed")){var e=!1;return n(this.childs,function(i){e=i.updateView(t)||e}),e}},J.prototype._dispose=function(){K.prototype._disposeChilds.call(this),this.childs=null,G.prototype._dispose.call(this)};var Le={};i(K,G),K.prototype._init=function(t){G.prototype._init.call(this,t),this.el&&this._initFromEl(t),Le[this.id]=this,this.tagName=this.tagName||this.aNode.tagName||"div",Te&&9>Te&&/^[a-z0-9]+-[a-z0-9]+$/i.test(this.tagName)&&(this.tagName="div")},K.prototype._initFromEl=function(){this.aNode=ce(this.el),this.parent._pushChildANode(this.aNode),this.tagName=this.aNode.tagName},K.prototype._inited=function(){this.props=this.binds=this.aNode.props,this._initPropHandlers(),this.el&&(this.tagName=this.el.tagName.toLowerCase(),pe(this),this._callHook("created"),this.el.parentNode&&this._callHook("attached"))},K.prototype._create=function(){this.el||(this.el=h(this.tagName),this.el.id=this.id,this.props.each(function(t){var e=this instanceof ae?z(t.expr,this.data,this):this.evalExpr(t.expr);Q(this,t.name).input.prop(this,t.name,e)},this))},K.prototype.create=function(){this.lifeCycle.is("created")||(this._create(),this._callHook("created"))},K.prototype._created=function(){G.prototype._created.call(this),this._initSelfChanger(),this.bindEvents()},K.prototype._initSelfChanger=function(){this.binds&&this.binds.each(function(t){if(t.twoWay)switch(t.name){case"value":switch(this.tagName){case"input":case"textarea":this.on("oninput"in this.el?"input":"propertychange",r(Z,this,t));break;case"select":this.on("change",r(Z,this,t))}break;case"checked":if("input"===this.tagName)switch(this.el.type){case"checkbox":case"radio":this.on("click",r(Z,this,t))}}},this)},K.prototype.attach=function(t,e){this.lifeCycle.is("attached")||(this._attach(t,e),this._noticeAttached())},K.prototype._attach=function(t,e){this.create(),this.el.innerHTML=se(this),t&&(e?t.insertBefore(this.el,e):t.appendChild(this.el))};var Ue={input:function(t,e){return{name:"oninput"in t.el?"input":"propertychange",fn:r(te,t,e)}},"*":function(t,e){return{name:e.name,fn:r(ee,t,e)}}};K.prototype.bindEvents=function(){this.aNode.events.each(function(t){var e=Ue[t.name]||Ue["*"],i=e(this,t);this.on(i.name,i.fn)},this)},K.prototype.unbindEvents=function(){var t=this.eventListeners;for(var e in t)t.hasOwnProperty(e)&&this.un(e);this.eventListeners=null},K.prototype.fire=function(t,e){n(this.eventListeners[t],function(t){t.call(this,e)},this)},K.prototype.on=function(t,e){"function"==typeof e&&(this.eventListeners[t]||(this.eventListeners[t]=[]),this.eventListeners[t].push(e),o(this.el,t,e))},K.prototype.un=function(t,e){for(var i=this.eventListeners[t],n=i instanceof Array&&i.length;n--;){var s=i[n];e&&e!==s||(i.splice(n,1),a(this.el,t,s))}},K.prototype.genHTML=function(){var t=new l;return ie(this,t),t.push(se(this)),ne(this,t),t.toString()};var De={readonly:"readOnly",cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder","for":"htmlFor","class":"className"},Me=[re("disabled",function(t){switch(t.tagName){case"input":case"textarea":case"button":case"select":return!0}}),re("readonly",function(t){switch(t.tagName){case"input":case"textarea":return!0}}),{input:{attr:function(t,e,i){var n=t.props.get("value");return n&&s(i,t.evalExpr(n.expr))?' checked="checked"':void 0},prop:function(t,e,i){var n=t.props.get("value");return n&&s(i,t.evalExpr(n.expr))?void(t.el.checked=!0):void(t.el.checked=!1)}},output:function(t,e){var i=t.el;t.scope[i.checked?"push":"remove"](e.expr,i.value)},choose:function(t){if(t.aNode){var e=t.props.get("type");return"input"===t.tagName&&e&&"checkbox"===t.evalExpr(e.expr)&&"checked"}}},{input:{attr:function(t,e,i){var n=t.props.get("value");return n&&i===t.evalExpr(n.expr)?' checked="checked"':void 0},prop:function(t,e,i){var n=t.props.get("value");return n&&i===t.evalExpr(n.expr)?void(t.el.checked=!0):void(t.el.checked=!1)}},output:function(t,e){var i=t.el;t.scope.set(e.expr,i.checked?i.value:"",{target:{id:t.id,prop:e.name}})},choose:function(t){if(t.aNode){var e=t.props.get("type");return"input"===t.tagName&&e&&"radio"===t.evalExpr(e.expr)&&"checked"}}},{input:{attr:function(t,e,i){i&&u(function(){t.el[e]=i})},prop:function(t,e,i){t.el[e]=i}},output:function(t,e){t.scope.set(e.expr,t.el[e.name],{target:{id:t.id,prop:e.name}})},choose:function(t){return"select"===t.tagName&&"value"}},{input:{attr:function(t,e,i){return i?' style="'+i+'"':void 0},prop:function(t,e,i){t.el.style.cssText=i}},choose:function(){return"style"}},{input:{attr:function(t,e,i){return null!=i?" "+e+'="'+i+'"':void 0},prop:function(t,e,i){e=De[e]||e,t.el[e]=i}},output:function(t,e){t.scope.set(e.expr,t.el[e.name],{target:{id:t.id,prop:e.name}})},choose:function(){return"*"}}];K.prototype._initPropHandlers=function(){this.propHandlers={},n(Me,function(t){var e=t.choose(this);e&&(this.propHandlers[e]=t)},this)},K.prototype.setProp=function(t,e){this.lifeCycle.is("created")&&Q(this,t).input.prop(this,t,e)},K.prototype.updateView=function(t){if(!this.lifeCycle.is("disposed")){var e=!1;return this.props.each(function(i){!oe(t,this,i.name)&&V(i.expr,t.expr,this.scope)&&(u(function(){this.lifeCycle.is("disposed")||this.setProp(i.name,this.evalExpr(i.expr))},this),e=!0)},this),n(this.childs,function(i){e=i.updateView(t)||e}),e&&this._noticeUpdatedSoon(),e}},K.prototype._noticeUpdatedSoon=function(){this._updateOpCount++,u(this._noticeUpdated,this)},K.prototype._noticeUpdated=function(){this._updatedOp++,this._updatedOp>=this._updateOpCount&&(this._updateOpCount=0,this._updatedOp=0,this._callHook("updated"))},K.prototype.detach=function(){this.lifeCycle.is("attached")&&(this._detach(),this._callHook("detached"))},K.prototype._detach=function(){p(this.el)},K.prototype._dispose=function(){this._disposeChilds(),this.detach(),this.unbindEvents(),this.valueSynchronizer&&a(this.el,this.valueSynchronizerEvent,this.valueSynchronizer),this.el=null,this.childs=null,this.propHandlers=null,this.props=null,this.binds=null,delete Le[this.id],G.prototype._dispose.call(this)},K.prototype._disposeChilds=function(){n(this.childs,function(t){t.dispose()}),this.childs.length=0},K.prototype._pushChildANode=function(t){this.aNode.childs.push(t)},i(ae,K),ae.prototype.init=function(t){if(this.filters=t.filters||this.filters||{},this.messages=t.messages||this.messages||{},this._compile(),!t.el){var e=this.constructor.prototype.aNode;if(t.aNode){var i=t.aNode,s={};n(i.childs,function(t){var e="__default__",i=!t.isText&&t.props.get("slot");i&&(e=i.raw),s[e]||(s[e]=[]),s[e].push(t)},this),this.aNode=new g({tagName:e.tagName||i.tagName,givenSlots:s,childs:e.childs,props:e.props,binds:i.props,events:i.events.concat(e.events),directives:i.directives.concat(e.directives)})}}this._callHook("compiled"),K.prototype._init.call(this,t),this.binds=this.aNode.binds||new d,this.props=this.aNode.props,this.owner||(this.owner=this);var r=t.data;r||"function"!=typeof this.initData||(r=this.initData());for(var o in r)r.hasOwnProperty(o)&&this.data.set(o,r[o]);this.scope&&this.binds.each(function(t){this.data.set(t.name,this.evalExpr(t.expr))},this),this.computedDeps={};for(var a in this.computed)this.computedDeps[a]||this._calcComputed(a);this._callHook("inited"),this._isInitFromEl&&(this._callHook("created"),this._callHook("attached"))},ae.prototype._calcComputed=function(t){var e,i=this.computedDeps[t];i||(i=this.computedDeps[t]={},e=1),this.data.set(t,this.computed[t].call({data:{get:r(function(n){return e&&!i[n]&&(i[n]=1,this.computed[n]&&this._calcComputed(n),this.watch(n,function(){this._calcComputed(t)})),this.data.get(n)},this)}}))},ae.prototype._inited=function(){this._initPropHandlers()},ae.prototype.dispatch=function(t,e){for(var i=this.parentComponent;i;){if("function"==typeof i.messages[t]){i.messages[t].call(i,{target:this,value:e});break}i=i.parentComponent}},ae.prototype.ref=function(t){function e(s){for(var r=0,o=s.childs.length;o>r;r++){if(i)return;var a=s.childs[r];if(a instanceof ae){var p=a.aNode.directives.get("ref");p&&z(p.value,a.scope||n.data,n)===t&&(i=a)}else a instanceof K&&e(a)}}var i=null,n=this;return e(n),i},ae.prototype._initFromEl=function(){this._isInitFromEl=!0,this.aNode=ce(this.el),this.aNode.binds=this.aNode.props,this.aNode.props=new d,this.parent&&this.parent._pushChildANode(this.aNode),pe(this)},le.prototype.goNext=function(){this.current=this.raw[++this.index],this.next=this.raw[this.index+1]},ae.prototype._compile=function(){var t=this.constructor.prototype;if(!t._isComponentsPreDefined){var e=t.components;for(var i in e)e.hasOwnProperty(i)&&"object"==typeof e[i]&&(e[i]=Ne(e[i]));t._isComponentsPreDefined=!0}if(!t.aNode&&(t.aNode=new g,t.template)){var n=y(t.template),s=n.childs[0];if(!s||s.isText)throw new Error("[SAN FATEL] template must have a root element.");t.aNode=s,"template"===s.tagName&&(s.tagName=null),s.events.each(function(t){t.isOwn=!0}),t.template=null}},ae.prototype._initSelfChanger=function(){this.dataChanger||(this.dataChanger=r(this._dataChanger,this),this.data.onChange(this.dataChanger))},ae.prototype._dataChanger=function(t){var e=!1;this.props.each(function(e){V(e.expr,t.expr,this.data)&&u(function(){this.setProp(e.name,z(e.expr,this.data,this))},this)},this),n(this.childs,function(i){e=i.updateView(t)||e}),n(this.slotChilds,function(i){e=i.slotUpdateView(t)||e}),e&&this._noticeUpdatedSoon(),this.binds.each(function(e){if(e.twoWay&&!oe(t,this.owner)&&V(E(e.name),t.expr,this.data)){var i=e.expr;if(t.expr.type===ke.PROP_ACCESSOR){switch(i={type:ke.PROP_ACCESSOR,paths:[]},e.expr.type){case ke.IDENT:i.paths.push(e.expr);break;case ke.PROP_ACCESSOR:Array.prototype.push.apply(i.paths,e.expr.paths)}Array.prototype.push.apply(i.paths,t.expr.paths.slice(1))}this.scope.set(i,z(t.expr,this.data,this),{target:{id:this.id,prop:e.name}})}},this)},ae.prototype.updateView=function(t){if(!this.lifeCycle.is("disposed")){var e=!1;return this.binds.each(function(i){!oe(t,this,i.name)&&V(i.expr,t.expr,this.scope)&&(this.data.set(i.name,this.evalExpr(i.expr),{target:{id:this.owner.id}}),e=!0)},this),e}},ae.prototype.watch=function(t,e){var i=E(t);this.data.onChange(r(function(t){V(i,t.expr,this.data)&&e.call(this,z(i,this.data,this),t)},this))},ae.prototype._dispose=function(){this.slotChilds=null,this.data.unChange(),this.dataChanger=null,this.data=null,K.prototype._dispose.call(this)},i(de,K),de.prototype._initFromEl=function(t){if(t.el){if("if"===t.el.getAttribute("san-stump")){var e=y(t.el.innerHTML);e=e.childs[0],e.directives.remove("else"),this.aNode=e,this.tagName=this.aNode.tagName}else{this.el=null,this._create(),t.el.parentNode.insertBefore(this.el,t.el.nextSibling),t.el.removeAttribute("san-if");var i=he(t.el,this,t.elWalker);this.childs.push(i),this.aNode.childs=i.aNode.childs.slice(0)}t.ifDirective&&this.aNode.directives.push(t.ifDirective),this.parent._pushChildANode(this.aNode)}},de.prototype._pushChildANode=function(){},de.prototype._create=function(){this.el||(this.el=document.createElement("script"),this.el.type="text/san",this.el.id=this.id)},de.prototype._inited=function(){this.el&&(this._callHook("created"),this.el.parentNode&&this._callHook("attached"))},de.prototype.genHTML=function(){var t=new l,e=this.aNode.directives.get("if");if(this.evalExpr(e.value)){var i=fe(this);this.childs.push(i),t.push(i.genHTML())}return Ae&&!t.length&&t.push("﻿"),t.push(X(this)),t.toString()},de.prototype.updateView=function(t){if(!this.lifeCycle.is("disposed")){var e=this.aNode.directives.get("if").value,i=this.childs[0];return V(e,t.expr,this.scope)?(this.evalExpr(e)&&i&&i.updateView(t),u(function(){var t=this.evalExpr(e),i=this.childs[0];
t?i||(i=fe(this),i.attach(this.el.parentNode,this.el),this.childs[0]=i):i&&(i.dispose(),this.childs.length=0)},this),!0):i&&i.updateView(t)}},de.prototype._noticeAttached=function(){var t=this.aNode.directives.get("if");this.evalExpr(t.value)&&this.childs[0]._noticeAttached(),this._callHook("created"),this._callHook("attached")},i(ge,K),ge.prototype._pushChildANode=function(){},ge.prototype.genHTML=function(){var t=new l;return ye(this,function(e,i){var n=me(this,e,i);this.childs.push(n),t.push(n.genHTML())}),Ae&&!t.length&&t.push("﻿"),t.push(X(this)),t.toString()},ge.prototype._initFromEl=function(t){if(t.el){for(;;){var e=t.elWalker.current;if("for"===e.getAttribute("san-stump")){var i=y(e.innerHTML);i=i.childs[0],this.aNode=i,this.tagName=this.aNode.tagName;break}e.removeAttribute("san-for");var n=he(e,this,t.elWalker);this.childs.push(n);var s=t.elWalker.next;if(!s||!s.getAttribute("san-for")&&"for"!==s.getAttribute("san-stump"))break;t.elWalker.goNext()}this.parent._pushChildANode(this.aNode)}},ge.prototype._inited=function(){this.el&&(this._callHook("created"),this.el.parentNode&&this._callHook("attached"))},ge.prototype._attach=function(t,e){this.create(),t&&(e?t.insertBefore(this.el,e):t.appendChild(this.el));var i=new l;ye(this,function(t,e){var n=me(this,t,e);this.childs.push(n),i.push(n.genHTML())}),this.el.insertAdjacentHTML("beforebegin",i.toString())},ge.prototype._detach=function(){n(this.childs,function(t){t.dispose()}),this.childs.length=0,p(this.el)},ge.prototype._create=function(){this.el||(this.el=document.createElement("script"),this.el.type="text/san",this.el.id=this.id)},ge.prototype.updateView=function(t){if(!this.lifeCycle.is("disposed")){var i=this.aNode.directives.get("for"),s=t.expr,r=s.paths;s.type===ke.IDENT&&(r=[s]);var o=r.length,a=i.list,p=a.paths;a.type===ke.IDENT&&(p=[a]);for(var h,c=p.length,d=0,f=0;o>f&&c>f;f++)if(this.evalExpr(r[f])!==this.evalExpr(p[f])){d=-1;break}d>=0&&o>c&&(h=+this.evalExpr(r[c]),d=o-c===1?1:2);var v=!1;switch(d){case-1:n(this.childs,function(e){v=e.updateView(t)||v});break;case 0:switch(t.type){case Ie.SPLICE:var g=t.index,y=t.deleteCount;u(function(){if(!this.lifeCycle.is("disposed")){for(var e=[g,y],i=0;y>i;i++)this.childs[g+i].dispose();var s=this.childs[g+y]||this;n(t.insertions,function(t,i){var n=me(this,t,g+i);e.push(n),n.attach(s.el.parentNode,s.el)},this),this.childs.splice.apply(this.childs,e)}},this),xe(this,g+y,function(e){return e-y+t.insertions.length});break;case Ie.SET:u(function(){if(!this.lifeCycle.is("disposed")){this._disposeChilds();var t=new l;ye(this,function(e,i){var n=me(this,e,i);this.childs.push(n),t.push(n.genHTML())}),this.el.insertAdjacentHTML("beforebegin",t.toString()),this._noticeAttached()}},this)}v=!0;break;case 1:case 2:t.type===Ie.SET&&(t=e({},t),t.expr={type:ke.PROP_ACCESSOR,paths:[{name:i.item,type:ke.IDENT}].concat(r.slice(c+1))},F.prototype.set.call(this.childs[h].scope,t.expr,t.value,{silence:!0}),this.childs[h].updateView(t),v=!0)}return v&&this._noticeUpdatedSoon(),v}},Ae&&(de.prototype.attached=q.prototype.attached=ge.prototype.attached=function(){if(this.el){var t=this.el.previousSibling;if(t&&3===t.nodeType){var e="string"==typeof t.textContent?"textContent":"data",i=t[e];i&&"﻿"!==i||p(t)}}});var Be={version:"3.0.3-rc.8",Component:ae,defineComponent:Ne,parseTemplate:y,parseExpr:E,ExprType:ke,LifeCycle:$,nextTick:u,getEl:function(t){return Le[t]},inherits:i};"object"==typeof exports&&"object"==typeof module?exports=module.exports=Be:"function"==typeof define&&define.amd?define("san",[],Be):t.san=Be}(this);