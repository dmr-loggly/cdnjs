!function(t){function e(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function i(t,i){var n=t.prototype,s=new Function;s.prototype=i.prototype,t.prototype=new s,t.prototype.constructor=t,e(t.prototype,n)}function n(t,e,i){if(t&&t.length>0)for(var n=0,s=t.length;n<s&&!1!==e.call(i||t,t[n],n);n++);}function s(t,e){var i;return n(t,function(t){return!(i=t===e)}),i}function r(t,e){var i=Function.prototype.bind,n=Array.prototype.slice;if(i&&t.bind===i)return i.apply(t,n.call(arguments,1));var s=n.call(arguments,2);return function(){return t.apply(e,s.concat(n.call(arguments)))}}function o(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)}function a(t,e,i){t.addEventListener?t.removeEventListener(e,i,!1):t.detachEvent("on"+e,i)}function p(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function h(t){return xt[t]?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t)}function c(){return"_san_"+wt++}function u(t,e){if(e&&(t=r(t,e)),Ct.push(t),!Nt)if(Nt=function(){var t=Ct.slice(0);Ct=[],Nt=null,n(t,function(t){t()})},"function"==typeof MutationObserver){var i=1,s=new MutationObserver(Nt),o=document.createTextNode(i);s.observe(o,{characterData:!0}),o.data=++i}else"function"==typeof setImmediate?setImmediate(Nt):setTimeout(Nt,0)}function l(){this.raw=bt?[]:"",this.length=0}function f(){this.raw=[],this.index={}}function d(t){return/^(area|base|br|col|embed|hr|img|input|keygen|param|source|track|wbr)$/i.test(t)}function v(t){this.source=t,this.len=this.source.length,this.index=0}function g(t){t&&t.isText||(this.directives=new f,this.props=new f,this.events=[],this.childs=[]),e(this,t)}function y(t){function e(t){t&&r.childs.push(new g({isText:!0,text:t,textExpr:C(t),parent:r}))}var i=new g;if("string"!=typeof t)return i;t=t.replace(/<!--([\s\S]*?)-->/gm,"").replace(/(^\s+|\s+$)/g,"");for(var n,s=new v(t),r=i,o=0;null!=(n=s.match(/<(\/)?([a-z0-9-]+)\s*/gi));){var a=n[1],p=n[2].toLowerCase();if(e(t.slice(o,s.index-n[0].length)),a&&62===s.currentCode()){for(var h=r;h&&h.tagName!==p;)h=h.parent;h&&(r=h.parent),s.go(1)}else if(!a){for(var c=new g({tagName:p,parent:r}),u=d(p);;){var l=s.currentCode();if(62===l){s.go(1);break}if(47===l&&62===s.charCode(s.index+1)){s.go(2),u=1;break}var f=s.match(/([-:0-9a-z\(\)\[\]]+)(=(['"])([^\3]*?)\3)?\s*/gi);f&&m(c,f[1],f[2]?f[4]:f[1])}r.childs.push(c),u||(r=c)}o=s.index}return e(s.cut(o)),i}function m(t,e,i,n){if("id"===e)return void(t.id=i);var s,r,o=e.indexOf("-");switch(o>0&&(r=e.slice(0,o),s=e.slice(o+1)),r){case"on":t.events.push({name:s,expr:b(i)});break;case"san":var a=w(s,i);a&&t.directives.push(a);break;case"prop":x(t,s,i);break;default:n||x(t,e,i)}}function x(t,e,i){var n=i.match(/^\{=\s*(.*?)\s*=\}$/);if(n)return void t.props.push({name:e,expr:E(n[1]),x:!0});t.props.push(N({name:e,expr:C(i),raw:i}))}function N(t){return"class"===t.name&&n(t.expr.segs,function(t){t.type===At.INTERP&&t.filters.push({type:At.CALL,name:"join",args:[{type:At.STRING,value:" "}]})}),t}function w(t,e){var i=St[t];if(i){var n=i(e);return n.name=t,n}}function C(t){function e(t){t&&r.push({type:At.STRING,value:t})}for(var i,n=new v(t),s=0,r=[];null!=(i=n.match(/\{\{\s*([\s\S]+?)\s*\}\}/gi));)e(n.cut(s,n.index-i[0].length)),r.push(_(i[1])),s=n.index;return e(n.cut(s)),{type:At.TEXT,segs:r}}function _(t){for(var e=new v(t),i=R(e),n=[];e.goUntil(124);)n.push(Y(e));return{type:At.INTERP,expr:i,filters:n}}function E(t){return"object"==typeof t&&t.type?t:R(new v(t))}function b(t){return Y(new v(t))}function T(t){var e,i=t.currentCode(),n=t.index;t:for(;e=t.nextCode();)switch(e){case 92:t.go(1);break;case i:t.go(1);break t}var s=t.cut(n,t.index);return{type:At.STRING,value:new Function("return "+s)()}}function A(t){return t.match(/\s*([\$0-9a-z_]+)/gi)[1]}function S(t){var e=t.match(/\s*(-?[0-9]+(.[0-9]+)?)/g);return{type:At.NUMBER,value:e[1]-0}}function k(t){var e={type:At.ACCESSOR,paths:[{type:At.STRING,value:A(t)}]};t:for(;;)switch(t.currentCode()){case 46:t.go(1),e.paths.push({type:At.STRING,value:A(t)});break;case 91:t.go(1),e.paths.push(R(t)),t.goUntil(93);break;default:break t}return e}function R(t){var e=H(t);if(t.goUntil(),63===t.currentCode()){t.go(1);var i=R(t);if(t.goUntil(),58===t.currentCode())return t.go(1),{type:At.TERTIARY,segs:[e,i,R(t)]}}return e}function H(t){var e=I(t);if(t.goUntil(),124===t.currentCode()){if(124===t.nextCode())return t.go(1),{type:At.BINARY,operator:248,segs:[e,H(t)]};t.go(-1)}return e}function I(t){var e=L(t);if(t.goUntil(),38===t.currentCode()){if(38===t.nextCode())return t.go(1),{type:At.BINARY,operator:76,segs:[e,I(t)]};t.go(-1)}return e}function L(t){var e=U(t);t.goUntil();var i=t.currentCode();switch(i){case 61:case 33:if(61===t.nextCode())return i+=61,61===t.nextCode()&&(i+=61,t.go(1)),{type:At.BINARY,operator:i,segs:[e,L(t)]};t.go(-1)}return e}function U(t){var e=M(t);t.goUntil();var i=t.currentCode();switch(i){case 60:case 62:return 61===t.nextCode()&&(i+=61,t.go(1)),{type:At.BINARY,operator:i,segs:[e,U(t)]}}return e}function M(t){var e=O(t);t.goUntil();var i=t.currentCode();switch(i){case 43:case 45:return t.go(1),{type:At.BINARY,operator:i,segs:[e,M(t)]}}return e}function O(t){var e=P(t);t.goUntil();var i=t.currentCode();switch(i){case 42:case 47:return t.go(1),{type:At.BINARY,operator:i,segs:[e,O(t)]}}return e}function P(t){switch(t.goUntil(),t.currentCode()){case 33:return t.go(1),{type:At.UNARY,expr:P(t)};case 34:case 39:return T(t);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return S(t);case 40:return B(t)}return k(t)}function B(t){t.go(1);var e=R(t);return t.goUntil(41),e}function Y(t){t.goUntil();var e=A(t),i=[];if(t.goUntil(40))for(;!t.goUntil(41);)i.push(R(t)),t.goUntil(44);return{type:At.CALL,name:e,args:i}}function V(t,e,i){var s;return n(e,function(e){return!(s=G(t,e,i))}),s?1:0}function G(t,e,i){switch(e.type){case At.ACCESSOR:for(var s=e.paths,r=s.length,o=t.paths,a=o.length,p=1,h=0;h<r;h++){var c=s[h];if(c.type===At.ACCESSOR&&G(t,c,i))return 1;p&&h<a&&$(c,i)!=o[h].value&&(p=0)}return p&&(p=Math.max(1,a-r+2)),p;case At.UNARY:return G(t,e.expr,i)?1:0;case At.TEXT:case At.BINARY:case At.TERTIARY:return V(t,e.segs,i);case At.INTERP:if(!G(t,e.expr,i)){var u;return n(e.filters,function(e){return!(u=V(t,e.args,i))}),u?1:0}return 1}return 0}function j(t){this.parent=t,this.listeners=[],this.data={}}function F(t){return Ht[t]}function D(t){return null==t?"":String(t).replace(/[&<>"']/g,F)}function $(t,e,i,s){switch(t.type){case At.UNARY:return!$(t.expr,e,i);case At.BINARY:var r=kt[t.operator];if("function"==typeof r)return r($(t.segs[0],e,i),$(t.segs[1],e,i));return;case At.TERTIARY:return $($(t.segs[0],e,i)?t.segs[1]:t.segs[2],e,i);case At.STRING:case At.NUMBER:return t.value;case At.ACCESSOR:return e.get(t);case At.INTERP:var o=$(t.expr,e,i);return i&&n(t.filters,function(t){var s=t.name,r=i.filters[s]||It[s];if("function"==typeof r){var a=[o];n(t.args,function(t){a.push($(t,e,i))}),o=r.apply(i,a)}}),null==o&&(o=""),o;case At.TEXT:var a=new l;return n(t.segs,function(t){var n=$(t,e,i);s&&t.type===At.INTERP&&!t.filters[0]&&(n=D(n)),a.push(n)}),a.toString()}}function z(){this.raw={}}function W(t){t=t||{},this.lifeCycle=new z,this.init(t)}function X(t){return'<script type="text/san" id="'+t.id+'"></script>'}function q(t){W.call(this,t)}function J(t){this.childs=[],this.listeners={},W.call(this,t)}function K(t,e){return t=t.toLowerCase(),{input:{attr:function(e,i,n){if(n&&"false"!==n&&"0"!==n)return" "+t+'="'+t+'"'},prop:function(e,i,n){var s=Mt[t]||t;e.el[s]=!(!n||"false"===n||"0"===n)}},choose:function(i){if(s(e,i.tagName))return t}}}function Q(t,e){return t.propHandlers[e]||Ot}function Z(t){Q(this,t.name).output(this,t)}function tt(t,e){var i=[],s=t.expr;n(s.args,function(t){i.push(t.type===At.ACCESSOR&&1===t.paths.length&&"$event"===t.paths[0].value?this instanceof ot?e:e||window.event:this.evalExpr(t))},this);var r=this.owner;this instanceof ot&&t.isOwn&&(r=this);var o=r[s.name];"function"==typeof o&&o.apply(r,i)}function et(t,e){t.tagName&&(e.push("<"),e.push(t.tagName),e.push(' id="'),e.push(t.id),e.push('"'),t.props.each(function(t){var i=this instanceof ot?$(t.expr,this.data,this):this.evalExpr(t.expr,1);e.push(Q(this,t.name).input.attr(this,t.name,i)||"")},t),e.push(">"))}function it(t,e){var i=t.tagName;d(i)||(e.push("</"),e.push(i),e.push(">"))}function nt(t){if("textarea"===t.tagName){var e=t.props.get("value");return e?D(t.evalExpr(e.expr)):""}var i=new l;return n(t.aNode.childs,function(e){var n=pt(e,t);this._static||t.childs.push(n),i.push(n.genHTML())}),i.toString()}function st(t,e,i){var n=t.option.target;return n&&n.id===e.id&&(!i||n.prop===i)}function rt(t){this.childs=[],W.call(this,t)}function ot(t){this.slotChilds=[],this.data=new j,this.dataChanges=[],J.call(this,t)}function at(t){for(var e,i=new lt(t.el);e=i.current;){var n=ht(e,t,i);n&&t.childs.push(n),i.goNext()}}function pt(t,e,i){var n=e instanceof ot?e:e.owner;i=i||(e instanceof ot?e.data:e.scope);var s={aNode:t,owner:n,scope:i,parent:e};if(t.isText)return new q(s);if(t.directives.get("if"))return new ft(s);if(t.directives.get("else"))return new vt(s);if(t.directives.get("for"))return new gt(s);var r=n.components[t.tagName];return r?new r(s):"slot"===t.tagName?new rt(s):new J(s)}function ht(t,e,i){var n=e instanceof ot?e:e.owner,s=t.tagName.toLowerCase(),r=null;s.indexOf("-")>0&&(r=n.components[s]);var o=t.getAttribute("san-component");o&&(r=n.components[o]);var a={owner:n,scope:n.data,parent:e,el:t,elWalker:i};if(r)return new r(a);var p=ct(t),h=t.getAttribute("san-stump");return a.aNode=p,p.directives.get("if")||"if"===h?new ft(a):p.directives.get("else")||"else"===h?new vt(a):p.directives.get("for")||"for"===h?new gt(a):ut(t)?new q(a):new J(a)}function ct(t){var e=new g;return e.tagName=t.tagName.toLowerCase(),n(t.attributes,function(t){m(e,t.name,t.value,!0)}),e}function ut(t){return"SCRIPT"===t.tagName&&"text/san"===t.type}function lt(t){this.raw=[],this.index=0;for(var e=t.firstChild;e;)1===e.nodeType&&this.raw.push(e),e=e.nextSibling;this.current=this.raw[this.index],this.next=this.raw[this.index+1]}function ft(t){J.call(this,t)}function dt(t){var e=t.aNode,i=new g({childs:e.childs,props:e.props,events:e.events,tagName:e.tagName,directives:(new f).concat(e.directives)});return i.directives.remove("if"),i.directives.remove("else"),pt(i,t)}function vt(t){for(var e=t.parent.childs,i=e.length;i--;){var n=e[i];if(n instanceof ft){var s={name:"if",value:{type:At.UNARY,expr:n.aNode.directives.get("if").value}};return t.aNode.directives.push(s),t.el&&(ut(t.el)?t.el.setAttribute("san-stump","if"):t.el.removeAttribute("san-else")),t.ifDirective=s,new ft(t)}}}function gt(t){J.call(this,t)}function yt(t,e,i){function s(t){return t.paths[0].value===r.item?{type:At.ACCESSOR,paths:r.list.paths.concat({type:At.NUMBER,value:o.get(r.index)},t.paths.slice(1))}:t}var r=t.aNode.directives.get("for"),o=new j(t.scope);o.set(r.item,e),o.set(r.index,i),n(["set","remove","unshift","shift","push","pop","splice"],function(e){var i=t.scope[e];o[e]=function(e){e=s(E(e)),i.apply(t.scope,[e].concat(Array.prototype.slice.call(arguments,1)))}});var a=t.aNode,p=new g({childs:a.childs,props:a.props,events:a.events,tagName:a.tagName,directives:(new f).concat(a.directives)});return p.directives.remove("for"),pt(p,t,o)}function mt(t){function e(t){ot.call(this,t)}return e.prototype=t,i(e,ot),e}var xt={};n("svg,g,defs,desc,metadata,symbol,use,image,path,rect,circle,line,ellipse,polyline,polygon,text,tspan,tref,textpath,marker,pattern,clippath,mask,filter,cursor,view,animate,font,font-face,glyph,missing-glyph".split(","),function(t){xt[t]=1});var Nt,wt=1,Ct=[],_t="undefined"!=typeof navigator&&navigator.userAgent.match(/msie\s*([0-9]+)/i),Et=_t?_t[1]-0:0,bt=Et&&Et<8,Tt=Et&&Et<9;l.prototype.toString=function(){return bt?this.raw.join(""):this.raw},l.prototype.push=bt?function(t){this.raw[this.length++]=t}:function(t){this.length++,this.raw+=t},f.prototype.push=function(t){this.index[t.name]||(this.raw.push(t),this.index[t.name]=t)},f.prototype.getAt=function(t){return this.raw[t]},f.prototype.get=function(t){return this.index[t]},f.prototype.each=function(t,e){n(this.raw,r(t,e||this))},f.prototype.remove=function(t){this.index[t]=null;for(var e=this.raw.length;e--;)if(this.raw[e].name===t){this.raw.splice(e,1);break}},f.prototype.concat=function(t){var e=new f;return n(this.raw.concat(t.raw),function(t){e.push(t)}),e};var At={STRING:1,NUMBER:2,ACCESSOR:3,INTERP:4,CALL:5,TEXT:6,BINARY:7,UNARY:8,TERTIARY:9};v.prototype.currentCode=function(){return this.charCode(this.index)},v.prototype.cut=function(t,e){return this.source.slice(t,e)},v.prototype.go=function(t){this.index+=t},v.prototype.nextCode=function(){return this.go(1),this.currentCode()},v.prototype.charCode=function(t){return this.source.charCodeAt(t)},v.prototype.goUntil=function(t){for(var e;this.index<this.len&&(e=this.currentCode());)switch(e){case 32:case 9:this.index++;break;default:if(e===t)return this.index++,1;return}},v.prototype.match=function(t){t.lastIndex=this.index;var e=t.exec(this.source);return e&&(this.index=t.lastIndex),e};var St={for:function(t){var e=new v(t),i=e.match(/^\s*([\$0-9a-z_]+)(\s*,\s*([\$0-9a-z_]+))?\s+in\s+/gi);if(i)return{item:i[1],index:i[3]||"$index",list:k(e)}},ref:function(t){return{value:C(t)}},if:function(t){return{value:E(t)}},else:function(){return{value:!0}}},kt={43:function(t,e){return t+e},45:function(t,e){return t-e},42:function(t,e){return t*e},47:function(t,e){return t/e},60:function(t,e){return t<e},62:function(t,e){return t>e},76:function(t,e){return t&&e},94:function(t,e){return t!=e},121:function(t,e){return t<=e},122:function(t,e){return t==e},123:function(t,e){return t>=e},155:function(t,e){return t!==e},183:function(t,e){return t===e},248:function(t,e){return t||e}},Rt={SET:1,SPLICE:2};j.prototype.onChange=function(t){"function"==typeof t&&this.listeners.push(t)},j.prototype.unChange=function(t){for(var e=this.listeners.length;e--;)t&&this.listeners[e]!==t||this.listeners.splice(e,1)},j.prototype.fireChange=function(t){n(this.listeners,function(e){e.call(this,t)},this)},j.prototype.get=function(t){if(t=E(t),t.type===At.ACCESSOR){for(var e=t.paths,i=0,n=e.length;i<n&&null!=e[i].value;i++);for(var s=this.data,r=0;null!=s&&r<i;r++)s=s[e[r].value];for(null==s&&this.parent&&(s=this.parent.get({type:At.ACCESSOR,paths:e.slice(0,i)})),r=i;null!=s&&r<n;r++)s=s[e[r].value||$(e[r],this)];return s}},j.prototype.set=function(t,e,i){if(i=i||{},t=E(t),t.type===At.ACCESSOR){for(var n,s=this.data,r=t.paths,o=0,a=r.length;o<a-1;o++){var p=$(r[o],this);null==s[p]&&(s[p]={}),s=s[p]}n=$(r[o],this),null!=n&&(s[n]=e,!i.silence&&this.fireChange({type:Rt.SET,expr:t,value:e,option:i}))}},j.prototype.push=function(t,e,i){var n=this.get(t);n instanceof Array&&this.splice(t,[n.length,0,e],i)},j.prototype.pop=function(t,e){var i=this.get(t);if(i instanceof Array){var n=i.length;if(n)return this.splice(t,[n-1,1],e)[0]}},j.prototype.shift=function(t,e){return this.splice(t,[0,1],e)[0]},j.prototype.unshift=function(t,e,i){this.splice(t,[0,0,e],i)},j.prototype.removeAt=function(t,e,i){this.splice(t,[e,1],i)},j.prototype.remove=function(t,e,i){var n=this.get(t);if(n instanceof Array)for(var s=n.length;s--;)if(n[s]===e){this.splice(t,[s,1],i);break}},j.prototype.splice=function(t,e,i){i=i||{},t=E(t);var n=this.get(t),s=[];if(n instanceof Array){var r=e[0];if(r<0||r>n.length)return;s=n.splice.apply(n,e),!i.silence&&this.fireChange({expr:t,type:Rt.SPLICE,index:r,deleteCount:s.length,value:s,insertions:e.slice(2),option:i})}return s};var Ht={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},It={html:D,url:encodeURIComponent,raw:function(t){return t},join:function(t,e){return t instanceof Array?t.join(e):t}},Lt={compiled:{value:1},inited:{value:2},created:{value:3},attached:{value:4,mutex:"detached"},detached:{value:5,mutex:"attached"},disposed:{value:6,mutex:"*"}};z.prototype.set=function(t){var e=Lt[t];e&&("*"===e.mutex?this.raw={}:e.mutex&&(this.raw[Lt[e.mutex].value]=0),this.raw[e.value]=1)},z.prototype.is=function(t){var e=Lt[t];return!!e&&!!this.raw[e.value]},W.prototype._callHook=function(t){this.lifeCycle.is(t)||(this.lifeCycle.set(t),"function"==typeof this["_"+t]&&this["_"+t].call(this),"function"==typeof this[t]&&this[t].call(this))},W.prototype.init=function(t){this._init(t),this._callHook("inited")},W.prototype._init=function(t){this.owner=t.owner,this.parent=t.parent,this.parentComponent=this.parent instanceof ot?this.parent:this.parent&&this.parent.parentComponent,this.scope=t.scope,this.aNode=this.aNode||t.aNode,this.el=t.el,this.id=this.el&&this.el.id||this.aNode&&this.aNode.id||c()},W.prototype._created=function(){this.el||(this.el=document.getElementById(this.id))},W.prototype._noticeAttached=function(){n(this.childs,function(t){t._noticeAttached()}),this._callHook("created"),this._callHook("attached")},W.prototype.dispose=function(){this._dispose(),this._callHook("disposed")},W.prototype._dispose=function(){this.el=null,this.owner=null,this.scope=null,this.aNode=null,this.parent=null,this.parentComponent=null},W.prototype.evalExpr=function(t,e){return $(t,this.scope,this.owner,e)},i(q,W),q.prototype._init=function(t){W.prototype._init.call(this,t),this.el&&(this.aNode.isText=!0,this.aNode.textExpr=C(this.el.innerHTML),this.parent._pushChildANode(this.aNode));var e=this.aNode.textExpr.segs;this._static=1===e.length&&e[0].type===At.STRING},q.prototype._inited=function(){this.el&&(this._callHook("created"),this.el.parentNode&&this._callHook("attached"))},q.prototype.genHTML=function(){var t=Tt?"\ufeff":"";return(this.evalExpr(this.aNode.textExpr,1)||t)+(this._static?"":X(this))},q.prototype.update=function(){var t=this.el.previousSibling;if(t&&3===t.nodeType){t["string"==typeof t.textContent?"textContent":"data"]=this.evalExpr(this.aNode.textExpr)}else this.el.insertAdjacentHTML("beforebegin",this.evalExpr(this.aNode.textExpr,1))},q.prototype.updateView=function(t){n(t,function(t){if(G(t.expr,this.aNode.textExpr,this.scope))return this.update(),!1},this)};var Ut={};i(J,W),J.prototype._init=function(t){W.prototype._init.call(this,t),this.el&&this._initFromEl(t),Ut[this.id]=this,this.tagName=this.tagName||this.aNode.tagName||"div",Et&&Et<9&&/^[a-z0-9]+-[a-z0-9]+$/i.test(this.tagName)&&(this.tagName="div")},J.prototype._initFromEl=function(){this.aNode=ct(this.el),this.parent._pushChildANode(this.aNode),this.tagName=this.aNode.tagName},J.prototype._inited=function(){"option"===this.tagName&&!this.aNode.props.get("value")&&this.aNode.childs[0]&&this.aNode.props.push({name:"value",expr:this.aNode.childs[0].textExpr}),this.props=this.binds=this.aNode.props,this._initPropHandlers(),this.el&&(this.tagName=this.el.tagName.toLowerCase(),at(this),this._callHook("created"),this.el.parentNode&&this._callHook("attached"))},J.prototype._create=function(){this.el||(this.el=h(this.tagName),this.el.id=this.id,this.props.each(function(t){var e=this instanceof ot?$(t.expr,this.data,this):this.evalExpr(t.expr,1),i=/^\s+([a-z0-9_-]+)=(['"])([^\2]*)\2$/.exec(Q(this,t.name).input.attr(this,t.name,e));i&&this.el.setAttribute(i[1],i[3])},this))},J.prototype.create=function(){this.lifeCycle.is("created")||(this._create(),this._callHook("created"))},J.prototype._created=function(){W.prototype._created.call(this),this._initSelfChanger(),this.bindEvents()},J.prototype._initSelfChanger=function(){this.binds&&this.binds.each(function(e){if(e.x){var i=r(Z,this,e);switch(e.name){case"value":switch(this.tagName){case"input":case"textarea":t.CompositionEvent&&(this.on("compositionstart",function(){this.composing=1}),this.on("compositionend",function(){this.composing=0;var t=document.createEvent("HTMLEvents");t.initEvent("input",!0,!0),this.dispatchEvent(t)})),this.on("oninput"in this.el?"input":"propertychange",function(t){this.composing||i(t)});break;case"select":this.on("change",i)}break;case"checked":switch(this.tagName){case"input":switch(this.el.type){case"checkbox":case"radio":this.on("click",i)}}}}},this)};var Mt={readonly:"readOnly",cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder",for:"htmlFor",class:"className"},Ot={input:{attr:function(t,e,i){if(null!=i)return" "+e+'="'+i+'"'},prop:function(t,e,i){e=Mt[e]||e,xt[t.tagName]?t.el.setAttribute(e,i):t.el[e]=i}},output:function(t,e){t.scope.set(e.expr,t.el[e.name],{target:{id:t.id,prop:e.name}})}},Pt=[K("disabled",["input","textarea","button","select"]),K("readonly",["input","textarea"]),K("mutiple",["input"]),{input:{attr:function(t,e,i){var n=t.props.get("value");if(n&&s(i,t.evalExpr(n.expr)))return' checked="checked"'},prop:function(t,e,i){var n=t.props.get("value");if(n&&s(i,t.evalExpr(n.expr)))return void(t.el.checked=!0);t.el.checked=!1}},output:function(t,e){var i=t.el;t.scope[i.checked?"push":"remove"](e.expr,i.value)},choose:function(t){if(t.aNode){var e=t.props.get("type");return"input"===t.tagName&&e&&"checkbox"===e.raw&&"checked"}}},{input:{attr:function(t,e,i){var n=t.props.get("value");if(n&&i===t.evalExpr(n.expr))return' checked="checked"'},prop:function(t,e,i){var n=t.props.get("value");if(n&&i===t.evalExpr(n.expr))return void(t.el.checked=!0);t.el.checked=!1}},output:function(t,e){var i=t.el;t.scope.set(e.expr,i.checked?i.value:"",{target:{id:t.id,prop:e.name}})},choose:function(t){if(t.aNode){var e=t.props.get("type");return"input"===t.tagName&&e&&"radio"===e.raw&&"checked"}}},{input:{attr:function(t,e,i){var n,s=Ot.input.attr(t,e,i),r=t.parent;return"select"===r.tagName&&(n=r.props.get("value"))&&r.evalExpr(n.expr)===i&&(s+=" selected"),s},prop:Ot.input.prop},choose:function(t){return"option"===t.tagName&&"value"}},{input:{attr:function(){},prop:function(t,e,i){t.el[e]=i}},output:Ot.output,choose:function(t){return"textarea"===t.tagName&&"value"}},{input:{attr:function(t,e,i){if(i)return' style="'+i+'"'},prop:function(t,e,i){t.el.style.cssText=i}},choose:function(){return"style"}}];J.prototype._initPropHandlers=function(){this.propHandlers={},n(Pt,function(t){var e=t.choose(this);e&&(this.propHandlers[e]=t)},this)},J.prototype.attach=function(t,e){this.lifeCycle.is("attached")||(this._attach(t,e),this._noticeAttached())},J.prototype._attach=function(t,e){this.create(),this.el.innerHTML=nt(this),t&&(e?t.insertBefore(this.el,e):t.appendChild(this.el))},J.prototype.bindEvents=function(){n(this.aNode.events,function(t){this.on(t.name,r(tt,this,t))},this)},J.prototype.unbindEvents=function(){var t=this.listeners;for(var e in t)t.hasOwnProperty(e)&&this.un(e);this.listeners=null},J.prototype.fire=function(t,e){n(this.listeners[t],function(t){t.call(this,e)},this)},J.prototype.on=function(t,e){"function"==typeof e&&(this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e),o(this.el,t,e))},J.prototype.un=function(t,e){for(var i=this.listeners[t],n=i&&i.length;n--;){var s=i[n];e&&e!==s||(i.splice(n,1),a(this.el,t,s))}},J.prototype.genHTML=function(){var t=new l;return et(this,t),t.push(nt(this)),it(this,t),t.toString()},J.prototype.setProp=function(t,e){this.lifeCycle.is("created")&&Q(this,t).input.prop(this,t,e)},J.prototype.updateView=function(t){this.props.each(function(e){n(t,function(t){if(!st(t,this,e.name)&&G(t.expr,e.expr,this.scope))return this.setProp(e.name,this.evalExpr(e.expr)),!1},this)},this),n(this.childs,function(e){e.updateView(t)})},J.prototype.detach=function(){this.lifeCycle.is("attached")&&(this._detach(),this._callHook("detached"))},J.prototype._detach=function(){p(this.el)},J.prototype._dispose=function(){this._disposeChilds(),this.detach(),this.unbindEvents(),this.el=null,this.childs=null,this.propHandlers=null,this.props=null,this.binds=null,Ut[this.id]=null,W.prototype._dispose.call(this)},J.prototype._disposeChilds=function(){n(this.childs,function(t){t.dispose()}),this.childs.length=0},J.prototype._pushChildANode=function(t){this.aNode.childs.push(t)},i(rt,W),rt.prototype._init=function(t){var e=t.aNode.props.get("name");this.name=e?e.raw:"____";var i=t.owner,n=i.aNode.givenSlots,s=n&&n[this.name],r=new g;s?(r.childs=s,t.owner=i.owner,t.scope=i.scope):r.childs=t.aNode.childs.slice(0),t.aNode=r,W.prototype._init.call(this,t)},rt.prototype._inited=function(){this.owner.slotChilds.push(this)},rt.prototype.genHTML=function(){return nt(this)},rt.prototype.updateView=function(){},rt.prototype.slotUpdateView=function(t){n(this.childs,function(e){e.updateView(t)})},rt.prototype._dispose=function(){J.prototype._disposeChilds.call(this),W.prototype._dispose.call(this)},i(ot,J),ot.prototype.init=function(t){if(this.filters=this.filters||this.constructor.filters||{},this.messages=t.messages||this.messages||{},this._compile(),!t.el){var e=this.constructor.prototype.aNode;if(t.aNode){var i=t.aNode,s={};n(i.childs,function(t){var e="____",i=!t.isText&&t.props.get("slot");i&&(e=i.raw),s[e]||(s[e]=[]),s[e].push(t)},this),this.aNode=new g({tagName:e.tagName||i.tagName,givenSlots:s,childs:e.childs,props:e.props,binds:i.props,events:i.events.concat(e.events),directives:i.directives.concat(e.directives)})}}this._callHook("compiled"),J.prototype._init.call(this,t),this.binds=this.aNode.binds||new f,this.binds.each(function(t){var e=t.expr;e.type===At.TEXT&&1===e.segs.length&&(e=t.expr=e.segs[0],e.type===At.INTERP&&0===e.filters.length&&(t.expr=e.expr))}),this.props=this.aNode.props;var r=t.data||"function"==typeof this.initData&&this.initData();for(var o in r)r.hasOwnProperty(o)&&this.data.set(o,r[o]);this.scope&&this.binds.each(function(t){this.data.set(t.name,this.evalExpr(t.expr))},this),this.computedDeps={};for(var a in this.computed)this.computedDeps[a]||this._calcComputed(a);this._callHook("inited")},ot.prototype._calcComputed=function(t){var e=this.computedDeps[t];e||(e=this.computedDeps[t]={}),this.data.set(t,this.computed[t].call({data:{get:r(function(i){return e[i]||(e[i]=1,this.computed[i]&&this._calcComputed(i),this.watch(i,function(){this._calcComputed(t)})),this.data.get(i)},this)}}))},ot.prototype._inited=function(){this._initPropHandlers(),this._isInitFromEl&&(this._callHook("created"),this._callHook("attached"))},ot.prototype.dispatch=function(t,e){for(var i=this.parentComponent;i;){if("function"==typeof i.messages[t]){i.messages[t].call(i,{target:this,value:e});break}i=i.parentComponent}},ot.prototype.ref=function(t){function e(r){n(r.childs,function(n){if(n instanceof ot){var r=n.aNode.directives.get("ref");r&&$(r.value,n.scope||s.data,s)===t&&(i=n)}else n instanceof J&&e(n);return!i})}var i,s=this;return e(this),n(this.slotChilds,function(t){return e(t),!i}),i},ot.prototype._initFromEl=function(){this._isInitFromEl=!0,this.aNode=ct(this.el),this.aNode.binds=this.aNode.props,this.aNode.props=new f,this.parent&&this.parent._pushChildANode(this.aNode),at(this)},lt.prototype.goNext=function(){this.current=this.raw[++this.index],this.next=this.raw[this.index+1]},ot.prototype._compile=function(){var t=this.constructor,e=t.prototype;if(!e._isComponentsReady){e.components=e.components||t.components||{};var i=e.components;for(var s in i){var r=i[s];"object"==typeof r?i[s]=mt(r):"self"===r&&(i[s]=t)}e._isComponentsReady=1}if(!e.aNode){e.aNode=new g;var o=e.template||t.template;if(o){var a=y(o),p=a.childs[0];e.aNode=p,"template"===p.tagName&&(p.tagName=null),n(p.events,function(t){t.isOwn=1})}}},ot.prototype._initSelfChanger=function(){this.dataChanger||(this.dataChanger=r(this._dataChanger,this),this.data.onChange(this.dataChanger))},ot.prototype.updateView=function(t){if(!this.lifeCycle.is("disposed")){n(t,function(t){var e=t.expr;this.binds.each(function(i){var n,s=i.name,r=i.expr;!st(t,this,s)&&(n=G(e,r,this.scope))&&(n>2&&(s={type:At.ACCESSOR,paths:[{type:At.STRING,value:s}].concat(e.paths.slice(r.paths.length))},r=e),this.data.set(s,this.evalExpr(r),{target:{id:this.owner.id}}))},this)},this);var e=this.dataChanges;e.length&&(this.dataChanges=[],this.props.each(function(t){n(e,function(e){if(G(e.expr,t.expr,this.data))return this.setProp(t.name,$(t.expr,this.data,this)),!1},this)},this),n(this.childs,function(t){t.updateView(e)}),n(this.slotChilds,function(t){t.slotUpdateView(e)}),this._callHook("updated"),this.owner&&(n(e,function(t){this.binds.each(function(e){var i=t.expr;if(e.x&&!st(t,this.owner)&&G(i,E(e.name),this.data)){var n=e.expr;i.paths.length>1&&(n={type:At.ACCESSOR,paths:e.expr.paths.concat(i.paths.slice(1))}),this.scope.set(n,$(i,this.data,this),{target:{id:this.id,prop:e.name}})}},this)},this),this.owner.updateView()))}},ot.prototype._dataChanger=function(t){var e=this.dataChanges.length;for(e||u(this.updateView,this);e--;)switch(G(t.expr,this.dataChanges[e].expr)){case 1:case 2:t.type===Rt.SET&&this.dataChanges.splice(e,1)}this.dataChanges.push(t)},ot.prototype.watch=function(t,e){var i=E(t);this.data.onChange(r(function(t){G(t.expr,i,this.data)&&e.call(this,$(i,this.data,this),t)},this))},ot.prototype._dispose=function(){this.slotChilds=null,this.data.unChange(),this.dataChanger=null,this.dataChanges.length=0,this.data=null,J.prototype._dispose.call(this)},i(ft,J),ft.prototype._initFromEl=function(t){if(t.el){if("if"===t.el.getAttribute("san-stump")){var e=y(t.el.innerHTML);e=e.childs[0],this.aNode=e}else{this.el=null,this._create(),t.el.parentNode.insertBefore(this.el,t.el.nextSibling),t.el.removeAttribute("san-if");var i=ht(t.el,this,t.elWalker);this.childs.push(i),this.aNode.childs=i.aNode.childs.slice(0)}t.ifDirective&&this.aNode.directives.push(t.ifDirective),this.parent._pushChildANode(this.aNode)}},ft.prototype._create=function(){this.el||(this.el=document.createElement("script"),this.el.type="text/san",this.el.id=this.id)},ft.prototype._inited=function(){this.el&&(this._callHook("created"),this.el.parentNode&&this._callHook("attached"))},ft.prototype._created=W.prototype._created,ft.prototype.genHTML=function(){var t=new l;if(this.evalExpr(this.aNode.directives.get("if").value)){var e=dt(this);this.childs[0]=e,t.push(e.genHTML())}return Tt&&!t.length&&t.push("\ufeff"),t.push(X(this)),t.toString()},ft.prototype.updateView=function(t){var e=this.aNode.directives.get("if").value,i=this.childs[0];this.evalExpr(e)?i?i.updateView(t):(i=dt(this),i.attach(this.el.parentNode,this.el),this.childs[0]=i):this._disposeChilds()},ft.prototype._pushChildANode=function(){},i(gt,J),gt.prototype._pushChildANode=function(){},gt.prototype._created=W.prototype._created,gt.prototype.genHTML=function(t){var e=new l;return n(this.evalExpr(this.aNode.directives.get("for").list),function(t,i){var n=yt(this,t,i);this.childs.push(n),e.push(n.genHTML())},this),t||(Tt&&!e.length&&e.push("\ufeff"),e.push(X(this))),e.toString()},gt.prototype._initFromEl=function(t){if(t.el){for(;;){var e=t.elWalker.current;if("for"===e.getAttribute("san-stump")){var i=y(e.innerHTML);i=i.childs[0],this.aNode=i;break}e.removeAttribute("san-for");var n=ht(e,this,t.elWalker);this.childs.push(n);var s=t.elWalker.next;if(!s||!s.getAttribute("san-for")&&"for"!==s.getAttribute("san-stump"))break;t.elWalker.goNext()}this.parent._pushChildANode(this.aNode)}},gt.prototype._inited=function(){this.el&&(this._callHook("created"),this.el.parentNode&&this._callHook("attached"))},gt.prototype._attach=function(t,e){this.create(),t&&(e?t.insertBefore(this.el,e):t.appendChild(this.el)),this.el.insertAdjacentHTML("beforebegin",this.genHTML(1))},gt.prototype._detach=function(){this._disposeChilds(),p(this.el)},gt.prototype._create=function(){this.el||(this.el=document.createElement("script"),this.el.type="text/san",this.el.id=this.id)},gt.prototype.updateView=function(t){var i=[];n(this.childs,function(){i.push([])});var s=0,r=this.aNode.directives.get("for");if(n(t,function(t){var o=G(t.expr,r.list,this.scope);if(o){if(o>2){var a=t.expr.paths,p=r.list.paths.length;t=e({},t),t.expr={type:At.ACCESSOR,paths:[{value:r.item,type:At.STRING}].concat(a.slice(p+1))};var h=+this.evalExpr(a[p]);j.prototype.set.call(this.childs[h].scope,t.expr,t.value,{silence:!0}),
i[h].push(t)}else if(t.type===Rt.SET)this._disposeChilds(),s=1;else if(2===o&&t.type===Rt.SPLICE){var c=t.index,u=t.deleteCount,l={type:Rt.SET,option:t.option,expr:{type:At.ACCESSOR,paths:t.expr.paths.concat({type:At.STRING,value:"length"})}},f={type:Rt.SET,option:t.option,expr:{type:At.ACCESSOR,paths:[{type:At.STRING,value:r.index}]}},d=t.insertions.length;n(this.childs,function(t,e){i[e].push(l),e>=c+u&&(i[e].push(f),j.prototype.set.call(t.scope,f.expr,e-u+d,{silence:!0}))},this);var v=[c,u],g=[c,u];n(t.insertions,function(t,e){v.push(yt(this,t,c+e)),g.push([])},this),n(this.childs.splice.apply(this.childs,v),function(t){t.dispose()}),i.splice.apply(i,g)}}else n(i,function(e){e.push(t)});return!s},this),s)this.el.insertAdjacentHTML("beforebegin",this.genHTML(1)),this._noticeAttached();else for(var o=this.childs.length,a=this;o--;){var p=this.childs[o];p.lifeCycle.is("attached")?p.updateView(i[o]):p.attach(a.el.parentNode,a.el),a=p}},Tt&&(ft.prototype.attached=q.prototype.attached=gt.prototype.attached=function(){if(this.el){var t=this.el.previousSibling;if(t&&3===t.nodeType){var e="string"==typeof t.textContent?"textContent":"data",i=t[e];i&&"\ufeff"!==i||p(t)}}});var Bt={version:"3.0.3-rc.17",Component:ot,defineComponent:mt,parseTemplate:y,parseExpr:E,ExprType:At,LifeCycle:z,nextTick:u,inherits:i,debug:!0};"object"==typeof exports&&"object"==typeof module?exports=module.exports=Bt:"function"==typeof define&&define.amd?define("san",[],Bt):t.san=Bt}(this);