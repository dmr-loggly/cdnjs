!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../lib/infer"),require("../lib/tern"),require("acorn/dist/walk"),require("./modules")):"function"==typeof define&&define.amd?define(["../lib/infer","../lib/tern","acorn/dist/walk","./modules"],e):e(tern,tern,acorn.walk)}(function(s,e,o){"use strict";function r(n,i){var l=s.cx().parent.mod.modules,a=null;function p(e,o,r){a||((a=new s.Obj(!0)).origin=n.name,a.originNode=n.ast,i.addType(a));var t=a.defProp(e,r);t.origin=n.name,o.propagate(t)}o.simple(n.ast,{ImportDeclaration:function(e){for(var o=l.resolveModule(e.source.value,n.name),r=0;r<e.specifiers.length;r++){var t=e.specifiers[r],i=n.scope.getProp(t.local.name);"ImportNamespaceSpecifier"==t.type?o.propagate(i):"ImportDefaultSpecifier"==t.type?(o.getProp("default").propagate(i),o.propagate(i,80)):o.getProp(t.imported.name).propagate(i)}},ExportAllDeclaration:function(e){l.resolveModule(e.source.value,n.name).forAllProps(function(e,o,r){r&&p(e,o,o.originNode)})},ExportDefaultDeclaration:function(e){var o=e.declaration.id||e.declaration;p("default",s.expressionType({node:o,state:n.scope}),o)},ExportNamedDeclaration:function(e){var o=e.declaration;if(o)if("VariableDeclaration"==o.type)for(var r=0;r<o.declarations.length;++r){var t=o.declarations[r];"Identifier"==t.id.type&&p(t.id.name,n.scope.getProp(t.id.name),t.id)}else p(o.id.name,n.scope.getProp(o.id.name),o.id);if(e.specifiers.length){var i=e.source?l.resolveModule(e.source.value,n.name):n.scope;for(r=0;r<e.specifiers.length;r++){var a=e.specifiers[r];p(a.exported.name,i.getProp(a.local.name),a.local)}}}})}function t(e){if("Literal"==e.type&&"string"==typeof e.value){var o=s.findExpressionAround(e.sourceFile.ast,null,e.end,null,function(e,o){return"ImportDeclaration"==o.type||/Export(All|Named)Declaration/.test(o.type)});if(o&&o.node.source==e)return e.value}}function i(e,o){if("Identifier"==e.type){var r=s.findExpressionAround(e.sourceFile.ast,null,e.end,null,"ImportDeclaration");if(!r)return;for(var t=r.node.specifiers,i=0;i<t.length;i++){var a=t[i];if(a.local==e){var n={name:r.node.source.value,prop:null};return"ImportDefaultSpecifier"==a.type?n.prop="default":"ImportSpecifier"==a.type&&(n.prop=a.imported.name),n}}}else if("ImportDeclaration"==e.type&&/^import\s+\{\s*([\w$]+\s*,\s*)*$/.test(e.sourceFile.text.slice(e.start,o)))return{name:e.source.value,prop:""}}e.registerPlugin("es_modules",function(e){e.loadPlugin("modules"),e.mod.modules.on("getExports",r),e.mod.modules.modNameTests.push(t),e.mod.modules.importTests.push(i),e.mod.modules.completableTypes.Identifier=!0,e.mod.modules.completableTypes.Literal=!0,e.mod.modules.completableTypes.ImportDeclaration=!0})});