"use strict";!function(t,e){"function"==typeof define&&define.amd?define(["jquery","moment"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("moment")):t.Calendar=e(jQuery,moment)}(this,function(c,o){function t(t){var d=this;this.settings=t,this.calIsOpen=!1,this.presetIsOpen=!1,this.sameDayRange=t.same_day_range||!1,this.element=t.element||c(".daterange"),this.selected=null,this.type=this.element.hasClass("daterange--single")?"single":"double",this.required=0!=t.required,this.format=t.format||{},this.format.input=t.format&&t.format.input||"MMMM D, YYYY",this.format.preset=t.format&&t.format.preset||"ll",this.format.jump_month=t.format&&t.format.jump_month||"MMMM",this.format.jump_year=t.format&&t.format.jump_year||"YYYY",this.placeholder=t.placeholder||this.format.input,this.days_array=t.days_array&&7==t.days_array.length?t.days_array:o.weekdaysMin(),this.orig_start_date=null,this.orig_end_date=null,this.orig_current_date=null,this.earliest_date=t.earliest_date?o(t.earliest_date):o("January 1, 1900"),this.latest_date=t.latest_date?o(t.latest_date):o("December 31, 2900"),this.end_date=t.end_date?o(t.end_date):"double"==this.type?o():null,this.start_date=t.start_date?o(t.start_date):"double"==this.type?o(this.end_date,-1,"month"):null,this.current_date=t.current_date?o(t.current_date):"single"==this.type?o():null,this.presets=0!=t.presets&&"single"!=this.type,this.callback=t.callback||this.calendarSetDates,this.calendarHTML(this.type),c(".dr-presets",this.element).click(function(){d.presetToggle()}),c(".dr-list-item",this.element).click(function(){var t=c(".dr-item-aside",this).data("start"),e=c(".dr-item-aside",this).data("end");d.start_date=d.calendarCheckDate(t),d.end_date=d.calendarCheckDate(e),d.calendarSetDates(),d.presetToggle(),d.calendarSaveDates()}),c(".dr-date",this.element).on({click:function(){d.calendarOpen(this)},keyup:function(t){9!=t.keyCode||d.calIsOpen||d.start_date||d.end_date||d.calendarOpen(this)},keydown:function(t){switch(t.keyCode){case 9:c(d.selected).hasClass("dr-date-start")?(t.preventDefault(),d.calendarCheckDates(),d.calendarSetDates(),c(".dr-date-end",d.element).trigger("click")):(d.calendarCheckDates(),d.calendarSetDates(),d.calendarSaveDates(),d.calendarClose("force"));break;case 13:t.preventDefault(),d.calendarCheckDates(),d.calendarSetDates(),d.calendarSaveDates(),d.calendarClose("force");break;case 27:d.calendarSetDates(),d.calendarClose("force");break;case 38:t.preventDefault();var e="day";t.shiftKey&&(e="week"),t.metaKey&&(e="month");var a=o(d.current_date).subtract(1,e);c(this).html(a.format(d.format.input)),d.current_date=a.toDate();break;case 40:t.preventDefault();e="day";t.shiftKey&&(e="week"),t.metaKey&&(e="month");var s=o(d.current_date).add(1,e);c(this).html(s.format(d.format.input)),d.current_date=s.toDate()}}}),c(".dr-month-switcher i",this.element).click(function(){var t=c(".dr-month-switcher span",d.element).data("month"),e=c(".dr-year-switcher span",d.element).data("year"),a=o([e,t,1]),s=a.clone().subtract(1,"month"),r=a.clone().add(1,"month").startOf("day");c(this).hasClass("dr-left")?d.calendarOpen(d.selected,s):c(this).hasClass("dr-right")&&d.calendarOpen(d.selected,r)}),c(".dr-year-switcher i",this.element).click(function(){var t=c(".dr-month-switcher span",d.element).data("month"),e=c(".dr-year-switcher span",d.element).data("year"),a=o([e,t,1]),s=a.clone().subtract(1,"year"),r=a.clone().add(1,"year").startOf("day");c(this).hasClass("dr-left")?d.calendarOpen(d.selected,s):c(this).hasClass("dr-right")&&d.calendarOpen(d.selected,r)}),c(".dr-dates-dash",this.element).click(function(){c(".dr-date-start",d.element).trigger("click")}),this.element.on("click",function(){window.addEventListener("click",function(t){d.element.find(t.target).length||(d.presetIsOpen&&d.presetToggle(),d.calIsOpen&&(c(d.selected).hasClass("dr-date-end")&&d.calendarSaveDates(),d.calendarSetDates(),d.calendarClose("force")))})})}return t.prototype.presetToggle=function(){0==this.presetIsOpen?(this.orig_start_date=this.start_date,this.orig_end_date=this.end_date,this.orig_current_date=this.current_date,this.presetIsOpen=!0):this.presetIsOpen&&(this.presetIsOpen=!1),1==this.calIsOpen&&this.calendarClose(),c(".dr-preset-list",this.element).slideToggle(200),c(".dr-input",this.element).toggleClass("dr-active"),c(".dr-presets",this.element).toggleClass("dr-active"),this.element.toggleClass("dr-active")},t.prototype.presetCreate=function(){var i=this,n=c('<ul class="dr-preset-list" style="display: none;"></ul>'),t="object"==typeof i.settings.presets?i.settings.presets:[{label:"Last 30 days",start:o(i.latest_date).subtract(29,"days"),end:i.latest_date},{label:"Last month",start:o(i.latest_date).subtract(1,"month").startOf("month"),end:o(i.latest_date).subtract(1,"month").endOf("month")},{label:"Last 3 months",start:o(i.latest_date).subtract(3,"month").startOf("month"),end:o(i.latest_date).subtract(1,"month").endOf("month")},{label:"Last 6 months",start:o(i.latest_date).subtract(6,"month").startOf("month"),end:o(i.latest_date).subtract(1,"month").endOf("month")},{label:"Last year",start:o(i.latest_date).subtract(12,"month").startOf("month"),end:o(i.latest_date).subtract(1,"month").endOf("month")},{label:"All time",start:i.earliest_date,end:i.latest_date}];return 6<=o(i.latest_date).diff(o(i.latest_date).startOf("month"),"days")&&t.splice(1,0,{label:"This month",start:o(i.latest_date).startOf("month"),end:i.latest_date}),c.each(t,function(t,e){o(e.start).isBefore(i.earliest_date)&&(e.start=i.earliest_date),o(e.start).isAfter(i.latest_date)&&(e.start=i.latest_date),o(e.end).isBefore(i.earliest_date)&&(e.end=i.earliest_date),o(e.end).isAfter(i.latest_date)&&(e.end=i.latest_date);var a=o(e.start).toISOString(),s=o(e.end).toISOString(),r=o(e.start).format(i.format.preset)+" &ndash; "+o(e.end).format(i.format.preset);if(c(".dr-preset-list",i.element).length){var d=c(".dr-preset-list .dr-list-item:nth-of-type("+(t+1)+") .dr-item-aside",i.element);d.data("start",a),d.data("end",s),d.html(r)}else n.append('<li class="dr-list-item">'+e.label+'<span class="dr-item-aside" data-start="'+a+'" data-end="'+s+'">'+r+"</span></li>")}),n},t.prototype.calendarSetDates=function(){if(c(".dr-date-start",this.element).html(o(this.start_date).format(this.format.input)),c(".dr-date-end",this.element).html(o(this.end_date).format(this.format.input)),!this.start_date&&!this.end_date){var t=c(".dr-date",this.element).html(),e=o(this.current_date).format(this.format.input);0!=t.length||this.required||(e=""),t!=e&&c(".dr-date",this.element).html(e)}},t.prototype.calendarSaveDates=function(){if("double"==this.type){if(!o(this.orig_end_date).isSame(this.end_date)||!o(this.orig_start_date).isSame(this.start_date))return this.callback()}else if(c(this.selected).html().length&&!o(this.orig_current_date).isSame(this.current_date))return this.callback()},t.prototype.calendarCheckDate=function(t){var e=t?t.replace(/(?:\d)((?:st|nd|rd|th)?,?)/,"").split(" "):[];if("today"!=t&&"now"!=t||(t=o().isAfter(this.latest_date)?this.latest_date:o()),"earliest"==t&&(t=this.earliest_date),"latest"==t&&(t=this.latest_date),t&&(/\bago\b/.test(t)||/\bahead\b/.test(t))&&(t=this.stringToDate(t)),2==e.length&&(e.push(o().format(this.format.jump_year)),t=e.join(" ")),t&&"string"==c.type(t)){var a=o(t,this.format.input);a.isValid()&&(t=a)}return new Date(t)},t.prototype.calendarCheckDates=function(){var t=c(".dr-date-start",this.element).html(),e=c(".dr-date-end",this.element).html(),a=o(this.calendarCheckDate(c(this.selected).html()));if("ytd"==t||"ytd"==e)var s=o().startOf("year"),r=o().isAfter(this.latest_date)?this.latest_date:o();else s=o(this.calendarCheckDate(t)),r=o(this.calendarCheckDate(e));if(a.isSame(s)&&s.isAfter(r)&&(r=s.add(6,"day")),a.isSame(r)&&r.isBefore(s)&&(s=r.subtract(6,"day")),(r.isBefore(this.earliest_date)||s.isBefore(this.earliest_date))&&(s=o(this.earliest_date),r=o(this.earliest_date).add(6,"day")),(r.isAfter(this.latest_date)||s.isAfter(this.latest_date))&&(s=o(this.latest_date).subtract(6,"day"),r=o(this.latest_date)),s.isSame(r)&&!this.sameDayRange)return this.calendarSetDates();this.start_date=s.isValid()?s.toDate():this.start_date,this.end_date=r.isValid()?r.toDate():this.end_date,this.current_date=a.isValid()?a.toDate():this.current_date},t.prototype.stringToDate=function(t){var e=t.split(" ");return"ago"==e[2]?o(this.current_date).subtract(e[0],e[1]):"ahead"==e[2]?o(this.current_date).add(e[0],e[1]):this.current_date},t.prototype.calendarOpen=function(t,e){var i,n=this,a=c(".dr-dates",this.element).innerWidth()-8;this.selected=t||this.selected,1==this.presetIsOpen&&this.presetToggle(),1==this.calIsOpen?this.calendarClose(e?"switcher":void 0):c(this.selected).html().length&&(this.orig_start_date=this.start_date,this.orig_end_date=this.end_date,this.orig_current_date=this.current_date),this.calendarCheckDates(),this.calendarCreate(e),this.calendarSetDates();var s=o(e||this.current_date).add(1,"month").startOf("month").startOf("day"),r=o(e||this.current_date).subtract(1,"month").endOf("month"),d=o(e||this.current_date).add(1,"year").startOf("month").startOf("day"),l=o(e||this.current_date).subtract(1,"year").endOf("month"),h=o(e||this.current_date);c(".dr-month-switcher span",this.element).data("month",h.month()).html(h.format(this.format.jump_month)),c(".dr-year-switcher span",this.element).data("year",h.year()).html(h.format(this.format.jump_year)),c(".dr-switcher i",this.element).removeClass("dr-disabled"),s.isAfter(this.latest_date)&&c(".dr-month-switcher .dr-right",this.element).addClass("dr-disabled"),r.isBefore(this.earliest_date)&&c(".dr-month-switcher .dr-left",this.element).addClass("dr-disabled"),d.isAfter(this.latest_date)&&c(".dr-year-switcher .dr-right",this.element).addClass("dr-disabled"),l.isBefore(this.earliest_date)&&c(".dr-year-switcher .dr-left",this.element).addClass("dr-disabled"),c(".dr-day",this.element).on({mouseenter:function(){var d=c(this);o(n.start_date),o(n.end_date),o(n.current_date);function t(r){i=void 0,n.range(42).forEach(function(t){var e=d.next().data("date"),a=d.prev().data("date"),s=d.data("date");if(!s)return!1;if(a||(a=s),e||(e=s),"start"==r){if(o(e).isSame(n.end_date)||n.sameDayRange&&o(s).isSame(n.end_date))return!1;if(o(s).isAfter(n.end_date)&&(i=i||o(s).add(6,"day").startOf("day"),5<t||e&&o(e).isAfter(n.latest_date)))return c(d).addClass("dr-end"),i=o(s),!1;d=d.next().addClass("dr-maybe")}else if("end"==r){if(o(a).isSame(n.start_date)||n.sameDayRange&&o(s).isSame(n.start_date))return!1;if(o(s).isBefore(n.start_date)&&(i=i||o(s).subtract(6,"day"),5<t||a&&o(a).isBefore(n.earliest_date)))return c(d).addClass("dr-start"),i=o(s),!1;d=d.prev().addClass("dr-maybe")}})}c(n.selected).hasClass("dr-date-start")&&(d.addClass("dr-hover dr-hover-before"),c(".dr-start",n.element).css({border:"none","padding-left":"0.3125rem"}),t("start")),c(n.selected).hasClass("dr-date-end")&&(d.addClass("dr-hover dr-hover-after"),c(".dr-end",n.element).css({border:"none","padding-right":"0.3125rem"}),t("end")),n.start_date||n.end_date||d.addClass("dr-maybe"),c(".dr-selected",n.element).css("background-color","transparent")},mouseleave:function(){c(this).hasClass("dr-hover-before dr-end")&&c(this).removeClass("dr-end"),c(this).hasClass("dr-hover-after dr-start")&&c(this).removeClass("dr-start"),c(this).removeClass("dr-hover dr-hover-before dr-hover-after"),c(".dr-start, .dr-end",n.element).css({border:"",padding:""}),c(".dr-maybe:not(.dr-current)",n.element).removeClass("dr-start dr-end"),c(".dr-day",n.element).removeClass("dr-maybe"),c(".dr-selected",n.element).css("background-color","")},mousedown:function(){var t=c(this).data("date"),e=o(t).format(n.format.input);i&&c(".dr-date",n.element).not(n.selected).html(i.format(n.format.input)),c(n.selected).html(e),n.calendarOpen(n.selected),c(n.selected).hasClass("dr-date-start")?c(".dr-date-end",n.element).trigger("click"):(n.calendarSaveDates(),n.calendarClose("force"))}}),c(".dr-calendar",this.element).css("width",a).slideDown(200),c(".dr-input",this.element).addClass("dr-active"),c(t).addClass("dr-active").focus(),this.element.addClass("dr-active"),this.calIsOpen=!0},t.prototype.calendarClose=function(t){var e=this;if(!this.calIsOpen||this.presetIsOpen||"force"==t?c(".dr-calendar",this.element).slideUp(200,function(){c(".dr-day",e.element).remove()}):c(".dr-day",this.element).remove(),"switcher"==t)return!1;c(".dr-input, .dr-date",this.element).removeClass("dr-active"),this.element.removeClass("dr-active"),this.calIsOpen=!1},t.prototype.calendarCreate=function(t){var s=this;this.calendarArray(this.start_date,this.end_date,this.current_date,t).forEach(function(t,e){var a="dr-day";t.fade&&(a+=" dr-fade"),t.start&&(a+=" dr-start"),t.end&&(a+=" dr-end"),t.current&&(a+=" dr-current"),t.selected&&(a+=" dr-selected"),t.outside&&(a+=" dr-outside"),c(".dr-day-list",s.element).append('<li class="'+a+'" data-date="'+t.date+'">'+t.str+"</li>")})},t.prototype.calendarArray=function(t,e,a,s){a=o(a||t||e).startOf("day");for(var r=s||a||t||e,d=o(r).startOf("month").startOf("week"),i=o(d).add(41,"days").endOf("day"),n=[],l=o(d);l.isBefore(i);)n.push({str:+l.format("D"),start:t&&l.isSame(t,"day"),end:e&&l.isSame(e,"day"),current:a&&l.isSame(a,"day"),selected:t&&e&&l.isBetween(t,e),date:l.toISOString(),outside:l.isBefore(this.earliest_date)||l.isAfter(this.latest_date),fade:!l.isSame(r,"month")}),l.add(1,"d");return n},t.prototype.calendarHTML=function(t){var a=c('<ul class="dr-days-of-week-list"></ul>'),e=this.days_array.splice(o.localeData().firstDayOfWeek()).concat(this.days_array.splice(0,o.localeData().firstDayOfWeek()));return c.each(e,function(t,e){a.append('<li class="dr-day-of-week">'+e+"</li>")}),"double"==t?this.element.append('<div class="dr-input"><div class="dr-dates"><div class="dr-date dr-date-start" contenteditable>'+o(this.start_date).format(this.format.input)+'</div><span class="dr-dates-dash">&ndash;</span><div class="dr-date dr-date-end" contenteditable>'+o(this.end_date).format(this.format.input)+"</div></div>"+(this.presets?'<div class="dr-presets"><span class="dr-preset-bar"></span><span class="dr-preset-bar"></span><span class="dr-preset-bar"></span></div>':"")+'</div><div class="dr-selections"><div class="dr-calendar" style="display: none;"><div class="dr-range-switcher"><div class="dr-switcher dr-month-switcher"><i class="dr-left"></i><span>April</span><i class="dr-right"></i></div><div class="dr-switcher dr-year-switcher"><i class="dr-left"></i><span>2015</span><i class="dr-right"></i></div></div>'+a[0].outerHTML+'<ul class="dr-day-list"></ul></div>'+(this.presets?this.presetCreate()[0].outerHTML:"")+"</div>"):this.element.append('<div class="dr-input"><div class="dr-dates"><div class="dr-date" contenteditable placeholder="'+this.placeholder+'">'+(this.required?o(this.current_date).format(this.format.input):"")+'</div></div></div><div class="dr-selections"><div class="dr-calendar" style="display: none;"><div class="dr-range-switcher"><div class="dr-switcher dr-month-switcher"><i class="dr-left"></i><span></span><i class="dr-right"></i></div><div class="dr-switcher dr-year-switcher"><i class="dr-left"></i><span></span><i class="dr-right"></i></div></div>'+a[0].outerHTML+'<ul class="dr-day-list"></ul></div></div>')},t.prototype.range=function(t){for(var e=new Array(t),a=0;a<t;a++)e[a]=a;return e},t});