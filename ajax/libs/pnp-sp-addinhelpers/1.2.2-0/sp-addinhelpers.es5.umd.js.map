{"version":3,"file":"sp-addinhelpers.es5.umd.js","sources":["../../../../packages/sp-addinhelpers/src/sprequestexecutorclient.ts","../../../../packages/sp-addinhelpers/src/sprestaddin.ts"],"sourcesContent":["import { extend, HttpClientImpl } from \"@pnp/common\";\n\n/**\n * Makes requests using the SP.RequestExecutor library.\n */\nexport class SPRequestExecutorClient implements HttpClientImpl {\n    /**\n     * Fetches a URL using the SP.RequestExecutor library.\n     */\n    public fetch(url: string, options: any): Promise<Response> {\n        if (SP === undefined || SP.RequestExecutor === undefined) {\n            throw Error(\"SP.RequestExecutor is undefined. Load the SP.RequestExecutor.js library (/_layouts/15/SP.RequestExecutor.js) before loading the PnP JS Core library.\");\n        }\n\n        const addinWebUrl = url.substring(0, url.indexOf(\"/_api\")),\n            executor = new SP.RequestExecutor(addinWebUrl);\n\n        let headers: { [key: string]: string; } = {},\n            iterator: IterableIterator<[string, string]>,\n            temp: IteratorResult<[string, string]>;\n\n        if (options.headers && options.headers instanceof Headers) {\n            iterator = <IterableIterator<[string, string]>>options.headers.entries();\n            temp = iterator.next();\n            while (!temp.done) {\n                headers[temp.value[0]] = temp.value[1];\n                temp = iterator.next();\n            }\n        } else {\n            headers = <any>options.headers;\n        }\n\n        return new Promise((resolve, reject) => {\n\n            let requestOptions = {\n                error: (error: SP.ResponseInfo) => {\n                    reject(this.convertToResponse(error));\n                },\n                headers: headers,\n                method: options.method,\n                success: (response: SP.ResponseInfo) => {\n                    resolve(this.convertToResponse(response));\n                },\n                url: url,\n            };\n\n            if (options.body) {\n                requestOptions = extend(requestOptions, { body: options.body });\n            } else {\n                requestOptions = extend(requestOptions, { binaryStringRequestBody: true });\n            }\n            executor.executeAsync(requestOptions);\n        });\n    }\n\n    /**\n     * Converts a SharePoint REST API response to a fetch API response.\n     */\n    private convertToResponse = (spResponse: SP.ResponseInfo): Response => {\n        const responseHeaders = new Headers();\n\n        if (spResponse.headers !== undefined) {\n            for (const h in spResponse.headers) {\n                if (spResponse.headers[h]) {\n                    responseHeaders.append(h, spResponse.headers[h]);\n                }\n            }\n        }\n\n        // Cannot have an empty string body when creating a Response with status 204\n        const body = spResponse.statusCode === 204 ? null : spResponse.body;\n\n        return new Response(body, {\n            headers: responseHeaders,\n            status: spResponse.statusCode,\n            statusText: spResponse.statusText,\n        });\n    }\n}\n","import {\n    SPRest,\n    Web,\n    Site,\n    SharePointQueryable,\n    SharePointQueryableConstructor,\n} from \"@pnp/sp\";\n\nimport {\n    isUrlAbsolute,\n    combine,\n} from \"@pnp/common\";\n\nexport class SPRestAddIn extends SPRest {\n\n    /**\n     * Begins a cross-domain, host site scoped REST request, for use in add-in webs\n     *\n     * @param addInWebUrl The absolute url of the add-in web\n     * @param hostWebUrl The absolute url of the host web\n     */\n    public crossDomainSite(addInWebUrl: string, hostWebUrl: string): Site {\n        return this._cdImpl(Site, addInWebUrl, hostWebUrl, \"site\");\n    }\n\n    /**\n     * Begins a cross-domain, host web scoped REST request, for use in add-in webs\n     *\n     * @param addInWebUrl The absolute url of the add-in web\n     * @param hostWebUrl The absolute url of the host web\n     */\n    public crossDomainWeb(addInWebUrl: string, hostWebUrl: string): Web {\n        return this._cdImpl(Web, addInWebUrl, hostWebUrl, \"web\");\n    }\n\n    /**\n     * Implements the creation of cross domain REST urls\n     *\n     * @param factory The constructor of the object to create Site | Web\n     * @param addInWebUrl The absolute url of the add-in web\n     * @param hostWebUrl The absolute url of the host web\n     * @param urlPart String part to append to the url \"site\" | \"web\"\n     */\n    private _cdImpl<T extends SharePointQueryable>(\n        factory: SharePointQueryableConstructor<T>,\n        addInWebUrl: string,\n        hostWebUrl: string,\n        urlPart: string): T {\n\n        if (!isUrlAbsolute(addInWebUrl)) {\n            throw Error(\"The addInWebUrl parameter must be an absolute url.\");\n        }\n\n        if (!isUrlAbsolute(hostWebUrl)) {\n            throw Error(\"The hostWebUrl parameter must be an absolute url.\");\n        }\n\n        const url = combine(addInWebUrl, \"_api/SP.AppContextSite(@target)\");\n\n        const instance = new factory(url, urlPart);\n        instance.query.set(\"@target\", \"'\" + encodeURIComponent(hostWebUrl) + \"'\");\n        return instance.configure(this._options);\n    }\n}\n\nexport const sp = new SPRestAddIn();\n"],"names":["extend","tslib_1.__extends","Site","Web","isUrlAbsolute","combine","SPRest","sp"],"mappings":"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"}