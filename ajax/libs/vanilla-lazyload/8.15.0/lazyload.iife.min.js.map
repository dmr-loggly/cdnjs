{"version":3,"sources":["lazyload.js"],"names":["LazyLoad","isInsideViewport","element","container","threshold","isBelowViewport","isAboveViewport","isAtRightOfViewport","isAtLeftOfViewport","getDefaultSettings","elements_selector","window","throttle","data_src","data_srcset","data_sizes","class_loading","class_loaded","class_error","class_initial","skip_invisible","callback_load","callback_error","callback_set","callback_processed","callback_enter","to_webp","callCallback","callback","argument","getTopOffset","getBoundingClientRect","top","pageYOffset","ownerDocument","documentElement","clientTop","innerHeight","offsetHeight","getLeftOffset","left","pageXOffset","clientLeft","documentWidth","innerWidth","offsetWidth","createInstance","classObj","options","event","instance","CustomEvent","detail","err","document","createEvent","initCustomEvent","dispatchEvent","getData","attribute","getAttribute","setData","value","setAttribute","setWasProcessed","getWasProcessed","replaceExtToWebp","condition","replace","runningOnBrowser","isBot","test","navigator","userAgent","supportsClassList","createElement","supportsWebp","canvas","getContext","toDataURL","indexOf","detectWebp","setSourcesInChildren","parentTag","attrName","dataAttrName","toWebpFlag","childTag","i","children","tagName","attrValue","setAttributeIfValue","setSourcesBgImage","settings","srcDataValue","setValue","style","backgroundImage","setSourcesFunctions","IMG","srcsetDataName","parent","parentNode","sizesDataValue","srcsetDataValue","IFRAME","VIDEO","srcDataName","setSources","setSourcesFunction","addClass","className","classList","add","removeClass","remove","RegExp","instanceSettings","this","_settings","_extends","_queryOriginNode","_previousLoopTime","_loopTimeout","_boundHandleScroll","handleScroll","bind","_isFirstLoop","addEventListener","update","prototype","_reveal","force","errorCallback","removeEventListener","loadCallback","_loopThroughElements","forceDownload","elements","_elements","elementsLength","length","processedIndexes","firstLoop","offsetParent","load","push","splice","pop","_stopScrollHandler","_purgeElements","elementsToPurge","_startScrollHandler","_isHandlingScroll","now","Date","remainingTime","clearTimeout","setTimeout","loadAll","Array","slice","call","querySelectorAll","destroy","optionsItem","autoInitialize","lazyLoadOptions"],"mappings":"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","file":"lazyload.iife.min.js","sourcesContent":["var LazyLoad = (function () {\n'use strict';\n\nvar getDefaultSettings = () => ({\r\n\telements_selector: \"img\",\r\n\tcontainer: window,\r\n\tthreshold: 300,\r\n\tthrottle: 150,\r\n\tdata_src: \"src\",\r\n\tdata_srcset: \"srcset\",\r\n\tdata_sizes: \"sizes\",\r\n\tclass_loading: \"loading\",\r\n\tclass_loaded: \"loaded\",\r\n\tclass_error: \"error\",\r\n\tclass_initial: \"initial\",\r\n\tskip_invisible: true,\r\n\tcallback_load: null,\r\n\tcallback_error: null,\r\n\tcallback_set: null,\r\n\tcallback_processed: null,\r\n\tcallback_enter: null,\r\n\tto_webp: false\r\n});\n\nconst callCallback = function(callback, argument) {\r\n\tif (callback) {\r\n\t\tcallback(argument);\r\n\t}\r\n};\n\nconst getTopOffset = function(element) {\r\n\treturn (\r\n\t\telement.getBoundingClientRect().top +\r\n\t\twindow.pageYOffset -\r\n\t\telement.ownerDocument.documentElement.clientTop\r\n\t);\r\n};\r\n\r\nconst isBelowViewport = function(element, container, threshold) {\r\n\tconst fold =\r\n\t\tcontainer === window\r\n\t\t\t? window.innerHeight + window.pageYOffset\r\n\t\t\t: getTopOffset(container) + container.offsetHeight;\r\n\treturn fold <= getTopOffset(element) - threshold;\r\n};\r\n\r\nconst getLeftOffset = function(element) {\r\n\treturn (\r\n\t\telement.getBoundingClientRect().left +\r\n\t\twindow.pageXOffset -\r\n\t\telement.ownerDocument.documentElement.clientLeft\r\n\t);\r\n};\r\n\r\nconst isAtRightOfViewport = function(element, container, threshold) {\r\n\tconst documentWidth = window.innerWidth;\r\n\tconst fold =\r\n\t\tcontainer === window\r\n\t\t\t? documentWidth + window.pageXOffset\r\n\t\t\t: getLeftOffset(container) + documentWidth;\r\n\treturn fold <= getLeftOffset(element) - threshold;\r\n};\r\n\r\nconst isAboveViewport = function(element, container, threshold) {\r\n\tconst fold =\r\n\t\tcontainer === window ? window.pageYOffset : getTopOffset(container);\r\n\treturn fold >= getTopOffset(element) + threshold + element.offsetHeight;\r\n};\r\n\r\nconst isAtLeftOfViewport = function(element, container, threshold) {\r\n\tconst fold =\r\n\t\tcontainer === window ? window.pageXOffset : getLeftOffset(container);\r\n\treturn fold >= getLeftOffset(element) + threshold + element.offsetWidth;\r\n};\r\n\r\nfunction isInsideViewport(element, container, threshold) {\r\n\treturn (\r\n\t\t!isBelowViewport(element, container, threshold) &&\r\n\t\t!isAboveViewport(element, container, threshold) &&\r\n\t\t!isAtRightOfViewport(element, container, threshold) &&\r\n\t\t!isAtLeftOfViewport(element, container, threshold)\r\n\t);\r\n}\n\n/* Creates instance and notifies it through the window element */\r\nconst createInstance = function(classObj, options) {\r\n\tvar event;\r\n\tlet eventString = \"LazyLoad::Initialized\";\r\n\tlet instance = new classObj(options);\r\n\ttry {\r\n\t\t// Works in modern browsers\r\n\t\tevent = new CustomEvent(eventString, { detail: { instance } });\r\n\t} catch (err) {\r\n\t\t// Works in Internet Explorer (all versions)\r\n\t\tevent = document.createEvent(\"CustomEvent\");\r\n\t\tevent.initCustomEvent(eventString, false, false, { instance });\r\n\t}\r\n\twindow.dispatchEvent(event);\r\n};\r\n\r\n/* Auto initialization of one or more instances of lazyload, depending on the \r\n    options passed in (plain object or an array) */\r\nfunction autoInitialize(classObj, options) {\r\n\tif (!options) {\r\n\t\treturn;\r\n\t}\r\n\tif (!options.length) {\r\n\t\t// Plain object\r\n\t\tcreateInstance(classObj, options);\r\n\t} else {\r\n\t\t// Array of objects\r\n\t\tfor (let i = 0, optionsItem; (optionsItem = options[i]); i += 1) {\r\n\t\t\tcreateInstance(classObj, optionsItem);\r\n\t\t}\r\n\t}\r\n}\n\nconst dataPrefix = \"data-\";\r\nconst processedDataName = \"was-processed\";\r\nconst processedDataValue = \"true\";\r\n\r\nconst getData = (element, attribute) => {\r\n\treturn element.getAttribute(dataPrefix + attribute);\r\n};\r\n\r\nconst setData = (element, attribute, value) => {\r\n\treturn element.setAttribute(dataPrefix + attribute, value);\r\n};\r\n\r\nconst setWasProcessed = element =>\r\n\tsetData(element, processedDataName, processedDataValue);\r\n\r\nconst getWasProcessed = element =>\r\n\tgetData(element, processedDataName) === processedDataValue;\n\nconst replaceExtToWebp = (value, condition) =>\n\tcondition ? value.replace(/\\.(jpe?g|png)/gi, \".webp\") : value;\n\nconst detectWebp = () => {\n\tvar webpString = \"image/webp\";\n\tvar canvas = document.createElement(\"canvas\");\n\n\tif (canvas.getContext && canvas.getContext(\"2d\")) {\n\t\treturn canvas.toDataURL(webpString).indexOf(`data:${webpString}`) === 0;\n\t}\n\n\treturn false;\n};\n\nconst runningOnBrowser = typeof window !== \"undefined\";\r\n\r\nconst isBot =\r\n\t(runningOnBrowser && !(\"onscroll\" in window)) ||\r\n\t/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent);\r\nconst supportsClassList =\r\n\trunningOnBrowser && \"classList\" in document.createElement(\"p\");\r\n\r\nconst supportsWebp = runningOnBrowser && detectWebp();\n\nconst setSourcesInChildren = function(\r\n\tparentTag,\r\n\tattrName,\r\n\tdataAttrName,\r\n\ttoWebpFlag\r\n) {\r\n\tfor (let i = 0, childTag; (childTag = parentTag.children[i]); i += 1) {\r\n\t\tif (childTag.tagName === \"SOURCE\") {\r\n\t\t\tlet attrValue = getData(childTag, dataAttrName);\r\n\t\t\tsetAttributeIfValue(childTag, attrName, attrValue, toWebpFlag);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst setAttributeIfValue = function(\r\n\telement,\r\n\tattrName,\r\n\tvalue,\r\n\ttoWebpFlag\r\n) {\r\n\tif (!value) {\r\n\t\treturn;\r\n\t}\r\n\telement.setAttribute(attrName, replaceExtToWebp(value, toWebpFlag));\r\n};\r\n\r\nconst setSourcesImg = (element, settings) => {\r\n\tconst toWebpFlag = supportsWebp && settings.to_webp;\r\n\tconst srcsetDataName = settings.data_srcset;\r\n\tconst parent = element.parentNode;\r\n\r\n\tif (parent && parent.tagName === \"PICTURE\") {\r\n\t\tsetSourcesInChildren(parent, \"srcset\", srcsetDataName, toWebpFlag);\r\n\t}\r\n\tconst sizesDataValue = getData(element, settings.data_sizes);\r\n\tsetAttributeIfValue(element, \"sizes\", sizesDataValue);\r\n\tconst srcsetDataValue = getData(element, srcsetDataName);\r\n\tsetAttributeIfValue(element, \"srcset\", srcsetDataValue, toWebpFlag);\r\n\tconst srcDataValue = getData(element, settings.data_src);\r\n\tsetAttributeIfValue(element, \"src\", srcDataValue, toWebpFlag);\r\n};\r\n\r\nconst setSourcesIframe = (element, settings) => {\r\n\tconst srcDataValue = getData(element, settings.data_src);\r\n\r\n\tsetAttributeIfValue(element, \"src\", srcDataValue);\r\n};\r\n\r\nconst setSourcesVideo = (element, settings) => {\r\n\tconst srcDataName = settings.data_src;\r\n\tconst srcDataValue = getData(element, srcDataName);\r\n\r\n\tsetSourcesInChildren(element, \"src\", srcDataName);\r\n\tsetAttributeIfValue(element, \"src\", srcDataValue);\r\n};\r\n\r\nconst setSourcesBgImage = (element, settings) => {\r\n\tconst toWebpFlag = supportsWebp && settings.to_webp;\r\n\tconst srcDataValue = getData(element, settings.data_src);\r\n\r\n\tif (srcDataValue) {\r\n\t\tlet setValue = replaceExtToWebp(srcDataValue, toWebpFlag);\r\n\t\telement.style.backgroundImage = `url(\"${setValue}\")`;\r\n\t}\r\n};\r\n\r\nconst setSourcesFunctions = {\r\n\tIMG: setSourcesImg,\r\n\tIFRAME: setSourcesIframe,\r\n\tVIDEO: setSourcesVideo\r\n};\r\n\r\nconst setSources = (element, settings) => {\r\n\tconst tagName = element.tagName;\r\n\tconst setSourcesFunction = setSourcesFunctions[tagName];\r\n\tif (setSourcesFunction) {\r\n\t\tsetSourcesFunction(element, settings);\r\n\t\treturn;\r\n\t}\r\n\tsetSourcesBgImage(element, settings);\r\n};\n\nconst addClass = (element, className) => {\r\n\tif (supportsClassList) {\r\n\t\telement.classList.add(className);\r\n\t\treturn;\r\n\t}\r\n\telement.className += (element.className ? \" \" : \"\") + className;\r\n};\r\n\r\nconst removeClass = (element, className) => {\r\n\tif (supportsClassList) {\r\n\t\telement.classList.remove(className);\r\n\t\treturn;\r\n\t}\r\n\telement.className = element.className.\r\n\t\treplace(new RegExp(\"(^|\\\\s+)\" + className + \"(\\\\s+|$)\"), \" \").\r\n\t\treplace(/^\\s+/, \"\").\r\n\t\treplace(/\\s+$/, \"\");\r\n};\n\n/*\r\n * Constructor\r\n */\r\n\r\nconst LazyLoad = function(instanceSettings) {\r\n\tthis._settings = Object.assign({}, getDefaultSettings(), instanceSettings);\r\n\tthis._queryOriginNode =\r\n\t\tthis._settings.container === window\r\n\t\t\t? document\r\n\t\t\t: this._settings.container;\r\n\r\n\tthis._previousLoopTime = 0;\r\n\tthis._loopTimeout = null;\r\n\tthis._boundHandleScroll = this.handleScroll.bind(this);\r\n\r\n\tthis._isFirstLoop = true;\r\n\twindow.addEventListener(\"resize\", this._boundHandleScroll);\r\n\tthis.update();\r\n};\r\n\r\nLazyLoad.prototype = {\r\n\t_reveal: function(element, force) {\r\n\t\tif (!force && getWasProcessed(element)) {\r\n\t\t\treturn; // element has already been processed and force wasn't true\r\n\t\t}\r\n\r\n\t\tconst settings = this._settings;\r\n\r\n\t\tconst errorCallback = function() {\r\n\t\t\t/* As this method is asynchronous, it must be protected against external destroy() calls */\r\n\t\t\tif (!settings) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telement.removeEventListener(\"load\", loadCallback);\r\n\t\t\telement.removeEventListener(\"error\", errorCallback);\r\n\t\t\tremoveClass(element, settings.class_loading);\r\n\t\t\taddClass(element, settings.class_error);\r\n\t\t\tcallCallback(settings.callback_error, element);\r\n\t\t};\r\n\r\n\t\tconst loadCallback = function() {\r\n\t\t\t/* As this method is asynchronous, it must be protected against external destroy() calls */\r\n\t\t\tif (!settings) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tremoveClass(element, settings.class_loading);\r\n\t\t\taddClass(element, settings.class_loaded);\r\n\t\t\telement.removeEventListener(\"load\", loadCallback);\r\n\t\t\telement.removeEventListener(\"error\", errorCallback);\r\n\t\t\tcallCallback(settings.callback_load, element);\r\n\t\t};\r\n\r\n\t\tcallCallback(settings.callback_enter, element);\r\n\t\tif ([\"IMG\", \"IFRAME\", \"VIDEO\"].indexOf(element.tagName) > -1) {\r\n\t\t\telement.addEventListener(\"load\", loadCallback);\r\n\t\t\telement.addEventListener(\"error\", errorCallback);\r\n\t\t\taddClass(element, settings.class_loading);\r\n\t\t}\r\n\t\tsetSources(element, settings);\r\n\t\tcallCallback(settings.callback_set, element);\r\n\t},\r\n\r\n\t_loopThroughElements: function(forceDownload) {\r\n\t\tconst settings = this._settings,\r\n\t\t\telements = this._elements,\r\n\t\t\telementsLength = !elements ? 0 : elements.length;\r\n\t\tlet i,\r\n\t\t\tprocessedIndexes = [],\r\n\t\t\tfirstLoop = this._isFirstLoop;\r\n\r\n\t\tfor (i = 0; i < elementsLength; i++) {\r\n\t\t\tlet element = elements[i];\r\n\t\t\t/* If must skip_invisible and element is invisible, skip it */\r\n\t\t\tif (settings.skip_invisible && element.offsetParent === null) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\tisBot ||\r\n\t\t\t\tforceDownload ||\r\n\t\t\t\tisInsideViewport(\r\n\t\t\t\t\telement,\r\n\t\t\t\t\tsettings.container,\r\n\t\t\t\t\tsettings.threshold\r\n\t\t\t\t)\r\n\t\t\t) {\r\n\t\t\t\tif (firstLoop) {\r\n\t\t\t\t\taddClass(element, settings.class_initial);\r\n\t\t\t\t}\r\n\t\t\t\t/* Start loading the image */\r\n\t\t\t\tthis.load(element);\r\n\t\t\t\t/* Marking the element as processed. */\r\n\t\t\t\tprocessedIndexes.push(i);\r\n\t\t\t\tsetWasProcessed(element);\r\n\t\t\t}\r\n\t\t}\r\n\t\t/* Removing processed elements from this._elements. */\r\n\t\twhile (processedIndexes.length) {\r\n\t\t\telements.splice(processedIndexes.pop(), 1);\r\n\t\t\tcallCallback(settings.callback_processed, elements.length);\r\n\t\t}\r\n\t\t/* Stop listening to scroll event when 0 elements remains */\r\n\t\tif (elementsLength === 0) {\r\n\t\t\tthis._stopScrollHandler();\r\n\t\t}\r\n\t\t/* Sets isFirstLoop to false */\r\n\t\tif (firstLoop) {\r\n\t\t\tthis._isFirstLoop = false;\r\n\t\t}\r\n\t},\r\n\r\n\t_purgeElements: function() {\r\n\t\tconst elements = this._elements,\r\n\t\t\telementsLength = elements.length;\r\n\t\tlet i,\r\n\t\t\telementsToPurge = [];\r\n\r\n\t\tfor (i = 0; i < elementsLength; i++) {\r\n\t\t\tlet element = elements[i];\r\n\t\t\t/* If the element has already been processed, skip it */\r\n\t\t\tif (getWasProcessed(element)) {\r\n\t\t\t\telementsToPurge.push(i);\r\n\t\t\t}\r\n\t\t}\r\n\t\t/* Removing elements to purge from this._elements. */\r\n\t\twhile (elementsToPurge.length > 0) {\r\n\t\t\telements.splice(elementsToPurge.pop(), 1);\r\n\t\t}\r\n\t},\r\n\r\n\t_startScrollHandler: function() {\r\n\t\tif (!this._isHandlingScroll) {\r\n\t\t\tthis._isHandlingScroll = true;\r\n\t\t\tthis._settings.container.addEventListener(\r\n\t\t\t\t\"scroll\",\r\n\t\t\t\tthis._boundHandleScroll\r\n\t\t\t);\r\n\t\t}\r\n\t},\r\n\r\n\t_stopScrollHandler: function() {\r\n\t\tif (this._isHandlingScroll) {\r\n\t\t\tthis._isHandlingScroll = false;\r\n\t\t\tthis._settings.container.removeEventListener(\r\n\t\t\t\t\"scroll\",\r\n\t\t\t\tthis._boundHandleScroll\r\n\t\t\t);\r\n\t\t}\r\n\t},\r\n\r\n\thandleScroll: function() {\r\n\t\tconst throttle = this._settings.throttle;\r\n\r\n\t\tif (throttle !== 0) {\r\n\t\t\tlet now = Date.now();\r\n\t\t\tlet remainingTime = throttle - (now - this._previousLoopTime);\r\n\t\t\tif (remainingTime <= 0 || remainingTime > throttle) {\r\n\t\t\t\tif (this._loopTimeout) {\r\n\t\t\t\t\tclearTimeout(this._loopTimeout);\r\n\t\t\t\t\tthis._loopTimeout = null;\r\n\t\t\t\t}\r\n\t\t\t\tthis._previousLoopTime = now;\r\n\t\t\t\tthis._loopThroughElements();\r\n\t\t\t} else if (!this._loopTimeout) {\r\n\t\t\t\tthis._loopTimeout = setTimeout(\r\n\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\tthis._previousLoopTime = Date.now();\r\n\t\t\t\t\t\tthis._loopTimeout = null;\r\n\t\t\t\t\t\tthis._loopThroughElements();\r\n\t\t\t\t\t}.bind(this),\r\n\t\t\t\t\tremainingTime\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._loopThroughElements();\r\n\t\t}\r\n\t},\r\n\r\n\tloadAll: function() {\r\n\t\tthis._loopThroughElements(true);\r\n\t},\r\n\r\n\tupdate: function() {\r\n\t\t// Converts to array the nodeset obtained querying the DOM from _queryOriginNode with elements_selector\r\n\t\tthis._elements = Array.prototype.slice.call(\r\n\t\t\tthis._queryOriginNode.querySelectorAll(\r\n\t\t\t\tthis._settings.elements_selector\r\n\t\t\t)\r\n\t\t);\r\n\t\tthis._purgeElements();\r\n\t\tthis._loopThroughElements();\r\n\t\tthis._startScrollHandler();\r\n\t},\r\n\r\n\tdestroy: function() {\r\n\t\twindow.removeEventListener(\"resize\", this._boundHandleScroll);\r\n\t\tif (this._loopTimeout) {\r\n\t\t\tclearTimeout(this._loopTimeout);\r\n\t\t\tthis._loopTimeout = null;\r\n\t\t}\r\n\t\tthis._stopScrollHandler();\r\n\t\tthis._elements = null;\r\n\t\tthis._queryOriginNode = null;\r\n\t\tthis._settings = null;\r\n\t},\r\n\r\n\tload: function(element, force) {\r\n\t\tthis._reveal(element, force);\r\n\t}\r\n};\r\n\r\n/* Automatic instances creation if required (useful for async script loading) */\r\nif (runningOnBrowser) {\r\n\tautoInitialize(LazyLoad, window.lazyLoadOptions);\r\n}\n\nreturn LazyLoad;\n\n}());\n"]}