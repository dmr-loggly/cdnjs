"use strict";function attach(a,t,e,o){var c;e=void 0===e||e,a.socket=t,a._flushBuffer=function(){a.write(a._attachSocketBuffer),a._attachSocketBuffer=null},a._pushToBuffer=function(e){a._attachSocketBuffer?a._attachSocketBuffer+=e:(a._attachSocketBuffer=e,setTimeout(a._flushBuffer,10))},a._getMessage=function(e){var t;if("object"==typeof e.data){if(!(e.data instanceof ArrayBuffer))throw"TODO: handle Blob?";c||(c=new TextDecoder),t=c.decode(e.data)}o?a._pushToBuffer(t||e.data):a.write(t||e.data)},a._sendData=function(e){1===t.readyState&&t.send(e)},t.addEventListener("message",a._getMessage),e&&a.on("data",a._sendData),t.addEventListener("close",a.detach.bind(a,t)),t.addEventListener("error",a.detach.bind(a,t))}function detach(e,t){e.off("data",e._sendData),(t=void 0===t?e.socket:t)&&t.removeEventListener("message",e._getMessage),delete e.socket}function apply(e){e.prototype.attach=function(e,t,a){return attach(this,e,t,a)},e.prototype.detach=function(e){return detach(this,e)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.attach=attach,exports.detach=detach,exports.apply=apply;