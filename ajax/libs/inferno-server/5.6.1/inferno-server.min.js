!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("inferno"),require("stream")):"function"==typeof define&&define.amd?define(["exports","inferno","stream"],t):t((e.Inferno=e.Inferno||{},e.Inferno.Server=e.Inferno.Server||{}),e.Inferno,e.stream)}(this,function(e,P,t){"use strict";var r="a runtime error occured! Use Inferno in development environment to find the error.";function $(e){return I(e)||D(e)}function N(e){return D(e)||!1===e||B(e)||I(e)}function _(e){return"function"==typeof e}function w(e){return"string"==typeof e}function M(e){return"number"==typeof e}function D(e){return null===e}function B(e){return!0===e}function I(e){return void 0===e}function E(e){throw e||(e=r),new Error("Inferno Error: "+e)}function R(e,t){var r={};if(e)for(var n in e)r[n]=e[n];if(t)for(var o in t)r[o]=t[o];return r}"undefined"==typeof window||window.document;var u=new RegExp(/["'&<>]/);function V(e){if(!u.test(e))return e;var t,r="",n="",o=0;for(t=0;t<e.length;t++){switch(e.charCodeAt(t)){case 34:n="&quot;";break;case 39:n="&#039;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}o<t&&(r+=e.slice(o,t)),r+=n,o=t+1}return r+e.slice(o,t)}var n=/[A-Z]/g,o={};function s(e){return void 0!==o[e]?o[e]:o[e]=e.replace(n,"-$&").toLowerCase()+":"}var i=new RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),a={},c={};function A(e){return void 0!==c[e]||void 0===a[e]&&(i.test(e)?c[e]=!0:!(a[e]=!0))}var O=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]);function j(e){if(w(e))return e;var t="";for(var r in e){var n=e[r];w(n)?t+=""+s(r)+n+";":M(n)&&(t+=""+s(r)+P.getNumberStyleValue(r,n)+";")}return t}function l(e){return function e(t,r,n,o){var u=t.flags,s=t.type,i=t.props||P.EMPTY_OBJ,a=t.children;if(0<(14&u)){if(4&u){var c,l=new s(i,n);if(l.$BS=!1,_(l.getChildContext)&&(c=l.getChildContext()),c=$(c)?n:R(n,c),l.props===P.EMPTY_OBJ&&(l.props=i),l.context=n,l.$UN=!1,_(l.componentWillMount)&&(l.$BR=!0,l.componentWillMount(),l.$BR=!1),l.$PSS){var d=l.state,h=l.$PS;if(null===d)l.state=h;else for(var f in h)d[f]=h[f];l.$PSS=!1,l.$PS=null}var p=l.render(i,l.state,l.context);return N(p)?"\x3c!--!--\x3e":w(p)?V(p):M(p)?p+"":e(p,t,c,!0)}var v=s(i,n);return N(v)?"\x3c!--!--\x3e":w(v)?V(v):M(v)?v+"":e(v,t,n,!0)}if(0<(481&u)){var m,y="<"+s,F=O.has(s),g=t.className;if(w(g)?y+=' class="'+V(g)+'"':M(g)&&(y+=' class="'+g+'"'),!D(i)){for(var S in i){var x=i[S];switch(S){case"dangerouslySetInnerHTML":m=x.__html;break;case"style":$(i.style)||(y+=' style="'+j(i.style)+'"');break;case"children":case"className":break;case"defaultValue":i.value||(y+=' value="'+(w(x)?V(x):x)+'"');break;case"defaultChecked":i.checked||(y+=' checked="'+x+'"');break;default:A(S)&&(w(x)?y+=" "+S+'="'+V(x)+'"':M(x)?y+=" "+S+'="'+x+'"':B(x)&&(y+=" "+S))}}"option"===s&&void 0!==i.value&&i.value===r.props.value&&(y+=" selected")}if(F)y+=">";else{y+=">";var T=t.childFlags;if(2&T)y+=e(a,t,n,!0);else if(12&T)for(var b=0,k=a.length;b<k;b++)y+=e(a[b],t,n,0===b);else m&&(y+=m);F||(y+="</"+s+">")}if(String(s).match(/[\s\n\/='"\0<>]/))throw y;return y}return 0<(16&u)?(o?"":"\x3c!----\x3e")+(""===a?" ":V(a)):(E(),"")}(e,{},{},!0)}var d=function(t){function e(e){t.call(this),this.collector=[Infinity],this.promises=[],this.pushQueue=this.pushQueue.bind(this),e&&this.renderVNodeToQueue(e,null,!1,null)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._read=function(){setTimeout(this.pushQueue,0)},e.prototype.addToQueue=function(e,t){if($(t))"string"==typeof e&&this.collector.length-1==0?this.push(e):"string"==typeof e&&"string"==typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"==typeof this.promises[t][r]&&"string"==typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},e.prototype.pushQueue=function(){var e=this.collector[0];if("string"==typeof e)this.push(e),this.collector.shift();else if(e&&("object"==typeof e||_(e))&&_(e.then)){var r=this;e.then(function(e){var t;(t=r.collector).splice.apply(t,[0,1].concat(r.promises[e])),r.promises[e]=null,setTimeout(r.pushQueue,0)}),this.collector[0]=null}else Infinity===e&&this.emit("end")},e.prototype.renderVNodeToQueue=function(e,t,r,n){var o=this,u=e.flags,s=e.type,i=e.props||P.EMPTY_OBJ,a=e.children;if(0<(14&u))if(4&u){var c,l=new s(i,t);if(l.$BS=!1,I(l.getChildContext)||(c=l.getChildContext()),$(c)||(t=R(t,c)),l.props===P.EMPTY_OBJ&&(l.props=i),l.context=t,l.$UN=!1,_(l.componentWillMount)){if(l.$BR=!0,l.componentWillMount(),l.$PSS){var d=l.state,h=l.$PS;if(null===d)l.state=h;else for(var f in h)d[f]=h[f];l.$PSS=!1,l.$PS=null}l.$BR=!1}if(_(l.getInitialProps)){var p=l.getInitialProps(l.props,l.context);if(p){if(Promise.resolve(p)===p){var v=this.promises.push([])-1;return void this.addToQueue(p.then(function(e){l.$PSS=!1,"object"==typeof e&&(l.props=R(l.props,e));var t=l.render(l.props,l.state,l.context);return N(t)?o.addToQueue("\x3c!--!--\x3e",v):w(t)?o.addToQueue(V(t),v):M(t)?o.addToQueue(t+"",v):o.renderVNodeToQueue(t,l.context,!0,v),setTimeout(o.pushQueue,0),v}),n)}l.props=R(l.props,p)}}var m=l.render(l.props,l.state,l.context);l.$PSS=!1,N(m)?this.addToQueue("\x3c!--!--\x3e",n):w(m)?this.addToQueue(V(m),n):M(m)?this.addToQueue(m+"",n):this.renderVNodeToQueue(m,t,!0,n)}else{var y=s(i,t);N(y)?this.addToQueue("\x3c!--!--\x3e",n):w(y)?this.addToQueue(V(y),n):M(y)?this.addToQueue(y+"",n):this.renderVNodeToQueue(y,t,!0,n)}else if(0<(481&u)){var F,g="<"+s,S=O.has(s),x=e.className;if(w(x)?g+=' class="'+V(x)+'"':M(x)&&(g+=' class="'+x+'"'),!D(i))for(var T in i){var b=i[T];switch(T){case"dangerouslySetInnerHTML":F=b.__html;break;case"style":$(i.style)||(g+=' style="'+j(i.style)+'"');break;case"children":case"className":break;case"defaultValue":i.value||(g+=' value="'+(w(b)?V(b):b)+'"');break;case"defaultChecked":i.checked||(g+=' checked="'+b+'"');break;default:A(T)&&(w(b)?g+=" "+T+'="'+V(b)+'"':M(b)?g+=" "+T+'="'+b+'"':B(b)&&(g+=" "+T))}}if(g+=">",String(s).match(/[\s\n\/='"\0<>]/))throw g;if(S)this.addToQueue(g,n);else{var k=e.childFlags;if(2&k)return this.addToQueue(g,n),this.renderVNodeToQueue(a,t,!0,n),void this.addToQueue("</"+s+">",n);if(12&k){this.addToQueue(g,n),g="";for(var Q=0,C=a.length;Q<C;Q++)o.renderVNodeToQueue(a[Q],t,0===Q,n)}if(F)return void this.addToQueue(g+F+"</"+s+">",n);S||this.addToQueue(g+"</"+s+">",n)}}else 0<(16&u)?this.addToQueue((r?"":"\x3c!----\x3e")+(""===a?" ":V(a)),n):E()},e}(t.Readable);function h(e){return new d(e)}var f=Promise.resolve(),p=function(t){function e(e){t.call(this),this.started=!1,this.initNode=e}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._read=function(){var t=this;this.started||(this.started=!0,f.then(function(){return t.renderNode(t.initNode,null,!1)}).then(function(){t.push(null)}).catch(function(e){t.emit("error",e)}))},e.prototype.renderNode=function(e,t,r){var n=e.flags;return 0<(14&n)?this.renderComponent(e,t,4&n):0<(481&n)?this.renderElement(e,t):this.renderText(e,r)},e.prototype.renderComponent=function(e,o,t){var u=this,r=e.type,n=e.props;if(!t){var s=r(n,o);return N(s)?this.push("\x3c!--!--\x3e"):w(s)?this.push(V(s)):M(s)?this.push(s+""):this.renderNode(s,o,!1)}var i,a=new r(n,o);return a.$BS=!1,_(a.getChildContext)&&(i=a.getChildContext()),$(i)||(o=R(o,i)),a.context=o,a.$BR=!0,Promise.resolve(a.componentWillMount&&a.componentWillMount()).then(function(){if(a.$PSS){var e=a.state,t=a.$PS;if(null===e)a.state=t;else for(var r in t)e[r]=t[r];a.$PSS=!1,a.$PS=null}a.$BR=!1;var n=a.render(a.props,a.state,a.context);return a.$PSS=!1,N(n)?u.push("\x3c!--!--\x3e"):w(n)?u.push(V(n)):M(n)?u.push(n+""):u.renderNode(n,o,!1)})},e.prototype.renderChildren=function(e,r,t){var n=this;return 2&t?this.renderNode(e,r,!1):12&t?e.reduce(function(e,t){return e.then(function(e){return 0<(16&t.flags)&&e&&n.push("\x3c!----\x3e"),Promise.resolve(n.renderNode(t,r,!1)).then(function(){return!!(16&t.flags)})})},Promise.resolve(!1)):void 0},e.prototype.renderText=function(e,t){this.push((t?"\x3c!----\x3e":"")+(""===e.children?" ":V(e.children)))},e.prototype.renderElement=function(e,t){var r,n=this,o=e.type,u=e.props,s="<"+o,i=O.has(o),a=e.className;if(w(a)?s+=' class="'+V(a)+'"':M(a)&&(s+=' class="'+a+'"'),!D(u))for(var c in u){var l=u[c];switch(c){case"dangerouslySetInnerHTML":r=l.__html;break;case"style":$(u.style)||(s+=' style="'+j(u.style)+'"');break;case"children":case"className":break;case"defaultValue":u.value||(s+=' value="'+(w(l)?V(l):l)+'"');break;case"defaultChecked":u.checked||(s+=' checked="'+l+'"');break;default:if(A(c)){w(l)?s+=" "+c+'="'+V(l)+'"':M(l)?s+=" "+c+'="'+l+'"':B(l)&&(s+=" "+c);break}}}if(s+=">",this.push(s),String(o).match(/[\s\n\/='"\0<>]/))throw s;if(!i){if(r)return this.push(r),void this.push("</"+o+">");var d=e.childFlags;if(!(1&d))return Promise.resolve(this.renderChildren(e.children,t,d)).then(function(){n.push("</"+o+">")});this.push("</"+o+">")}},e}(t.Readable);function v(e){return new p(e)}e.RenderQueueStream=d,e.RenderStream=p,e.renderToStaticMarkup=l,e.renderToString=l,e.streamAsStaticMarkup=v,e.streamAsString=v,e.streamQueueAsStaticMarkup=h,e.streamQueueAsString=h,Object.defineProperty(e,"__esModule",{value:!0})});
